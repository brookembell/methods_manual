<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Cleaning Code for Environment Data | LASTING Four-Pillar Model Methodology</title>
  <meta name="description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Cleaning Code for Environment Data | LASTING Four-Pillar Model Methodology" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Cleaning Code for Environment Data | LASTING Four-Pillar Model Methodology" />
  
  <meta name="twitter:description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  

<meta name="author" content="Brooke M. Bell" />


<meta name="date" content="2025-05-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cleaning-code-for-health-data.html"/>
<link rel="next" href="cleaning-code-for-cost-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">LASTING Methods Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#github-repository"><i class="fa fa-check"></i>Github Repository</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data-inputs"><i class="fa fa-check"></i>Data Inputs</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code"><i class="fa fa-check"></i>Code</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#model-output"><i class="fa fa-check"></i>Model Output</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html"><i class="fa fa-check"></i><b>1</b> Summary of Data Inputs</a>
<ul>
<li class="chapter" data-level="1.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#diet-inputs"><i class="fa fa-check"></i><b>1.2</b> Diet Inputs</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#counterfactual-intake"><i class="fa fa-check"></i><b>1.2.1</b> Counterfactual Intake</a></li>
<li class="chapter" data-level="1.2.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#dietary-intake"><i class="fa fa-check"></i><b>1.2.2</b> Dietary Intake</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#economic-inputs"><i class="fa fa-check"></i><b>1.3</b> Economic Inputs</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#food-prices"><i class="fa fa-check"></i><b>1.3.1</b> Food Prices</a></li>
<li class="chapter" data-level="1.3.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#food-at-home-fah-vs.-food-away-from-home-fafh-ratio"><i class="fa fa-check"></i><b>1.3.2</b> Food-At-Home (FAH) vs. Food-Away-From-Home (FAFH) Ratio</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#environment-inputs"><i class="fa fa-check"></i><b>1.4</b> Environment Inputs</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#greenhouse-gas-emissions-ghg-and-cumulative-energy-demand-ced-impact-factors"><i class="fa fa-check"></i><b>1.4.1</b> Greenhouse Gas Emissions (GHG) and Cumulative Energy Demand (CED) Impact Factors</a></li>
<li class="chapter" data-level="1.4.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#water-scarcity-ws-and-bluewater-use-bwu-impact-factors"><i class="fa fa-check"></i><b>1.4.2</b> Water Scarcity (WS) and Bluewater Use (BWU) Impact Factors</a></li>
<li class="chapter" data-level="1.4.3" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#land-use-impact-factors"><i class="fa fa-check"></i><b>1.4.3</b> Land Use Impact Factors</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#health-inputs"><i class="fa fa-check"></i><b>1.5</b> Health Inputs</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#cancer-incidence"><i class="fa fa-check"></i><b>1.5.1</b> Cancer Incidence</a></li>
<li class="chapter" data-level="1.5.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#cardiometabolic-disease-cmd-mortality"><i class="fa fa-check"></i><b>1.5.2</b> Cardiometabolic Disease (CMD) Mortality</a></li>
<li class="chapter" data-level="1.5.3" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#effect-sizes-for-diet-and-body-mass-index-bmi"><i class="fa fa-check"></i><b>1.5.3</b> Effect Sizes for Diet and Body Mass Index (BMI)</a></li>
<li class="chapter" data-level="1.5.4" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#effect-sizes-for-diet-and-systolic-blood-pressure-sbp"><i class="fa fa-check"></i><b>1.5.4</b> Effect Sizes for Diet and Systolic Blood Pressure (SBP)</a></li>
<li class="chapter" data-level="1.5.5" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#log-relative-risks-logrr-for-diet-cancer"><i class="fa fa-check"></i><b>1.5.5</b> Log Relative Risks (LogRR) for Diet-Cancer</a></li>
<li class="chapter" data-level="1.5.6" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#overweight-prevalence"><i class="fa fa-check"></i><b>1.5.6</b> Overweight Prevalence</a></li>
<li class="chapter" data-level="1.5.7" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#relative-risks-rr-for-bmi-and-cancer"><i class="fa fa-check"></i><b>1.5.7</b> Relative Risks (RR) for BMI and Cancer</a></li>
<li class="chapter" data-level="1.5.8" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#relative-risks-rr-for-bmi-and-cmd"><i class="fa fa-check"></i><b>1.5.8</b> Relative Risks (RR) for BMI and CMD</a></li>
<li class="chapter" data-level="1.5.9" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#relative-risks-rr-for-sbp-and-cmd"><i class="fa fa-check"></i><b>1.5.9</b> Relative Risks (RR) for SBP and CMD</a></li>
<li class="chapter" data-level="1.5.10" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#systolic-blood-pressure"><i class="fa fa-check"></i><b>1.5.10</b> Systolic Blood Pressure</a></li>
<li class="chapter" data-level="1.5.11" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#tmred"><i class="fa fa-check"></i><b>1.5.11</b> TMRED</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#social-inputs"><i class="fa fa-check"></i><b>1.6</b> Social Inputs</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#forced-labor-risk"><i class="fa fa-check"></i><b>1.6.1</b> Forced Labor Risk</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#other-inputs"><i class="fa fa-check"></i><b>1.7</b> Other Inputs</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#mapping-from-food-group-to-fcid-code"><i class="fa fa-check"></i><b>1.7.1</b> Mapping from Food Group to FCID Code</a></li>
<li class="chapter" data-level="1.7.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#mapping-from-food-group-to-fndds-code"><i class="fa fa-check"></i><b>1.7.2</b> Mapping from Food Group to FNDDS Code</a></li>
<li class="chapter" data-level="1.7.3" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#inedible-and-wasted-food-proportions"><i class="fa fa-check"></i><b>1.7.3</b> Inedible and Wasted Food Proportions</a></li>
<li class="chapter" data-level="1.7.4" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#labels"><i class="fa fa-check"></i><b>1.7.4</b> Labels</a></li>
<li class="chapter" data-level="1.7.5" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#weight-conversion-units"><i class="fa fa-check"></i><b>1.7.5</b> Weight Conversion Units</a></li>
<li class="chapter" data-level="1.7.6" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#u.s.-population-size"><i class="fa fa-check"></i><b>1.7.6</b> U.S. Population Size</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html"><i class="fa fa-check"></i><b>2</b> Cleaning Code for NHANES Diet Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#processed-and-organ-meat"><i class="fa fa-check"></i><b>2.1</b> Processed and Organ Meat</a></li>
<li class="chapter" data-level="2.2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#clean-raw-nhanes-data"><i class="fa fa-check"></i><b>2.2</b> Clean Raw NHANES Data</a></li>
<li class="chapter" data-level="2.3" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#create-sugar-sweetened-beverage-ssb-variables"><i class="fa fa-check"></i><b>2.3</b> Create Sugar Sweetened Beverage (SSB) Variables</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#import-and-merge-data-inputs"><i class="fa fa-check"></i><b>2.3.1</b> Import and Merge Data Inputs</a></li>
<li class="chapter" data-level="2.3.2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#create-ssb-indicator-variable"><i class="fa fa-check"></i><b>2.3.2</b> Create SSB Indicator Variable</a></li>
<li class="chapter" data-level="2.3.3" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#calculate-ssb-intake"><i class="fa fa-check"></i><b>2.3.3</b> Calculate SSB Intake</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#energy-adjustement"><i class="fa fa-check"></i><b>2.4</b> Energy Adjustement</a></li>
<li class="chapter" data-level="2.5" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#calculating-standard-deviations-using-sas-macros"><i class="fa fa-check"></i><b>2.5</b> Calculating Standard Deviations Using SAS Macros</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#prepare-nhanes-data-for-sas-macros"><i class="fa fa-check"></i><b>2.5.1</b> Prepare NHANES Data for SAS Macros</a></li>
<li class="chapter" data-level="2.5.2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#fill-out-macro-template"><i class="fa fa-check"></i><b>2.5.2</b> Fill Out Macro Template</a></li>
<li class="chapter" data-level="2.5.3" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#log-in-to-tufts-hpc"><i class="fa fa-check"></i><b>2.5.3</b> Log In to Tufts HPC</a></li>
<li class="chapter" data-level="2.5.4" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#run-sas-macro"><i class="fa fa-check"></i><b>2.5.4</b> Run SAS Macro</a></li>
<li class="chapter" data-level="2.5.5" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#export-output-to-box"><i class="fa fa-check"></i><b>2.5.5</b> Export Output to Box</a></li>
<li class="chapter" data-level="2.5.6" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#clean-output-from-cluster"><i class="fa fa-check"></i><b>2.5.6</b> Clean Output from Cluster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html"><i class="fa fa-check"></i><b>3</b> Cleaning Code for Health Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#create-final-data-inputs"><i class="fa fa-check"></i><b>3.1</b> Create Final Data Inputs</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#other-data-inputs"><i class="fa fa-check"></i><b>3.1.1</b> Other Data Inputs</a></li>
<li class="chapter" data-level="3.1.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#health-data-inputs"><i class="fa fa-check"></i><b>3.1.2</b> Health Data Inputs</a></li>
<li class="chapter" data-level="3.1.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#diet-data-inputs"><i class="fa fa-check"></i><b>3.1.3</b> Diet Data Inputs</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#clean-health-datasets"><i class="fa fa-check"></i><b>3.2</b> Clean Health Datasets</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#cancer-incidence-and-2-cvd-mortality"><i class="fa fa-check"></i><b>3.2.1</b> (1) Cancer incidence and (2) CVD mortality</a></li>
<li class="chapter" data-level="3.2.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#effect-sizes-for-diet-and-bmi-and-4-diet-and-sbp"><i class="fa fa-check"></i><b>3.2.2</b> (3) Effect sizes for diet and BMI and (4) diet and SBP</a></li>
<li class="chapter" data-level="3.2.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#rrs-for-bmi-and-cancer-and-6-for-bmi-and-cvd"><i class="fa fa-check"></i><b>3.2.3</b> (5) RRs for BMI and cancer and (6) for BMI and CVD</a></li>
<li class="chapter" data-level="3.2.4" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#logrrs-for-diet-and-cancer-and-8-for-diet-and-cvd"><i class="fa fa-check"></i><b>3.2.4</b> (7) LogRRs for diet and cancer and (8) for diet and CVD</a></li>
<li class="chapter" data-level="3.2.5" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#rrs-for-sbp-and-cvd"><i class="fa fa-check"></i><b>3.2.5</b> (9) RRs for SBP and CVD</a></li>
<li class="chapter" data-level="3.2.6" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#current-intake-nhanes-11-tmred-12-counterfactual-and-13-other-health-data"><i class="fa fa-check"></i><b>3.2.6</b> (10) Current intake (NHANES), (11) TMRED, (12) Counterfactual, and (13) Other health data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#restructure-data"><i class="fa fa-check"></i><b>3.3</b> Restructure data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning Code for Environment Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#clean-and-restructure-intermediary-datasets"><i class="fa fa-check"></i><b>4.1</b> Clean and Restructure Intermediary Datasets</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#import-and-merge-data-inputs-1"><i class="fa fa-check"></i><b>4.1.1</b> Import and Merge Data Inputs</a></li>
<li class="chapter" data-level="4.1.2" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#calculate-average-environmental-and-social-impact-per-fcid-code"><i class="fa fa-check"></i><b>4.1.2</b> Calculate Average Environmental and Social Impact, Per FCID Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html"><i class="fa fa-check"></i><b>5</b> Cleaning Code for Cost Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#clean-and-restructure-intermediary-datasets-1"><i class="fa fa-check"></i><b>5.1</b> Clean and Restructure Intermediary Datasets</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#import-and-merge-data-inputs-2"><i class="fa fa-check"></i><b>5.1.1</b> Import and Merge Data Inputs</a></li>
<li class="chapter" data-level="5.1.2" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#calculate-average-food-cost-per-fndds-food-code"><i class="fa fa-check"></i><b>5.1.2</b> Calculate Average Food Cost, Per FNDDS Food Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html"><i class="fa fa-check"></i><b>6</b> Calculate Cost, Environment, and Social Impact Factors</a>
<ul>
<li class="chapter" data-level="6.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#prepare-data"><i class="fa fa-check"></i><b>6.1</b> Prepare Data</a></li>
<li class="chapter" data-level="6.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors"><i class="fa fa-check"></i><b>6.2</b> Cost Impact Factors</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors-by-food-by-subgroup"><i class="fa fa-check"></i><b>6.2.1</b> Cost Impact Factors, by Food, by Subgroup</a></li>
<li class="chapter" data-level="6.2.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors-per-100-grams-and-per-1-dga-serving"><i class="fa fa-check"></i><b>6.2.2</b> Cost Impact Factors, Per 100 Grams and Per 1 DGA Serving</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmental-social-impact-factors"><i class="fa fa-check"></i><b>6.3</b> Environmental &amp; Social Impact Factors</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmental-social-impact-factors-by-food-by-subgroup"><i class="fa fa-check"></i><b>6.3.1</b> Environmental &amp; Social Impact Factors, by Food, by Subgroup</a></li>
<li class="chapter" data-level="6.3.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmentsocial-impact-factors-per-100-grams-and-per-1-dga-serving"><i class="fa fa-check"></i><b>6.3.2</b> Environment/Social Impact Factors, Per 100 Grams and Per 1 DGA Serving</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#finalize-impact-factors"><i class="fa fa-check"></i><b>6.4</b> Finalize Impact Factors</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#merge-cost-environment-and-social-impact-factors"><i class="fa fa-check"></i><b>6.4.1</b> Merge Cost, Environment, and Social Impact Factors</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#calculate-inedible-and-wasted-proportions"><i class="fa fa-check"></i><b>6.5</b> Calculate Inedible and Wasted Proportions</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmentsocial"><i class="fa fa-check"></i><b>6.5.1</b> Environment/Social</a></li>
<li class="chapter" data-level="6.5.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost"><i class="fa fa-check"></i><b>6.5.2</b> Cost</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#export-data"><i class="fa fa-check"></i><b>6.6</b> Export Data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="finalize-model-data-inputs.html"><a href="finalize-model-data-inputs.html"><i class="fa fa-check"></i><b>7</b> Finalize Model Data Inputs</a>
<ul>
<li class="chapter" data-level="7.1" data-path="finalize-model-data-inputs.html"><a href="finalize-model-data-inputs.html#clean-and-merge-all-inputs"><i class="fa fa-check"></i><b>7.1</b> Clean and Merge All Inputs</a></li>
<li class="chapter" data-level="7.2" data-path="finalize-model-data-inputs.html"><a href="finalize-model-data-inputs.html#copy-model-inputs-to-github"><i class="fa fa-check"></i><b>7.2</b> Copy Model Inputs to GitHub</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">LASTING Four-Pillar Model Methodology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-code-for-environment-data" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Cleaning Code for Environment Data<a href="cleaning-code-for-environment-data.html#cleaning-code-for-environment-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter walks you through all of the R code used to clean the raw <strong>ENVIRONMENT</strong>-related data inputs. The resulting cleaned dataset is then used to calculate the environment impact factors (see <strong>Chapter XXX</strong>).</p>
<div id="clean-and-restructure-intermediary-datasets" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Clean and Restructure Intermediary Datasets<a href="cleaning-code-for-environment-data.html#clean-and-restructure-intermediary-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This script imports all of raw cost-related data inputs, and then cleans and merges them so that the cost impact factors can later be calculated.</p>
<p>Note that you must first open the ‘methods_manual’ R project before running this script or else it will not work.</p>
<p>First, let’s set up our environment.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="cleaning-code-for-environment-data.html#cb104-1" tabindex="-1"></a><span class="co"># check working directory</span></span>
<span id="cb104-2"><a href="cleaning-code-for-environment-data.html#cb104-2" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/Users/bmb73/Library/CloudStorage/Box-Box/lasting_aim_3/model development/methods_manual&quot;</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="cleaning-code-for-environment-data.html#cb106-1" tabindex="-1"></a><span class="co"># SET UP -----</span></span>
<span id="cb106-2"><a href="cleaning-code-for-environment-data.html#cb106-2" tabindex="-1"></a></span>
<span id="cb106-3"><a href="cleaning-code-for-environment-data.html#cb106-3" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb106-4"><a href="cleaning-code-for-environment-data.html#cb106-4" tabindex="-1"></a></span>
<span id="cb106-5"><a href="cleaning-code-for-environment-data.html#cb106-5" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span>
<span id="cb106-6"><a href="cleaning-code-for-environment-data.html#cb106-6" tabindex="-1"></a></span>
<span id="cb106-7"><a href="cleaning-code-for-environment-data.html#cb106-7" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb106-8"><a href="cleaning-code-for-environment-data.html#cb106-8" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb106-9"><a href="cleaning-code-for-environment-data.html#cb106-9" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb106-10"><a href="cleaning-code-for-environment-data.html#cb106-10" tabindex="-1"></a></span>
<span id="cb106-11"><a href="cleaning-code-for-environment-data.html#cb106-11" tabindex="-1"></a>my_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span></code></pre></div>
<div id="import-and-merge-data-inputs-1" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Import and Merge Data Inputs<a href="cleaning-code-for-environment-data.html#import-and-merge-data-inputs-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="nhanes-diet-intake" class="section level4 unnumbered hasAnchor">
<h4>NHANES Diet Intake<a href="cleaning-code-for-environment-data.html#nhanes-diet-intake" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>The following code is the same code used in Section XXX</strong>.</p>
<p>First, read in the NHANES food-level datasets. The data were split into “day 1” and “day 2” earlier, and here we are going to merge them into “both days”. There also are different datasets containing just sugar sweetened beverage (SSB) data, so we have to import those in separately, and then merge with the rest of the day1/day2 diet datasets.</p>
<p>Import all of the “day 1” datasets first.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="cleaning-code-for-environment-data.html#cb107-1" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb107-2"><a href="cleaning-code-for-environment-data.html#cb107-2" tabindex="-1"></a>day1 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day1_clean.rds&quot;</span>)</span>
<span id="cb107-3"><a href="cleaning-code-for-environment-data.html#cb107-3" tabindex="-1"></a></span>
<span id="cb107-4"><a href="cleaning-code-for-environment-data.html#cb107-4" tabindex="-1"></a><span class="co"># only select needed variables</span></span>
<span id="cb107-5"><a href="cleaning-code-for-environment-data.html#cb107-5" tabindex="-1"></a>day1_sub <span class="ot">&lt;-</span> day1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(SEQN, DRDINT, DR1DRSTZ, DR1ILINE, DR1IFDCD, </span>
<span id="cb107-6"><a href="cleaning-code-for-environment-data.html#cb107-6" tabindex="-1"></a>                            DR1IGRMS, DESCRIPTION, foodsource, nhanes_cycle, dayrec, added_sugar) <span class="sc">%&gt;%</span> </span>
<span id="cb107-7"><a href="cleaning-code-for-environment-data.html#cb107-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">seqn =</span> SEQN,</span>
<span id="cb107-8"><a href="cleaning-code-for-environment-data.html#cb107-8" tabindex="-1"></a>         <span class="at">line =</span> DR1ILINE,</span>
<span id="cb107-9"><a href="cleaning-code-for-environment-data.html#cb107-9" tabindex="-1"></a>         <span class="at">foodcode =</span> DR1IFDCD,</span>
<span id="cb107-10"><a href="cleaning-code-for-environment-data.html#cb107-10" tabindex="-1"></a>         <span class="at">grams =</span> DR1IGRMS,</span>
<span id="cb107-11"><a href="cleaning-code-for-environment-data.html#cb107-11" tabindex="-1"></a>         <span class="at">description =</span> DESCRIPTION,</span>
<span id="cb107-12"><a href="cleaning-code-for-environment-data.html#cb107-12" tabindex="-1"></a>         <span class="at">daysintake =</span> DRDINT,</span>
<span id="cb107-13"><a href="cleaning-code-for-environment-data.html#cb107-13" tabindex="-1"></a>         <span class="at">reliable =</span> DR1DRSTZ)</span>
<span id="cb107-14"><a href="cleaning-code-for-environment-data.html#cb107-14" tabindex="-1"></a></span>
<span id="cb107-15"><a href="cleaning-code-for-environment-data.html#cb107-15" tabindex="-1"></a><span class="co"># ssb</span></span>
<span id="cb107-16"><a href="cleaning-code-for-environment-data.html#cb107-16" tabindex="-1"></a>ssb_1 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day1_ssb.rds&quot;</span>)</span>
<span id="cb107-17"><a href="cleaning-code-for-environment-data.html#cb107-17" tabindex="-1"></a></span>
<span id="cb107-18"><a href="cleaning-code-for-environment-data.html#cb107-18" tabindex="-1"></a><span class="co"># merge food and ssb</span></span>
<span id="cb107-19"><a href="cleaning-code-for-environment-data.html#cb107-19" tabindex="-1"></a>day1_sub1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(day1_sub, ssb_1, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seqn&quot;</span> <span class="ot">=</span> <span class="st">&quot;SEQN&quot;</span>,</span>
<span id="cb107-20"><a href="cleaning-code-for-environment-data.html#cb107-20" tabindex="-1"></a>                                               <span class="st">&quot;line&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1ILINE&quot;</span>,</span>
<span id="cb107-21"><a href="cleaning-code-for-environment-data.html#cb107-21" tabindex="-1"></a>                                               <span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1IFDCD&quot;</span>,</span>
<span id="cb107-22"><a href="cleaning-code-for-environment-data.html#cb107-22" tabindex="-1"></a>                                               <span class="st">&quot;description&quot;</span> <span class="ot">=</span> <span class="st">&quot;DESCRIPTION&quot;</span>,</span>
<span id="cb107-23"><a href="cleaning-code-for-environment-data.html#cb107-23" tabindex="-1"></a>                                               <span class="st">&quot;grams&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1IGRMS&quot;</span>))</span></code></pre></div>
<p>Then import all of “day 2” datasets.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="cleaning-code-for-environment-data.html#cb108-1" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb108-2"><a href="cleaning-code-for-environment-data.html#cb108-2" tabindex="-1"></a>day2 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day2_clean.rds&quot;</span>)</span>
<span id="cb108-3"><a href="cleaning-code-for-environment-data.html#cb108-3" tabindex="-1"></a></span>
<span id="cb108-4"><a href="cleaning-code-for-environment-data.html#cb108-4" tabindex="-1"></a><span class="co"># only select needed variables</span></span>
<span id="cb108-5"><a href="cleaning-code-for-environment-data.html#cb108-5" tabindex="-1"></a>day2_sub <span class="ot">&lt;-</span> day2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(SEQN, DRDINT, DR2DRSTZ, DR2ILINE, DR2IFDCD, </span>
<span id="cb108-6"><a href="cleaning-code-for-environment-data.html#cb108-6" tabindex="-1"></a>                            DR2IGRMS, DESCRIPTION, foodsource, nhanes_cycle, dayrec, added_sugar) <span class="sc">%&gt;%</span> </span>
<span id="cb108-7"><a href="cleaning-code-for-environment-data.html#cb108-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">seqn =</span> SEQN,</span>
<span id="cb108-8"><a href="cleaning-code-for-environment-data.html#cb108-8" tabindex="-1"></a>         <span class="at">line =</span> DR2ILINE,</span>
<span id="cb108-9"><a href="cleaning-code-for-environment-data.html#cb108-9" tabindex="-1"></a>         <span class="at">foodcode =</span> DR2IFDCD,</span>
<span id="cb108-10"><a href="cleaning-code-for-environment-data.html#cb108-10" tabindex="-1"></a>         <span class="at">grams =</span> DR2IGRMS,</span>
<span id="cb108-11"><a href="cleaning-code-for-environment-data.html#cb108-11" tabindex="-1"></a>         <span class="at">description =</span> DESCRIPTION,</span>
<span id="cb108-12"><a href="cleaning-code-for-environment-data.html#cb108-12" tabindex="-1"></a>         <span class="at">daysintake =</span> DRDINT,</span>
<span id="cb108-13"><a href="cleaning-code-for-environment-data.html#cb108-13" tabindex="-1"></a>         <span class="at">reliable =</span> DR2DRSTZ)</span>
<span id="cb108-14"><a href="cleaning-code-for-environment-data.html#cb108-14" tabindex="-1"></a></span>
<span id="cb108-15"><a href="cleaning-code-for-environment-data.html#cb108-15" tabindex="-1"></a><span class="co"># ssb</span></span>
<span id="cb108-16"><a href="cleaning-code-for-environment-data.html#cb108-16" tabindex="-1"></a>ssb_2 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day2_ssb.rds&quot;</span>)</span>
<span id="cb108-17"><a href="cleaning-code-for-environment-data.html#cb108-17" tabindex="-1"></a></span>
<span id="cb108-18"><a href="cleaning-code-for-environment-data.html#cb108-18" tabindex="-1"></a><span class="co"># merge food and ssb</span></span>
<span id="cb108-19"><a href="cleaning-code-for-environment-data.html#cb108-19" tabindex="-1"></a>day2_sub1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(day2_sub, ssb_2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seqn&quot;</span> <span class="ot">=</span> <span class="st">&quot;SEQN&quot;</span>,</span>
<span id="cb108-20"><a href="cleaning-code-for-environment-data.html#cb108-20" tabindex="-1"></a>                                               <span class="st">&quot;line&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2ILINE&quot;</span>,</span>
<span id="cb108-21"><a href="cleaning-code-for-environment-data.html#cb108-21" tabindex="-1"></a>                                               <span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2IFDCD&quot;</span>,</span>
<span id="cb108-22"><a href="cleaning-code-for-environment-data.html#cb108-22" tabindex="-1"></a>                                               <span class="st">&quot;description&quot;</span> <span class="ot">=</span> <span class="st">&quot;DESCRIPTION&quot;</span>,</span>
<span id="cb108-23"><a href="cleaning-code-for-environment-data.html#cb108-23" tabindex="-1"></a>                                               <span class="st">&quot;grams&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2IGRMS&quot;</span>))</span></code></pre></div>
<p>Then, combine the “day 1” and “day 2” datasets to get a “both_days” dataset.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="cleaning-code-for-environment-data.html#cb109-1" tabindex="-1"></a>both_days <span class="ot">&lt;-</span> <span class="fu">rbind</span>(day1_sub1, day2_sub1) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(seqn, dayrec, line)</span>
<span id="cb109-2"><a href="cleaning-code-for-environment-data.html#cb109-2" tabindex="-1"></a></span>
<span id="cb109-3"><a href="cleaning-code-for-environment-data.html#cb109-3" tabindex="-1"></a><span class="co"># check to make sure the formatting worked</span></span>
<span id="cb109-4"><a href="cleaning-code-for-environment-data.html#cb109-4" tabindex="-1"></a>both_days <span class="sc">%&gt;%</span> <span class="fu">filter</span>(description <span class="sc">==</span> <span class="st">&quot;Meat, NFS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co">#looks good!</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 12
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 84032          1        1     9 20000000 11.0  Meat, NFS   Other      2015-2016         1           0     0
## 2 86178          2        1     5 20000000  4.19 Meat, NFS   Other      2015-2016         1           0     0
## 3 86487          2        1    10 20000000 73.3  Meat, NFS   Grocery    2015-2016         1           0     0
## 4 86801          2        1    13 20000000 11.2  Meat, NFS   Other      2015-2016         1           0     0
## 5 87065          2        1     3 20000000 50.2  Meat, NFS   Other      2015-2016         1           0     0
## 6 88767          2        1    12 20000000  7.33 Meat, NFS   Other      2015-2016         1           0     0</code></pre>
<p>Lastly, remove the original diet datasets becuase they are very large and we don’t need them anymore.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="cleaning-code-for-environment-data.html#cb111-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="mapping-from-dietary-factor-to-fndds-food-code" class="section level4 unnumbered hasAnchor">
<h4>Mapping from Dietary Factor to FNDDS Food Code<a href="cleaning-code-for-environment-data.html#mapping-from-dietary-factor-to-fndds-food-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This mapping is needed to handle some data processing in later code chunks.</p>
<p>First, create an empty dataset template that contains all of the foodcodes that exist in the diet dataset (both_days).</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="cleaning-code-for-environment-data.html#cb112-1" tabindex="-1"></a>all_foodcodes <span class="ot">&lt;-</span> both_days <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<p>Then, import the non-grain food mapping (labeled as “map_a”).</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="cleaning-code-for-environment-data.html#cb113-1" tabindex="-1"></a>map_a <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fndds_mapping/DATA/Food_to_FNDDS_mapping_detailed_04-06-25.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 109 Columns: 2
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Foodgroup
## dbl (1): foodcode_prefix
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Then, join the template and the first mapping.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="cleaning-code-for-environment-data.html#cb115-1" tabindex="-1"></a>my_join <span class="ot">&lt;-</span> <span class="fu">full_join</span>(<span class="fu">mutate</span>(all_foodcodes, <span class="at">i=</span><span class="dv">1</span>), </span>
<span id="cb115-2"><a href="cleaning-code-for-environment-data.html#cb115-2" tabindex="-1"></a>                     <span class="fu">mutate</span>(map_a, <span class="at">i=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3"><a href="cleaning-code-for-environment-data.html#cb115-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>i) <span class="sc">%&gt;%</span> </span>
<span id="cb115-4"><a href="cleaning-code-for-environment-data.html#cb115-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(foodcode, <span class="fu">paste0</span>(<span class="st">&quot;^&quot;</span>, foodcode_prefix))) <span class="sc">%&gt;%</span> </span>
<span id="cb115-5"><a href="cleaning-code-for-environment-data.html#cb115-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>foodcode_prefix)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(i)`</code></pre>
<pre><code>## Warning in full_join(mutate(all_foodcodes, i = 1), mutate(map_a, i = 1)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 1 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<p>Import the grain-only mapping (labeled as “map_b”).</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="cleaning-code-for-environment-data.html#cb118-1" tabindex="-1"></a>map_b <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fndds_mapping/DATA/Food_to_FNDDS_mapping_WHOLE_GRAINS_ONLY_09-05-23.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 1728 Columns: 2
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Foodgroup
## dbl (1): foodcode
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Merge my_join with the second mapping.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="cleaning-code-for-environment-data.html#cb120-1" tabindex="-1"></a>my_join1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(my_join, map_b) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(foodcode)</span></code></pre></div>
<p>Lastly, merge back with both_days.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="cleaning-code-for-environment-data.html#cb121-1" tabindex="-1"></a>both_days1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days, my_join1, <span class="at">by =</span> <span class="st">&quot;foodcode&quot;</span>)</span></code></pre></div>
<p>Check how many FNDDS codes in the dataset don’t have a mapping to a dietary factor (i.e., food group category)</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="cleaning-code-for-environment-data.html#cb122-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> </span>
<span id="cb122-2"><a href="cleaning-code-for-environment-data.html#cb122-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb122-3"><a href="cleaning-code-for-environment-data.html#cb122-3" tabindex="-1"></a>  <span class="fu">select</span>(foodcode, description) <span class="sc">%&gt;%</span> </span>
<span id="cb122-4"><a href="cleaning-code-for-environment-data.html#cb122-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb122-5"><a href="cleaning-code-for-environment-data.html#cb122-5" tabindex="-1"></a>  <span class="fu">arrange</span>(foodcode)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 2
## # ℹ 2 variables: foodcode &lt;dbl&gt;, description &lt;chr&gt;</code></pre>
<p>Check SSB by comparing the “ssb” indicator variable and the data when the foodgroup is set to “ssb”.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="cleaning-code-for-environment-data.html#cb124-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1    14 92308000  372  Tea, iced,… Other      2015-2016         2        6.81     1
## 2 83736          2        1     2 92410510  326. Soft drink… Grocery    2015-2016         1        6.97     1
## 3 83736          2        1     7 95320200  356. Sports dri… Grocery    2015-2016         1        4.46     1
## 4 83736          2        1     5 95320200  372  Sports dri… Grocery    2015-2016         2        4.65     1
## 5 83736          2        1     7 92410310  248  Soft drink… Grocery    2015-2016         2        5.88     1
## 6 83742          2        1    13 92510960  207. Lemonade, … Other      2015-2016         1        3.22     1
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="cleaning-code-for-environment-data.html#cb126-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1    14 92308000  372  Tea, iced,… Other      2015-2016         2        6.81     1
## 2 83736          2        1     2 92410510  326. Soft drink… Grocery    2015-2016         1        6.97     1
## 3 83736          2        1     7 92410310  248  Soft drink… Grocery    2015-2016         2        5.88     1
## 4 83742          2        1    13 92510960  207. Lemonade, … Other      2015-2016         1        3.22     1
## 5 83742          2        1     9 92410310  150. Soft drink… Other      2015-2016         2        3.54     1
## 6 83744          2        1     8 92410510  512  Soft drink… Other      2015-2016         1       11.0      1
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="cleaning-code-for-environment-data.html#cb128-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># need to change these to ssb</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83736          2        1     7 95320200  356. Sports dri… Grocery    2015-2016         1        4.46     1
## 2 83736          2        1     5 95320200  372  Sports dri… Grocery    2015-2016         2        4.65     1
## 3 83753          2        1     6 95320200  744  Sports dri… Other      2015-2016         2        9.3      1
## 4 83768          2        1    12 64204010  580. Mango nect… Grocery    2015-2016         1        9.64     1
## 5 83780          2        1     9 64205010  116. Peach nect… Grocery    2015-2016         2        2.76     1
## 6 83795          2        1    10 95320200  310  Sports dri… Other      2015-2016         2        3.88     1
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="cleaning-code-for-environment-data.html#cb130-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># need to change these to other</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1     1 92101000   720 Coffee, br… Grocery    2015-2016         1           0     0
## 2 83732          2        1     7 92410320   600 Soft drink… Grocery    2015-2016         1           0     0
## 3 83732          2        1     1 92101000   255 Coffee, br… Grocery    2015-2016         2           0     0
## 4 83732          2        1    15 92410520   480 Soft drink… Other      2015-2016         2           0     0
## 5 83733          2        1     1 92101000   480 Coffee, br… Grocery    2015-2016         1           0     0
## 6 83733          2        1     1 92101000   450 Coffee, br… Grocery    2015-2016         2           0     0
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="cleaning-code-for-environment-data.html#cb132-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode  grams description      foodsource nhanes_cycle dayrec added_sugar
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1 83732          2        1     2 91200040   4    Sugar substitut… Grocery    2015-2016         1        0   
## 2 83732          2        1     3 12210400   3.92 Coffee creamer,… Grocery    2015-2016         1        0.07
## 3 83732          2        1     4 94100100 240    Water, bottled,… Grocery    2015-2016         1        0   
## 4 83732          2        1     5 51101010  75    Bread, white, t… Grocery    2015-2016         1        0.74
## 5 83732          2        1     6 81103080  28.6  Margarine-like … Grocery    2015-2016         1        0   
## 6 83732          2        1     8 27564060 204    Frankfurter or … Grocery    2015-2016         1        1.63
## # ℹ 2 more variables: ssb &lt;dbl&gt;, Foodgroup &lt;chr&gt;</code></pre>
<p>We see that, for some of the rows, ssb is labeled incorrectly, so we need to fix it.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="cleaning-code-for-environment-data.html#cb134-1" tabindex="-1"></a>both_days2 <span class="ot">&lt;-</span> both_days1 <span class="sc">%&gt;%</span> </span>
<span id="cb134-2"><a href="cleaning-code-for-environment-data.html#cb134-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Foodgroup =</span> <span class="fu">ifelse</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>, <span class="st">&quot;ssb&quot;</span>, Foodgroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-3"><a href="cleaning-code-for-environment-data.html#cb134-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Foodgroup =</span> <span class="fu">ifelse</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>, <span class="st">&quot;other&quot;</span>, Foodgroup))</span></code></pre></div>
<p>Check again. Looks good.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="cleaning-code-for-environment-data.html#cb135-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1    14 92308000  372  Tea, iced,… Other      2015-2016         2        6.81     1
## 2 83736          2        1     2 92410510  326. Soft drink… Grocery    2015-2016         1        6.97     1
## 3 83736          2        1     7 95320200  356. Sports dri… Grocery    2015-2016         1        4.46     1
## 4 83736          2        1     5 95320200  372  Sports dri… Grocery    2015-2016         2        4.65     1
## 5 83736          2        1     7 92410310  248  Soft drink… Grocery    2015-2016         2        5.88     1
## 6 83742          2        1    13 92510960  207. Lemonade, … Other      2015-2016         1        3.22     1
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="cleaning-code-for-environment-data.html#cb137-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 13
## # ℹ 13 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;,
## #   Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="cleaning-code-for-environment-data.html#cb139-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 13
## # ℹ 13 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;,
## #   Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="cleaning-code-for-environment-data.html#cb141-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode  grams description      foodsource nhanes_cycle dayrec added_sugar
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1 83732          2        1     1 92101000 720    Coffee, brewed   Grocery    2015-2016         1        0   
## 2 83732          2        1     2 91200040   4    Sugar substitut… Grocery    2015-2016         1        0   
## 3 83732          2        1     3 12210400   3.92 Coffee creamer,… Grocery    2015-2016         1        0.07
## 4 83732          2        1     4 94100100 240    Water, bottled,… Grocery    2015-2016         1        0   
## 5 83732          2        1     5 51101010  75    Bread, white, t… Grocery    2015-2016         1        0.74
## 6 83732          2        1     6 81103080  28.6  Margarine-like … Grocery    2015-2016         1        0   
## # ℹ 2 more variables: ssb &lt;dbl&gt;, Foodgroup &lt;chr&gt;</code></pre>
<p>Rename variable.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="cleaning-code-for-environment-data.html#cb143-1" tabindex="-1"></a>both_days3 <span class="ot">&lt;-</span> both_days2 <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="cleaning-code-for-environment-data.html#cb143-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Foodgroup_FNDDS =</span> Foodgroup)</span></code></pre></div>
<p>Tidy up the global environment and only keep the datasets we currently need.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="cleaning-code-for-environment-data.html#cb144-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days3&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
<p>This dataset containing the FNDDS foodcodes that represent seafood dishes will then be used in the following code chunk.</p>
</div>
<div id="mapping-from-fndds-food-code-to-fcid-code" class="section level4 unnumbered hasAnchor">
<h4>Mapping from FNDDS Food Code to FCID Code<a href="cleaning-code-for-environment-data.html#mapping-from-fndds-food-code-to-fcid-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Import the mapping and join with the both_days dataset.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="cleaning-code-for-environment-data.html#cb145-1" tabindex="-1"></a><span class="co"># import </span></span>
<span id="cb145-2"><a href="cleaning-code-for-environment-data.html#cb145-2" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/fndds_to_fcid_mapping/DATA/FCID_0118_LASTING.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 122027 Columns: 12
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): food_desc, fcid_desc, procform_desc, cookstatus_desc, cookmethod_desc
## dbl (7): foodcode, fcidcode, procform, cookstatus, cookmethod, impute, wt
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="cleaning-code-for-environment-data.html#cb147-1" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> map <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode, fcidcode, fcid_desc, wt)</span>
<span id="cb147-2"><a href="cleaning-code-for-environment-data.html#cb147-2" tabindex="-1"></a></span>
<span id="cb147-3"><a href="cleaning-code-for-environment-data.html#cb147-3" tabindex="-1"></a><span class="co"># combine with food data</span></span>
<span id="cb147-4"><a href="cleaning-code-for-environment-data.html#cb147-4" tabindex="-1"></a>both_days4 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(both_days3, map1, <span class="at">by =</span> <span class="st">&quot;foodcode&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in full_join(both_days3, map1, by = &quot;foodcode&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 1 of `x` matches multiple rows in `y`.
## ℹ Row 76852 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="cleaning-code-for-environment-data.html#cb149-1" tabindex="-1"></a><span class="co"># if SEQN (subject ID) is missing, remove from dataset</span></span>
<span id="cb149-2"><a href="cleaning-code-for-environment-data.html#cb149-2" tabindex="-1"></a>both_days5 <span class="ot">&lt;-</span> both_days4 <span class="sc">%&gt;%</span> </span>
<span id="cb149-3"><a href="cleaning-code-for-environment-data.html#cb149-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(seqn))) <span class="sc">%&gt;%</span> </span>
<span id="cb149-4"><a href="cleaning-code-for-environment-data.html#cb149-4" tabindex="-1"></a>  <span class="fu">arrange</span>(seqn, dayrec, line) <span class="sc">%&gt;%</span> </span>
<span id="cb149-5"><a href="cleaning-code-for-environment-data.html#cb149-5" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">c</span>(foodsource, nhanes_cycle, dayrec), <span class="at">.after =</span> <span class="fu">last_col</span>())</span>
<span id="cb149-6"><a href="cleaning-code-for-environment-data.html#cb149-6" tabindex="-1"></a></span>
<span id="cb149-7"><a href="cleaning-code-for-environment-data.html#cb149-7" tabindex="-1"></a><span class="co"># look at ssb</span></span>
<span id="cb149-8"><a href="cleaning-code-for-environment-data.html#cb149-8" tabindex="-1"></a>both_days5 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 16
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 83732          2        1    14 92308000  372  Tea, iced, brewe…        6.81     1 ssb               1.01e8
## 2 83732          2        1    14 92308000  372  Tea, iced, brewe…        6.81     1 ssb               8.60e9
## 3 83732          2        1    14 92308000  372  Tea, iced, brewe…        6.81     1 ssb               9.50e9
## 4 83732          2        1    14 92308000  372  Tea, iced, brewe…        6.81     1 ssb               9.50e9
## 5 83736          2        1     2 92410510  326. Soft drink, frui…        6.97     1 ssb               1.50e9
## 6 83736          2        1     7 95320200  356. Sports drink (Ga…        4.46     1 ssb               9.50e9
## # ℹ 5 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="cleaning-code-for-environment-data.html#cb151-1" tabindex="-1"></a>both_days5 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(fcid_desc) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## fcid_desc
##                       Almond                 Apple, juice               Apricot, juice 
##                           90                         1759                         1767 
##                       Banana                Barley, flour                  Beet, sugar 
##                         1767                           31                         6782 
##                   Blackberry                    Blueberry                  Boysenberry 
##                         1759                         1759                         1759 
##                   Cantaloupe                      Cassava                       Cherry 
##                           17                          341                            5 
##                Cherry, juice                     Cinnamon        Cocoa bean, chocolate 
##                         1759                         1244                            9 
##           Cocoa bean, powder                Coconut, meat                Coconut, milk 
##                           64                           17                            3 
##                 Coconut, oil              Coffee, instant         Coffee, roasted bean 
##                         1305                          361                          360 
##           Corn, field, flour             Corn, field, oil          Corn, field, starch 
##                           41                           82                          424 
##           Corn, field, syrup             Cranberry, juice                 Grape, juice 
##                        16067                         1936                         1759 
##            Grapefruit, juice                        Guava                        Lemon 
##                         1760                           22                           70 
##                 Lemon, juice                  Lime, juice                 Mango, juice 
##                         2971                         1759                         1897 
##                 Maple, sugar                    Milk, fat          Milk, nonfat solids 
##                           70                          538                          600 
##                  Milk, water      Oat, groats/rolled oats                       Orange 
##                          538                           18                            5 
##                Orange, juice                Papaya, juice          Passionfruit, juice 
##                         2086                            7                         1760 
##                        Peach                 Peach, juice                  Pear, juice 
##                         1759                           17                         1777 
##                   Peppermint             Pineapple, juice                Potato, flour 
##                         1235                         1771                          341 
##             Raspberry, juice                  Rice, flour                      Seaweed 
##                         1759                          341                            5 
##                 Sesame, seed                      Soursop               Soybean, flour 
##                           81                            2                           61 
##                 Soybean, oil            Soybean, soy milk                Spices, other 
##                           59                           19                         1305 
##            Strawberry, juice             Sugarcane, sugar                     Tamarind 
##                         1759                         7089                           16 
##             Tangerine, juice                   Tea, dried                 Tea, instant 
##                         1759                         2982                          279 
## Water, indirect, all sources                 Wheat, flour 
##                         6183                          341</code></pre>
</div>
<div id="food-loss-and-waste-data" class="section level4 unnumbered hasAnchor">
<h4>Food Loss and Waste Data<a href="cleaning-code-for-environment-data.html#food-loss-and-waste-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Import the food loss &amp; waste coefficients and join with the both_days dataset.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="cleaning-code-for-environment-data.html#cb153-1" tabindex="-1"></a><span class="co"># import losswaste data</span></span>
<span id="cb153-2"><a href="cleaning-code-for-environment-data.html#cb153-2" tabindex="-1"></a><span class="co"># losswaste &lt;- read_csv(&quot;data_inputs/OTHER/food_waste/DATA/losswaste.csv&quot;)</span></span>
<span id="cb153-3"><a href="cleaning-code-for-environment-data.html#cb153-3" tabindex="-1"></a></span>
<span id="cb153-4"><a href="cleaning-code-for-environment-data.html#cb153-4" tabindex="-1"></a><span class="co"># import the proxy data for missing loss/waste data</span></span>
<span id="cb153-5"><a href="cleaning-code-for-environment-data.html#cb153-5" tabindex="-1"></a>losswaste_complete <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/food_waste/DATA/missing_data/resolved/Missing waste coefficients (full)_090523.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb153-6"><a href="cleaning-code-for-environment-data.html#cb153-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(fcid_desc, Foodgroup, Proxy, Notes))</span></code></pre></div>
<pre><code>## Rows: 484 Columns: 8
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (4): fcid_desc, Foodgroup, Proxy, Notes
## dbl (4): fcidcode, waste_coef, ined_coef, retloss_coef
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="cleaning-code-for-environment-data.html#cb155-1" tabindex="-1"></a><span class="co"># merge with bothdays</span></span>
<span id="cb155-2"><a href="cleaning-code-for-environment-data.html#cb155-2" tabindex="-1"></a>both_days6 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days5, losswaste_complete, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span></code></pre></div>
</div>
<div id="mapping-from-fcid-food-code-to-dietary-factor" class="section level4 unnumbered hasAnchor">
<h4>Mapping From FCID Food Code to Dietary Factor<a href="cleaning-code-for-environment-data.html#mapping-from-fcid-food-code-to-dietary-factor" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we import the original mapping.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="cleaning-code-for-environment-data.html#cb156-1" tabindex="-1"></a><span class="co"># import fcid-diet factor mapping</span></span>
<span id="cb156-2"><a href="cleaning-code-for-environment-data.html#cb156-2" tabindex="-1"></a>new_map <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fcid_mapping/DATA/FCID_to_dietaryfactor_mapping_01-09-2024_final.xlsx&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb156-3"><a href="cleaning-code-for-environment-data.html#cb156-3" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code, Foodgroup) <span class="sc">%&gt;%</span> </span>
<span id="cb156-4"><a href="cleaning-code-for-environment-data.html#cb156-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fcidcode =</span> FCID_Code,</span>
<span id="cb156-5"><a href="cleaning-code-for-environment-data.html#cb156-5" tabindex="-1"></a>         <span class="at">Foodgroup_FCID =</span> Foodgroup)</span>
<span id="cb156-6"><a href="cleaning-code-for-environment-data.html#cb156-6" tabindex="-1"></a></span>
<span id="cb156-7"><a href="cleaning-code-for-environment-data.html#cb156-7" tabindex="-1"></a><span class="co"># merge</span></span>
<span id="cb156-8"><a href="cleaning-code-for-environment-data.html#cb156-8" tabindex="-1"></a>both_days7 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days6, new_map, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span>
<span id="cb156-9"><a href="cleaning-code-for-environment-data.html#cb156-9" tabindex="-1"></a></span>
<span id="cb156-10"><a href="cleaning-code-for-environment-data.html#cb156-10" tabindex="-1"></a><span class="co"># which FNDDS foodcodes have missing FCID food group?</span></span>
<span id="cb156-11"><a href="cleaning-code-for-environment-data.html#cb156-11" tabindex="-1"></a>both_days7 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup_FCID)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar           NA
## 2 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other                 NA
## 3 83732          2        1     2 91200040     2 Sugar substitute…           0     0 added_sugar           NA
## 4 83732          2        1    15 92410520   480 Soft drink, frui…           0     0 other                 NA
## 5 83735          1        1     4 92410370   180 Soft drink, pepp…           0     0 other                 NA
## 6 83735          1        1    11 92410370   360 Soft drink, pepp…           0     0 other                 NA
## # ℹ 9 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="cleaning-code-for-environment-data.html#cb158-1" tabindex="-1"></a>both_days7 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup_FCID)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode, description) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 57 × 2
##    foodcode description                                    
##       &lt;dbl&gt; &lt;chr&gt;                                          
##  1 91200040 Sugar substitute, saccharin, powder            
##  2 92410320 Soft drink, cola, diet                         
##  3 92410520 Soft drink, fruit flavored, diet, caffeine free
##  4 92410370 Soft drink, pepper type, diet                  
##  5 92410350 Soft drink, cola, decaffeinated, diet          
##  6 91201010 Sugar substitute, aspartame, powder            
##  7 91107000 Sugar substitute, sucralose, powder            
##  8 92410210 Carbonated water, unsweetened                  
##  9 93301217 Vodka and water                                
## 10 93301218 Vodka and tonic                                
## # ℹ 47 more rows</code></pre>
<p>But, we can see that there’s some missing so our team went and manually updated the mapping, which is imported in the following code chunk.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="cleaning-code-for-environment-data.html#cb160-1" tabindex="-1"></a><span class="co"># import updated mapping</span></span>
<span id="cb160-2"><a href="cleaning-code-for-environment-data.html#cb160-2" tabindex="-1"></a>fcids_new <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fcid_mapping/DATA/missing_data/resolved/Missing FCIDS_mapped.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb160-3"><a href="cleaning-code-for-environment-data.html#cb160-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>description) <span class="sc">%&gt;%</span> </span>
<span id="cb160-4"><a href="cleaning-code-for-environment-data.html#cb160-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Foodgroup_FCID =</span> Foodgroup)</span></code></pre></div>
<pre><code>## Rows: 55 Columns: 3
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): description, Foodgroup
## dbl (1): foodcode
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="cleaning-code-for-environment-data.html#cb162-1" tabindex="-1"></a><span class="co"># row patch new mapping with both days</span></span>
<span id="cb162-2"><a href="cleaning-code-for-environment-data.html#cb162-2" tabindex="-1"></a>both_days8 <span class="ot">&lt;-</span> <span class="fu">rows_patch</span>(both_days7, fcids_new, <span class="at">unmatched =</span> <span class="st">&quot;ignore&quot;</span>)</span></code></pre></div>
<pre><code>## Matching, by = &quot;foodcode&quot;</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="cleaning-code-for-environment-data.html#cb164-1" tabindex="-1"></a><span class="co"># which ones have missing fcid?</span></span>
<span id="cb164-2"><a href="cleaning-code-for-environment-data.html#cb164-2" tabindex="-1"></a>both_days8 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar           NA
## 2 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other                 NA
## 3 83732          2        1     2 91200040     2 Sugar substitute…           0     0 added_sugar           NA
## 4 83732          2        1    15 92410520   480 Soft drink, frui…           0     0 other                 NA
## 5 83735          1        1     4 92410370   180 Soft drink, pepp…           0     0 other                 NA
## 6 83735          1        1    11 92410370   360 Soft drink, pepp…           0     0 other                 NA
## # ℹ 9 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="cleaning-code-for-environment-data.html#cb166-1" tabindex="-1"></a>both_days8 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode, description, fcidcode) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   foodcode description                                     fcidcode
##      &lt;dbl&gt; &lt;chr&gt;                                              &lt;dbl&gt;
## 1 91200040 Sugar substitute, saccharin, powder                   NA
## 2 92410320 Soft drink, cola, diet                                NA
## 3 92410520 Soft drink, fruit flavored, diet, caffeine free       NA
## 4 92410370 Soft drink, pepper type, diet                         NA
## 5 92410350 Soft drink, cola, decaffeinated, diet                 NA
## 6 91201010 Sugar substitute, aspartame, powder                   NA</code></pre>
<p>There are now fewer missing coefficients, but still some. In some of these cases, the FNDDS foodcode can represent the FCID code (i.e., single ingredient foods). Below, I manually add these waste coefficents for dasheen and corn.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="cleaning-code-for-environment-data.html#cb168-1" tabindex="-1"></a><span class="co"># dasheen</span></span>
<span id="cb168-2"><a href="cleaning-code-for-environment-data.html#cb168-2" tabindex="-1"></a>dash <span class="ot">&lt;-</span> losswaste_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fcidcode <span class="sc">==</span> <span class="st">&quot;103139000&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb168-3"><a href="cleaning-code-for-environment-data.html#cb168-3" tabindex="-1"></a>  <span class="co">#change the fcidcode</span></span>
<span id="cb168-4"><a href="cleaning-code-for-environment-data.html#cb168-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodcode =</span> <span class="dv">71962020</span>,</span>
<span id="cb168-5"><a href="cleaning-code-for-environment-data.html#cb168-5" tabindex="-1"></a>         <span class="at">wt =</span> <span class="dv">100</span>)</span>
<span id="cb168-6"><a href="cleaning-code-for-environment-data.html#cb168-6" tabindex="-1"></a></span>
<span id="cb168-7"><a href="cleaning-code-for-environment-data.html#cb168-7" tabindex="-1"></a><span class="co"># corn</span></span>
<span id="cb168-8"><a href="cleaning-code-for-environment-data.html#cb168-8" tabindex="-1"></a>corn <span class="ot">&lt;-</span> losswaste_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fcidcode <span class="sc">==</span> <span class="st">&quot;1500127000&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb168-9"><a href="cleaning-code-for-environment-data.html#cb168-9" tabindex="-1"></a>  <span class="co">#change the fcidcode</span></span>
<span id="cb168-10"><a href="cleaning-code-for-environment-data.html#cb168-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodcode =</span> <span class="dv">75215990</span>, </span>
<span id="cb168-11"><a href="cleaning-code-for-environment-data.html#cb168-11" tabindex="-1"></a>         <span class="at">wt =</span> <span class="dv">100</span>)</span>
<span id="cb168-12"><a href="cleaning-code-for-environment-data.html#cb168-12" tabindex="-1"></a></span>
<span id="cb168-13"><a href="cleaning-code-for-environment-data.html#cb168-13" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb168-14"><a href="cleaning-code-for-environment-data.html#cb168-14" tabindex="-1"></a>comb <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dash, corn) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>fcidcode)</span>
<span id="cb168-15"><a href="cleaning-code-for-environment-data.html#cb168-15" tabindex="-1"></a></span>
<span id="cb168-16"><a href="cleaning-code-for-environment-data.html#cb168-16" tabindex="-1"></a><span class="co"># row patch with bothdays</span></span>
<span id="cb168-17"><a href="cleaning-code-for-environment-data.html#cb168-17" tabindex="-1"></a>both_days9 <span class="ot">&lt;-</span> <span class="fu">rows_patch</span>(both_days8, comb, <span class="at">by =</span> <span class="st">&quot;foodcode&quot;</span>)</span>
<span id="cb168-18"><a href="cleaning-code-for-environment-data.html#cb168-18" tabindex="-1"></a></span>
<span id="cb168-19"><a href="cleaning-code-for-environment-data.html#cb168-19" tabindex="-1"></a><span class="co"># check missing fcid</span></span>
<span id="cb168-20"><a href="cleaning-code-for-environment-data.html#cb168-20" tabindex="-1"></a>both_days9 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar           NA
## 2 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other                 NA
## 3 83732          2        1     2 91200040     2 Sugar substitute…           0     0 added_sugar           NA
## 4 83732          2        1    15 92410520   480 Soft drink, frui…           0     0 other                 NA
## 5 83735          1        1     4 92410370   180 Soft drink, pepp…           0     0 other                 NA
## 6 83735          1        1    11 92410370   360 Soft drink, pepp…           0     0 other                 NA
## # ℹ 9 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="cleaning-code-for-environment-data.html#cb170-1" tabindex="-1"></a><span class="co"># check missing waste coef</span></span>
<span id="cb170-2"><a href="cleaning-code-for-environment-data.html#cb170-2" tabindex="-1"></a>both_days9 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(waste_coef)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
## 1 83732          2        1     1 92101000   720 Coffee, brewed              0     0 other             9.50e9
## 2 83732          2        1     1 92101000   720 Coffee, brewed              0     0 other             8.60e9
## 3 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar      NA     
## 4 83732          2        1     4 94100100   240 Water, bottled, …           0     0 water             8.60e9
## 5 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other            NA     
## 6 83732          2        1    11 94100100   240 Water, bottled, …           0     0 water             8.60e9
## # ℹ 9 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<p>There’s still a few FCID codes that don’t have waste and inedible coefficients, but it’s not very many, so we will leave for now.</p>
<p>Calculate the FCID-level consumed, inedible, and wasted amounts of food.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="cleaning-code-for-environment-data.html#cb172-1" tabindex="-1"></a>both_days10 <span class="ot">&lt;-</span> both_days9 <span class="sc">%&gt;%</span> </span>
<span id="cb172-2"><a href="cleaning-code-for-environment-data.html#cb172-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">consumed_amt_FCID =</span> grams <span class="sc">*</span> (wt <span class="sc">/</span> <span class="dv">100</span>),</span>
<span id="cb172-3"><a href="cleaning-code-for-environment-data.html#cb172-3" tabindex="-1"></a>         <span class="at">inedible_amt_FCID =</span> consumed_amt_FCID <span class="sc">*</span> ined_coef,</span>
<span id="cb172-4"><a href="cleaning-code-for-environment-data.html#cb172-4" tabindex="-1"></a>         <span class="at">wasted_amt_FCID =</span> consumed_amt_FCID <span class="sc">*</span> waste_coef)</span></code></pre></div>
<p>Calculate the FNDDS-level consumed, inedible, and wasted amounts of food. This isn’t needed for the environmental impact factors, but it is needed for the cost impact factors in the next section.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="cleaning-code-for-environment-data.html#cb173-1" tabindex="-1"></a>both_days11 <span class="ot">&lt;-</span></span>
<span id="cb173-2"><a href="cleaning-code-for-environment-data.html#cb173-2" tabindex="-1"></a>  both_days10 <span class="sc">%&gt;%</span> </span>
<span id="cb173-3"><a href="cleaning-code-for-environment-data.html#cb173-3" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, dayrec, line, foodcode) <span class="sc">%&gt;%</span> </span>
<span id="cb173-4"><a href="cleaning-code-for-environment-data.html#cb173-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">consumed_amt_FNDDS =</span> grams,</span>
<span id="cb173-5"><a href="cleaning-code-for-environment-data.html#cb173-5" tabindex="-1"></a>         <span class="at">inedible_amt_FNDDS =</span> <span class="fu">sum</span>(inedible_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-6"><a href="cleaning-code-for-environment-data.html#cb173-6" tabindex="-1"></a>         <span class="at">wasted_amt_FNDDS =</span> <span class="fu">sum</span>(wasted_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb173-7"><a href="cleaning-code-for-environment-data.html#cb173-7" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb173-8"><a href="cleaning-code-for-environment-data.html#cb173-8" tabindex="-1"></a></span>
<span id="cb173-9"><a href="cleaning-code-for-environment-data.html#cb173-9" tabindex="-1"></a><span class="co"># get distinct dataset</span></span>
<span id="cb173-10"><a href="cleaning-code-for-environment-data.html#cb173-10" tabindex="-1"></a>fndds_flw <span class="ot">&lt;-</span> both_days11 <span class="sc">%&gt;%</span> </span>
<span id="cb173-11"><a href="cleaning-code-for-environment-data.html#cb173-11" tabindex="-1"></a>  <span class="fu">select</span>(seqn, dayrec, line, foodcode, description, consumed_amt_FNDDS, </span>
<span id="cb173-12"><a href="cleaning-code-for-environment-data.html#cb173-12" tabindex="-1"></a>         inedible_amt_FNDDS, wasted_amt_FNDDS) <span class="sc">%&gt;%</span> </span>
<span id="cb173-13"><a href="cleaning-code-for-environment-data.html#cb173-13" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb173-14"><a href="cleaning-code-for-environment-data.html#cb173-14" tabindex="-1"></a>  <span class="fu">arrange</span>(seqn, dayrec, line)</span>
<span id="cb173-15"><a href="cleaning-code-for-environment-data.html#cb173-15" tabindex="-1"></a></span>
<span id="cb173-16"><a href="cleaning-code-for-environment-data.html#cb173-16" tabindex="-1"></a><span class="co"># export to use in next section</span></span>
<span id="cb173-17"><a href="cleaning-code-for-environment-data.html#cb173-17" tabindex="-1"></a><span class="fu">saveRDS</span>(fndds_flw, <span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/fndds_flw.rds&quot;</span>)</span></code></pre></div>
<p>Tidy up the global environment.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="cleaning-code-for-environment-data.html#cb174-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days11&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="fcid-level-environmental-impact-factors-datafield" class="section level4 unnumbered hasAnchor">
<h4>FCID-Level Environmental Impact Factors (dataField)<a href="cleaning-code-for-environment-data.html#fcid-level-environmental-impact-factors-datafield" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two environmental datasets that need to be imported. The first dataset contains greenhouse gas (GHG) and cumulative energy demand (CED) impact factors. The second contains water scarcity (WATER) and bluewater use (BLUEWATER) impact factors.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="cleaning-code-for-environment-data.html#cb175-1" tabindex="-1"></a><span class="co"># import datafield (non-water)</span></span>
<span id="cb175-2"><a href="cleaning-code-for-environment-data.html#cb175-2" tabindex="-1"></a>datafield <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/ENVIRONMENT/ghg_ced_impacts/DATA/dataFIELDv1.0_LASTING_120723.xlsx&quot;</span>,</span>
<span id="cb175-3"><a href="cleaning-code-for-environment-data.html#cb175-3" tabindex="-1"></a>                <span class="at">sheet =</span> <span class="st">&quot;FCID linkages&quot;</span>,</span>
<span id="cb175-4"><a href="cleaning-code-for-environment-data.html#cb175-4" tabindex="-1"></a>                <span class="at">skip =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...11`
## • `` -&gt; `...12`
## • `# of datapoints` -&gt; `# of datapoints...13`
## • `N-average` -&gt; `N-average...14`
## • `Std. Dev` -&gt; `Std. Dev...15`
## • `` -&gt; `...16`
## • `# of datapoints` -&gt; `# of datapoints...17`
## • `N-average` -&gt; `N-average...18`
## • `Std. Dev` -&gt; `Std. Dev...19`
## • `` -&gt; `...20`
## • `` -&gt; `...21`
## • `` -&gt; `...22`
## • `basis` -&gt; `basis...23`
## • `n` -&gt; `n...24`
## • `proxy group mean` -&gt; `proxy group mean...25`
## • `SD (group or indiv food)` -&gt; `SD (group or indiv food)...26`
## • `scaled SD (group SD*food mean/group mean)` -&gt; `scaled SD (group SD*food mean/group mean)...27`
## • `basis` -&gt; `basis...28`
## • `n` -&gt; `n...29`
## • `proxy group mean` -&gt; `proxy group mean...30`
## • `SD (group or indiv food)` -&gt; `SD (group or indiv food)...31`
## • `scaled SD (group SD*food mean/group mean)` -&gt; `scaled SD (group SD*food mean/group mean)...32`</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="cleaning-code-for-environment-data.html#cb177-1" tabindex="-1"></a>datafield_sub <span class="ot">&lt;-</span> datafield <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="cleaning-code-for-environment-data.html#cb177-2" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code, <span class="st">`</span><span class="at">MJ / kg</span><span class="st">`</span>, <span class="st">`</span><span class="at">CO2 eq / kg</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="cleaning-code-for-environment-data.html#cb177-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GHG_mn =</span> <span class="st">`</span><span class="at">CO2 eq / kg</span><span class="st">`</span>,</span>
<span id="cb177-4"><a href="cleaning-code-for-environment-data.html#cb177-4" tabindex="-1"></a>         <span class="at">CED_mn =</span> <span class="st">`</span><span class="at">MJ / kg</span><span class="st">`</span>,</span>
<span id="cb177-5"><a href="cleaning-code-for-environment-data.html#cb177-5" tabindex="-1"></a>         <span class="at">fcidcode =</span> FCID_Code) <span class="sc">%&gt;%</span> </span>
<span id="cb177-6"><a href="cleaning-code-for-environment-data.html#cb177-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode))</span>
<span id="cb177-7"><a href="cleaning-code-for-environment-data.html#cb177-7" tabindex="-1"></a></span>
<span id="cb177-8"><a href="cleaning-code-for-environment-data.html#cb177-8" tabindex="-1"></a><span class="co"># import datafield (water impacts)</span></span>
<span id="cb177-9"><a href="cleaning-code-for-environment-data.html#cb177-9" tabindex="-1"></a>datafield_water <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/ENVIRONMENT/water_impacts/DATA/dataFIELD_water public v1_LASTING_120723.xlsx&quot;</span>,</span>
<span id="cb177-10"><a href="cleaning-code-for-environment-data.html#cb177-10" tabindex="-1"></a>                             <span class="at">sheet =</span> <span class="st">&quot;FCID Codes&quot;</span>,</span>
<span id="cb177-11"><a href="cleaning-code-for-environment-data.html#cb177-11" tabindex="-1"></a>                             <span class="at">skip =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...10`</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="cleaning-code-for-environment-data.html#cb179-1" tabindex="-1"></a>datafield_water_sub <span class="ot">&lt;-</span> datafield_water <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="cleaning-code-for-environment-data.html#cb179-2" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code, <span class="st">`</span><span class="at">liter eq. / kg</span><span class="st">`</span>, <span class="st">`</span><span class="at">L /kg</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb179-3"><a href="cleaning-code-for-environment-data.html#cb179-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">WATER_mn =</span> <span class="st">`</span><span class="at">liter eq. / kg</span><span class="st">`</span>,</span>
<span id="cb179-4"><a href="cleaning-code-for-environment-data.html#cb179-4" tabindex="-1"></a>         <span class="at">BLUEWATER_mn =</span> <span class="st">`</span><span class="at">L /kg</span><span class="st">`</span>,</span>
<span id="cb179-5"><a href="cleaning-code-for-environment-data.html#cb179-5" tabindex="-1"></a>         <span class="at">fcidcode =</span> FCID_Code) <span class="sc">%&gt;%</span> </span>
<span id="cb179-6"><a href="cleaning-code-for-environment-data.html#cb179-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode))</span>
<span id="cb179-7"><a href="cleaning-code-for-environment-data.html#cb179-7" tabindex="-1"></a></span>
<span id="cb179-8"><a href="cleaning-code-for-environment-data.html#cb179-8" tabindex="-1"></a><span class="co"># merge the two datafield datasets together</span></span>
<span id="cb179-9"><a href="cleaning-code-for-environment-data.html#cb179-9" tabindex="-1"></a>datafield_comb <span class="ot">&lt;-</span> <span class="fu">left_join</span>(datafield_sub, datafield_water_sub, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span>
<span id="cb179-10"><a href="cleaning-code-for-environment-data.html#cb179-10" tabindex="-1"></a></span>
<span id="cb179-11"><a href="cleaning-code-for-environment-data.html#cb179-11" tabindex="-1"></a><span class="co"># now merge with bothdays</span></span>
<span id="cb179-12"><a href="cleaning-code-for-environment-data.html#cb179-12" tabindex="-1"></a>both_days12 <span class="ot">&lt;-</span> both_days11 <span class="sc">%&gt;%</span> </span>
<span id="cb179-13"><a href="cleaning-code-for-environment-data.html#cb179-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode)) <span class="sc">%&gt;%</span> </span>
<span id="cb179-14"><a href="cleaning-code-for-environment-data.html#cb179-14" tabindex="-1"></a>  <span class="fu">left_join</span>(datafield_comb, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span></code></pre></div>
<p>Below, we check the dataset for missing impact factors.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="cleaning-code-for-environment-data.html#cb180-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 2 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other           &lt;NA&gt;    
## 3 83732          2        1     2 91200040     2 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 4 83732          2        1    15 92410520   480 Soft drink, frui…           0     0 other           &lt;NA&gt;    
## 5 83735          1        1     4 92410370   180 Soft drink, pepp…           0     0 other           &lt;NA&gt;    
## 6 83735          1        1    11 92410370   360 Soft drink, pepp…           0     0 other           &lt;NA&gt;    
## # ℹ 19 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="cleaning-code-for-environment-data.html#cb182-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn) <span class="sc">&amp;</span> ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 0 × 30
## # ℹ 30 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;, Foodgroup_FNDDS &lt;chr&gt;, fcidcode &lt;chr&gt;, fcid_desc &lt;chr&gt;,
## #   wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;,
## #   wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;,
## #   CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="cleaning-code-for-environment-data.html#cb184-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn) <span class="sc">&amp;</span> Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 0 × 30
## # ℹ 30 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;, Foodgroup_FNDDS &lt;chr&gt;, fcidcode &lt;chr&gt;, fcid_desc &lt;chr&gt;,
## #   wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;,
## #   wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;,
## #   CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="cleaning-code-for-environment-data.html#cb186-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn) <span class="sc">&amp;</span> Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-2"><a href="cleaning-code-for-environment-data.html#cb186-2" tabindex="-1"></a>  <span class="fu">select</span>(description, Foodgroup_FNDDS) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># these are all diet drinks and not ssb</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 2
## # ℹ 2 variables: description &lt;chr&gt;, Foodgroup_FNDDS &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="cleaning-code-for-environment-data.html#cb188-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FNDDS) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## Foodgroup_FNDDS
##     added_sugar        babyfood       dairy_tot fruit_exc_juice     fruit_juice      gr_refined 
##            2125            4322           30348               4             557            4024 
##        gr_whole           other      pf_poultry         pf_redm      pf_seafood          veg_dg 
##            1134            3438             145              27               3               5 
##         veg_oth         veg_sta           water 
##             102               9              41</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="cleaning-code-for-environment-data.html#cb190-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## Foodgroup_FCID
##        babyfood fruit_exc_juice        gr_whole           other      pf_seafood          veg_dg 
##           40550               4               7            5046               3               5 
##         veg_oth         veg_sta           water 
##              92               9             568</code></pre>
<p>Our team manually assigned proxies for some of these FCID codes with missing environmental impact factors.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="cleaning-code-for-environment-data.html#cb192-1" tabindex="-1"></a><span class="co"># import proxies for missing enviro data</span></span>
<span id="cb192-2"><a href="cleaning-code-for-environment-data.html#cb192-2" tabindex="-1"></a>ghg_proxies <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/ENVIRONMENT/ghg_ced_impacts/DATA/missing_data/resolved/Missing environmental impacts_mapped.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 6 Columns: 7
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (4): description, fcid_desc, proxy_desc, proxy_notes
## dbl (3): foodcode, fcidcode, proxy_fcidcode
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="cleaning-code-for-environment-data.html#cb194-1" tabindex="-1"></a>ghg_proxies_sub <span class="ot">&lt;-</span> ghg_proxies <span class="sc">%&gt;%</span> </span>
<span id="cb194-2"><a href="cleaning-code-for-environment-data.html#cb194-2" tabindex="-1"></a>  <span class="fu">select</span>(foodcode, description, proxy_fcidcode, proxy_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb194-3"><a href="cleaning-code-for-environment-data.html#cb194-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fcidcode =</span> proxy_fcidcode,</span>
<span id="cb194-4"><a href="cleaning-code-for-environment-data.html#cb194-4" tabindex="-1"></a>         <span class="at">fcid_desc =</span> proxy_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb194-5"><a href="cleaning-code-for-environment-data.html#cb194-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode))</span>
<span id="cb194-6"><a href="cleaning-code-for-environment-data.html#cb194-6" tabindex="-1"></a></span>
<span id="cb194-7"><a href="cleaning-code-for-environment-data.html#cb194-7" tabindex="-1"></a><span class="co"># update rows with proxies</span></span>
<span id="cb194-8"><a href="cleaning-code-for-environment-data.html#cb194-8" tabindex="-1"></a>both_days13 <span class="ot">&lt;-</span> <span class="fu">rows_update</span>(both_days12, ghg_proxies_sub, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;foodcode&quot;</span>, <span class="st">&quot;description&quot;</span>))</span>
<span id="cb194-9"><a href="cleaning-code-for-environment-data.html#cb194-9" tabindex="-1"></a></span>
<span id="cb194-10"><a href="cleaning-code-for-environment-data.html#cb194-10" tabindex="-1"></a><span class="co"># check corn</span></span>
<span id="cb194-11"><a href="cleaning-code-for-environment-data.html#cb194-11" tabindex="-1"></a>both_days13 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(foodcode <span class="sc">==</span> <span class="dv">75215990</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># good</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 93779          2        1     6 75215990 170   Corn, cooked, fr…           0     0 veg_oth         1500127…
## 2 93806          2        1    12 75215990 108   Corn, cooked, fr…           0     0 veg_oth         1500127…
## 3 93881          2        1     7 75215990 108   Corn, cooked, fr…           0     0 veg_oth         1500127…
## 4 93973          1        1     6 75215990  49.6 Corn, cooked, fr…           0     0 veg_oth         1500127…
## 5 93985          2        1    10 75215990 170   Corn, cooked, fr…           0     0 veg_oth         1500127…
## 6 94011          2        1    12 75215990  36   Corn, cooked, fr…           0     0 veg_oth         1500127…
## # ℹ 19 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="cleaning-code-for-environment-data.html#cb196-1" tabindex="-1"></a><span class="co"># fcid should be herb</span></span>
<span id="cb196-2"><a href="cleaning-code-for-environment-data.html#cb196-2" tabindex="-1"></a>both_days13 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(foodcode <span class="sc">==</span> <span class="dv">72133200</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># good!</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 87109          1        1     2 72133200    84 Sweet potato lea…           0     0 veg_dg          1901184…
## 2 87109          1        1     2 72133200    84 Sweet potato lea…           0     0 veg_dg          1901184…
## 3 87109          1        1     2 72133200    84 Sweet potato lea…           0     0 veg_dg          1901184…
## 4 87109          1        1     2 72133200    84 Sweet potato lea…           0     0 veg_dg          1901184…
## 5 87109          1        1     8 72133200    84 Sweet potato lea…           0     0 veg_dg          1901184…
## 6 87109          1        1     8 72133200    84 Sweet potato lea…           0     0 veg_dg          1901184…
## # ℹ 19 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="cleaning-code-for-environment-data.html#cb198-1" tabindex="-1"></a><span class="co"># insert enviro data for fcids that were originally missing</span></span>
<span id="cb198-2"><a href="cleaning-code-for-environment-data.html#cb198-2" tabindex="-1"></a>both_days14 <span class="ot">&lt;-</span> both_days13 <span class="sc">%&gt;%</span> </span>
<span id="cb198-3"><a href="cleaning-code-for-environment-data.html#cb198-3" tabindex="-1"></a>  <span class="fu">rows_patch</span>(datafield_comb, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>, <span class="at">unmatched =</span> <span class="st">&quot;ignore&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb198-4"><a href="cleaning-code-for-environment-data.html#cb198-4" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb198-5"><a href="cleaning-code-for-environment-data.html#cb198-5" tabindex="-1"></a></span>
<span id="cb198-6"><a href="cleaning-code-for-environment-data.html#cb198-6" tabindex="-1"></a><span class="co"># check corn</span></span>
<span id="cb198-7"><a href="cleaning-code-for-environment-data.html#cb198-7" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(foodcode <span class="sc">==</span> <span class="dv">75215990</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 93779          2        1     6 75215990 170   Corn, cooked, fr…           0     0 veg_oth         1500127…
## 2 93806          2        1    12 75215990 108   Corn, cooked, fr…           0     0 veg_oth         1500127…
## 3 93881          2        1     7 75215990 108   Corn, cooked, fr…           0     0 veg_oth         1500127…
## 4 93973          1        1     6 75215990  49.6 Corn, cooked, fr…           0     0 veg_oth         1500127…
## 5 93985          2        1    10 75215990 170   Corn, cooked, fr…           0     0 veg_oth         1500127…
## 6 94011          2        1    12 75215990  36   Corn, cooked, fr…           0     0 veg_oth         1500127…
## # ℹ 19 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="cleaning-code-for-environment-data.html#cb200-1" tabindex="-1"></a><span class="co"># confirm there are no more missing FCIDs</span></span>
<span id="cb200-2"><a href="cleaning-code-for-environment-data.html#cb200-2" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># good</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 2 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other           &lt;NA&gt;    
## 3 83732          2        1     2 91200040     2 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 4 83732          2        1    15 92410520   480 Soft drink, frui…           0     0 other           &lt;NA&gt;    
## 5 83735          1        1     4 92410370   180 Soft drink, pepp…           0     0 other           &lt;NA&gt;    
## 6 83735          1        1    11 92410370   360 Soft drink, pepp…           0     0 other           &lt;NA&gt;    
## # ℹ 19 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="cleaning-code-for-environment-data.html#cb202-1" tabindex="-1"></a><span class="co"># confirm there are no more missing GHG</span></span>
<span id="cb202-2"><a href="cleaning-code-for-environment-data.html#cb202-2" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() </span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 2 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other           &lt;NA&gt;    
## 3 83732          2        1     2 91200040     2 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 4 83732          2        1    15 92410520   480 Soft drink, frui…           0     0 other           &lt;NA&gt;    
## 5 83735          1        1     4 92410370   180 Soft drink, pepp…           0     0 other           &lt;NA&gt;    
## 6 83735          1        1    11 92410370   360 Soft drink, pepp…           0     0 other           &lt;NA&gt;    
## # ℹ 19 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="cleaning-code-for-environment-data.html#cb204-1" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(description, Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   description                                     Foodgroup_FCID
##   &lt;chr&gt;                                           &lt;chr&gt;         
## 1 Sugar substitute, saccharin, powder             other         
## 2 Soft drink, cola, diet                          other         
## 3 Soft drink, fruit flavored, diet, caffeine free other         
## 4 Soft drink, pepper type, diet                   other         
## 5 Soft drink, cola, decaffeinated, diet           other         
## 6 Milk, human                                     babyfood</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="cleaning-code-for-environment-data.html#cb206-1" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   Foodgroup_FCID
##   &lt;chr&gt;         
## 1 other         
## 2 babyfood      
## 3 water         
## 4 gr_whole      
## 5 pf_seafood</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="cleaning-code-for-environment-data.html#cb208-1" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(WATER_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   Foodgroup_FCID
##   &lt;chr&gt;         
## 1 other         
## 2 babyfood      
## 3 water         
## 4 gr_whole      
## 5 pf_seafood</code></pre>
<p>At this point, most of the missing is for babyfood and other foods, so we will move on.</p>
<p>Tidy up the global environment.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="cleaning-code-for-environment-data.html#cb210-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days14&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="fcid-level-social-impact-factors-i.e.-forced-labor-risk" class="section level4 unnumbered hasAnchor">
<h4>FCID-Level Social Impact Factors (i.e., Forced Labor Risk)<a href="cleaning-code-for-environment-data.html#fcid-level-social-impact-factors-i.e.-forced-labor-risk" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Import the forced labor (FL) risk scores (excluding seafood for now) and join with both_days.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="cleaning-code-for-environment-data.html#cb211-1" tabindex="-1"></a><span class="co"># import fl scores</span></span>
<span id="cb211-2"><a href="cleaning-code-for-environment-data.html#cb211-2" tabindex="-1"></a>fl <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/SOCIAL/forced_labor/DATA/FL_scores_FCID_062124.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb211-3"><a href="cleaning-code-for-environment-data.html#cb211-3" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code_chr, Weight_Conversion, FL_Score_Value_grams) <span class="sc">%&gt;%</span> </span>
<span id="cb211-4"><a href="cleaning-code-for-environment-data.html#cb211-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FCID_Code_chr =</span> <span class="fu">as.character</span>(FCID_Code_chr))</span></code></pre></div>
<pre><code>## Rows: 399 Columns: 10
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (3): FCID_Desc, Foodgroup, FL_Score
## dbl (7): FCID_Code, Weight_Conversion, FL_Score_Value, FL_Score_Value_NOFEED, FL_Score_Value_grams, FL_Sc...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="cleaning-code-for-environment-data.html#cb213-1" tabindex="-1"></a><span class="co"># now merge</span></span>
<span id="cb213-2"><a href="cleaning-code-for-environment-data.html#cb213-2" tabindex="-1"></a>both_days15 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days14, fl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;fcidcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;FCID_Code_chr&quot;</span>))</span>
<span id="cb213-3"><a href="cleaning-code-for-environment-data.html#cb213-3" tabindex="-1"></a></span>
<span id="cb213-4"><a href="cleaning-code-for-environment-data.html#cb213-4" tabindex="-1"></a><span class="co"># any missing fl scores?</span></span>
<span id="cb213-5"><a href="cleaning-code-for-environment-data.html#cb213-5" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co">#fine</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83732          2        1     1 92101000   720 Coffee, brewed              0     0 other           9500115…
## 2 83732          2        1     1 92101000   720 Coffee, brewed              0     0 other           8602000…
## 3 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 4 83732          2        1     4 94100100   240 Water, bottled, …           0     0 water           8601200…
## 5 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other           &lt;NA&gt;    
## 6 83732          2        1     9 75506010    20 Mustard                     0     0 veg_oth         9500390…
## # ℹ 21 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;,
## #   Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="cleaning-code-for-environment-data.html#cb215-1" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="co">#fine</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   Foodgroup_FCID
##   &lt;chr&gt;         
## 1 coffee_tea    
## 2 water         
## 3 other         
## 4 pf_seafood    
## 5 babyfood      
## 6 gr_whole</code></pre>
<p>Now we have to handle the seafood scores. First, look at the rows where either the FNDDS- or FCID-level food group is seafood.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="cleaning-code-for-environment-data.html#cb217-1" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83733          2        1     4 26107140   226 Catfish, coated,…        0.43     0 pf_seafood      2301236…
## 2 83733          2        1     4 26107140   226 Catfish, coated,…        0.43     0 pf_seafood      2001319…
## 3 83733          2        1     4 26107140   226 Catfish, coated,…        0.43     0 pf_seafood      9500265…
## 4 83733          2        1     4 26107140   226 Catfish, coated,…        0.43     0 pf_seafood      2002330…
## 5 83733          2        1     4 26107140   226 Catfish, coated,…        0.43     0 pf_seafood      8000158…
## 6 83733          2        1     4 26107140   226 Catfish, coated,…        0.43     0 pf_seafood      2003128…
## # ℹ 21 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;,
## #   Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="cleaning-code-for-environment-data.html#cb219-1" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83733          2        1     4 26107140  226  Catfish, coated,…        0.43     0 pf_seafood      8000158…
## 2 83733          2        1     5 26107140  680  Catfish, coated,…        1.29     0 pf_seafood      8000158…
## 3 83742          2        1    11 58146372  188. Pasta with tomat…        0.19     0 gr_refined      8000161…
## 4 83742          2        1    11 58146372  188. Pasta with tomat…        0.19     0 gr_refined      8000162…
## 5 83755          2        1    10 26109110  153  Cod, cooked, NS …        0        0 pf_seafood      8000160…
## 6 83756          2        1     3 27450060  119  Tuna salad, made…        0.44     0 pf_seafood      8000159…
## # ℹ 21 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;,
## #   Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="cleaning-code-for-environment-data.html#cb221-1" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span> <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83733          2        1     4 26107140  226  Catfish, coated,…        0.43     0 pf_seafood      8000158…
## 2 83733          2        1     5 26107140  680  Catfish, coated,…        1.29     0 pf_seafood      8000158…
## 3 83755          2        1    10 26109110  153  Cod, cooked, NS …        0        0 pf_seafood      8000160…
## 4 83756          2        1     3 27450060  119  Tuna salad, made…        0.44     0 pf_seafood      8000159…
## 5 83761          2        1     4 27450750  197. Fish and vegetab…        0        0 pf_seafood      8000160…
## 6 83761          2        1    10 27250120  347. Shrimp and noodl…        0        0 pf_seafood      8000161…
## # ℹ 21 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;,
## #   Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<p>Split both_days into two distinct datasets so that we can work with them separately: one containing all rows where both the FNDDS- and FCID-level food group is seafood, and the second containing the remaining rows.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="cleaning-code-for-environment-data.html#cb223-1" tabindex="-1"></a>seafood <span class="ot">&lt;-</span> both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span> <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb223-2"><a href="cleaning-code-for-environment-data.html#cb223-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Weight_Conversion, FL_Score_Value_grams))</span>
<span id="cb223-3"><a href="cleaning-code-for-environment-data.html#cb223-3" tabindex="-1"></a></span>
<span id="cb223-4"><a href="cleaning-code-for-environment-data.html#cb223-4" tabindex="-1"></a>no_seafood <span class="ot">&lt;-</span> both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span> <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>))</span>
<span id="cb223-5"><a href="cleaning-code-for-environment-data.html#cb223-5" tabindex="-1"></a></span>
<span id="cb223-6"><a href="cleaning-code-for-environment-data.html#cb223-6" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb223-7"><a href="cleaning-code-for-environment-data.html#cb223-7" tabindex="-1"></a><span class="fu">nrow</span>(seafood) <span class="sc">+</span> <span class="fu">nrow</span>(no_seafood)</span></code></pre></div>
<pre><code>## [1] 2823994</code></pre>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="cleaning-code-for-environment-data.html#cb225-1" tabindex="-1"></a><span class="fu">nrow</span>(both_days15)</span></code></pre></div>
<pre><code>## [1] 2823994</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="cleaning-code-for-environment-data.html#cb227-1" tabindex="-1"></a><span class="fu">nrow</span>(seafood) <span class="sc">+</span> <span class="fu">nrow</span>(no_seafood) <span class="sc">==</span> <span class="fu">nrow</span>(both_days15)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Now, import the seafood-specific forced labor scores (“sea_scores”) and join with the seafood diet dataset (“seafood”).</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="cleaning-code-for-environment-data.html#cb229-1" tabindex="-1"></a><span class="co"># import seafood scores</span></span>
<span id="cb229-2"><a href="cleaning-code-for-environment-data.html#cb229-2" tabindex="-1"></a>sea_scores <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/SOCIAL/forced_labor/DATA/seafood_FL_scores_FNDDS_062124.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb229-3"><a href="cleaning-code-for-environment-data.html#cb229-3" tabindex="-1"></a>  <span class="fu">select</span>(FNDDS_Code, FL_Score_Value_grams)</span></code></pre></div>
<pre><code>## Rows: 387 Columns: 8
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): FNDDS_Desc, FL_Score
## dbl (6): FNDDS_Code, FL_Score_Value_chr, FL_Score_Value_NOFEED, FL_Score_Value, FL_Score_Value_grams, FL_...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="cleaning-code-for-environment-data.html#cb231-1" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb231-2"><a href="cleaning-code-for-environment-data.html#cb231-2" tabindex="-1"></a>sea_join <span class="ot">&lt;-</span> <span class="fu">left_join</span>(seafood, sea_scores, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;FNDDS_Code&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in left_join(seafood, sea_scores, by = c(foodcode = &quot;FNDDS_Code&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 26 of `x` matches multiple rows in `y`.
## ℹ Row 15 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<p>The seafood dish “bouillabaisse” was very complicated to handle, and therefore we had to calculate the FL score for this dish in a separate Excel sheet, which gets read in below.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="cleaning-code-for-environment-data.html#cb233-1" tabindex="-1"></a><span class="co"># missing</span></span>
<span id="cb233-2"><a href="cleaning-code-for-environment-data.html#cb233-2" tabindex="-1"></a>sea_join <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="co"># bouillabaise</span></span></code></pre></div>
<pre><code>## # A tibble: 24 × 31
##     seqn daysintake reliable  line foodcode grams description   added_sugar   ssb Foodgroup_FNDDS fcidcode  
##    &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;     
##  1 84522          1        1     4 27350110  497. Bouillabaisse           0     0 pf_seafood      8000161000
##  2 84522          1        1     4 27350110  497. Bouillabaisse           0     0 pf_seafood      8000160000
##  3 84522          1        1     4 27350110  497. Bouillabaisse           0     0 pf_seafood      8000162000
##  4 84522          1        1     4 27350110  497. Bouillabaisse           0     0 pf_seafood      8000157000
##  5 85731          2        1     9 27350110  454  Bouillabaisse           0     0 pf_seafood      8000161000
##  6 85731          2        1     9 27350110  454  Bouillabaisse           0     0 pf_seafood      8000160000
##  7 85731          2        1     9 27350110  454  Bouillabaisse           0     0 pf_seafood      8000162000
##  8 85731          2        1     9 27350110  454  Bouillabaisse           0     0 pf_seafood      8000157000
##  9 86452          2        1     5 27350110  454  Bouillabaisse           0     0 pf_seafood      8000161000
## 10 86452          2        1     5 27350110  454  Bouillabaisse           0     0 pf_seafood      8000160000
## # ℹ 14 more rows
## # ℹ 20 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;,
## #   FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="cleaning-code-for-environment-data.html#cb235-1" tabindex="-1"></a><span class="co"># import bouillabaise scores</span></span>
<span id="cb235-2"><a href="cleaning-code-for-environment-data.html#cb235-2" tabindex="-1"></a>bou <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/SOCIAL/forced_labor/DATA/Seafood_mapping_06-04-24.xlsx&quot;</span>,</span>
<span id="cb235-3"><a href="cleaning-code-for-environment-data.html#cb235-3" tabindex="-1"></a>                 <span class="at">sheet =</span> <span class="st">&quot;Bouillabaisse_scores&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb235-4"><a href="cleaning-code-for-environment-data.html#cb235-4" tabindex="-1"></a>  <span class="fu">select</span>(FNDDS_code, FCID_code, FL_Score_FCID) <span class="sc">%&gt;%</span> </span>
<span id="cb235-5"><a href="cleaning-code-for-environment-data.html#cb235-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">foodcode =</span> FNDDS_code,</span>
<span id="cb235-6"><a href="cleaning-code-for-environment-data.html#cb235-6" tabindex="-1"></a>         <span class="at">fcidcode =</span> FCID_code) <span class="sc">%&gt;%</span> </span>
<span id="cb235-7"><a href="cleaning-code-for-environment-data.html#cb235-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FL_Score_Value_bou =</span> FL_Score_FCID <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb235-8"><a href="cleaning-code-for-environment-data.html#cb235-8" tabindex="-1"></a>         <span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode)) <span class="sc">%&gt;%</span> </span>
<span id="cb235-9"><a href="cleaning-code-for-environment-data.html#cb235-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>FL_Score_FCID)</span>
<span id="cb235-10"><a href="cleaning-code-for-environment-data.html#cb235-10" tabindex="-1"></a></span>
<span id="cb235-11"><a href="cleaning-code-for-environment-data.html#cb235-11" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb235-12"><a href="cleaning-code-for-environment-data.html#cb235-12" tabindex="-1"></a>sea_join1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(sea_join, bou)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(foodcode, fcidcode)`</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="cleaning-code-for-environment-data.html#cb237-1" tabindex="-1"></a>sea_join2 <span class="ot">&lt;-</span> sea_join1 <span class="sc">%&gt;%</span> </span>
<span id="cb237-2"><a href="cleaning-code-for-environment-data.html#cb237-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FL_Score_Value_grams =</span> <span class="fu">ifelse</span>(foodcode <span class="sc">==</span> <span class="dv">27350110</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_Score_Value_grams), FL_Score_Value_bou, FL_Score_Value_grams),</span>
<span id="cb237-3"><a href="cleaning-code-for-environment-data.html#cb237-3" tabindex="-1"></a>         <span class="co"># set weight conversion to 1 for seafood</span></span>
<span id="cb237-4"><a href="cleaning-code-for-environment-data.html#cb237-4" tabindex="-1"></a>         <span class="at">Weight_Conversion =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb237-5"><a href="cleaning-code-for-environment-data.html#cb237-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>FL_Score_Value_bou)</span>
<span id="cb237-6"><a href="cleaning-code-for-environment-data.html#cb237-6" tabindex="-1"></a></span>
<span id="cb237-7"><a href="cleaning-code-for-environment-data.html#cb237-7" tabindex="-1"></a>sea_join2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="co">#none-woo!</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 32
## # ℹ 32 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;, Foodgroup_FNDDS &lt;chr&gt;, fcidcode &lt;chr&gt;, fcid_desc &lt;chr&gt;,
## #   wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;,
## #   wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;,
## #   CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;,
## #   Weight_Conversion &lt;dbl&gt;</code></pre>
<p>Now re-combine the seafood and non-seafood datasets.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="cleaning-code-for-environment-data.html#cb239-1" tabindex="-1"></a><span class="co"># combine back with no seafood</span></span>
<span id="cb239-2"><a href="cleaning-code-for-environment-data.html#cb239-2" tabindex="-1"></a>both_days12 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(no_seafood, sea_join2) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(seqn, dayrec, line)</span>
<span id="cb239-3"><a href="cleaning-code-for-environment-data.html#cb239-3" tabindex="-1"></a></span>
<span id="cb239-4"><a href="cleaning-code-for-environment-data.html#cb239-4" tabindex="-1"></a><span class="co"># check missing</span></span>
<span id="cb239-5"><a href="cleaning-code-for-environment-data.html#cb239-5" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Weight_Conversion)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co">#fine</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83732          2        1     1 92101000   720 Coffee, brewed              0     0 other           9500115…
## 2 83732          2        1     1 92101000   720 Coffee, brewed              0     0 other           8602000…
## 3 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 4 83732          2        1     4 94100100   240 Water, bottled, …           0     0 water           8601200…
## 5 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other           &lt;NA&gt;    
## 6 83732          2        1     9 75506010    20 Mustard                     0     0 veg_oth         9500390…
## # ℹ 21 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;,
## #   Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="cleaning-code-for-environment-data.html#cb241-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() </span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83732          2        1     1 92101000   720 Coffee, brewed              0     0 other           9500115…
## 2 83732          2        1     1 92101000   720 Coffee, brewed              0     0 other           8602000…
## 3 83732          2        1     2 91200040     4 Sugar substitute…           0     0 added_sugar     &lt;NA&gt;    
## 4 83732          2        1     4 94100100   240 Water, bottled, …           0     0 water           8601200…
## 5 83732          2        1     7 92410320   600 Soft drink, cola…           0     0 other           &lt;NA&gt;    
## 6 83732          2        1     9 75506010    20 Mustard                     0     0 veg_oth         9500390…
## # ℹ 21 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;,
## #   Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="cleaning-code-for-environment-data.html#cb243-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(fcid_desc) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   fcid_desc                   
##   &lt;chr&gt;                       
## 1 Coffee, roasted bean        
## 2 Water, indirect, all sources
## 3 &lt;NA&gt;                        
## 4 Water, direct, bottled      
## 5 Vinegar                     
## 6 Water, direct, tap</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="cleaning-code-for-environment-data.html#cb245-1" tabindex="-1"></a><span class="co"># missing_fl &lt;- both_days12 %&gt;% filter(is.na(FL_Score_Value_grams)) %&gt;% </span></span>
<span id="cb245-2"><a href="cleaning-code-for-environment-data.html#cb245-2" tabindex="-1"></a><span class="co">#   select(description, Foodgroup_FNDDS, fcid_desc, Foodgroup_FCID) %&gt;% </span></span>
<span id="cb245-3"><a href="cleaning-code-for-environment-data.html#cb245-3" tabindex="-1"></a><span class="co">#   filter(!(Foodgroup_FCID %in% c(&quot;water&quot;, &quot;coffee_tea&quot;, &quot;babyfood&quot;, &quot;other&quot;))) %&gt;% </span></span>
<span id="cb245-4"><a href="cleaning-code-for-environment-data.html#cb245-4" tabindex="-1"></a><span class="co">#   distinct()</span></span>
<span id="cb245-5"><a href="cleaning-code-for-environment-data.html#cb245-5" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb245-6"><a href="cleaning-code-for-environment-data.html#cb245-6" tabindex="-1"></a><span class="co"># # export</span></span>
<span id="cb245-7"><a href="cleaning-code-for-environment-data.html#cb245-7" tabindex="-1"></a><span class="co"># write_csv(missing_fl, paste(&quot;data_inputs/SOCIAL/forced_labor/DATA/missing_data/Missing FL scores_&quot;, my_date, &quot;.csv&quot;, sep=&quot;&quot;))</span></span></code></pre></div>
<p>For the remaining missing FL scores for seafood, we will calculate the median seafood-specific FL score and impute the missing scores.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="cleaning-code-for-environment-data.html#cb246-1" tabindex="-1"></a><span class="co"># create impute median</span></span>
<span id="cb246-2"><a href="cleaning-code-for-environment-data.html#cb246-2" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> </span>
<span id="cb246-3"><a href="cleaning-code-for-environment-data.html#cb246-3" tabindex="-1"></a>  <span class="fu">select</span>(seqn, line, dayrec, fcidcode, Foodgroup_FCID, fcid_desc, FL_Score_Value_grams) <span class="sc">%&gt;%</span> </span>
<span id="cb246-4"><a href="cleaning-code-for-environment-data.html#cb246-4" tabindex="-1"></a>  <span class="fu">filter</span>(Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb246-5"><a href="cleaning-code-for-environment-data.html#cb246-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb246-6"><a href="cleaning-code-for-environment-data.html#cb246-6" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##    seqn  line dayrec fcidcode   Foodgroup_FCID fcid_desc                            FL_Score_Value_grams
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;                                               &lt;dbl&gt;
## 1 83733     4      2 8000158000 pf_seafood     Fish-freshwater finfish, farm raised              0.00131
## 2 83733     5      2 8000158000 pf_seafood     Fish-freshwater finfish, farm raised              0.00131
## 3 83742    11      2 8000161000 pf_seafood     Fish-shellfish, crustacean                       NA      
## 4 83742    11      2 8000162000 pf_seafood     Fish-shellfish, mollusc                          NA      
## 5 83755    10      2 8000160000 pf_seafood     Fish-saltwater finfish, other                     0.00131
## 6 83756     3      2 8000159000 pf_seafood     Fish-saltwater finfish, tuna                      0.00121</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="cleaning-code-for-environment-data.html#cb248-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> </span>
<span id="cb248-2"><a href="cleaning-code-for-environment-data.html#cb248-2" tabindex="-1"></a>  <span class="fu">select</span>(fcidcode, fcid_desc, Foodgroup_FCID, FL_Score_Value_grams) <span class="sc">%&gt;%</span> </span>
<span id="cb248-3"><a href="cleaning-code-for-environment-data.html#cb248-3" tabindex="-1"></a>  <span class="fu">filter</span>(Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb248-4"><a href="cleaning-code-for-environment-data.html#cb248-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb248-5"><a href="cleaning-code-for-environment-data.html#cb248-5" tabindex="-1"></a>  <span class="fu">arrange</span>(fcidcode) <span class="sc">%&gt;%</span> </span>
<span id="cb248-6"><a href="cleaning-code-for-environment-data.html#cb248-6" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   fcidcode   fcid_desc               Foodgroup_FCID FL_Score_Value_grams
##   &lt;chr&gt;      &lt;chr&gt;                   &lt;chr&gt;                         &lt;dbl&gt;
## 1 8000157000 Fish-freshwater finfish pf_seafood               0.000751  
## 2 8000157000 Fish-freshwater finfish pf_seafood               0.00108   
## 3 8000157000 Fish-freshwater finfish pf_seafood               0.00167   
## 4 8000157000 Fish-freshwater finfish pf_seafood              NA         
## 5 8000157000 Fish-freshwater finfish pf_seafood               0.000578  
## 6 8000157000 Fish-freshwater finfish pf_seafood               0.00000150</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="cleaning-code-for-environment-data.html#cb250-1" tabindex="-1"></a>imputed_fl <span class="ot">&lt;-</span></span>
<span id="cb250-2"><a href="cleaning-code-for-environment-data.html#cb250-2" tabindex="-1"></a>  both_days12 <span class="sc">%&gt;%</span> </span>
<span id="cb250-3"><a href="cleaning-code-for-environment-data.html#cb250-3" tabindex="-1"></a>  <span class="fu">select</span>(seqn, line, dayrec, fcidcode, Foodgroup_FCID, fcid_desc, FL_Score_Value_grams) <span class="sc">%&gt;%</span> </span>
<span id="cb250-4"><a href="cleaning-code-for-environment-data.html#cb250-4" tabindex="-1"></a>  <span class="fu">filter</span>(Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb250-5"><a href="cleaning-code-for-environment-data.html#cb250-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb250-6"><a href="cleaning-code-for-environment-data.html#cb250-6" tabindex="-1"></a>  <span class="fu">group_by</span>(fcidcode, fcid_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb250-7"><a href="cleaning-code-for-environment-data.html#cb250-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">FL_g_group_median =</span> <span class="fu">median</span>(FL_Score_Value_grams, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb250-8"><a href="cleaning-code-for-environment-data.html#cb250-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(fcidcode)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;fcidcode&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="cleaning-code-for-environment-data.html#cb252-1" tabindex="-1"></a><span class="co"># join imputed fl scores with food data</span></span>
<span id="cb252-2"><a href="cleaning-code-for-environment-data.html#cb252-2" tabindex="-1"></a>both_days13 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days12, imputed_fl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;fcidcode&quot;</span>, <span class="st">&quot;fcid_desc&quot;</span>))</span>
<span id="cb252-3"><a href="cleaning-code-for-environment-data.html#cb252-3" tabindex="-1"></a></span>
<span id="cb252-4"><a href="cleaning-code-for-environment-data.html#cb252-4" tabindex="-1"></a><span class="co"># insert food_group median price if missing</span></span>
<span id="cb252-5"><a href="cleaning-code-for-environment-data.html#cb252-5" tabindex="-1"></a>both_days14 <span class="ot">&lt;-</span> both_days13 <span class="sc">%&gt;%</span> </span>
<span id="cb252-6"><a href="cleaning-code-for-environment-data.html#cb252-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FL_Score_Value_grams =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(FL_Score_Value_grams) <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>, FL_g_group_median, FL_Score_Value_grams)) <span class="sc">%&gt;%</span> </span>
<span id="cb252-7"><a href="cleaning-code-for-environment-data.html#cb252-7" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb252-8"><a href="cleaning-code-for-environment-data.html#cb252-8" tabindex="-1"></a></span>
<span id="cb252-9"><a href="cleaning-code-for-environment-data.html#cb252-9" tabindex="-1"></a><span class="co"># check if any missing price per gram (shouldn&#39;t be)</span></span>
<span id="cb252-10"><a href="cleaning-code-for-environment-data.html#cb252-10" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(fcid_desc) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   fcid_desc                   
##   &lt;chr&gt;                       
## 1 Coffee, roasted bean        
## 2 Water, indirect, all sources
## 3 &lt;NA&gt;                        
## 4 Water, direct, bottled      
## 5 Vinegar                     
## 6 Water, direct, tap</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="cleaning-code-for-environment-data.html#cb254-1" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams) <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 33
## # ℹ 33 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;, Foodgroup_FNDDS &lt;chr&gt;, fcidcode &lt;chr&gt;, fcid_desc &lt;chr&gt;,
## #   wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;,
## #   wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;,
## #   CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;,
## #   FL_Score_Value_grams &lt;dbl&gt;, FL_g_group_median &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="cleaning-code-for-environment-data.html#cb256-1" tabindex="-1"></a><span class="co"># check cocoa bean</span></span>
<span id="cb256-2"><a href="cleaning-code-for-environment-data.html#cb256-2" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fcid_desc <span class="sc">==</span> <span class="st">&quot;Cocoa bean, chocolate&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 33
##    seqn daysintake reliable  line foodcode grams description       added_sugar   ssb Foodgroup_FNDDS fcidcode
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   
## 1 83735          1        1     5 91705300     8 Chocolate, sweet…        0.93     0 added_sugar     9500109…
## 2 83735          1        1     6 91705310    14 Chocolate, sweet…        1.4      0 added_sugar     9500109…
## 3 83737          2        1     4 27146160   244 Chicken with mol…        0        0 pf_poultry      9500109…
## 4 83739          2        1    14 53210900    42 Cookie, graham c…        3.88     0 gr_refined      9500109…
## 5 83745          2        1     9 53206000    90 Cookie, chocolat…        6.97     0 gr_refined      9500109…
## 6 83755          2        1    11 53520160    36 Doughnut, chocol…        2.12     0 gr_refined      9500109…
## # ℹ 22 more variables: fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;,
## #   waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;,
## #   inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;,
## #   wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;, WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;,
## #   Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;, FL_g_group_median &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="cleaning-code-for-environment-data.html#cb258-1" tabindex="-1"></a><span class="co"># create new nhanes cycle variable</span></span>
<span id="cb258-2"><a href="cleaning-code-for-environment-data.html#cb258-2" tabindex="-1"></a>both_days15 <span class="ot">&lt;-</span> both_days14 <span class="sc">%&gt;%</span></span>
<span id="cb258-3"><a href="cleaning-code-for-environment-data.html#cb258-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nhanes1516 =</span> <span class="fu">ifelse</span>(nhanes_cycle <span class="sc">==</span> <span class="st">&quot;2015-2016&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code></pre></div>
</div>
</div>
<div id="calculate-average-environmental-and-social-impact-per-fcid-code" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Calculate Average Environmental and Social Impact, Per FCID Code<a href="cleaning-code-for-environment-data.html#calculate-average-environmental-and-social-impact-per-fcid-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, we will calculate (i) the average environmental impacts per 1 gram of each FCID code, and (ii) the average amount of forced labor risk per 1 gram of each FCID code. This process includes aggregating and summarizing the diet dataset.</p>
<p>First, take the original environmental impact factors provided by the dataField datasets, the units of which are per 1 kilograms (1000 grams) and divide by 1000 to get the impacts per 1 gram of food. The forced labor impact factor, on the other hand, just needs to be multiplied by the weight conversion factor.</p>
<p>Then, for all the impact factors, calculate the total amounts of impact for the given amount of consumed food by multiplying the impact factor (per 1 gram of food) by the consumed amount of food (in grams).</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="cleaning-code-for-environment-data.html#cb259-1" tabindex="-1"></a>my_enviro_table <span class="ot">&lt;-</span> </span>
<span id="cb259-2"><a href="cleaning-code-for-environment-data.html#cb259-2" tabindex="-1"></a>  both_days15 <span class="sc">%&gt;%</span> </span>
<span id="cb259-3"><a href="cleaning-code-for-environment-data.html#cb259-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb259-4"><a href="cleaning-code-for-environment-data.html#cb259-4" tabindex="-1"></a>    <span class="at">GHG_impact_per_gram =</span> GHG_mn <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb259-5"><a href="cleaning-code-for-environment-data.html#cb259-5" tabindex="-1"></a>    <span class="at">GHG_impact_per_FCID_Consumed =</span> GHG_impact_per_gram <span class="sc">*</span> consumed_amt_FCID,</span>
<span id="cb259-6"><a href="cleaning-code-for-environment-data.html#cb259-6" tabindex="-1"></a>    </span>
<span id="cb259-7"><a href="cleaning-code-for-environment-data.html#cb259-7" tabindex="-1"></a>    <span class="at">CED_impact_per_gram =</span> CED_mn <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb259-8"><a href="cleaning-code-for-environment-data.html#cb259-8" tabindex="-1"></a>    <span class="at">CED_impact_per_FCID_Consumed =</span> CED_impact_per_gram <span class="sc">*</span> consumed_amt_FCID,</span>
<span id="cb259-9"><a href="cleaning-code-for-environment-data.html#cb259-9" tabindex="-1"></a>    </span>
<span id="cb259-10"><a href="cleaning-code-for-environment-data.html#cb259-10" tabindex="-1"></a>    <span class="at">WATER_impact_per_gram =</span> WATER_mn <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb259-11"><a href="cleaning-code-for-environment-data.html#cb259-11" tabindex="-1"></a>    <span class="at">WATER_impact_per_FCID_Consumed =</span> WATER_impact_per_gram <span class="sc">*</span> consumed_amt_FCID,</span>
<span id="cb259-12"><a href="cleaning-code-for-environment-data.html#cb259-12" tabindex="-1"></a>    </span>
<span id="cb259-13"><a href="cleaning-code-for-environment-data.html#cb259-13" tabindex="-1"></a>    <span class="at">BLUEWATER_impact_per_gram =</span> BLUEWATER_mn <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb259-14"><a href="cleaning-code-for-environment-data.html#cb259-14" tabindex="-1"></a>    <span class="at">BLUEWATER_impact_per_FCID_Consumed =</span> BLUEWATER_impact_per_gram <span class="sc">*</span> consumed_amt_FCID,</span>
<span id="cb259-15"><a href="cleaning-code-for-environment-data.html#cb259-15" tabindex="-1"></a>    </span>
<span id="cb259-16"><a href="cleaning-code-for-environment-data.html#cb259-16" tabindex="-1"></a>    <span class="at">FL_impact_per_gram =</span> FL_Score_Value_grams <span class="sc">*</span> Weight_Conversion,</span>
<span id="cb259-17"><a href="cleaning-code-for-environment-data.html#cb259-17" tabindex="-1"></a>    <span class="at">FL_impact_per_FCID_Consumed =</span> FL_impact_per_gram <span class="sc">*</span> consumed_amt_FCID)</span></code></pre></div>
<p>Check missing.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="cleaning-code-for-environment-data.html#cb260-1" tabindex="-1"></a><span class="co"># what food groups have missing impact factors?</span></span>
<span id="cb260-2"><a href="cleaning-code-for-environment-data.html#cb260-2" tabindex="-1"></a>my_enviro_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_impact_per_gram)) <span class="sc">%&gt;%</span> </span>
<span id="cb260-3"><a href="cleaning-code-for-environment-data.html#cb260-3" tabindex="-1"></a>  <span class="fu">select</span>(fcidcode, fcid_desc, Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   fcidcode   fcid_desc                                    Foodgroup_FCID
##   &lt;chr&gt;      &lt;chr&gt;                                        &lt;chr&gt;         
## 1 &lt;NA&gt;       &lt;NA&gt;                                         other         
## 2 3700222501 Milk, human                                  babyfood      
## 3 &lt;NA&gt;       &lt;NA&gt;                                         water         
## 4 2002365001 Sunflower, oil-babyfood                      babyfood      
## 5 1400114001 Coconut, oil-babyfood                        babyfood      
## 6 3600223001 Milk, nonfat solids-baby food/infant formula babyfood</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="cleaning-code-for-environment-data.html#cb262-1" tabindex="-1"></a><span class="co"># this is fine</span></span>
<span id="cb262-2"><a href="cleaning-code-for-environment-data.html#cb262-2" tabindex="-1"></a></span>
<span id="cb262-3"><a href="cleaning-code-for-environment-data.html#cb262-3" tabindex="-1"></a>my_enviro_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_impact_per_gram)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-4"><a href="cleaning-code-for-environment-data.html#cb262-4" tabindex="-1"></a>  <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   Foodgroup_FCID
##   &lt;chr&gt;         
## 1 other         
## 2 babyfood      
## 3 water         
## 4 gr_whole      
## 5 pf_seafood</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="cleaning-code-for-environment-data.html#cb264-1" tabindex="-1"></a>my_enviro_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_impact_per_gram)) <span class="sc">%&gt;%</span> </span>
<span id="cb264-2"><a href="cleaning-code-for-environment-data.html#cb264-2" tabindex="-1"></a>  <span class="fu">select</span>(fcidcode, fcid_desc, Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   fcidcode   fcid_desc                    Foodgroup_FCID
##   &lt;chr&gt;      &lt;chr&gt;                        &lt;chr&gt;         
## 1 9500115000 Coffee, roasted bean         coffee_tea    
## 2 8602000000 Water, indirect, all sources water         
## 3 &lt;NA&gt;       &lt;NA&gt;                         other         
## 4 8601200000 Water, direct, bottled       water         
## 5 9500390000 Vinegar                      other         
## 6 8601100000 Water, direct, tap           water</code></pre>
<p>Then, calculate the total impacts, per day, per person, by adding up the food-level impacts for each person-day combination. Additionally, calculate the consumed, inedible, and wasted amounts of food per day, per person, to be used later in the code.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="cleaning-code-for-environment-data.html#cb266-1" tabindex="-1"></a>enviro_impact <span class="ot">&lt;-</span> my_enviro_table <span class="sc">%&gt;%</span> </span>
<span id="cb266-2"><a href="cleaning-code-for-environment-data.html#cb266-2" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, fcidcode, dayrec) <span class="sc">%&gt;%</span> </span>
<span id="cb266-3"><a href="cleaning-code-for-environment-data.html#cb266-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GHG_per_day_Consumed =</span> <span class="fu">sum</span>(GHG_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb266-4"><a href="cleaning-code-for-environment-data.html#cb266-4" tabindex="-1"></a>            <span class="at">CED_per_day_Consumed =</span> <span class="fu">sum</span>(CED_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb266-5"><a href="cleaning-code-for-environment-data.html#cb266-5" tabindex="-1"></a>            <span class="at">WATER_per_day_Consumed =</span> <span class="fu">sum</span>(WATER_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb266-6"><a href="cleaning-code-for-environment-data.html#cb266-6" tabindex="-1"></a>            <span class="at">BLUEWATER_per_day_Consumed =</span> <span class="fu">sum</span>(BLUEWATER_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb266-7"><a href="cleaning-code-for-environment-data.html#cb266-7" tabindex="-1"></a>            <span class="at">FL_per_day_Consumed =</span> <span class="fu">sum</span>(FL_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb266-8"><a href="cleaning-code-for-environment-data.html#cb266-8" tabindex="-1"></a>            </span>
<span id="cb266-9"><a href="cleaning-code-for-environment-data.html#cb266-9" tabindex="-1"></a>            <span class="at">consumed_per_day =</span> <span class="fu">sum</span>(consumed_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb266-10"><a href="cleaning-code-for-environment-data.html#cb266-10" tabindex="-1"></a>            <span class="at">inedible_per_day =</span> <span class="fu">sum</span>(inedible_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb266-11"><a href="cleaning-code-for-environment-data.html#cb266-11" tabindex="-1"></a>            <span class="at">wasted_per_day =</span> <span class="fu">sum</span>(wasted_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb266-12"><a href="cleaning-code-for-environment-data.html#cb266-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(fcidcode)))  <span class="co"># this is needed bc there are some na fcidcodes</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;, &#39;fcidcode&#39;. You can override using the `.groups` argument.</code></pre>
<p>Now, repeat the same steps above specifically for sugar sweetened beverages (this is done by including the “ssb” variable in the “group_by” statement).</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="cleaning-code-for-environment-data.html#cb268-1" tabindex="-1"></a><span class="co"># now do ssb</span></span>
<span id="cb268-2"><a href="cleaning-code-for-environment-data.html#cb268-2" tabindex="-1"></a>ssb_impact <span class="ot">&lt;-</span> my_enviro_table <span class="sc">%&gt;%</span> </span>
<span id="cb268-3"><a href="cleaning-code-for-environment-data.html#cb268-3" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, fcidcode, dayrec, ssb) <span class="sc">%&gt;%</span> </span>
<span id="cb268-4"><a href="cleaning-code-for-environment-data.html#cb268-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GHG_per_day_Consumed =</span> <span class="fu">sum</span>(GHG_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-5"><a href="cleaning-code-for-environment-data.html#cb268-5" tabindex="-1"></a>            <span class="at">CED_per_day_Consumed =</span> <span class="fu">sum</span>(CED_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-6"><a href="cleaning-code-for-environment-data.html#cb268-6" tabindex="-1"></a>            <span class="at">WATER_per_day_Consumed =</span> <span class="fu">sum</span>(WATER_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-7"><a href="cleaning-code-for-environment-data.html#cb268-7" tabindex="-1"></a>            <span class="at">BLUEWATER_per_day_Consumed =</span> <span class="fu">sum</span>(BLUEWATER_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-8"><a href="cleaning-code-for-environment-data.html#cb268-8" tabindex="-1"></a>            <span class="at">FL_per_day_Consumed =</span> <span class="fu">sum</span>(FL_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-9"><a href="cleaning-code-for-environment-data.html#cb268-9" tabindex="-1"></a>            </span>
<span id="cb268-10"><a href="cleaning-code-for-environment-data.html#cb268-10" tabindex="-1"></a>            <span class="at">consumed_per_day =</span> <span class="fu">sum</span>(consumed_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-11"><a href="cleaning-code-for-environment-data.html#cb268-11" tabindex="-1"></a>            <span class="at">inedible_per_day =</span> <span class="fu">sum</span>(inedible_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-12"><a href="cleaning-code-for-environment-data.html#cb268-12" tabindex="-1"></a>            <span class="at">wasted_per_day =</span> <span class="fu">sum</span>(wasted_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb268-13"><a href="cleaning-code-for-environment-data.html#cb268-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(fcidcode)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;, &#39;fcidcode&#39;, &#39;dayrec&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="cleaning-code-for-environment-data.html#cb270-1" tabindex="-1"></a><span class="co"># calculate sum of fcid codes for ssb</span></span>
<span id="cb270-2"><a href="cleaning-code-for-environment-data.html#cb270-2" tabindex="-1"></a>ssb_impact <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 12
## # Groups:   seqn, fcidcode, dayrec [6]
##    seqn fcidcode   dayrec   ssb GHG_per_day_Consumed CED_per_day_Consumed WATER_per_day_Consumed
##   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;                &lt;dbl&gt;                  &lt;dbl&gt;
## 1 83732 101052000       2     1              0.00321               0.0375                   3.95
## 2 83732 8602000000      2     1              0                     0                        0   
## 3 83732 9500362000      2     1              0.00731               0.0537                  10.7 
## 4 83732 9500372000      2     1              0.00378               0.0529                  11.2 
## 5 83736 101052000       1     1              0.00184               0.0215                   2.26
## 6 83736 101052000       2     1              0.00192               0.0225                   2.36
## # ℹ 5 more variables: BLUEWATER_per_day_Consumed &lt;dbl&gt;, FL_per_day_Consumed &lt;dbl&gt;, consumed_per_day &lt;dbl&gt;,
## #   inedible_per_day &lt;dbl&gt;, wasted_per_day &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="cleaning-code-for-environment-data.html#cb272-1" tabindex="-1"></a><span class="co"># calculate summed ssb impact for each seqn and day</span></span>
<span id="cb272-2"><a href="cleaning-code-for-environment-data.html#cb272-2" tabindex="-1"></a>ssb_impact1 <span class="ot">&lt;-</span> ssb_impact <span class="sc">%&gt;%</span> </span>
<span id="cb272-3"><a href="cleaning-code-for-environment-data.html#cb272-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb272-4"><a href="cleaning-code-for-environment-data.html#cb272-4" tabindex="-1"></a>  <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb272-5"><a href="cleaning-code-for-environment-data.html#cb272-5" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, dayrec) <span class="sc">%&gt;%</span> </span>
<span id="cb272-6"><a href="cleaning-code-for-environment-data.html#cb272-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GHG_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(GHG_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb272-7"><a href="cleaning-code-for-environment-data.html#cb272-7" tabindex="-1"></a>            <span class="at">CED_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(CED_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb272-8"><a href="cleaning-code-for-environment-data.html#cb272-8" tabindex="-1"></a>            <span class="at">WATER_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(WATER_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb272-9"><a href="cleaning-code-for-environment-data.html#cb272-9" tabindex="-1"></a>            <span class="at">BLUEWATER_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(BLUEWATER_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb272-10"><a href="cleaning-code-for-environment-data.html#cb272-10" tabindex="-1"></a>            <span class="at">FL_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(FL_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb272-11"><a href="cleaning-code-for-environment-data.html#cb272-11" tabindex="-1"></a>            </span>
<span id="cb272-12"><a href="cleaning-code-for-environment-data.html#cb272-12" tabindex="-1"></a>            <span class="at">consumed_per_day_ssb =</span> <span class="fu">sum</span>(consumed_per_day, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb272-13"><a href="cleaning-code-for-environment-data.html#cb272-13" tabindex="-1"></a>            <span class="at">inedible_per_day_ssb =</span> <span class="fu">sum</span>(inedible_per_day, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb272-14"><a href="cleaning-code-for-environment-data.html#cb272-14" tabindex="-1"></a>            <span class="at">wasted_per_day_ssb =</span> <span class="fu">sum</span>(wasted_per_day, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="cleaning-code-for-environment-data.html#cb274-1" tabindex="-1"></a><span class="co"># go back to non-ssb</span></span>
<span id="cb274-2"><a href="cleaning-code-for-environment-data.html#cb274-2" tabindex="-1"></a></span>
<span id="cb274-3"><a href="cleaning-code-for-environment-data.html#cb274-3" tabindex="-1"></a><span class="co"># check missing</span></span>
<span id="cb274-4"><a href="cleaning-code-for-environment-data.html#cb274-4" tabindex="-1"></a>enviro_impact <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(consumed_per_day)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Groups:   seqn, fcidcode [0]
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, dayrec &lt;dbl&gt;, GHG_per_day_Consumed &lt;dbl&gt;,
## #   CED_per_day_Consumed &lt;dbl&gt;, WATER_per_day_Consumed &lt;dbl&gt;, BLUEWATER_per_day_Consumed &lt;dbl&gt;,
## #   FL_per_day_Consumed &lt;dbl&gt;, consumed_per_day &lt;dbl&gt;, inedible_per_day &lt;dbl&gt;, wasted_per_day &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="cleaning-code-for-environment-data.html#cb276-1" tabindex="-1"></a>enviro_impact <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode))</span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Groups:   seqn, fcidcode [0]
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, dayrec &lt;dbl&gt;, GHG_per_day_Consumed &lt;dbl&gt;,
## #   CED_per_day_Consumed &lt;dbl&gt;, WATER_per_day_Consumed &lt;dbl&gt;, BLUEWATER_per_day_Consumed &lt;dbl&gt;,
## #   FL_per_day_Consumed &lt;dbl&gt;, consumed_per_day &lt;dbl&gt;, inedible_per_day &lt;dbl&gt;, wasted_per_day &lt;dbl&gt;</code></pre>
<p>Transform dataset to wide format.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="cleaning-code-for-environment-data.html#cb278-1" tabindex="-1"></a>enviro_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(enviro_impact, </span>
<span id="cb278-2"><a href="cleaning-code-for-environment-data.html#cb278-2" tabindex="-1"></a>                           <span class="at">names_from =</span> dayrec,</span>
<span id="cb278-3"><a href="cleaning-code-for-environment-data.html#cb278-3" tabindex="-1"></a>                           <span class="at">values_from =</span> <span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">&quot;per_day&quot;</span>)))</span></code></pre></div>
<p>Because some participants have 2 days of dietary recall, we need to calculate average impacts for each FCID code, per participant. If a participant only has 1 day of recall, then we use that to represent the average.</p>
<p>To calculate the average, we first need to determine how many days of recall each participant has.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="cleaning-code-for-environment-data.html#cb279-1" tabindex="-1"></a><span class="co"># calculate # days of recall</span></span>
<span id="cb279-2"><a href="cleaning-code-for-environment-data.html#cb279-2" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">select</span>(reliable) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## reliable
##       1       4 
## 2799377   25083</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="cleaning-code-for-environment-data.html#cb281-1" tabindex="-1"></a>daysofintake <span class="ot">&lt;-</span> both_days15 <span class="sc">%&gt;%</span> <span class="fu">select</span>(seqn, daysintake, reliable) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb281-2"><a href="cleaning-code-for-environment-data.html#cb281-2" tabindex="-1"></a></span>
<span id="cb281-3"><a href="cleaning-code-for-environment-data.html#cb281-3" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb281-4"><a href="cleaning-code-for-environment-data.html#cb281-4" tabindex="-1"></a>enviro_wide1 <span class="ot">&lt;-</span> enviro_wide <span class="sc">%&gt;%</span> </span>
<span id="cb281-5"><a href="cleaning-code-for-environment-data.html#cb281-5" tabindex="-1"></a>  <span class="fu">left_join</span>(daysofintake, <span class="at">by =</span> <span class="st">&quot;seqn&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in left_join(., daysofintake, by = &quot;seqn&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 33073 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="cleaning-code-for-environment-data.html#cb283-1" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb283-2"><a href="cleaning-code-for-environment-data.html#cb283-2" tabindex="-1"></a>enviro_wide1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_1)) <span class="co">#good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 20
## # Groups:   seqn, fcidcode [0]
## # ℹ 20 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, GHG_per_day_Consumed_1 &lt;dbl&gt;, GHG_per_day_Consumed_2 &lt;dbl&gt;,
## #   CED_per_day_Consumed_1 &lt;dbl&gt;, CED_per_day_Consumed_2 &lt;dbl&gt;, WATER_per_day_Consumed_1 &lt;dbl&gt;,
## #   WATER_per_day_Consumed_2 &lt;dbl&gt;, BLUEWATER_per_day_Consumed_1 &lt;dbl&gt;, BLUEWATER_per_day_Consumed_2 &lt;dbl&gt;,
## #   FL_per_day_Consumed_1 &lt;dbl&gt;, FL_per_day_Consumed_2 &lt;dbl&gt;, consumed_per_day_1 &lt;dbl&gt;,
## #   consumed_per_day_2 &lt;dbl&gt;, inedible_per_day_1 &lt;dbl&gt;, inedible_per_day_2 &lt;dbl&gt;, wasted_per_day_1 &lt;dbl&gt;,
## #   wasted_per_day_2 &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;</code></pre>
<p>Now, we have to fill in some 0s to properly calculate averages later on.</p>
<p>If a participant has 2 days of intake and their corresponding impact (e.g., GHG) for day 1 or day 2 is missing (NA), then we need to replace those NAs with 0s, because in this case, the data aren’t “missing”, the participant just didn’t consume that food on those day.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="cleaning-code-for-environment-data.html#cb285-1" tabindex="-1"></a>enviro_wide2 <span class="ot">&lt;-</span> enviro_wide1 <span class="sc">%&gt;%</span> </span>
<span id="cb285-2"><a href="cleaning-code-for-environment-data.html#cb285-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="co"># day 2</span></span>
<span id="cb285-3"><a href="cleaning-code-for-environment-data.html#cb285-3" tabindex="-1"></a>    <span class="at">GHG_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(GHG_per_day_Consumed_2), <span class="dv">0</span>, GHG_per_day_Consumed_2),</span>
<span id="cb285-4"><a href="cleaning-code-for-environment-data.html#cb285-4" tabindex="-1"></a>    <span class="at">CED_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(CED_per_day_Consumed_2), <span class="dv">0</span>, CED_per_day_Consumed_2),</span>
<span id="cb285-5"><a href="cleaning-code-for-environment-data.html#cb285-5" tabindex="-1"></a>    <span class="at">WATER_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(WATER_per_day_Consumed_2), <span class="dv">0</span>, WATER_per_day_Consumed_2),</span>
<span id="cb285-6"><a href="cleaning-code-for-environment-data.html#cb285-6" tabindex="-1"></a>    <span class="at">BLUEWATER_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(BLUEWATER_per_day_Consumed_2), <span class="dv">0</span>, BLUEWATER_per_day_Consumed_2),</span>
<span id="cb285-7"><a href="cleaning-code-for-environment-data.html#cb285-7" tabindex="-1"></a>    <span class="at">FL_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_per_day_Consumed_2), <span class="dv">0</span>, FL_per_day_Consumed_2),</span>
<span id="cb285-8"><a href="cleaning-code-for-environment-data.html#cb285-8" tabindex="-1"></a>    </span>
<span id="cb285-9"><a href="cleaning-code-for-environment-data.html#cb285-9" tabindex="-1"></a>    <span class="at">consumed_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_2), <span class="dv">0</span>, consumed_per_day_2),</span>
<span id="cb285-10"><a href="cleaning-code-for-environment-data.html#cb285-10" tabindex="-1"></a>    <span class="at">wasted_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_2), <span class="dv">0</span>, wasted_per_day_2),</span>
<span id="cb285-11"><a href="cleaning-code-for-environment-data.html#cb285-11" tabindex="-1"></a>    <span class="at">inedible_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_2), <span class="dv">0</span>, inedible_per_day_2),</span>
<span id="cb285-12"><a href="cleaning-code-for-environment-data.html#cb285-12" tabindex="-1"></a>    </span>
<span id="cb285-13"><a href="cleaning-code-for-environment-data.html#cb285-13" tabindex="-1"></a>    <span class="co"># day1</span></span>
<span id="cb285-14"><a href="cleaning-code-for-environment-data.html#cb285-14" tabindex="-1"></a>    <span class="at">GHG_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(GHG_per_day_Consumed_1), <span class="dv">0</span>, GHG_per_day_Consumed_1),</span>
<span id="cb285-15"><a href="cleaning-code-for-environment-data.html#cb285-15" tabindex="-1"></a>    <span class="at">CED_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(CED_per_day_Consumed_1), <span class="dv">0</span>, CED_per_day_Consumed_1),</span>
<span id="cb285-16"><a href="cleaning-code-for-environment-data.html#cb285-16" tabindex="-1"></a>    <span class="at">WATER_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(WATER_per_day_Consumed_1), <span class="dv">0</span>, WATER_per_day_Consumed_1),</span>
<span id="cb285-17"><a href="cleaning-code-for-environment-data.html#cb285-17" tabindex="-1"></a>    <span class="at">BLUEWATER_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(BLUEWATER_per_day_Consumed_1), <span class="dv">0</span>, BLUEWATER_per_day_Consumed_1),</span>
<span id="cb285-18"><a href="cleaning-code-for-environment-data.html#cb285-18" tabindex="-1"></a>    <span class="at">FL_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_per_day_Consumed_1), <span class="dv">0</span>, FL_per_day_Consumed_1),</span>
<span id="cb285-19"><a href="cleaning-code-for-environment-data.html#cb285-19" tabindex="-1"></a>    </span>
<span id="cb285-20"><a href="cleaning-code-for-environment-data.html#cb285-20" tabindex="-1"></a>    <span class="at">consumed_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_1), <span class="dv">0</span>, consumed_per_day_1),</span>
<span id="cb285-21"><a href="cleaning-code-for-environment-data.html#cb285-21" tabindex="-1"></a>    <span class="at">wasted_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_1), <span class="dv">0</span>, wasted_per_day_1),</span>
<span id="cb285-22"><a href="cleaning-code-for-environment-data.html#cb285-22" tabindex="-1"></a>    <span class="at">inedible_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_1), <span class="dv">0</span>, inedible_per_day_1))</span></code></pre></div>
<p>Calculate the <strong>average</strong> total impacts of consumed food at the FCID code-level for each person. This will give us the data we need to calculate the environmental and forced labor impact factors in the next section.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="cleaning-code-for-environment-data.html#cb286-1" tabindex="-1"></a><span class="co"># summarize DAY1 AND DAY2</span></span>
<span id="cb286-2"><a href="cleaning-code-for-environment-data.html#cb286-2" tabindex="-1"></a>enviro_wide3 <span class="ot">&lt;-</span> enviro_wide2 <span class="sc">%&gt;%</span> </span>
<span id="cb286-3"><a href="cleaning-code-for-environment-data.html#cb286-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb286-4"><a href="cleaning-code-for-environment-data.html#cb286-4" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb286-5"><a href="cleaning-code-for-environment-data.html#cb286-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ghg_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(GHG_per_day_Consumed_1, GHG_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-6"><a href="cleaning-code-for-environment-data.html#cb286-6" tabindex="-1"></a>         <span class="at">ced_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(CED_per_day_Consumed_1, CED_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-7"><a href="cleaning-code-for-environment-data.html#cb286-7" tabindex="-1"></a>         <span class="at">water_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(WATER_per_day_Consumed_1, WATER_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-8"><a href="cleaning-code-for-environment-data.html#cb286-8" tabindex="-1"></a>         <span class="at">bluewater_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(BLUEWATER_per_day_Consumed_1, BLUEWATER_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-9"><a href="cleaning-code-for-environment-data.html#cb286-9" tabindex="-1"></a>         <span class="at">fl_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(FL_per_day_Consumed_1, FL_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-10"><a href="cleaning-code-for-environment-data.html#cb286-10" tabindex="-1"></a>         </span>
<span id="cb286-11"><a href="cleaning-code-for-environment-data.html#cb286-11" tabindex="-1"></a>         <span class="at">consumed_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(consumed_per_day_1, consumed_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-12"><a href="cleaning-code-for-environment-data.html#cb286-12" tabindex="-1"></a>         <span class="at">inedible_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(inedible_per_day_1, inedible_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-13"><a href="cleaning-code-for-environment-data.html#cb286-13" tabindex="-1"></a>         <span class="at">wasted_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(wasted_per_day_1, wasted_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-14"><a href="cleaning-code-for-environment-data.html#cb286-14" tabindex="-1"></a>  <span class="fu">select</span>(seqn, fcidcode, <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;ghg_impact_avg_&quot;</span>, <span class="st">&quot;ced_impact_avg_&quot;</span>, <span class="st">&quot;water_impact_avg_&quot;</span>, <span class="st">&quot;bluewater_impact_avg_&quot;</span>, <span class="st">&quot;fl_impact_avg_&quot;</span>)),</span>
<span id="cb286-15"><a href="cleaning-code-for-environment-data.html#cb286-15" tabindex="-1"></a>         consumed_avg, inedible_avg, wasted_avg)</span></code></pre></div>
<p>Import the FCID-to-dietary-factor mapping and join with enviro_wide so that we can later on summarize the impacts at the dietary factor (i.e., food group) level.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="cleaning-code-for-environment-data.html#cb287-1" tabindex="-1"></a><span class="co"># import fcid-diet factor mapping</span></span>
<span id="cb287-2"><a href="cleaning-code-for-environment-data.html#cb287-2" tabindex="-1"></a>new_map <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fcid_mapping/DATA/FCID_to_dietaryfactor_mapping_01-09-2024_final.xlsx&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb287-3"><a href="cleaning-code-for-environment-data.html#cb287-3" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code, Foodgroup) <span class="sc">%&gt;%</span> </span>
<span id="cb287-4"><a href="cleaning-code-for-environment-data.html#cb287-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fcidcode =</span> FCID_Code,</span>
<span id="cb287-5"><a href="cleaning-code-for-environment-data.html#cb287-5" tabindex="-1"></a>         <span class="at">Foodgroup_FCID =</span> Foodgroup) <span class="sc">%&gt;%</span> </span>
<span id="cb287-6"><a href="cleaning-code-for-environment-data.html#cb287-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode))</span>
<span id="cb287-7"><a href="cleaning-code-for-environment-data.html#cb287-7" tabindex="-1"></a></span>
<span id="cb287-8"><a href="cleaning-code-for-environment-data.html#cb287-8" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb287-9"><a href="cleaning-code-for-environment-data.html#cb287-9" tabindex="-1"></a>enviro_wide4 <span class="ot">&lt;-</span> enviro_wide3 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(new_map, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span>
<span id="cb287-10"><a href="cleaning-code-for-environment-data.html#cb287-10" tabindex="-1"></a></span>
<span id="cb287-11"><a href="cleaning-code-for-environment-data.html#cb287-11" tabindex="-1"></a><span class="co"># CHECK NA</span></span>
<span id="cb287-12"><a href="cleaning-code-for-environment-data.html#cb287-12" tabindex="-1"></a>enviro_wide4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup_FCID)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Rowwise: 
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, ghg_impact_avg_Consumed &lt;dbl&gt;, ced_impact_avg_Consumed &lt;dbl&gt;,
## #   water_impact_avg_Consumed &lt;dbl&gt;, bluewater_impact_avg_Consumed &lt;dbl&gt;, fl_impact_avg_Consumed &lt;dbl&gt;,
## #   consumed_avg &lt;dbl&gt;, inedible_avg &lt;dbl&gt;, wasted_avg &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="cleaning-code-for-environment-data.html#cb289-1" tabindex="-1"></a>enviro_wide4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(consumed_avg)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Rowwise: 
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, ghg_impact_avg_Consumed &lt;dbl&gt;, ced_impact_avg_Consumed &lt;dbl&gt;,
## #   water_impact_avg_Consumed &lt;dbl&gt;, bluewater_impact_avg_Consumed &lt;dbl&gt;, fl_impact_avg_Consumed &lt;dbl&gt;,
## #   consumed_avg &lt;dbl&gt;, inedible_avg &lt;dbl&gt;, wasted_avg &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="cleaning-code-for-environment-data.html#cb291-1" tabindex="-1"></a>enviro_wide4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(ghg_impact_avg_Consumed)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Rowwise: 
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, ghg_impact_avg_Consumed &lt;dbl&gt;, ced_impact_avg_Consumed &lt;dbl&gt;,
## #   water_impact_avg_Consumed &lt;dbl&gt;, bluewater_impact_avg_Consumed &lt;dbl&gt;, fl_impact_avg_Consumed &lt;dbl&gt;,
## #   consumed_avg &lt;dbl&gt;, inedible_avg &lt;dbl&gt;, wasted_avg &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="cleaning-code-for-environment-data.html#cb293-1" tabindex="-1"></a>enviro_wide4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fl_impact_avg_Consumed)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Rowwise: 
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, ghg_impact_avg_Consumed &lt;dbl&gt;, ced_impact_avg_Consumed &lt;dbl&gt;,
## #   water_impact_avg_Consumed &lt;dbl&gt;, bluewater_impact_avg_Consumed &lt;dbl&gt;, fl_impact_avg_Consumed &lt;dbl&gt;,
## #   consumed_avg &lt;dbl&gt;, inedible_avg &lt;dbl&gt;, wasted_avg &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<p>Now add up the impacts per person, by dietary factor (food group).</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="cleaning-code-for-environment-data.html#cb295-1" tabindex="-1"></a>enviro_wide5 <span class="ot">&lt;-</span> enviro_wide4 <span class="sc">%&gt;%</span> </span>
<span id="cb295-2"><a href="cleaning-code-for-environment-data.html#cb295-2" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, Foodgroup_FCID) <span class="sc">%&gt;%</span> </span>
<span id="cb295-3"><a href="cleaning-code-for-environment-data.html#cb295-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ghg_impact_sum_Consumed =</span> <span class="fu">sum</span>(ghg_impact_avg_Consumed),</span>
<span id="cb295-4"><a href="cleaning-code-for-environment-data.html#cb295-4" tabindex="-1"></a>            <span class="at">ced_impact_sum_Consumed =</span> <span class="fu">sum</span>(ced_impact_avg_Consumed),</span>
<span id="cb295-5"><a href="cleaning-code-for-environment-data.html#cb295-5" tabindex="-1"></a>            <span class="at">water_impact_sum_Consumed =</span> <span class="fu">sum</span>(water_impact_avg_Consumed),</span>
<span id="cb295-6"><a href="cleaning-code-for-environment-data.html#cb295-6" tabindex="-1"></a>            <span class="at">bluewater_impact_sum_Consumed =</span> <span class="fu">sum</span>(bluewater_impact_avg_Consumed),</span>
<span id="cb295-7"><a href="cleaning-code-for-environment-data.html#cb295-7" tabindex="-1"></a>            <span class="at">fl_impact_sum_Consumed =</span> <span class="fu">sum</span>(fl_impact_avg_Consumed),</span>
<span id="cb295-8"><a href="cleaning-code-for-environment-data.html#cb295-8" tabindex="-1"></a>            </span>
<span id="cb295-9"><a href="cleaning-code-for-environment-data.html#cb295-9" tabindex="-1"></a>            <span class="at">consumed_sum =</span> <span class="fu">sum</span>(consumed_avg),</span>
<span id="cb295-10"><a href="cleaning-code-for-environment-data.html#cb295-10" tabindex="-1"></a>            <span class="at">inedible_sum =</span> <span class="fu">sum</span>(inedible_avg),</span>
<span id="cb295-11"><a href="cleaning-code-for-environment-data.html#cb295-11" tabindex="-1"></a>            <span class="at">wasted_sum =</span> <span class="fu">sum</span>(wasted_avg))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;. You can override using the `.groups` argument.</code></pre>
<p>Now, repeat the same steps above specifically for sugar sweetened beverages.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="cleaning-code-for-environment-data.html#cb297-1" tabindex="-1"></a><span class="co"># average day 1 and day 2 impacts </span></span>
<span id="cb297-2"><a href="cleaning-code-for-environment-data.html#cb297-2" tabindex="-1"></a>ssb_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(ssb_impact1, </span>
<span id="cb297-3"><a href="cleaning-code-for-environment-data.html#cb297-3" tabindex="-1"></a>                        <span class="at">id_cols =</span> seqn,</span>
<span id="cb297-4"><a href="cleaning-code-for-environment-data.html#cb297-4" tabindex="-1"></a>                        <span class="at">names_from =</span> dayrec,</span>
<span id="cb297-5"><a href="cleaning-code-for-environment-data.html#cb297-5" tabindex="-1"></a>                        <span class="at">values_from =</span> <span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">&quot;per_day&quot;</span>)))</span>
<span id="cb297-6"><a href="cleaning-code-for-environment-data.html#cb297-6" tabindex="-1"></a></span>
<span id="cb297-7"><a href="cleaning-code-for-environment-data.html#cb297-7" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb297-8"><a href="cleaning-code-for-environment-data.html#cb297-8" tabindex="-1"></a>ssb_wide1 <span class="ot">&lt;-</span> ssb_wide <span class="sc">%&gt;%</span> </span>
<span id="cb297-9"><a href="cleaning-code-for-environment-data.html#cb297-9" tabindex="-1"></a>  <span class="fu">left_join</span>(daysofintake, <span class="at">by =</span> <span class="st">&quot;seqn&quot;</span>)</span>
<span id="cb297-10"><a href="cleaning-code-for-environment-data.html#cb297-10" tabindex="-1"></a></span>
<span id="cb297-11"><a href="cleaning-code-for-environment-data.html#cb297-11" tabindex="-1"></a><span class="co"># fix 2 participants with duplicated data</span></span>
<span id="cb297-12"><a href="cleaning-code-for-environment-data.html#cb297-12" tabindex="-1"></a>ssb_wide1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(seqn <span class="sc">==</span> <span class="st">&quot;87444&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 19
## # Groups:   seqn [1]
##    seqn GHG_per_day_Consumed_ssb_2 GHG_per_day_Consumed_ssb_1 CED_per_day_Consumed_s…¹ CED_per_day_Consumed…²
##   &lt;dbl&gt;                      &lt;dbl&gt;                      &lt;dbl&gt;                    &lt;dbl&gt;                  &lt;dbl&gt;
## 1 87444                         NA                     0.0106                       NA                  0.123
## 2 87444                         NA                     0.0106                       NA                  0.123
## # ℹ abbreviated names: ¹​CED_per_day_Consumed_ssb_2, ²​CED_per_day_Consumed_ssb_1
## # ℹ 14 more variables: WATER_per_day_Consumed_ssb_2 &lt;dbl&gt;, WATER_per_day_Consumed_ssb_1 &lt;dbl&gt;,
## #   BLUEWATER_per_day_Consumed_ssb_2 &lt;dbl&gt;, BLUEWATER_per_day_Consumed_ssb_1 &lt;dbl&gt;,
## #   FL_per_day_Consumed_ssb_2 &lt;dbl&gt;, FL_per_day_Consumed_ssb_1 &lt;dbl&gt;, consumed_per_day_ssb_2 &lt;dbl&gt;,
## #   consumed_per_day_ssb_1 &lt;dbl&gt;, inedible_per_day_ssb_2 &lt;dbl&gt;, inedible_per_day_ssb_1 &lt;dbl&gt;,
## #   wasted_per_day_ssb_2 &lt;dbl&gt;, wasted_per_day_ssb_1 &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="cleaning-code-for-environment-data.html#cb299-1" tabindex="-1"></a>ssb_wide1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(seqn <span class="sc">==</span> <span class="st">&quot;95147&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 19
## # Groups:   seqn [1]
##    seqn GHG_per_day_Consumed_ssb_2 GHG_per_day_Consumed_ssb_1 CED_per_day_Consumed_s…¹ CED_per_day_Consumed…²
##   &lt;dbl&gt;                      &lt;dbl&gt;                      &lt;dbl&gt;                    &lt;dbl&gt;                  &lt;dbl&gt;
## 1 95147                         NA                     0.0340                       NA                  0.393
## 2 95147                         NA                     0.0340                       NA                  0.393
## # ℹ abbreviated names: ¹​CED_per_day_Consumed_ssb_2, ²​CED_per_day_Consumed_ssb_1
## # ℹ 14 more variables: WATER_per_day_Consumed_ssb_2 &lt;dbl&gt;, WATER_per_day_Consumed_ssb_1 &lt;dbl&gt;,
## #   BLUEWATER_per_day_Consumed_ssb_2 &lt;dbl&gt;, BLUEWATER_per_day_Consumed_ssb_1 &lt;dbl&gt;,
## #   FL_per_day_Consumed_ssb_2 &lt;dbl&gt;, FL_per_day_Consumed_ssb_1 &lt;dbl&gt;, consumed_per_day_ssb_2 &lt;dbl&gt;,
## #   consumed_per_day_ssb_1 &lt;dbl&gt;, inedible_per_day_ssb_2 &lt;dbl&gt;, inedible_per_day_ssb_1 &lt;dbl&gt;,
## #   wasted_per_day_ssb_2 &lt;dbl&gt;, wasted_per_day_ssb_1 &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="cleaning-code-for-environment-data.html#cb301-1" tabindex="-1"></a>ssb_wide2 <span class="ot">&lt;-</span> </span>
<span id="cb301-2"><a href="cleaning-code-for-environment-data.html#cb301-2" tabindex="-1"></a>  ssb_wide1 <span class="sc">%&gt;%</span> </span>
<span id="cb301-3"><a href="cleaning-code-for-environment-data.html#cb301-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(seqn <span class="sc">==</span> <span class="st">&quot;87444&quot;</span> <span class="sc">&amp;</span> reliable <span class="sc">==</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb301-4"><a href="cleaning-code-for-environment-data.html#cb301-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(seqn <span class="sc">==</span> <span class="st">&quot;95147&quot;</span> <span class="sc">&amp;</span> reliable <span class="sc">==</span> <span class="dv">4</span>))</span>
<span id="cb301-5"><a href="cleaning-code-for-environment-data.html#cb301-5" tabindex="-1"></a></span>
<span id="cb301-6"><a href="cleaning-code-for-environment-data.html#cb301-6" tabindex="-1"></a><span class="co"># add 0s when appropriate</span></span>
<span id="cb301-7"><a href="cleaning-code-for-environment-data.html#cb301-7" tabindex="-1"></a>ssb_wide3 <span class="ot">&lt;-</span> ssb_wide2 <span class="sc">%&gt;%</span> </span>
<span id="cb301-8"><a href="cleaning-code-for-environment-data.html#cb301-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="co"># day 2</span></span>
<span id="cb301-9"><a href="cleaning-code-for-environment-data.html#cb301-9" tabindex="-1"></a>    <span class="at">GHG_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(GHG_per_day_Consumed_ssb_2), <span class="dv">0</span>, GHG_per_day_Consumed_ssb_2),</span>
<span id="cb301-10"><a href="cleaning-code-for-environment-data.html#cb301-10" tabindex="-1"></a>    <span class="at">CED_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(CED_per_day_Consumed_ssb_2), <span class="dv">0</span>, CED_per_day_Consumed_ssb_2),</span>
<span id="cb301-11"><a href="cleaning-code-for-environment-data.html#cb301-11" tabindex="-1"></a>    <span class="at">WATER_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(WATER_per_day_Consumed_ssb_2), <span class="dv">0</span>, WATER_per_day_Consumed_ssb_2),</span>
<span id="cb301-12"><a href="cleaning-code-for-environment-data.html#cb301-12" tabindex="-1"></a>    <span class="at">BLUEWATER_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(BLUEWATER_per_day_Consumed_ssb_2), <span class="dv">0</span>, BLUEWATER_per_day_Consumed_ssb_2),</span>
<span id="cb301-13"><a href="cleaning-code-for-environment-data.html#cb301-13" tabindex="-1"></a>    <span class="at">FL_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_per_day_Consumed_ssb_2), <span class="dv">0</span>, FL_per_day_Consumed_ssb_2),</span>
<span id="cb301-14"><a href="cleaning-code-for-environment-data.html#cb301-14" tabindex="-1"></a>    </span>
<span id="cb301-15"><a href="cleaning-code-for-environment-data.html#cb301-15" tabindex="-1"></a>    <span class="at">consumed_per_day_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_ssb_2), <span class="dv">0</span>, consumed_per_day_ssb_2),</span>
<span id="cb301-16"><a href="cleaning-code-for-environment-data.html#cb301-16" tabindex="-1"></a>    <span class="at">wasted_per_day_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_ssb_2), <span class="dv">0</span>, wasted_per_day_ssb_2),</span>
<span id="cb301-17"><a href="cleaning-code-for-environment-data.html#cb301-17" tabindex="-1"></a>    <span class="at">inedible_per_day_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_ssb_2), <span class="dv">0</span>, inedible_per_day_ssb_2),</span>
<span id="cb301-18"><a href="cleaning-code-for-environment-data.html#cb301-18" tabindex="-1"></a>    </span>
<span id="cb301-19"><a href="cleaning-code-for-environment-data.html#cb301-19" tabindex="-1"></a>    <span class="co"># day1</span></span>
<span id="cb301-20"><a href="cleaning-code-for-environment-data.html#cb301-20" tabindex="-1"></a>    <span class="at">GHG_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(GHG_per_day_Consumed_ssb_1), <span class="dv">0</span>, GHG_per_day_Consumed_ssb_1),</span>
<span id="cb301-21"><a href="cleaning-code-for-environment-data.html#cb301-21" tabindex="-1"></a>    <span class="at">CED_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(CED_per_day_Consumed_ssb_1), <span class="dv">0</span>, CED_per_day_Consumed_ssb_1),</span>
<span id="cb301-22"><a href="cleaning-code-for-environment-data.html#cb301-22" tabindex="-1"></a>    <span class="at">WATER_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(WATER_per_day_Consumed_ssb_1), <span class="dv">0</span>, WATER_per_day_Consumed_ssb_1),</span>
<span id="cb301-23"><a href="cleaning-code-for-environment-data.html#cb301-23" tabindex="-1"></a>    <span class="at">BLUEWATER_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(BLUEWATER_per_day_Consumed_ssb_1), <span class="dv">0</span>, BLUEWATER_per_day_Consumed_ssb_1),</span>
<span id="cb301-24"><a href="cleaning-code-for-environment-data.html#cb301-24" tabindex="-1"></a>    <span class="at">FL_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_per_day_Consumed_ssb_1), <span class="dv">0</span>, FL_per_day_Consumed_ssb_1),</span>
<span id="cb301-25"><a href="cleaning-code-for-environment-data.html#cb301-25" tabindex="-1"></a>    </span>
<span id="cb301-26"><a href="cleaning-code-for-environment-data.html#cb301-26" tabindex="-1"></a>    <span class="at">consumed_per_day_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_ssb_1), <span class="dv">0</span>, consumed_per_day_ssb_1),</span>
<span id="cb301-27"><a href="cleaning-code-for-environment-data.html#cb301-27" tabindex="-1"></a>    <span class="at">wasted_per_day_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_ssb_1), <span class="dv">0</span>, wasted_per_day_ssb_1),</span>
<span id="cb301-28"><a href="cleaning-code-for-environment-data.html#cb301-28" tabindex="-1"></a>    <span class="at">inedible_per_day_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_ssb_1), <span class="dv">0</span>, inedible_per_day_ssb_1))</span>
<span id="cb301-29"><a href="cleaning-code-for-environment-data.html#cb301-29" tabindex="-1"></a></span>
<span id="cb301-30"><a href="cleaning-code-for-environment-data.html#cb301-30" tabindex="-1"></a><span class="co"># summarize DAY1 AND DAY2</span></span>
<span id="cb301-31"><a href="cleaning-code-for-environment-data.html#cb301-31" tabindex="-1"></a>ssb_wide4 <span class="ot">&lt;-</span> ssb_wide3 <span class="sc">%&gt;%</span> </span>
<span id="cb301-32"><a href="cleaning-code-for-environment-data.html#cb301-32" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb301-33"><a href="cleaning-code-for-environment-data.html#cb301-33" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb301-34"><a href="cleaning-code-for-environment-data.html#cb301-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ghg_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(GHG_per_day_Consumed_ssb_1, GHG_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb301-35"><a href="cleaning-code-for-environment-data.html#cb301-35" tabindex="-1"></a>         <span class="at">ced_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(CED_per_day_Consumed_ssb_1, CED_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb301-36"><a href="cleaning-code-for-environment-data.html#cb301-36" tabindex="-1"></a>         <span class="at">water_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(WATER_per_day_Consumed_ssb_1, WATER_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb301-37"><a href="cleaning-code-for-environment-data.html#cb301-37" tabindex="-1"></a>         <span class="at">bluewater_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(BLUEWATER_per_day_Consumed_ssb_1, BLUEWATER_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb301-38"><a href="cleaning-code-for-environment-data.html#cb301-38" tabindex="-1"></a>         <span class="at">fl_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(FL_per_day_Consumed_ssb_1, FL_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb301-39"><a href="cleaning-code-for-environment-data.html#cb301-39" tabindex="-1"></a>         </span>
<span id="cb301-40"><a href="cleaning-code-for-environment-data.html#cb301-40" tabindex="-1"></a>         <span class="at">consumed_sum =</span> <span class="fu">mean</span>(<span class="fu">c</span>(consumed_per_day_ssb_1, consumed_per_day_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb301-41"><a href="cleaning-code-for-environment-data.html#cb301-41" tabindex="-1"></a>         <span class="at">inedible_sum =</span> <span class="fu">mean</span>(<span class="fu">c</span>(inedible_per_day_ssb_1, inedible_per_day_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb301-42"><a href="cleaning-code-for-environment-data.html#cb301-42" tabindex="-1"></a>         <span class="at">wasted_sum =</span> <span class="fu">mean</span>(<span class="fu">c</span>(wasted_per_day_ssb_1, wasted_per_day_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb301-43"><a href="cleaning-code-for-environment-data.html#cb301-43" tabindex="-1"></a>  <span class="fu">select</span>(seqn, ghg_impact_sum_Consumed, ced_impact_sum_Consumed, water_impact_sum_Consumed, bluewater_impact_sum_Consumed, fl_impact_sum_Consumed,</span>
<span id="cb301-44"><a href="cleaning-code-for-environment-data.html#cb301-44" tabindex="-1"></a>         consumed_sum, inedible_sum, wasted_sum) <span class="sc">%&gt;%</span> </span>
<span id="cb301-45"><a href="cleaning-code-for-environment-data.html#cb301-45" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Foodgroup_FCID =</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb301-46"><a href="cleaning-code-for-environment-data.html#cb301-46" tabindex="-1"></a>  <span class="fu">relocate</span>(Foodgroup_FCID, <span class="at">.after =</span> <span class="st">&quot;seqn&quot;</span>)</span></code></pre></div>
<p>Combine the food and SSB datasets together, then transform to wide format.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="cleaning-code-for-environment-data.html#cb302-1" tabindex="-1"></a><span class="co"># rbind with rest of data</span></span>
<span id="cb302-2"><a href="cleaning-code-for-environment-data.html#cb302-2" tabindex="-1"></a>enviro_wide6 <span class="ot">&lt;-</span> </span>
<span id="cb302-3"><a href="cleaning-code-for-environment-data.html#cb302-3" tabindex="-1"></a>  <span class="fu">rbind</span>(enviro_wide5, ssb_wide4) <span class="sc">%&gt;%</span> </span>
<span id="cb302-4"><a href="cleaning-code-for-environment-data.html#cb302-4" tabindex="-1"></a>  <span class="fu">arrange</span>(seqn, Foodgroup_FCID)</span>
<span id="cb302-5"><a href="cleaning-code-for-environment-data.html#cb302-5" tabindex="-1"></a></span>
<span id="cb302-6"><a href="cleaning-code-for-environment-data.html#cb302-6" tabindex="-1"></a><span class="co"># transform to wide</span></span>
<span id="cb302-7"><a href="cleaning-code-for-environment-data.html#cb302-7" tabindex="-1"></a>enviro_wide7 <span class="ot">&lt;-</span> enviro_wide6 <span class="sc">%&gt;%</span> </span>
<span id="cb302-8"><a href="cleaning-code-for-environment-data.html#cb302-8" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> seqn,</span>
<span id="cb302-9"><a href="cleaning-code-for-environment-data.html#cb302-9" tabindex="-1"></a>              <span class="at">names_from =</span> Foodgroup_FCID,</span>
<span id="cb302-10"><a href="cleaning-code-for-environment-data.html#cb302-10" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="sc">!</span><span class="fu">c</span>(seqn, Foodgroup_FCID)) <span class="sc">%&gt;%</span> </span>
<span id="cb302-11"><a href="cleaning-code-for-environment-data.html#cb302-11" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)</span>
<span id="cb302-12"><a href="cleaning-code-for-environment-data.html#cb302-12" tabindex="-1"></a></span>
<span id="cb302-13"><a href="cleaning-code-for-environment-data.html#cb302-13" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb302-14"><a href="cleaning-code-for-environment-data.html#cb302-14" tabindex="-1"></a>enviro_wide7 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;ssb&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## Adding missing grouping variables: `seqn`</code></pre>
<pre><code>## # A tibble: 6 × 9
## # Groups:   seqn [6]
##    seqn ghg_impact_sum_Consumed_ssb ced_impact_sum_Consumed_ssb water_impact_sum_Con…¹ bluewater_impact_sum…²
##   &lt;dbl&gt;                       &lt;dbl&gt;                       &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;
## 1 83732                     0.00715                      0.0721                   12.9                   2.66
## 2 83733                     0                            0                         0                     0   
## 3 83734                     0                            0                         0                     0   
## 4 83735                     0                            0                         0                     0   
## 5 83736                     0.0375                       0.417                    19.0                   5.71
## 6 83737                     0                            0                         0                     0   
## # ℹ abbreviated names: ¹​water_impact_sum_Consumed_ssb, ²​bluewater_impact_sum_Consumed_ssb
## # ℹ 4 more variables: fl_impact_sum_Consumed_ssb &lt;dbl&gt;, consumed_sum_ssb &lt;dbl&gt;, inedible_sum_ssb &lt;dbl&gt;,
## #   wasted_sum_ssb &lt;dbl&gt;</code></pre>
<p>Export datasets to the temporary folder, so they can be used to calculate the impact factors in the next section.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="cleaning-code-for-environment-data.html#cb305-1" tabindex="-1"></a><span class="fu">saveRDS</span>(both_days15, <span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/both_days15_env.rds&quot;</span>)</span>
<span id="cb305-2"><a href="cleaning-code-for-environment-data.html#cb305-2" tabindex="-1"></a><span class="fu">saveRDS</span>(enviro_wide7, <span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/enviro_input_dat.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cleaning-code-for-health-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cleaning-code-for-cost-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-cleaning-code-enviro.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
