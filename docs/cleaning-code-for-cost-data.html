<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Cleaning Code for Cost Data | LASTING Four-Pillar Model Methodology</title>
  <meta name="description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Cleaning Code for Cost Data | LASTING Four-Pillar Model Methodology" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Cleaning Code for Cost Data | LASTING Four-Pillar Model Methodology" />
  
  <meta name="twitter:description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  

<meta name="author" content="Brooke M. Bell" />


<meta name="date" content="2025-05-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cleaning-code-for-environment-data.html"/>
<link rel="next" href="calculate-cost-environment-and-social-impact-factors.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">LASTING Methods Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#github-repository"><i class="fa fa-check"></i>Github Repository</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data-inputs"><i class="fa fa-check"></i>Data Inputs</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code"><i class="fa fa-check"></i>Code</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#model-output"><i class="fa fa-check"></i>Model Output</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html"><i class="fa fa-check"></i><b>1</b> Summary of Data Inputs</a>
<ul>
<li class="chapter" data-level="1.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#diet-inputs"><i class="fa fa-check"></i><b>1.2</b> Diet Inputs</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#counterfactual-intake"><i class="fa fa-check"></i><b>1.2.1</b> Counterfactual Intake</a></li>
<li class="chapter" data-level="1.2.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#dietary-intake"><i class="fa fa-check"></i><b>1.2.2</b> Dietary Intake</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#economic-inputs"><i class="fa fa-check"></i><b>1.3</b> Economic Inputs</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#food-prices"><i class="fa fa-check"></i><b>1.3.1</b> Food Prices</a></li>
<li class="chapter" data-level="1.3.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#food-at-home-fah-vs.-food-away-from-home-fafh-ratio"><i class="fa fa-check"></i><b>1.3.2</b> Food-At-Home (FAH) vs. Food-Away-From-Home (FAFH) Ratio</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#environment-inputs"><i class="fa fa-check"></i><b>1.4</b> Environment Inputs</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#greenhouse-gas-emissions-ghg-and-cumulative-energy-demand-ced-impact-factors"><i class="fa fa-check"></i><b>1.4.1</b> Greenhouse Gas Emissions (GHG) and Cumulative Energy Demand (CED) Impact Factors</a></li>
<li class="chapter" data-level="1.4.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#water-scarcity-ws-and-bluewater-use-bwu-impact-factors"><i class="fa fa-check"></i><b>1.4.2</b> Water Scarcity (WS) and Bluewater Use (BWU) Impact Factors</a></li>
<li class="chapter" data-level="1.4.3" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#land-use-impact-factors"><i class="fa fa-check"></i><b>1.4.3</b> Land Use Impact Factors</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#health-inputs"><i class="fa fa-check"></i><b>1.5</b> Health Inputs</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#cancer-incidence"><i class="fa fa-check"></i><b>1.5.1</b> Cancer Incidence</a></li>
<li class="chapter" data-level="1.5.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#cardiometabolic-disease-cmd-mortality"><i class="fa fa-check"></i><b>1.5.2</b> Cardiometabolic Disease (CMD) Mortality</a></li>
<li class="chapter" data-level="1.5.3" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#effect-sizes-for-diet-and-body-mass-index-bmi"><i class="fa fa-check"></i><b>1.5.3</b> Effect Sizes for Diet and Body Mass Index (BMI)</a></li>
<li class="chapter" data-level="1.5.4" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#effect-sizes-for-diet-and-systolic-blood-pressure-sbp"><i class="fa fa-check"></i><b>1.5.4</b> Effect Sizes for Diet and Systolic Blood Pressure (SBP)</a></li>
<li class="chapter" data-level="1.5.5" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#log-relative-risks-logrr-for-diet-cancer"><i class="fa fa-check"></i><b>1.5.5</b> Log Relative Risks (LogRR) for Diet-Cancer</a></li>
<li class="chapter" data-level="1.5.6" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#overweight-prevalence"><i class="fa fa-check"></i><b>1.5.6</b> Overweight Prevalence</a></li>
<li class="chapter" data-level="1.5.7" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#relative-risks-rr-for-bmi-and-cancer"><i class="fa fa-check"></i><b>1.5.7</b> Relative Risks (RR) for BMI and Cancer</a></li>
<li class="chapter" data-level="1.5.8" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#relative-risks-rr-for-bmi-and-cmd"><i class="fa fa-check"></i><b>1.5.8</b> Relative Risks (RR) for BMI and CMD</a></li>
<li class="chapter" data-level="1.5.9" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#relative-risks-rr-for-sbp-and-cmd"><i class="fa fa-check"></i><b>1.5.9</b> Relative Risks (RR) for SBP and CMD</a></li>
<li class="chapter" data-level="1.5.10" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#systolic-blood-pressure"><i class="fa fa-check"></i><b>1.5.10</b> Systolic Blood Pressure</a></li>
<li class="chapter" data-level="1.5.11" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#tmred"><i class="fa fa-check"></i><b>1.5.11</b> TMRED</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#social-inputs"><i class="fa fa-check"></i><b>1.6</b> Social Inputs</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#forced-labor-risk"><i class="fa fa-check"></i><b>1.6.1</b> Forced Labor Risk</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#other-inputs"><i class="fa fa-check"></i><b>1.7</b> Other Inputs</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#mapping-from-food-group-to-fcid-code"><i class="fa fa-check"></i><b>1.7.1</b> Mapping from Food Group to FCID Code</a></li>
<li class="chapter" data-level="1.7.2" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#mapping-from-food-group-to-fndds-code"><i class="fa fa-check"></i><b>1.7.2</b> Mapping from Food Group to FNDDS Code</a></li>
<li class="chapter" data-level="1.7.3" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#inedible-and-wasted-food-proportions"><i class="fa fa-check"></i><b>1.7.3</b> Inedible and Wasted Food Proportions</a></li>
<li class="chapter" data-level="1.7.4" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#labels"><i class="fa fa-check"></i><b>1.7.4</b> Labels</a></li>
<li class="chapter" data-level="1.7.5" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#weight-conversion-units"><i class="fa fa-check"></i><b>1.7.5</b> Weight Conversion Units</a></li>
<li class="chapter" data-level="1.7.6" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#u.s.-population-size"><i class="fa fa-check"></i><b>1.7.6</b> U.S. Population Size</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html"><i class="fa fa-check"></i><b>2</b> Cleaning Code for NHANES Diet Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#processed-and-organ-meat"><i class="fa fa-check"></i><b>2.1</b> Processed and Organ Meat</a></li>
<li class="chapter" data-level="2.2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#clean-raw-nhanes-data"><i class="fa fa-check"></i><b>2.2</b> Clean Raw NHANES Data</a></li>
<li class="chapter" data-level="2.3" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#create-sugar-sweetened-beverage-ssb-variables"><i class="fa fa-check"></i><b>2.3</b> Create Sugar Sweetened Beverage (SSB) Variables</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#import-and-merge-data-inputs"><i class="fa fa-check"></i><b>2.3.1</b> Import and Merge Data Inputs</a></li>
<li class="chapter" data-level="2.3.2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#create-ssb-indicator-variable"><i class="fa fa-check"></i><b>2.3.2</b> Create SSB Indicator Variable</a></li>
<li class="chapter" data-level="2.3.3" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#calculate-ssb-intake"><i class="fa fa-check"></i><b>2.3.3</b> Calculate SSB Intake</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#energy-adjustement"><i class="fa fa-check"></i><b>2.4</b> Energy Adjustement</a></li>
<li class="chapter" data-level="2.5" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#calculating-standard-deviations-using-sas-macros"><i class="fa fa-check"></i><b>2.5</b> Calculating Standard Deviations Using SAS Macros</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#prepare-nhanes-data-for-sas-macros"><i class="fa fa-check"></i><b>2.5.1</b> Prepare NHANES Data for SAS Macros</a></li>
<li class="chapter" data-level="2.5.2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#fill-out-macro-template"><i class="fa fa-check"></i><b>2.5.2</b> Fill Out Macro Template</a></li>
<li class="chapter" data-level="2.5.3" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#log-in-to-tufts-hpc"><i class="fa fa-check"></i><b>2.5.3</b> Log In to Tufts HPC</a></li>
<li class="chapter" data-level="2.5.4" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#run-sas-macro"><i class="fa fa-check"></i><b>2.5.4</b> Run SAS Macro</a></li>
<li class="chapter" data-level="2.5.5" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#export-output-to-box"><i class="fa fa-check"></i><b>2.5.5</b> Export Output to Box</a></li>
<li class="chapter" data-level="2.5.6" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#clean-output-from-cluster"><i class="fa fa-check"></i><b>2.5.6</b> Clean Output from Cluster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html"><i class="fa fa-check"></i><b>3</b> Cleaning Code for Health Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#create-final-data-inputs"><i class="fa fa-check"></i><b>3.1</b> Create Final Data Inputs</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#other-data-inputs"><i class="fa fa-check"></i><b>3.1.1</b> Other Data Inputs</a></li>
<li class="chapter" data-level="3.1.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#health-data-inputs"><i class="fa fa-check"></i><b>3.1.2</b> Health Data Inputs</a></li>
<li class="chapter" data-level="3.1.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#diet-data-inputs"><i class="fa fa-check"></i><b>3.1.3</b> Diet Data Inputs</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#clean-health-datasets"><i class="fa fa-check"></i><b>3.2</b> Clean Health Datasets</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#cancer-incidence-and-2-cvd-mortality"><i class="fa fa-check"></i><b>3.2.1</b> (1) Cancer incidence and (2) CVD mortality</a></li>
<li class="chapter" data-level="3.2.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#effect-sizes-for-diet-and-bmi-and-4-diet-and-sbp"><i class="fa fa-check"></i><b>3.2.2</b> (3) Effect sizes for diet and BMI and (4) diet and SBP</a></li>
<li class="chapter" data-level="3.2.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#rrs-for-bmi-and-cancer-and-6-for-bmi-and-cvd"><i class="fa fa-check"></i><b>3.2.3</b> (5) RRs for BMI and cancer and (6) for BMI and CVD</a></li>
<li class="chapter" data-level="3.2.4" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#logrrs-for-diet-and-cancer-and-8-for-diet-and-cvd"><i class="fa fa-check"></i><b>3.2.4</b> (7) LogRRs for diet and cancer and (8) for diet and CVD</a></li>
<li class="chapter" data-level="3.2.5" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#rrs-for-sbp-and-cvd"><i class="fa fa-check"></i><b>3.2.5</b> (9) RRs for SBP and CVD</a></li>
<li class="chapter" data-level="3.2.6" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#current-intake-nhanes-11-tmred-12-counterfactual-and-13-other-health-data"><i class="fa fa-check"></i><b>3.2.6</b> (10) Current intake (NHANES), (11) TMRED, (12) Counterfactual, and (13) Other health data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#restructure-data"><i class="fa fa-check"></i><b>3.3</b> Restructure data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning Code for Environment Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#clean-and-restructure-intermediary-datasets"><i class="fa fa-check"></i><b>4.1</b> Clean and Restructure Intermediary Datasets</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#import-and-merge-data-inputs-1"><i class="fa fa-check"></i><b>4.1.1</b> Import and Merge Data Inputs</a></li>
<li class="chapter" data-level="4.1.2" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#calculate-average-environmental-and-social-impact-per-fcid-code"><i class="fa fa-check"></i><b>4.1.2</b> Calculate Average Environmental and Social Impact, Per FCID Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html"><i class="fa fa-check"></i><b>5</b> Cleaning Code for Cost Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#clean-and-restructure-intermediary-datasets-1"><i class="fa fa-check"></i><b>5.1</b> Clean and Restructure Intermediary Datasets</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#import-and-merge-data-inputs-2"><i class="fa fa-check"></i><b>5.1.1</b> Import and Merge Data Inputs</a></li>
<li class="chapter" data-level="5.1.2" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#calculate-average-food-cost-per-fndds-food-code"><i class="fa fa-check"></i><b>5.1.2</b> Calculate Average Food Cost, Per FNDDS Food Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html"><i class="fa fa-check"></i><b>6</b> Calculate Cost, Environment, and Social Impact Factors</a>
<ul>
<li class="chapter" data-level="6.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#prepare-data"><i class="fa fa-check"></i><b>6.1</b> Prepare Data</a></li>
<li class="chapter" data-level="6.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors"><i class="fa fa-check"></i><b>6.2</b> Cost Impact Factors</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors-by-food-by-subgroup"><i class="fa fa-check"></i><b>6.2.1</b> Cost Impact Factors, by Food, by Subgroup</a></li>
<li class="chapter" data-level="6.2.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors-per-100-grams-and-per-1-dga-serving"><i class="fa fa-check"></i><b>6.2.2</b> Cost Impact Factors, Per 100 Grams and Per 1 DGA Serving</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmental-social-impact-factors"><i class="fa fa-check"></i><b>6.3</b> Environmental &amp; Social Impact Factors</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmental-social-impact-factors-by-food-by-subgroup"><i class="fa fa-check"></i><b>6.3.1</b> Environmental &amp; Social Impact Factors, by Food, by Subgroup</a></li>
<li class="chapter" data-level="6.3.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmentsocial-impact-factors-per-100-grams-and-per-1-dga-serving"><i class="fa fa-check"></i><b>6.3.2</b> Environment/Social Impact Factors, Per 100 Grams and Per 1 DGA Serving</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#finalize-impact-factors"><i class="fa fa-check"></i><b>6.4</b> Finalize Impact Factors</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#merge-cost-environment-and-social-impact-factors"><i class="fa fa-check"></i><b>6.4.1</b> Merge Cost, Environment, and Social Impact Factors</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#calculate-inedible-and-wasted-proportions"><i class="fa fa-check"></i><b>6.5</b> Calculate Inedible and Wasted Proportions</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmentsocial"><i class="fa fa-check"></i><b>6.5.1</b> Environment/Social</a></li>
<li class="chapter" data-level="6.5.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost"><i class="fa fa-check"></i><b>6.5.2</b> Cost</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#export-data"><i class="fa fa-check"></i><b>6.6</b> Export Data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="finalize-model-data-inputs.html"><a href="finalize-model-data-inputs.html"><i class="fa fa-check"></i><b>7</b> Finalize Model Data Inputs</a>
<ul>
<li class="chapter" data-level="7.1" data-path="finalize-model-data-inputs.html"><a href="finalize-model-data-inputs.html#clean-and-merge-all-inputs"><i class="fa fa-check"></i><b>7.1</b> Clean and Merge All Inputs</a></li>
<li class="chapter" data-level="7.2" data-path="finalize-model-data-inputs.html"><a href="finalize-model-data-inputs.html#copy-model-inputs-to-github"><i class="fa fa-check"></i><b>7.2</b> Copy Model Inputs to GitHub</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">LASTING Four-Pillar Model Methodology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-code-for-cost-data" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Cleaning Code for Cost Data<a href="cleaning-code-for-cost-data.html#cleaning-code-for-cost-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter walks you through all of the R code used to clean the raw <strong>COST</strong>-related data inputs. The resulting cleaned dataset is then used to calculate the cost impact factors (see <strong>Chapter XXX</strong>).</p>
<div id="clean-and-restructure-intermediary-datasets-1" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Clean and Restructure Intermediary Datasets<a href="cleaning-code-for-cost-data.html#clean-and-restructure-intermediary-datasets-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This script imports all of raw cost-related data inputs, and then cleans and merges them so that the cost impact factors can later be calculated.</p>
<p>Note that you must first open the ‘methods_manual’ R project before running this script or else it will not work.</p>
<p>First, let’s set up our environment.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="cleaning-code-for-cost-data.html#cb306-1" tabindex="-1"></a><span class="co"># check working directory</span></span>
<span id="cb306-2"><a href="cleaning-code-for-cost-data.html#cb306-2" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/Users/bmb73/Library/CloudStorage/Box-Box/lasting_aim_3/model development/methods_manual&quot;</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="cleaning-code-for-cost-data.html#cb308-1" tabindex="-1"></a><span class="co"># SET UP -----</span></span>
<span id="cb308-2"><a href="cleaning-code-for-cost-data.html#cb308-2" tabindex="-1"></a></span>
<span id="cb308-3"><a href="cleaning-code-for-cost-data.html#cb308-3" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb308-4"><a href="cleaning-code-for-cost-data.html#cb308-4" tabindex="-1"></a></span>
<span id="cb308-5"><a href="cleaning-code-for-cost-data.html#cb308-5" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span>
<span id="cb308-6"><a href="cleaning-code-for-cost-data.html#cb308-6" tabindex="-1"></a></span>
<span id="cb308-7"><a href="cleaning-code-for-cost-data.html#cb308-7" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb308-8"><a href="cleaning-code-for-cost-data.html#cb308-8" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb308-9"><a href="cleaning-code-for-cost-data.html#cb308-9" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb308-10"><a href="cleaning-code-for-cost-data.html#cb308-10" tabindex="-1"></a></span>
<span id="cb308-11"><a href="cleaning-code-for-cost-data.html#cb308-11" tabindex="-1"></a>my_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span></code></pre></div>
<div id="import-and-merge-data-inputs-2" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Import and Merge Data Inputs<a href="cleaning-code-for-cost-data.html#import-and-merge-data-inputs-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="nhanes-diet-intake-1" class="section level4 unnumbered hasAnchor">
<h4>NHANES Diet Intake<a href="cleaning-code-for-cost-data.html#nhanes-diet-intake-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, read in the NHANES food-level datasets. The data were split into “day 1” and “day 2” earlier, and here we are going to merge them into “both days”. There also are different datasets containing just sugar sweetened beverage (SSB) data, so we have to import those in separately, and then merge with the rest of the day1/day2 diet datasets.</p>
<p>Import all of the “day 1” datasets first.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="cleaning-code-for-cost-data.html#cb309-1" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb309-2"><a href="cleaning-code-for-cost-data.html#cb309-2" tabindex="-1"></a>day1 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day1_clean.rds&quot;</span>)</span>
<span id="cb309-3"><a href="cleaning-code-for-cost-data.html#cb309-3" tabindex="-1"></a></span>
<span id="cb309-4"><a href="cleaning-code-for-cost-data.html#cb309-4" tabindex="-1"></a><span class="co"># only select needed variables</span></span>
<span id="cb309-5"><a href="cleaning-code-for-cost-data.html#cb309-5" tabindex="-1"></a>day1_sub <span class="ot">&lt;-</span> day1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(SEQN, DRDINT, DR1DRSTZ, DR1ILINE, DR1IFDCD, </span>
<span id="cb309-6"><a href="cleaning-code-for-cost-data.html#cb309-6" tabindex="-1"></a>                            DR1IGRMS, DESCRIPTION, foodsource, nhanes_cycle, dayrec, added_sugar) <span class="sc">%&gt;%</span> </span>
<span id="cb309-7"><a href="cleaning-code-for-cost-data.html#cb309-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">seqn =</span> SEQN,</span>
<span id="cb309-8"><a href="cleaning-code-for-cost-data.html#cb309-8" tabindex="-1"></a>         <span class="at">line =</span> DR1ILINE,</span>
<span id="cb309-9"><a href="cleaning-code-for-cost-data.html#cb309-9" tabindex="-1"></a>         <span class="at">foodcode =</span> DR1IFDCD,</span>
<span id="cb309-10"><a href="cleaning-code-for-cost-data.html#cb309-10" tabindex="-1"></a>         <span class="at">grams =</span> DR1IGRMS,</span>
<span id="cb309-11"><a href="cleaning-code-for-cost-data.html#cb309-11" tabindex="-1"></a>         <span class="at">description =</span> DESCRIPTION,</span>
<span id="cb309-12"><a href="cleaning-code-for-cost-data.html#cb309-12" tabindex="-1"></a>         <span class="at">daysintake =</span> DRDINT,</span>
<span id="cb309-13"><a href="cleaning-code-for-cost-data.html#cb309-13" tabindex="-1"></a>         <span class="at">reliable =</span> DR1DRSTZ)</span>
<span id="cb309-14"><a href="cleaning-code-for-cost-data.html#cb309-14" tabindex="-1"></a></span>
<span id="cb309-15"><a href="cleaning-code-for-cost-data.html#cb309-15" tabindex="-1"></a><span class="co"># ssb</span></span>
<span id="cb309-16"><a href="cleaning-code-for-cost-data.html#cb309-16" tabindex="-1"></a>ssb_1 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day1_ssb.rds&quot;</span>)</span>
<span id="cb309-17"><a href="cleaning-code-for-cost-data.html#cb309-17" tabindex="-1"></a></span>
<span id="cb309-18"><a href="cleaning-code-for-cost-data.html#cb309-18" tabindex="-1"></a><span class="co"># merge food and ssb</span></span>
<span id="cb309-19"><a href="cleaning-code-for-cost-data.html#cb309-19" tabindex="-1"></a>day1_sub1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(day1_sub, ssb_1, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seqn&quot;</span> <span class="ot">=</span> <span class="st">&quot;SEQN&quot;</span>,</span>
<span id="cb309-20"><a href="cleaning-code-for-cost-data.html#cb309-20" tabindex="-1"></a>                                               <span class="st">&quot;line&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1ILINE&quot;</span>,</span>
<span id="cb309-21"><a href="cleaning-code-for-cost-data.html#cb309-21" tabindex="-1"></a>                                               <span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1IFDCD&quot;</span>,</span>
<span id="cb309-22"><a href="cleaning-code-for-cost-data.html#cb309-22" tabindex="-1"></a>                                               <span class="st">&quot;description&quot;</span> <span class="ot">=</span> <span class="st">&quot;DESCRIPTION&quot;</span>,</span>
<span id="cb309-23"><a href="cleaning-code-for-cost-data.html#cb309-23" tabindex="-1"></a>                                               <span class="st">&quot;grams&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1IGRMS&quot;</span>))</span></code></pre></div>
<p>Then import all of “day 2” datasets.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="cleaning-code-for-cost-data.html#cb310-1" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb310-2"><a href="cleaning-code-for-cost-data.html#cb310-2" tabindex="-1"></a>day2 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day2_clean.rds&quot;</span>)</span>
<span id="cb310-3"><a href="cleaning-code-for-cost-data.html#cb310-3" tabindex="-1"></a></span>
<span id="cb310-4"><a href="cleaning-code-for-cost-data.html#cb310-4" tabindex="-1"></a><span class="co"># only select needed variables</span></span>
<span id="cb310-5"><a href="cleaning-code-for-cost-data.html#cb310-5" tabindex="-1"></a>day2_sub <span class="ot">&lt;-</span> day2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(SEQN, DRDINT, DR2DRSTZ, DR2ILINE, DR2IFDCD, </span>
<span id="cb310-6"><a href="cleaning-code-for-cost-data.html#cb310-6" tabindex="-1"></a>                            DR2IGRMS, DESCRIPTION, foodsource, nhanes_cycle, dayrec, added_sugar) <span class="sc">%&gt;%</span> </span>
<span id="cb310-7"><a href="cleaning-code-for-cost-data.html#cb310-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">seqn =</span> SEQN,</span>
<span id="cb310-8"><a href="cleaning-code-for-cost-data.html#cb310-8" tabindex="-1"></a>         <span class="at">line =</span> DR2ILINE,</span>
<span id="cb310-9"><a href="cleaning-code-for-cost-data.html#cb310-9" tabindex="-1"></a>         <span class="at">foodcode =</span> DR2IFDCD,</span>
<span id="cb310-10"><a href="cleaning-code-for-cost-data.html#cb310-10" tabindex="-1"></a>         <span class="at">grams =</span> DR2IGRMS,</span>
<span id="cb310-11"><a href="cleaning-code-for-cost-data.html#cb310-11" tabindex="-1"></a>         <span class="at">description =</span> DESCRIPTION,</span>
<span id="cb310-12"><a href="cleaning-code-for-cost-data.html#cb310-12" tabindex="-1"></a>         <span class="at">daysintake =</span> DRDINT,</span>
<span id="cb310-13"><a href="cleaning-code-for-cost-data.html#cb310-13" tabindex="-1"></a>         <span class="at">reliable =</span> DR2DRSTZ)</span>
<span id="cb310-14"><a href="cleaning-code-for-cost-data.html#cb310-14" tabindex="-1"></a></span>
<span id="cb310-15"><a href="cleaning-code-for-cost-data.html#cb310-15" tabindex="-1"></a><span class="co"># ssb</span></span>
<span id="cb310-16"><a href="cleaning-code-for-cost-data.html#cb310-16" tabindex="-1"></a>ssb_2 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day2_ssb.rds&quot;</span>)</span>
<span id="cb310-17"><a href="cleaning-code-for-cost-data.html#cb310-17" tabindex="-1"></a></span>
<span id="cb310-18"><a href="cleaning-code-for-cost-data.html#cb310-18" tabindex="-1"></a><span class="co"># merge food and ssb</span></span>
<span id="cb310-19"><a href="cleaning-code-for-cost-data.html#cb310-19" tabindex="-1"></a>day2_sub1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(day2_sub, ssb_2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seqn&quot;</span> <span class="ot">=</span> <span class="st">&quot;SEQN&quot;</span>,</span>
<span id="cb310-20"><a href="cleaning-code-for-cost-data.html#cb310-20" tabindex="-1"></a>                                               <span class="st">&quot;line&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2ILINE&quot;</span>,</span>
<span id="cb310-21"><a href="cleaning-code-for-cost-data.html#cb310-21" tabindex="-1"></a>                                               <span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2IFDCD&quot;</span>,</span>
<span id="cb310-22"><a href="cleaning-code-for-cost-data.html#cb310-22" tabindex="-1"></a>                                               <span class="st">&quot;description&quot;</span> <span class="ot">=</span> <span class="st">&quot;DESCRIPTION&quot;</span>,</span>
<span id="cb310-23"><a href="cleaning-code-for-cost-data.html#cb310-23" tabindex="-1"></a>                                               <span class="st">&quot;grams&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2IGRMS&quot;</span>))</span></code></pre></div>
<p>Then, combine the “day 1” and “day 2” datasets to get a “both_days” dataset.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="cleaning-code-for-cost-data.html#cb311-1" tabindex="-1"></a>both_days <span class="ot">&lt;-</span> <span class="fu">rbind</span>(day1_sub1, day2_sub1) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(seqn, dayrec, line)</span>
<span id="cb311-2"><a href="cleaning-code-for-cost-data.html#cb311-2" tabindex="-1"></a></span>
<span id="cb311-3"><a href="cleaning-code-for-cost-data.html#cb311-3" tabindex="-1"></a><span class="co"># check to make sure the formatting worked</span></span>
<span id="cb311-4"><a href="cleaning-code-for-cost-data.html#cb311-4" tabindex="-1"></a>both_days <span class="sc">%&gt;%</span> <span class="fu">filter</span>(description <span class="sc">==</span> <span class="st">&quot;Meat, NFS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co">#looks good!</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 12
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 84032          1        1     9 20000000 11.0  Meat, NFS   Other      2015-2016         1           0     0
## 2 86178          2        1     5 20000000  4.19 Meat, NFS   Other      2015-2016         1           0     0
## 3 86487          2        1    10 20000000 73.3  Meat, NFS   Grocery    2015-2016         1           0     0
## 4 86801          2        1    13 20000000 11.2  Meat, NFS   Other      2015-2016         1           0     0
## 5 87065          2        1     3 20000000 50.2  Meat, NFS   Other      2015-2016         1           0     0
## 6 88767          2        1    12 20000000  7.33 Meat, NFS   Other      2015-2016         1           0     0</code></pre>
<p>Lastly, remove the original diet datasets becuase they are very large and we don’t need them anymore.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="cleaning-code-for-cost-data.html#cb313-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="mappings-from-dietary-factor-to-fndds-food-code" class="section level4 unnumbered hasAnchor">
<h4>Mappings from Dietary Factor to FNDDS Food Code<a href="cleaning-code-for-cost-data.html#mappings-from-dietary-factor-to-fndds-food-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two mappings from dietary factor to FNDDS Food Code. There is one specifically just for whole and refined grains - see <strong>section XXX</strong> on how the whole vs. refined grains designation was determined. And the second one is for all other non-grain foods.</p>
<p>First, create an empty dataset template that contains all of the foodcodes that exist in the diet dataset (both_days).</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="cleaning-code-for-cost-data.html#cb314-1" tabindex="-1"></a>all_foodcodes <span class="ot">&lt;-</span> both_days <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<p>Then, import the non-grain food mapping (labeled as “map_a”).</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="cleaning-code-for-cost-data.html#cb315-1" tabindex="-1"></a>map_a <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fndds_mapping/DATA/Food_to_FNDDS_mapping_detailed_04-06-25.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 109 Columns: 2
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Foodgroup
## dbl (1): foodcode_prefix
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Then, join the template and the first mapping.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="cleaning-code-for-cost-data.html#cb317-1" tabindex="-1"></a>my_join <span class="ot">&lt;-</span> <span class="fu">full_join</span>(<span class="fu">mutate</span>(all_foodcodes, <span class="at">i=</span><span class="dv">1</span>), </span>
<span id="cb317-2"><a href="cleaning-code-for-cost-data.html#cb317-2" tabindex="-1"></a>                     <span class="fu">mutate</span>(map_a, <span class="at">i=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb317-3"><a href="cleaning-code-for-cost-data.html#cb317-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>i) <span class="sc">%&gt;%</span> </span>
<span id="cb317-4"><a href="cleaning-code-for-cost-data.html#cb317-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(foodcode, <span class="fu">paste0</span>(<span class="st">&quot;^&quot;</span>, foodcode_prefix))) <span class="sc">%&gt;%</span> </span>
<span id="cb317-5"><a href="cleaning-code-for-cost-data.html#cb317-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>foodcode_prefix)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(i)`</code></pre>
<pre><code>## Warning in full_join(mutate(all_foodcodes, i = 1), mutate(map_a, i = 1)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 1 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<p>Import the grain-only mapping (labeled as “map_b”).</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="cleaning-code-for-cost-data.html#cb320-1" tabindex="-1"></a>map_b <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fndds_mapping/DATA/Food_to_FNDDS_mapping_WHOLE_GRAINS_ONLY_09-05-23.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 1728 Columns: 2
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Foodgroup
## dbl (1): foodcode
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Merge my_join with the second mapping.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="cleaning-code-for-cost-data.html#cb322-1" tabindex="-1"></a>my_join1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(my_join, map_b) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(foodcode)</span></code></pre></div>
<p>Lastly, merge back with both_days.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="cleaning-code-for-cost-data.html#cb323-1" tabindex="-1"></a>both_days1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days, my_join1, <span class="at">by =</span> <span class="st">&quot;foodcode&quot;</span>)</span></code></pre></div>
<p>Check how many FNDDS codes in the dataset don’t have a mapping to a dietary factor (i.e., food group category)</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="cleaning-code-for-cost-data.html#cb324-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> </span>
<span id="cb324-2"><a href="cleaning-code-for-cost-data.html#cb324-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb324-3"><a href="cleaning-code-for-cost-data.html#cb324-3" tabindex="-1"></a>  <span class="fu">select</span>(foodcode, description) <span class="sc">%&gt;%</span> </span>
<span id="cb324-4"><a href="cleaning-code-for-cost-data.html#cb324-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb324-5"><a href="cleaning-code-for-cost-data.html#cb324-5" tabindex="-1"></a>  <span class="fu">arrange</span>(foodcode)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 2
## # ℹ 2 variables: foodcode &lt;dbl&gt;, description &lt;chr&gt;</code></pre>
<p>Check SSB by comparing the “ssb” indicator variable and the data when the foodgroup is set to “ssb”.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="cleaning-code-for-cost-data.html#cb326-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1    14 92308000  372  Tea, iced,… Other      2015-2016         2        6.81     1
## 2 83736          2        1     2 92410510  326. Soft drink… Grocery    2015-2016         1        6.97     1
## 3 83736          2        1     7 95320200  356. Sports dri… Grocery    2015-2016         1        4.46     1
## 4 83736          2        1     5 95320200  372  Sports dri… Grocery    2015-2016         2        4.65     1
## 5 83736          2        1     7 92410310  248  Soft drink… Grocery    2015-2016         2        5.88     1
## 6 83742          2        1    13 92510960  207. Lemonade, … Other      2015-2016         1        3.22     1
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="cleaning-code-for-cost-data.html#cb328-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1    14 92308000  372  Tea, iced,… Other      2015-2016         2        6.81     1
## 2 83736          2        1     2 92410510  326. Soft drink… Grocery    2015-2016         1        6.97     1
## 3 83736          2        1     7 92410310  248  Soft drink… Grocery    2015-2016         2        5.88     1
## 4 83742          2        1    13 92510960  207. Lemonade, … Other      2015-2016         1        3.22     1
## 5 83742          2        1     9 92410310  150. Soft drink… Other      2015-2016         2        3.54     1
## 6 83744          2        1     8 92410510  512  Soft drink… Other      2015-2016         1       11.0      1
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="cleaning-code-for-cost-data.html#cb330-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># need to change these to ssb</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83736          2        1     7 95320200  356. Sports dri… Grocery    2015-2016         1        4.46     1
## 2 83736          2        1     5 95320200  372  Sports dri… Grocery    2015-2016         2        4.65     1
## 3 83753          2        1     6 95320200  744  Sports dri… Other      2015-2016         2        9.3      1
## 4 83768          2        1    12 64204010  580. Mango nect… Grocery    2015-2016         1        9.64     1
## 5 83780          2        1     9 64205010  116. Peach nect… Grocery    2015-2016         2        2.76     1
## 6 83795          2        1    10 95320200  310  Sports dri… Other      2015-2016         2        3.88     1
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="cleaning-code-for-cost-data.html#cb332-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># need to change these to other</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1     1 92101000   720 Coffee, br… Grocery    2015-2016         1           0     0
## 2 83732          2        1     7 92410320   600 Soft drink… Grocery    2015-2016         1           0     0
## 3 83732          2        1     1 92101000   255 Coffee, br… Grocery    2015-2016         2           0     0
## 4 83732          2        1    15 92410520   480 Soft drink… Other      2015-2016         2           0     0
## 5 83733          2        1     1 92101000   480 Coffee, br… Grocery    2015-2016         1           0     0
## 6 83733          2        1     1 92101000   450 Coffee, br… Grocery    2015-2016         2           0     0
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="cleaning-code-for-cost-data.html#cb334-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode  grams description      foodsource nhanes_cycle dayrec added_sugar
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1 83732          2        1     2 91200040   4    Sugar substitut… Grocery    2015-2016         1        0   
## 2 83732          2        1     3 12210400   3.92 Coffee creamer,… Grocery    2015-2016         1        0.07
## 3 83732          2        1     4 94100100 240    Water, bottled,… Grocery    2015-2016         1        0   
## 4 83732          2        1     5 51101010  75    Bread, white, t… Grocery    2015-2016         1        0.74
## 5 83732          2        1     6 81103080  28.6  Margarine-like … Grocery    2015-2016         1        0   
## 6 83732          2        1     8 27564060 204    Frankfurter or … Grocery    2015-2016         1        1.63
## # ℹ 2 more variables: ssb &lt;dbl&gt;, Foodgroup &lt;chr&gt;</code></pre>
<p>We see that, for some of the rows, ssb is labeled incorrectly, so we need to fix it.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="cleaning-code-for-cost-data.html#cb336-1" tabindex="-1"></a>both_days2 <span class="ot">&lt;-</span> both_days1 <span class="sc">%&gt;%</span> </span>
<span id="cb336-2"><a href="cleaning-code-for-cost-data.html#cb336-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Foodgroup =</span> <span class="fu">ifelse</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>, <span class="st">&quot;ssb&quot;</span>, Foodgroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb336-3"><a href="cleaning-code-for-cost-data.html#cb336-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Foodgroup =</span> <span class="fu">ifelse</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>, <span class="st">&quot;other&quot;</span>, Foodgroup))</span></code></pre></div>
<p>Check again. Looks good.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="cleaning-code-for-cost-data.html#cb337-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1    14 92308000  372  Tea, iced,… Other      2015-2016         2        6.81     1
## 2 83736          2        1     2 92410510  326. Soft drink… Grocery    2015-2016         1        6.97     1
## 3 83736          2        1     7 95320200  356. Sports dri… Grocery    2015-2016         1        4.46     1
## 4 83736          2        1     5 95320200  372  Sports dri… Grocery    2015-2016         2        4.65     1
## 5 83736          2        1     7 92410310  248  Soft drink… Grocery    2015-2016         2        5.88     1
## 6 83742          2        1    13 92510960  207. Lemonade, … Other      2015-2016         1        3.22     1
## # ℹ 1 more variable: Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="cleaning-code-for-cost-data.html#cb339-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 13
## # ℹ 13 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;,
## #   Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="cleaning-code-for-cost-data.html#cb341-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 13
## # ℹ 13 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;,
## #   Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="cleaning-code-for-cost-data.html#cb343-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode  grams description      foodsource nhanes_cycle dayrec added_sugar
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1 83732          2        1     1 92101000 720    Coffee, brewed   Grocery    2015-2016         1        0   
## 2 83732          2        1     2 91200040   4    Sugar substitut… Grocery    2015-2016         1        0   
## 3 83732          2        1     3 12210400   3.92 Coffee creamer,… Grocery    2015-2016         1        0.07
## 4 83732          2        1     4 94100100 240    Water, bottled,… Grocery    2015-2016         1        0   
## 5 83732          2        1     5 51101010  75    Bread, white, t… Grocery    2015-2016         1        0.74
## 6 83732          2        1     6 81103080  28.6  Margarine-like … Grocery    2015-2016         1        0   
## # ℹ 2 more variables: ssb &lt;dbl&gt;, Foodgroup &lt;chr&gt;</code></pre>
<p>Tidy up the global environment and only keep the datasets we currently need.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="cleaning-code-for-cost-data.html#cb345-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days2&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="food-at-home-fah-to-food-away-fram-home-fafh-ratios" class="section level4 unnumbered hasAnchor">
<h4>Food-At-Home (FAH) to Food-Away-Fram-Home (FAFH) Ratios<a href="cleaning-code-for-cost-data.html#food-at-home-fah-to-food-away-fram-home-fafh-ratios" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Import the FAH to FAFH ratios, whcih are later used to calculate the price of food purchased at grocery stores (i.e., food at home) vs. food bought outside of grocery stores (i.e., food away from home).</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="cleaning-code-for-cost-data.html#cb346-1" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb346-2"><a href="cleaning-code-for-cost-data.html#cb346-2" tabindex="-1"></a>ratios <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/ECONOMIC/fah_fafh_ratio/DATA/output_data/fafh_fah_ratio_clean_07-06-23.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb346-3"><a href="cleaning-code-for-cost-data.html#cb346-3" tabindex="-1"></a>  <span class="fu">select</span>(Diet_var, ratio_FAFH_FAH)</span></code></pre></div>
<pre><code>## Rows: 23 Columns: 5
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): Diet_var, Diet_label
## dbl (3): mean_100g_FAH, mean_100g_FAFH, ratio_FAFH_FAH
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="cleaning-code-for-cost-data.html#cb348-1" tabindex="-1"></a><span class="co"># rename &quot;dairy&quot; to &quot;dairy_tot&quot;</span></span>
<span id="cb348-2"><a href="cleaning-code-for-cost-data.html#cb348-2" tabindex="-1"></a>ratios1 <span class="ot">&lt;-</span> ratios <span class="sc">%&gt;%</span> </span>
<span id="cb348-3"><a href="cleaning-code-for-cost-data.html#cb348-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Diet_var_new =</span> <span class="fu">ifelse</span>(Diet_var <span class="sc">==</span> <span class="st">&quot;dairy&quot;</span>, <span class="st">&quot;dairy_tot&quot;</span>, Diet_var)) <span class="sc">%&gt;%</span> </span>
<span id="cb348-4"><a href="cleaning-code-for-cost-data.html#cb348-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Diet_var)</span></code></pre></div>
<p>Merge with both_days and then check for any missing values.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="cleaning-code-for-cost-data.html#cb349-1" tabindex="-1"></a><span class="co"># join with both_days</span></span>
<span id="cb349-2"><a href="cleaning-code-for-cost-data.html#cb349-2" tabindex="-1"></a>both_days3 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days2, ratios1, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Foodgroup&quot;</span> <span class="ot">=</span> <span class="st">&quot;Diet_var_new&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb349-3"><a href="cleaning-code-for-cost-data.html#cb349-3" tabindex="-1"></a></span>
<span id="cb349-4"><a href="cleaning-code-for-cost-data.html#cb349-4" tabindex="-1"></a><span class="co"># rename vars</span></span>
<span id="cb349-5"><a href="cleaning-code-for-cost-data.html#cb349-5" tabindex="-1"></a>both_days4 <span class="ot">&lt;-</span> both_days3 <span class="sc">%&gt;%</span> </span>
<span id="cb349-6"><a href="cleaning-code-for-cost-data.html#cb349-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Foodgroup_FNDDS =</span> Foodgroup)</span>
<span id="cb349-7"><a href="cleaning-code-for-cost-data.html#cb349-7" tabindex="-1"></a></span>
<span id="cb349-8"><a href="cleaning-code-for-cost-data.html#cb349-8" tabindex="-1"></a><span class="co"># any missing ratios?</span></span>
<span id="cb349-9"><a href="cleaning-code-for-cost-data.html#cb349-9" tabindex="-1"></a>both_days4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(ratio_FAFH_FAH)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83732          2        1     4 94100100   240 Water, bot… Grocery    2015-2016         1           0     0
## 2 83732          2        1    11 94100100   240 Water, bot… Grocery    2015-2016         1           0     0
## 3 83732          2        1    14 94100100   360 Water, bot… Grocery    2015-2016         1           0     0
## 4 83732          2        1    16 94000100   120 Water, tap  Other      2015-2016         1           0     0
## 5 83732          2        1     4 94000100   240 Water, tap  Other      2015-2016         2           0     0
## 6 83732          2        1     8 94100100   480 Water, bot… Grocery    2015-2016         2           0     0
## # ℹ 2 more variables: Foodgroup_FNDDS &lt;chr&gt;, ratio_FAFH_FAH &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="cleaning-code-for-cost-data.html#cb351-1" tabindex="-1"></a>both_days4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(ratio_FAFH_FAH)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FNDDS) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 1
##   Foodgroup_FNDDS
##   &lt;chr&gt;          
## 1 water          
## 2 babyfood</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="cleaning-code-for-cost-data.html#cb353-1" tabindex="-1"></a><span class="co"># assign ratio to 1 for water and babyfood just as a placeholder</span></span>
<span id="cb353-2"><a href="cleaning-code-for-cost-data.html#cb353-2" tabindex="-1"></a>both_days5 <span class="ot">&lt;-</span> both_days4 <span class="sc">%&gt;%</span> </span>
<span id="cb353-3"><a href="cleaning-code-for-cost-data.html#cb353-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ratio_FAFH_FAH =</span> <span class="fu">ifelse</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;water&quot;</span> <span class="sc">|</span> Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;babyfood&quot;</span>, <span class="dv">1</span>, ratio_FAFH_FAH))</span></code></pre></div>
<p>We see that all missing ratios are for water or babyfood, which we’re not using in this analysis, so we can ignore and just assign 1.</p>
<p>Do a final check.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="cleaning-code-for-cost-data.html#cb354-1" tabindex="-1"></a>both_days5 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(ratio_FAFH_FAH)) <span class="co"># none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 14
## # ℹ 14 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;,
## #   Foodgroup_FNDDS &lt;chr&gt;, ratio_FAFH_FAH &lt;dbl&gt;</code></pre>
</div>
<div id="food-cost-data" class="section level4 unnumbered hasAnchor">
<h4>Food Cost Data<a href="cleaning-code-for-cost-data.html#food-cost-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two cost datasets: one for the years 2015-2016 and the other for the years 2017-2018. We need to merge these with the corresponding NHANES cohorts (2015-2016 and 2017-2018).</p>
<p>First import and join the two datasets. Then, because the variable “price_100g” represents the food cost per 100 grams of food, we create a new variable that represents the food cost per 1 gram of food (which is what we want to use later on).</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="cleaning-code-for-cost-data.html#cb356-1" tabindex="-1"></a><span class="co"># import 2015-2016 price data</span></span>
<span id="cb356-2"><a href="cleaning-code-for-cost-data.html#cb356-2" tabindex="-1"></a>cost1516 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/ECONOMIC/food_prices/DATA/pp_national_average_prices_andi_v.1.30.2023.xlsx&quot;</span>,</span>
<span id="cb356-3"><a href="cleaning-code-for-cost-data.html#cb356-3" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">&quot;PP-NAP1516&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb356-4"><a href="cleaning-code-for-cost-data.html#cb356-4" tabindex="-1"></a>  <span class="fu">select</span>(food_code, price_100gm) <span class="sc">%&gt;%</span> </span>
<span id="cb356-5"><a href="cleaning-code-for-cost-data.html#cb356-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nhanes1516 =</span> <span class="dv">1</span>)</span>
<span id="cb356-6"><a href="cleaning-code-for-cost-data.html#cb356-6" tabindex="-1"></a></span>
<span id="cb356-7"><a href="cleaning-code-for-cost-data.html#cb356-7" tabindex="-1"></a><span class="co"># import 2017-2018</span></span>
<span id="cb356-8"><a href="cleaning-code-for-cost-data.html#cb356-8" tabindex="-1"></a>cost1718 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/ECONOMIC/food_prices/DATA/pp_national_average_prices_andi_v.1.30.2023.xlsx&quot;</span>,</span>
<span id="cb356-9"><a href="cleaning-code-for-cost-data.html#cb356-9" tabindex="-1"></a>                      <span class="at">sheet =</span> <span class="st">&quot;PP-NAP1718&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb356-10"><a href="cleaning-code-for-cost-data.html#cb356-10" tabindex="-1"></a>  <span class="fu">select</span>(food_code, price_100gm) <span class="sc">%&gt;%</span> </span>
<span id="cb356-11"><a href="cleaning-code-for-cost-data.html#cb356-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nhanes1516 =</span> <span class="dv">0</span>)</span>
<span id="cb356-12"><a href="cleaning-code-for-cost-data.html#cb356-12" tabindex="-1"></a></span>
<span id="cb356-13"><a href="cleaning-code-for-cost-data.html#cb356-13" tabindex="-1"></a><span class="co"># combine price datasets</span></span>
<span id="cb356-14"><a href="cleaning-code-for-cost-data.html#cb356-14" tabindex="-1"></a>price_comb <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cost1516, cost1718) <span class="sc">%&gt;%</span> </span>
<span id="cb356-15"><a href="cleaning-code-for-cost-data.html#cb356-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_per_gram =</span> price_100gm <span class="sc">/</span> <span class="dv">100</span>) <span class="co"># create price_per_gram var</span></span></code></pre></div>
<p>Then, join with both_days and check for missing values. We also calculate two variables, two_digits and three_digits, that represent the first two and three digits, respectively, of the NHANES FNDDS food code. The beginning digits of the food code correspond with different food categorizations created by the USDA. These variables will be used later.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="cleaning-code-for-cost-data.html#cb357-1" tabindex="-1"></a><span class="co"># create new nhanes cycle variable</span></span>
<span id="cb357-2"><a href="cleaning-code-for-cost-data.html#cb357-2" tabindex="-1"></a>both_days6 <span class="ot">&lt;-</span> both_days5 <span class="sc">%&gt;%</span></span>
<span id="cb357-3"><a href="cleaning-code-for-cost-data.html#cb357-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nhanes1516 =</span> <span class="fu">ifelse</span>(nhanes_cycle <span class="sc">==</span> <span class="st">&quot;2015-2016&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb357-4"><a href="cleaning-code-for-cost-data.html#cb357-4" tabindex="-1"></a></span>
<span id="cb357-5"><a href="cleaning-code-for-cost-data.html#cb357-5" tabindex="-1"></a><span class="co"># join with food data</span></span>
<span id="cb357-6"><a href="cleaning-code-for-cost-data.html#cb357-6" tabindex="-1"></a>both_days7 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days6, price_comb, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;food_code&quot;</span>, <span class="st">&quot;nhanes1516&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb357-7"><a href="cleaning-code-for-cost-data.html#cb357-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodcode =</span> <span class="fu">as.character</span>(foodcode),</span>
<span id="cb357-8"><a href="cleaning-code-for-cost-data.html#cb357-8" tabindex="-1"></a>         <span class="at">two_digits =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(foodcode, <span class="dv">1</span>, <span class="dv">2</span>)), <span class="co">#first two digits of fndds foodcode</span></span>
<span id="cb357-9"><a href="cleaning-code-for-cost-data.html#cb357-9" tabindex="-1"></a>         <span class="at">three_digits =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(foodcode, <span class="dv">1</span>, <span class="dv">3</span>))) <span class="co">#first three digits of fndds foodcode</span></span>
<span id="cb357-10"><a href="cleaning-code-for-cost-data.html#cb357-10" tabindex="-1"></a></span>
<span id="cb357-11"><a href="cleaning-code-for-cost-data.html#cb357-11" tabindex="-1"></a><span class="co"># how many are missing price data?</span></span>
<span id="cb357-12"><a href="cleaning-code-for-cost-data.html#cb357-12" tabindex="-1"></a>both_days7 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(price_per_gram)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 19
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 83734          2        1     4 27510233  225  Cheeseburg… Other      2015-2016         2        1.24     0
## 2 83735          1        1     3 27540250  242  Chicken fi… Other      2015-2016         1        2.08     0
## 3 83737          2        1     1 55200070   80  Waffle, wh… Grocery    2015-2016         1        0.62     0
## 4 83737          2        1     1 32130830   77  Egg omelet… Grocery    2015-2016         2        0        0
## 5 83742          2        1    15 58146391  133. Pasta with… Other      2015-2016         1        0        0
## 6 83742          2        1    16 58146301  133. Pasta with… Other      2015-2016         1        0.15     0
## # ℹ 7 more variables: Foodgroup_FNDDS &lt;chr&gt;, ratio_FAFH_FAH &lt;dbl&gt;, nhanes1516 &lt;dbl&gt;, price_100gm &lt;dbl&gt;,
## #   price_per_gram &lt;dbl&gt;, two_digits &lt;dbl&gt;, three_digits &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="cleaning-code-for-cost-data.html#cb359-1" tabindex="-1"></a>both_days7 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(price_100gm)) <span class="sc">%&gt;%</span> </span>
<span id="cb359-2"><a href="cleaning-code-for-cost-data.html#cb359-2" tabindex="-1"></a>  <span class="fu">select</span>(foodcode, description, Foodgroup_FNDDS) <span class="sc">%&gt;%</span> </span>
<span id="cb359-3"><a href="cleaning-code-for-cost-data.html#cb359-3" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb359-4"><a href="cleaning-code-for-cost-data.html#cb359-4" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   foodcode description                                                                        Foodgroup_FNDDS
##   &lt;chr&gt;    &lt;chr&gt;                                                                              &lt;chr&gt;          
## 1 27510233 Cheeseburger, 1 medium patty, with condiments, on bun, from fast food / restauran… pf_redm        
## 2 27540250 Chicken fillet, broiled, sandwich with cheese, on whole wheat roll, with lettuce,… pf_poultry     
## 3 55200070 Waffle, whole grain, reduced fat, from frozen                                      gr_refined     
## 4 32130830 Egg omelet or scrambled egg, with meat and dark-green vegetables, fat added in co… pf_egg         
## 5 58146391 Pasta with cream sauce and added vegetables, restaurant                            gr_refined     
## 6 58146301 Pasta with tomato-based sauce, and added vegetables, restaurant                    gr_refined</code></pre>
<p>There are a fair number of missing values, so we are going to calculate the average price for each food group (determined by first two digits of FNDDS food code) x foodsource (grocery vs not) combination, and then use these food group-level averages for the missing values (i.e., impute).</p>
<p>Create a dataset called imputed_price that contains the average prices for each food group x food source combination.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="cleaning-code-for-cost-data.html#cb361-1" tabindex="-1"></a>imputed_price <span class="ot">&lt;-</span></span>
<span id="cb361-2"><a href="cleaning-code-for-cost-data.html#cb361-2" tabindex="-1"></a>  both_days7 <span class="sc">%&gt;%</span> </span>
<span id="cb361-3"><a href="cleaning-code-for-cost-data.html#cb361-3" tabindex="-1"></a>  <span class="fu">select</span>(seqn, line, foodcode, two_digits, foodsource, price_per_gram) <span class="sc">%&gt;%</span> </span>
<span id="cb361-4"><a href="cleaning-code-for-cost-data.html#cb361-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb361-5"><a href="cleaning-code-for-cost-data.html#cb361-5" tabindex="-1"></a>  <span class="fu">group_by</span>(two_digits, foodsource) <span class="sc">%&gt;%</span> </span>
<span id="cb361-6"><a href="cleaning-code-for-cost-data.html#cb361-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">price_g_group_mean =</span> <span class="fu">mean</span>(price_per_gram, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb361-7"><a href="cleaning-code-for-cost-data.html#cb361-7" tabindex="-1"></a>            <span class="at">price_g_group_median =</span> <span class="fu">median</span>(price_per_gram, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb361-8"><a href="cleaning-code-for-cost-data.html#cb361-8" tabindex="-1"></a>            <span class="at">price_g_group_sd =</span> <span class="fu">sd</span>(price_per_gram, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;two_digits&#39;. You can override using the `.groups` argument.</code></pre>
<p>Then, merge with both_days and calculate a new variable, price_per_gram, that replaces any missing price value with the group median.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="cleaning-code-for-cost-data.html#cb363-1" tabindex="-1"></a><span class="co"># join imputed prices with food data</span></span>
<span id="cb363-2"><a href="cleaning-code-for-cost-data.html#cb363-2" tabindex="-1"></a>both_days8 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days7, imputed_price, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;two_digits&quot;</span>, <span class="st">&quot;foodsource&quot;</span>))</span>
<span id="cb363-3"><a href="cleaning-code-for-cost-data.html#cb363-3" tabindex="-1"></a></span>
<span id="cb363-4"><a href="cleaning-code-for-cost-data.html#cb363-4" tabindex="-1"></a><span class="co"># insert food_group median price if missing</span></span>
<span id="cb363-5"><a href="cleaning-code-for-cost-data.html#cb363-5" tabindex="-1"></a>both_days9 <span class="ot">&lt;-</span> both_days8 <span class="sc">%&gt;%</span> </span>
<span id="cb363-6"><a href="cleaning-code-for-cost-data.html#cb363-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_per_gram =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(price_per_gram), price_g_group_median, price_per_gram)) <span class="sc">%&gt;%</span> </span>
<span id="cb363-7"><a href="cleaning-code-for-cost-data.html#cb363-7" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb363-8"><a href="cleaning-code-for-cost-data.html#cb363-8" tabindex="-1"></a></span>
<span id="cb363-9"><a href="cleaning-code-for-cost-data.html#cb363-9" tabindex="-1"></a><span class="co"># check if any missing price per gram (shouldn&#39;t be)</span></span>
<span id="cb363-10"><a href="cleaning-code-for-cost-data.html#cb363-10" tabindex="-1"></a>both_days9 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(price_per_gram)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 22
## # ℹ 22 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;chr&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;,
## #   Foodgroup_FNDDS &lt;chr&gt;, ratio_FAFH_FAH &lt;dbl&gt;, nhanes1516 &lt;dbl&gt;, price_100gm &lt;dbl&gt;, price_per_gram &lt;dbl&gt;,
## #   two_digits &lt;dbl&gt;, three_digits &lt;dbl&gt;, price_g_group_mean &lt;dbl&gt;, price_g_group_median &lt;dbl&gt;,
## #   price_g_group_sd &lt;dbl&gt;</code></pre>
<p>Tidy up the global environment.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="cleaning-code-for-cost-data.html#cb365-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days9&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="mixed-dishes" class="section level4 unnumbered hasAnchor">
<h4>Mixed Dishes<a href="cleaning-code-for-cost-data.html#mixed-dishes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We want to obtain the food price of whole foods that correspond with the food groups in the DGA dietary patterns. Therefore, we do not want to use the prices of “mixed foods” that typically represent larger dishes that incorporate many different food groups and is thus not a good representation of whole foods.</p>
<p>To deal with this, we use a dataset that identifies FNDDS food code prefixes that represent “mixed dishes”. We use this data to categorize food codes into mixed vs. non-mixed foods, and then later stratify our results by this categorization. See <strong>Section XX</strong> to see how these mixed dish codes were determined.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="cleaning-code-for-cost-data.html#cb366-1" tabindex="-1"></a>mixed <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/raw_data/mixed/mixed_dishes_100923.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-2"><a href="cleaning-code-for-cost-data.html#cb366-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>foodcode_desc)</span></code></pre></div>
<pre><code>## Rows: 13 Columns: 3
## ── Column specification ─────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): foodcode_desc
## dbl (2): foodcode_prefix, mixed_dish
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Some of the categorizations are for prefixes with two digits, and some are for prefixes with three digits.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="cleaning-code-for-cost-data.html#cb368-1" tabindex="-1"></a>mixed_2dig <span class="ot">&lt;-</span> mixed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(foodcode_prefix <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">416</span>, <span class="dv">418</span>, <span class="dv">419</span>, <span class="dv">423</span>)))</span>
<span id="cb368-2"><a href="cleaning-code-for-cost-data.html#cb368-2" tabindex="-1"></a>mixed_3dig <span class="ot">&lt;-</span> mixed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(foodcode_prefix <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">416</span>, <span class="dv">418</span>, <span class="dv">419</span>, <span class="dv">423</span>)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">three_digits =</span> foodcode_prefix)</span></code></pre></div>
<p>First, join both_days with the two digits, and then the three digits. Then, create an indicator variable called “mixed_dish” that we can stratify by later.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="cleaning-code-for-cost-data.html#cb369-1" tabindex="-1"></a>both_days10 <span class="ot">&lt;-</span> both_days9 <span class="sc">%&gt;%</span> </span>
<span id="cb369-2"><a href="cleaning-code-for-cost-data.html#cb369-2" tabindex="-1"></a>  <span class="fu">left_join</span>(mixed_2dig, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;two_digits&quot;</span> <span class="ot">=</span> <span class="st">&quot;foodcode_prefix&quot;</span>))</span>
<span id="cb369-3"><a href="cleaning-code-for-cost-data.html#cb369-3" tabindex="-1"></a></span>
<span id="cb369-4"><a href="cleaning-code-for-cost-data.html#cb369-4" tabindex="-1"></a>both_days11 <span class="ot">&lt;-</span> both_days10 <span class="sc">%&gt;%</span> </span>
<span id="cb369-5"><a href="cleaning-code-for-cost-data.html#cb369-5" tabindex="-1"></a>  <span class="fu">rows_patch</span>(mixed_3dig, <span class="at">unmatched =</span> <span class="st">&quot;ignore&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb369-6"><a href="cleaning-code-for-cost-data.html#cb369-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mixed_dish =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(mixed_dish), <span class="dv">0</span>, mixed_dish))</span></code></pre></div>
<pre><code>## Matching, by = &quot;three_digits&quot;</code></pre>
<p>Check if everything merged correctly.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="cleaning-code-for-cost-data.html#cb371-1" tabindex="-1"></a>both_days11 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(mixed_dish <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(two_digits) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(two_digits)</span></code></pre></div>
<pre><code>## # A tibble: 11 × 1
##    two_digits
##         &lt;dbl&gt;
##  1         27
##  2         28
##  3         32
##  4         33
##  5         41
##  6         42
##  7         58
##  8         59
##  9         76
## 10         77
## 11         78</code></pre>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="cleaning-code-for-cost-data.html#cb373-1" tabindex="-1"></a><span class="co"># looks good</span></span></code></pre></div>
<p>Lastly, save a copy of this temporary dataset in case we need it for debugging later.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="cleaning-code-for-cost-data.html#cb374-1" tabindex="-1"></a><span class="fu">saveRDS</span>(both_days11, <span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/both_days11_cost.rds&quot;</span>)</span></code></pre></div>
<p>Tidy up the global environment.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="cleaning-code-for-cost-data.html#cb375-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days11&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
</div>
<div id="calculate-average-food-cost-per-fndds-food-code" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Calculate Average Food Cost, Per FNDDS Food Code<a href="cleaning-code-for-cost-data.html#calculate-average-food-cost-per-fndds-food-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, we will calculate the average food cost per 1 gram for each FNDDS food code. This process includes aggregating and summarizing the diet dataset.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="cleaning-code-for-cost-data.html#cb376-1" tabindex="-1"></a><span class="co"># keep this commented out unless you are starting the script from here</span></span>
<span id="cb376-2"><a href="cleaning-code-for-cost-data.html#cb376-2" tabindex="-1"></a><span class="co"># both_days11 &lt;- read_rds(&quot;data_inputs/IMPACT_FACTORS/temp_data/both_days11_cost.rds&quot;)</span></span>
<span id="cb376-3"><a href="cleaning-code-for-cost-data.html#cb376-3" tabindex="-1"></a><span class="co"># my_date &lt;- Sys.Date()</span></span></code></pre></div>
<p>First, select the variables we need to eventually calculate the cost impact factors.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="cleaning-code-for-cost-data.html#cb377-1" tabindex="-1"></a>my_price_table <span class="ot">&lt;-</span> both_days11 <span class="sc">%&gt;%</span> </span>
<span id="cb377-2"><a href="cleaning-code-for-cost-data.html#cb377-2" tabindex="-1"></a>  <span class="fu">select</span>(seqn, dayrec, line, foodcode, description, Foodgroup_FNDDS, </span>
<span id="cb377-3"><a href="cleaning-code-for-cost-data.html#cb377-3" tabindex="-1"></a>         foodsource, ratio_FAFH_FAH, price_per_gram, mixed_dish, grams) <span class="sc">%&gt;%</span> </span>
<span id="cb377-4"><a href="cleaning-code-for-cost-data.html#cb377-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb377-5"><a href="cleaning-code-for-cost-data.html#cb377-5" tabindex="-1"></a>  <span class="fu">arrange</span>(seqn, dayrec, line)</span></code></pre></div>
<p>Then, import the food-level consumed, inedible, and wasted amounts that was calculated in the previous <strong>Section XXX</strong> and join with my_price table. These values were calculated in the previous section because the inedible and wasted coefficients are at the FCID-level, which is the same level that the environmental impacts are at.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="cleaning-code-for-cost-data.html#cb378-1" tabindex="-1"></a><span class="co"># import </span></span>
<span id="cb378-2"><a href="cleaning-code-for-cost-data.html#cb378-2" tabindex="-1"></a>fndds_flw <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/fndds_flw.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb378-3"><a href="cleaning-code-for-cost-data.html#cb378-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodcode =</span> <span class="fu">as.character</span>(foodcode))</span>
<span id="cb378-4"><a href="cleaning-code-for-cost-data.html#cb378-4" tabindex="-1"></a></span>
<span id="cb378-5"><a href="cleaning-code-for-cost-data.html#cb378-5" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb378-6"><a href="cleaning-code-for-cost-data.html#cb378-6" tabindex="-1"></a>my_price_table1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(my_price_table, fndds_flw, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seqn&quot;</span>, <span class="st">&quot;dayrec&quot;</span>, <span class="st">&quot;line&quot;</span>, <span class="st">&quot;foodcode&quot;</span>, <span class="st">&quot;description&quot;</span>))</span>
<span id="cb378-7"><a href="cleaning-code-for-cost-data.html#cb378-7" tabindex="-1"></a></span>
<span id="cb378-8"><a href="cleaning-code-for-cost-data.html#cb378-8" tabindex="-1"></a><span class="co"># look at missing</span></span>
<span id="cb378-9"><a href="cleaning-code-for-cost-data.html#cb378-9" tabindex="-1"></a>my_price_table1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(inedible_amt_FNDDS) <span class="sc">|</span> <span class="fu">is.na</span>(wasted_amt_FNDDS))</span></code></pre></div>
<pre><code>## # A tibble: 0 × 14
## # ℹ 14 variables: seqn &lt;dbl&gt;, dayrec &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;chr&gt;, description &lt;chr&gt;,
## #   Foodgroup_FNDDS &lt;chr&gt;, foodsource &lt;chr&gt;, ratio_FAFH_FAH &lt;dbl&gt;, price_per_gram &lt;dbl&gt;, mixed_dish &lt;dbl&gt;,
## #   grams &lt;dbl&gt;, consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;</code></pre>
<p>Now, we need to adjust for the difference in price for food purchased at the grocery store vs. not purchased there. We do this by multiplying the food-level FAFH-FAH ratio by the food price/1g rate if the food source is “Other” (i.e., not grocery).</p>
<p>We also need to calculate the total price for the amounts of food consumed (price_impact_per_foodcode_Consumed).</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="cleaning-code-for-cost-data.html#cb380-1" tabindex="-1"></a><span class="co"># adjust price for FAFH</span></span>
<span id="cb380-2"><a href="cleaning-code-for-cost-data.html#cb380-2" tabindex="-1"></a><span class="co"># if food source is &#39;other&#39;, then multiple price by fah/fafh ratio</span></span>
<span id="cb380-3"><a href="cleaning-code-for-cost-data.html#cb380-3" tabindex="-1"></a>my_price_table2 <span class="ot">&lt;-</span> my_price_table1 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">price_per_gram_adjusted =</span> <span class="fu">ifelse</span>(foodsource <span class="sc">==</span> <span class="st">&quot;Other&quot;</span>, </span>
<span id="cb380-4"><a href="cleaning-code-for-cost-data.html#cb380-4" tabindex="-1"></a>                                                           price_per_gram <span class="sc">*</span> ratio_FAFH_FAH, </span>
<span id="cb380-5"><a href="cleaning-code-for-cost-data.html#cb380-5" tabindex="-1"></a>                                                           price_per_gram),</span>
<span id="cb380-6"><a href="cleaning-code-for-cost-data.html#cb380-6" tabindex="-1"></a>                                             <span class="at">price_impact_per_foodcode_Consumed =</span> consumed_amt_FNDDS <span class="sc">*</span> price_per_gram_adjusted)</span></code></pre></div>
<p>Now, we want to calculate the total amount of money spent on each FNDDS foodcode, per person, per day. This is necessary because for some participants, they consumed a given FNDDS foodcode multiple times in the same day, and we want to combine these so each FNDDS food code only has one corresponding daily price. For example, if someone had 100 grams of coffee in the morning and then another 75 grams in the afternoon, we want to get the price for 175 grams of coffee consumed that day.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="cleaning-code-for-cost-data.html#cb381-1" tabindex="-1"></a><span class="co"># Calculate total price per day, per person</span></span>
<span id="cb381-2"><a href="cleaning-code-for-cost-data.html#cb381-2" tabindex="-1"></a>price_impact_total <span class="ot">&lt;-</span> my_price_table2 <span class="sc">%&gt;%</span> </span>
<span id="cb381-3"><a href="cleaning-code-for-cost-data.html#cb381-3" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, foodcode, dayrec, mixed_dish) <span class="sc">%&gt;%</span> </span>
<span id="cb381-4"><a href="cleaning-code-for-cost-data.html#cb381-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">price_per_day_Consumed =</span> <span class="fu">sum</span>(price_impact_per_foodcode_Consumed),</span>
<span id="cb381-5"><a href="cleaning-code-for-cost-data.html#cb381-5" tabindex="-1"></a>            <span class="at">consumed_per_day =</span> <span class="fu">sum</span>(consumed_amt_FNDDS),</span>
<span id="cb381-6"><a href="cleaning-code-for-cost-data.html#cb381-6" tabindex="-1"></a>            <span class="at">inedible_per_day =</span> <span class="fu">sum</span>(inedible_amt_FNDDS),</span>
<span id="cb381-7"><a href="cleaning-code-for-cost-data.html#cb381-7" tabindex="-1"></a>            <span class="at">wasted_per_day =</span> <span class="fu">sum</span>(wasted_amt_FNDDS))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;, &#39;foodcode&#39;, &#39;dayrec&#39;. You can override using the `.groups`
## argument.</code></pre>
<p>Transform dataset to wide format.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="cleaning-code-for-cost-data.html#cb383-1" tabindex="-1"></a>price_wide_total <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(price_impact_total, </span>
<span id="cb383-2"><a href="cleaning-code-for-cost-data.html#cb383-2" tabindex="-1"></a>                                <span class="at">names_from =</span> <span class="fu">c</span>(dayrec),</span>
<span id="cb383-3"><a href="cleaning-code-for-cost-data.html#cb383-3" tabindex="-1"></a>                                <span class="at">values_from =</span> <span class="fu">c</span>(price_per_day_Consumed,</span>
<span id="cb383-4"><a href="cleaning-code-for-cost-data.html#cb383-4" tabindex="-1"></a>                                                consumed_per_day,</span>
<span id="cb383-5"><a href="cleaning-code-for-cost-data.html#cb383-5" tabindex="-1"></a>                                                inedible_per_day,</span>
<span id="cb383-6"><a href="cleaning-code-for-cost-data.html#cb383-6" tabindex="-1"></a>                                                wasted_per_day))</span></code></pre></div>
<p>Because some participants have 2 days of dietary recall, we need to calculate an average price for each foodcode, per particpant. If a participant only has 1 day of recall, then we use that to represent the average.</p>
<p>To calculate the average, we first need to determine how many days of recall each particpant has.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="cleaning-code-for-cost-data.html#cb384-1" tabindex="-1"></a><span class="co"># calculate # days of recall</span></span>
<span id="cb384-2"><a href="cleaning-code-for-cost-data.html#cb384-2" tabindex="-1"></a>both_days11 <span class="sc">%&gt;%</span> <span class="fu">select</span>(reliable) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## reliable
##      1      4 
## 420721   7623</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="cleaning-code-for-cost-data.html#cb386-1" tabindex="-1"></a>daysofintake <span class="ot">&lt;-</span> both_days11 <span class="sc">%&gt;%</span> <span class="fu">select</span>(seqn, daysintake, reliable) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb386-2"><a href="cleaning-code-for-cost-data.html#cb386-2" tabindex="-1"></a></span>
<span id="cb386-3"><a href="cleaning-code-for-cost-data.html#cb386-3" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb386-4"><a href="cleaning-code-for-cost-data.html#cb386-4" tabindex="-1"></a>price_wide_total1 <span class="ot">&lt;-</span> price_wide_total <span class="sc">%&gt;%</span> </span>
<span id="cb386-5"><a href="cleaning-code-for-cost-data.html#cb386-5" tabindex="-1"></a>  <span class="fu">left_join</span>(daysofintake, <span class="at">by =</span> <span class="st">&quot;seqn&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in left_join(., daysofintake, by = &quot;seqn&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 10171 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="cleaning-code-for-cost-data.html#cb388-1" tabindex="-1"></a><span class="co"># check missing</span></span>
<span id="cb388-2"><a href="cleaning-code-for-cost-data.html#cb388-2" tabindex="-1"></a>price_wide_total1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_1)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
## # Groups:   seqn, foodcode [6]
##    seqn foodcode mixed_dish price_per_day_Consumed_2 price_per_day_Consumed_1 consumed_per_day_2
##   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;                    &lt;dbl&gt;                    &lt;dbl&gt;              &lt;dbl&gt;
## 1 84306 11000000          0                       NA                       NA                 NA
## 2 85182 11000000          0                       NA                       NA                 NA
## 3 85616 11000000          0                       NA                       NA                 NA
## 4 86025 11000000          0                       NA                       NA                 NA
## 5 86408 11000000          0                       NA                       NA                 NA
## 6 86704 11000000          0                       NA                       NA                 NA
## # ℹ 7 more variables: consumed_per_day_1 &lt;dbl&gt;, inedible_per_day_2 &lt;dbl&gt;, inedible_per_day_1 &lt;dbl&gt;,
## #   wasted_per_day_2 &lt;dbl&gt;, wasted_per_day_1 &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;</code></pre>
<p>Now, we have to fill in some 0s to properly calculate averages later on.</p>
<p>If a participant has 2 days of intake and their corresponding price for day 1 or day 2 is missing (NA), then we need to replace those NAs with 0s, because in this case, the data aren’t “missing”, the participant just didn’t consume/spend money on that food that day.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="cleaning-code-for-cost-data.html#cb390-1" tabindex="-1"></a><span class="co"># add 0s when appropriate</span></span>
<span id="cb390-2"><a href="cleaning-code-for-cost-data.html#cb390-2" tabindex="-1"></a>price_wide_total2 <span class="ot">&lt;-</span> price_wide_total1 <span class="sc">%&gt;%</span> </span>
<span id="cb390-3"><a href="cleaning-code-for-cost-data.html#cb390-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb390-4"><a href="cleaning-code-for-cost-data.html#cb390-4" tabindex="-1"></a>    <span class="co"># day 2</span></span>
<span id="cb390-5"><a href="cleaning-code-for-cost-data.html#cb390-5" tabindex="-1"></a>    <span class="at">price_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(price_per_day_Consumed_2), <span class="dv">0</span>, price_per_day_Consumed_2),</span>
<span id="cb390-6"><a href="cleaning-code-for-cost-data.html#cb390-6" tabindex="-1"></a>    <span class="at">consumed_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_2), <span class="dv">0</span>, consumed_per_day_2),</span>
<span id="cb390-7"><a href="cleaning-code-for-cost-data.html#cb390-7" tabindex="-1"></a>    <span class="at">wasted_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_2), <span class="dv">0</span>, wasted_per_day_2),</span>
<span id="cb390-8"><a href="cleaning-code-for-cost-data.html#cb390-8" tabindex="-1"></a>    <span class="at">inedible_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_2), <span class="dv">0</span>, inedible_per_day_2),</span>
<span id="cb390-9"><a href="cleaning-code-for-cost-data.html#cb390-9" tabindex="-1"></a>    </span>
<span id="cb390-10"><a href="cleaning-code-for-cost-data.html#cb390-10" tabindex="-1"></a>    <span class="co"># day1</span></span>
<span id="cb390-11"><a href="cleaning-code-for-cost-data.html#cb390-11" tabindex="-1"></a>    <span class="at">price_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(price_per_day_Consumed_1), <span class="dv">0</span>, price_per_day_Consumed_1),</span>
<span id="cb390-12"><a href="cleaning-code-for-cost-data.html#cb390-12" tabindex="-1"></a>    <span class="at">consumed_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_1), <span class="dv">0</span>, consumed_per_day_1),</span>
<span id="cb390-13"><a href="cleaning-code-for-cost-data.html#cb390-13" tabindex="-1"></a>    <span class="at">wasted_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_1), <span class="dv">0</span>, wasted_per_day_1),</span>
<span id="cb390-14"><a href="cleaning-code-for-cost-data.html#cb390-14" tabindex="-1"></a>    <span class="at">inedible_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_1), <span class="dv">0</span>, inedible_per_day_1))</span></code></pre></div>
<p>Calculate the <strong>average</strong> total price of consumed food at the FNDDS foodcode-level for each person. This will give us the data we need to calculate the cost impact factors in the next section.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="cleaning-code-for-cost-data.html#cb391-1" tabindex="-1"></a>price_wide_total3 <span class="ot">&lt;-</span> price_wide_total2 <span class="sc">%&gt;%</span> </span>
<span id="cb391-2"><a href="cleaning-code-for-cost-data.html#cb391-2" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb391-3"><a href="cleaning-code-for-cost-data.html#cb391-3" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb391-4"><a href="cleaning-code-for-cost-data.html#cb391-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_total_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(price_per_day_Consumed_1, price_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb391-5"><a href="cleaning-code-for-cost-data.html#cb391-5" tabindex="-1"></a>         <span class="at">consumed_total_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(consumed_per_day_1, consumed_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb391-6"><a href="cleaning-code-for-cost-data.html#cb391-6" tabindex="-1"></a>         <span class="at">inedible_total_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(inedible_per_day_1, inedible_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb391-7"><a href="cleaning-code-for-cost-data.html#cb391-7" tabindex="-1"></a>         <span class="at">wasted_total_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(wasted_per_day_1, wasted_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb391-8"><a href="cleaning-code-for-cost-data.html#cb391-8" tabindex="-1"></a>  <span class="fu">select</span>(seqn, foodcode, mixed_dish, price_total_avg_Consumed, </span>
<span id="cb391-9"><a href="cleaning-code-for-cost-data.html#cb391-9" tabindex="-1"></a>         consumed_total_avg, inedible_total_avg, wasted_total_avg)</span></code></pre></div>
<p>We also want to calculate the same thing as above, but additionally stratified by food source (grocery vs. non-grocery). So we do the same calculations above, but additionally group by “foodsource”.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="cleaning-code-for-cost-data.html#cb392-1" tabindex="-1"></a><span class="co"># STRATIFIED BY FAH VS FAFH</span></span>
<span id="cb392-2"><a href="cleaning-code-for-cost-data.html#cb392-2" tabindex="-1"></a><span class="co"># Calculate fah and fafh price, per person</span></span>
<span id="cb392-3"><a href="cleaning-code-for-cost-data.html#cb392-3" tabindex="-1"></a>price_impact_split <span class="ot">&lt;-</span> my_price_table2 <span class="sc">%&gt;%</span> </span>
<span id="cb392-4"><a href="cleaning-code-for-cost-data.html#cb392-4" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, foodcode, dayrec, foodsource, mixed_dish) <span class="sc">%&gt;%</span> </span>
<span id="cb392-5"><a href="cleaning-code-for-cost-data.html#cb392-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">price_per_day_Consumed =</span> <span class="fu">sum</span>(price_impact_per_foodcode_Consumed),</span>
<span id="cb392-6"><a href="cleaning-code-for-cost-data.html#cb392-6" tabindex="-1"></a>            <span class="at">consumed_per_day =</span> <span class="fu">sum</span>(consumed_amt_FNDDS),</span>
<span id="cb392-7"><a href="cleaning-code-for-cost-data.html#cb392-7" tabindex="-1"></a>            <span class="at">inedible_per_day =</span> <span class="fu">sum</span>(inedible_amt_FNDDS),</span>
<span id="cb392-8"><a href="cleaning-code-for-cost-data.html#cb392-8" tabindex="-1"></a>            <span class="at">wasted_per_day =</span> <span class="fu">sum</span>(wasted_amt_FNDDS))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;, &#39;foodcode&#39;, &#39;dayrec&#39;, &#39;foodsource&#39;. You can override using the
## `.groups` argument.</code></pre>
<p>Calculate the average of Day 1 and Day 2 prices for each FNDDS foodcode.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="cleaning-code-for-cost-data.html#cb394-1" tabindex="-1"></a>price_wide_split <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(price_impact_split, </span>
<span id="cb394-2"><a href="cleaning-code-for-cost-data.html#cb394-2" tabindex="-1"></a>                                <span class="at">names_from =</span> <span class="fu">c</span>(foodsource, dayrec),</span>
<span id="cb394-3"><a href="cleaning-code-for-cost-data.html#cb394-3" tabindex="-1"></a>                                <span class="at">values_from =</span> <span class="fu">c</span>(price_per_day_Consumed,</span>
<span id="cb394-4"><a href="cleaning-code-for-cost-data.html#cb394-4" tabindex="-1"></a>                                                consumed_per_day,</span>
<span id="cb394-5"><a href="cleaning-code-for-cost-data.html#cb394-5" tabindex="-1"></a>                                                inedible_per_day,</span>
<span id="cb394-6"><a href="cleaning-code-for-cost-data.html#cb394-6" tabindex="-1"></a>                                                wasted_per_day))</span>
<span id="cb394-7"><a href="cleaning-code-for-cost-data.html#cb394-7" tabindex="-1"></a></span>
<span id="cb394-8"><a href="cleaning-code-for-cost-data.html#cb394-8" tabindex="-1"></a><span class="co"># join with days of intake dataset</span></span>
<span id="cb394-9"><a href="cleaning-code-for-cost-data.html#cb394-9" tabindex="-1"></a>price_wide_split1 <span class="ot">&lt;-</span> price_wide_split <span class="sc">%&gt;%</span> </span>
<span id="cb394-10"><a href="cleaning-code-for-cost-data.html#cb394-10" tabindex="-1"></a>  <span class="fu">left_join</span>(daysofintake, <span class="at">by =</span> <span class="st">&quot;seqn&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in left_join(., daysofintake, by = &quot;seqn&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 10171 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="cleaning-code-for-cost-data.html#cb396-1" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb396-2"><a href="cleaning-code-for-cost-data.html#cb396-2" tabindex="-1"></a>price_wide_split1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_Other_1)) <span class="co">#good</span></span></code></pre></div>
<pre><code>## # A tibble: 17,721 × 21
## # Groups:   seqn, foodcode [17,721]
##     seqn foodcode mixed_dish price_per_day_Consumed_Other_2 price_per_day_Consumed_G…¹ price_per_day_Consum…²
##    &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;                          &lt;dbl&gt;                      &lt;dbl&gt;                  &lt;dbl&gt;
##  1 83735 12310350          0                             NA                     0.0719                     NA
##  2 83735 54301100          0                             NA                     0.161                      NA
##  3 83735 58106602          1                             NA                     0.725                      NA
##  4 83735 71405040          0                             NA                     0.355                      NA
##  5 83735 91705300          0                             NA                     0.131                      NA
##  6 83735 91705310          0                             NA                     0.253                      NA
##  7 83735 91745010          0                             NA                     0.0791                     NA
##  8 83735 92410370          0                             NA                     0.521                      NA
##  9 83735 94100100          0                             NA                     0.0634                     NA
## 10 83750 11112110          0                             NA                     0.458                      NA
## # ℹ 17,711 more rows
## # ℹ abbreviated names: ¹​price_per_day_Consumed_Grocery_1, ²​price_per_day_Consumed_Grocery_2
## # ℹ 15 more variables: price_per_day_Consumed_Other_1 &lt;dbl&gt;, consumed_per_day_Other_2 &lt;dbl&gt;,
## #   consumed_per_day_Grocery_1 &lt;dbl&gt;, consumed_per_day_Grocery_2 &lt;dbl&gt;, consumed_per_day_Other_1 &lt;dbl&gt;,
## #   inedible_per_day_Other_2 &lt;dbl&gt;, inedible_per_day_Grocery_1 &lt;dbl&gt;, inedible_per_day_Grocery_2 &lt;dbl&gt;,
## #   inedible_per_day_Other_1 &lt;dbl&gt;, wasted_per_day_Other_2 &lt;dbl&gt;, wasted_per_day_Grocery_1 &lt;dbl&gt;,
## #   wasted_per_day_Grocery_2 &lt;dbl&gt;, wasted_per_day_Other_1 &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="cleaning-code-for-cost-data.html#cb398-1" tabindex="-1"></a><span class="co"># add 0s when appropriate</span></span>
<span id="cb398-2"><a href="cleaning-code-for-cost-data.html#cb398-2" tabindex="-1"></a>price_wide_split2 <span class="ot">&lt;-</span> price_wide_split1 <span class="sc">%&gt;%</span> </span>
<span id="cb398-3"><a href="cleaning-code-for-cost-data.html#cb398-3" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb398-4"><a href="cleaning-code-for-cost-data.html#cb398-4" tabindex="-1"></a>    </span>
<span id="cb398-5"><a href="cleaning-code-for-cost-data.html#cb398-5" tabindex="-1"></a>    <span class="co"># TWO DAYS OF INTAKE</span></span>
<span id="cb398-6"><a href="cleaning-code-for-cost-data.html#cb398-6" tabindex="-1"></a>    </span>
<span id="cb398-7"><a href="cleaning-code-for-cost-data.html#cb398-7" tabindex="-1"></a>    <span class="co"># day 2 - Other</span></span>
<span id="cb398-8"><a href="cleaning-code-for-cost-data.html#cb398-8" tabindex="-1"></a>    <span class="at">price_per_day_Consumed_Other_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(price_per_day_Consumed_Other_2), <span class="dv">0</span>, price_per_day_Consumed_Other_2),</span>
<span id="cb398-9"><a href="cleaning-code-for-cost-data.html#cb398-9" tabindex="-1"></a>    <span class="at">consumed_per_day_Other_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_Other_2), <span class="dv">0</span>, consumed_per_day_Other_2),</span>
<span id="cb398-10"><a href="cleaning-code-for-cost-data.html#cb398-10" tabindex="-1"></a>    <span class="at">wasted_per_day_Other_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_Other_2), <span class="dv">0</span>, wasted_per_day_Other_2),</span>
<span id="cb398-11"><a href="cleaning-code-for-cost-data.html#cb398-11" tabindex="-1"></a>    <span class="at">inedible_per_day_Other_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_Other_2), <span class="dv">0</span>, inedible_per_day_Other_2),</span>
<span id="cb398-12"><a href="cleaning-code-for-cost-data.html#cb398-12" tabindex="-1"></a>    </span>
<span id="cb398-13"><a href="cleaning-code-for-cost-data.html#cb398-13" tabindex="-1"></a>    <span class="co"># day1 - Other</span></span>
<span id="cb398-14"><a href="cleaning-code-for-cost-data.html#cb398-14" tabindex="-1"></a>    <span class="at">price_per_day_Consumed_Other_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(price_per_day_Consumed_Other_1), <span class="dv">0</span>, price_per_day_Consumed_Other_1),</span>
<span id="cb398-15"><a href="cleaning-code-for-cost-data.html#cb398-15" tabindex="-1"></a>    <span class="at">consumed_per_day_Other_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_Other_1), <span class="dv">0</span>, consumed_per_day_Other_1),</span>
<span id="cb398-16"><a href="cleaning-code-for-cost-data.html#cb398-16" tabindex="-1"></a>    <span class="at">wasted_per_day_Other_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_Other_1), <span class="dv">0</span>, wasted_per_day_Other_1),</span>
<span id="cb398-17"><a href="cleaning-code-for-cost-data.html#cb398-17" tabindex="-1"></a>    <span class="at">inedible_per_day_Other_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_Other_1), <span class="dv">0</span>, inedible_per_day_Other_1),</span>
<span id="cb398-18"><a href="cleaning-code-for-cost-data.html#cb398-18" tabindex="-1"></a>    </span>
<span id="cb398-19"><a href="cleaning-code-for-cost-data.html#cb398-19" tabindex="-1"></a>    <span class="co"># day 2 - Grocery</span></span>
<span id="cb398-20"><a href="cleaning-code-for-cost-data.html#cb398-20" tabindex="-1"></a>    <span class="at">price_per_day_Consumed_Grocery_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(price_per_day_Consumed_Grocery_2), <span class="dv">0</span>, price_per_day_Consumed_Grocery_2),</span>
<span id="cb398-21"><a href="cleaning-code-for-cost-data.html#cb398-21" tabindex="-1"></a>    <span class="at">consumed_per_day_Grocery_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_Grocery_2), <span class="dv">0</span>, consumed_per_day_Grocery_2),</span>
<span id="cb398-22"><a href="cleaning-code-for-cost-data.html#cb398-22" tabindex="-1"></a>    <span class="at">wasted_per_day_Grocery_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_Grocery_2), <span class="dv">0</span>, wasted_per_day_Grocery_2),</span>
<span id="cb398-23"><a href="cleaning-code-for-cost-data.html#cb398-23" tabindex="-1"></a>    <span class="at">inedible_per_day_Grocery_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_Grocery_2), <span class="dv">0</span>, inedible_per_day_Grocery_2),</span>
<span id="cb398-24"><a href="cleaning-code-for-cost-data.html#cb398-24" tabindex="-1"></a>    </span>
<span id="cb398-25"><a href="cleaning-code-for-cost-data.html#cb398-25" tabindex="-1"></a>    <span class="co"># day1 - Grocery</span></span>
<span id="cb398-26"><a href="cleaning-code-for-cost-data.html#cb398-26" tabindex="-1"></a>    <span class="at">price_per_day_Consumed_Grocery_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(price_per_day_Consumed_Grocery_1), <span class="dv">0</span>, price_per_day_Consumed_Grocery_1),</span>
<span id="cb398-27"><a href="cleaning-code-for-cost-data.html#cb398-27" tabindex="-1"></a>    <span class="at">consumed_per_day_Grocery_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_Grocery_1), <span class="dv">0</span>, consumed_per_day_Grocery_1),</span>
<span id="cb398-28"><a href="cleaning-code-for-cost-data.html#cb398-28" tabindex="-1"></a>    <span class="at">wasted_per_day_Grocery_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_Grocery_1), <span class="dv">0</span>, wasted_per_day_Grocery_1),</span>
<span id="cb398-29"><a href="cleaning-code-for-cost-data.html#cb398-29" tabindex="-1"></a>    <span class="at">inedible_per_day_Grocery_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_Grocery_1), <span class="dv">0</span>, inedible_per_day_Grocery_1),</span>
<span id="cb398-30"><a href="cleaning-code-for-cost-data.html#cb398-30" tabindex="-1"></a>    </span>
<span id="cb398-31"><a href="cleaning-code-for-cost-data.html#cb398-31" tabindex="-1"></a>    <span class="co"># ONE DAY OF INTAKE</span></span>
<span id="cb398-32"><a href="cleaning-code-for-cost-data.html#cb398-32" tabindex="-1"></a>    </span>
<span id="cb398-33"><a href="cleaning-code-for-cost-data.html#cb398-33" tabindex="-1"></a>    <span class="co"># day1 - Other</span></span>
<span id="cb398-34"><a href="cleaning-code-for-cost-data.html#cb398-34" tabindex="-1"></a>    <span class="at">price_per_day_Consumed_Other_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(price_per_day_Consumed_Other_1), <span class="dv">0</span>, price_per_day_Consumed_Other_1),</span>
<span id="cb398-35"><a href="cleaning-code-for-cost-data.html#cb398-35" tabindex="-1"></a>    <span class="at">consumed_per_day_Other_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_Other_1), <span class="dv">0</span>, consumed_per_day_Other_1),</span>
<span id="cb398-36"><a href="cleaning-code-for-cost-data.html#cb398-36" tabindex="-1"></a>    <span class="at">wasted_per_day_Other_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_Other_1), <span class="dv">0</span>, wasted_per_day_Other_1),</span>
<span id="cb398-37"><a href="cleaning-code-for-cost-data.html#cb398-37" tabindex="-1"></a>    <span class="at">inedible_per_day_Other_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_Other_1), <span class="dv">0</span>, inedible_per_day_Other_1),</span>
<span id="cb398-38"><a href="cleaning-code-for-cost-data.html#cb398-38" tabindex="-1"></a>    </span>
<span id="cb398-39"><a href="cleaning-code-for-cost-data.html#cb398-39" tabindex="-1"></a>    <span class="co"># day1 - Grocery</span></span>
<span id="cb398-40"><a href="cleaning-code-for-cost-data.html#cb398-40" tabindex="-1"></a>    <span class="at">price_per_day_Consumed_Grocery_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(price_per_day_Consumed_Grocery_1), <span class="dv">0</span>, price_per_day_Consumed_Grocery_1),</span>
<span id="cb398-41"><a href="cleaning-code-for-cost-data.html#cb398-41" tabindex="-1"></a>    <span class="at">consumed_per_day_Grocery_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_Grocery_1), <span class="dv">0</span>, consumed_per_day_Grocery_1),</span>
<span id="cb398-42"><a href="cleaning-code-for-cost-data.html#cb398-42" tabindex="-1"></a>    <span class="at">wasted_per_day_Grocery_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_Grocery_1), <span class="dv">0</span>, wasted_per_day_Grocery_1),</span>
<span id="cb398-43"><a href="cleaning-code-for-cost-data.html#cb398-43" tabindex="-1"></a>    <span class="at">inedible_per_day_Grocery_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_Grocery_1), <span class="dv">0</span>, inedible_per_day_Grocery_1))</span>
<span id="cb398-44"><a href="cleaning-code-for-cost-data.html#cb398-44" tabindex="-1"></a></span>
<span id="cb398-45"><a href="cleaning-code-for-cost-data.html#cb398-45" tabindex="-1"></a><span class="co"># summarize at foodcode-level for each person</span></span>
<span id="cb398-46"><a href="cleaning-code-for-cost-data.html#cb398-46" tabindex="-1"></a>price_wide_split3 <span class="ot">&lt;-</span> price_wide_split2 <span class="sc">%&gt;%</span> </span>
<span id="cb398-47"><a href="cleaning-code-for-cost-data.html#cb398-47" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb398-48"><a href="cleaning-code-for-cost-data.html#cb398-48" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb398-49"><a href="cleaning-code-for-cost-data.html#cb398-49" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb398-50"><a href="cleaning-code-for-cost-data.html#cb398-50" tabindex="-1"></a>    <span class="co">#FAH (Grocery)</span></span>
<span id="cb398-51"><a href="cleaning-code-for-cost-data.html#cb398-51" tabindex="-1"></a>    <span class="at">price_fah_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(price_per_day_Consumed_Grocery_1, price_per_day_Consumed_Grocery_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-52"><a href="cleaning-code-for-cost-data.html#cb398-52" tabindex="-1"></a>    <span class="at">consumed_fah_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(consumed_per_day_Grocery_1, consumed_per_day_Grocery_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-53"><a href="cleaning-code-for-cost-data.html#cb398-53" tabindex="-1"></a>    <span class="at">inedible_fah_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(inedible_per_day_Grocery_1, inedible_per_day_Grocery_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-54"><a href="cleaning-code-for-cost-data.html#cb398-54" tabindex="-1"></a>    <span class="at">wasted_fah_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(wasted_per_day_Grocery_1, wasted_per_day_Grocery_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-55"><a href="cleaning-code-for-cost-data.html#cb398-55" tabindex="-1"></a>    </span>
<span id="cb398-56"><a href="cleaning-code-for-cost-data.html#cb398-56" tabindex="-1"></a>    <span class="co">#FAFH (Other)</span></span>
<span id="cb398-57"><a href="cleaning-code-for-cost-data.html#cb398-57" tabindex="-1"></a>    <span class="at">price_fafh_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(price_per_day_Consumed_Other_1, price_per_day_Consumed_Other_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-58"><a href="cleaning-code-for-cost-data.html#cb398-58" tabindex="-1"></a>    <span class="at">consumed_fafh_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(consumed_per_day_Other_1, consumed_per_day_Other_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-59"><a href="cleaning-code-for-cost-data.html#cb398-59" tabindex="-1"></a>    <span class="at">inedible_fafh_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(inedible_per_day_Other_1, inedible_per_day_Other_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb398-60"><a href="cleaning-code-for-cost-data.html#cb398-60" tabindex="-1"></a>    <span class="at">wasted_fafh_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(wasted_per_day_Other_1, wasted_per_day_Other_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb398-61"><a href="cleaning-code-for-cost-data.html#cb398-61" tabindex="-1"></a>  </span>
<span id="cb398-62"><a href="cleaning-code-for-cost-data.html#cb398-62" tabindex="-1"></a>  <span class="fu">select</span>(seqn, foodcode, mixed_dish,</span>
<span id="cb398-63"><a href="cleaning-code-for-cost-data.html#cb398-63" tabindex="-1"></a>         price_fah_avg_Consumed, </span>
<span id="cb398-64"><a href="cleaning-code-for-cost-data.html#cb398-64" tabindex="-1"></a>         consumed_fah_avg, inedible_fah_avg, wasted_fah_avg,</span>
<span id="cb398-65"><a href="cleaning-code-for-cost-data.html#cb398-65" tabindex="-1"></a>         price_fafh_avg_Consumed, </span>
<span id="cb398-66"><a href="cleaning-code-for-cost-data.html#cb398-66" tabindex="-1"></a>         consumed_fafh_avg, inedible_fafh_avg, wasted_fafh_avg)</span></code></pre></div>
<p>Join the total price and the split price averages into one dataset.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="cleaning-code-for-cost-data.html#cb399-1" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb399-2"><a href="cleaning-code-for-cost-data.html#cb399-2" tabindex="-1"></a>price_wide_comb <span class="ot">&lt;-</span> <span class="fu">full_join</span>(price_wide_total3, price_wide_split3, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seqn&quot;</span>, <span class="st">&quot;foodcode&quot;</span>, <span class="st">&quot;mixed_dish&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in full_join(price_wide_total3, price_wide_split3, by = c(&quot;seqn&quot;, : Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 10171 of `x` matches multiple rows in `y`.
## ℹ Row 10171 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="cleaning-code-for-cost-data.html#cb401-1" tabindex="-1"></a><span class="co"># create foodcode-to-food group &quot;mapping&quot; to join with</span></span>
<span id="cb401-2"><a href="cleaning-code-for-cost-data.html#cb401-2" tabindex="-1"></a>map <span class="ot">&lt;-</span> both_days11 <span class="sc">%&gt;%</span></span>
<span id="cb401-3"><a href="cleaning-code-for-cost-data.html#cb401-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb401-4"><a href="cleaning-code-for-cost-data.html#cb401-4" tabindex="-1"></a>  <span class="fu">select</span>(foodcode, Foodgroup_FNDDS) <span class="sc">%&gt;%</span> </span>
<span id="cb401-5"><a href="cleaning-code-for-cost-data.html#cb401-5" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb401-6"><a href="cleaning-code-for-cost-data.html#cb401-6" tabindex="-1"></a></span>
<span id="cb401-7"><a href="cleaning-code-for-cost-data.html#cb401-7" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb401-8"><a href="cleaning-code-for-cost-data.html#cb401-8" tabindex="-1"></a>price_wide_comb1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(price_wide_comb, map, <span class="at">by =</span> <span class="st">&quot;foodcode&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb401-9"><a href="cleaning-code-for-cost-data.html#cb401-9" tabindex="-1"></a>  <span class="fu">relocate</span>(Foodgroup_FNDDS, <span class="at">.after =</span> mixed_dish)</span>
<span id="cb401-10"><a href="cleaning-code-for-cost-data.html#cb401-10" tabindex="-1"></a></span>
<span id="cb401-11"><a href="cleaning-code-for-cost-data.html#cb401-11" tabindex="-1"></a><span class="co"># add up prices by food group</span></span>
<span id="cb401-12"><a href="cleaning-code-for-cost-data.html#cb401-12" tabindex="-1"></a>price_wide_comb2 <span class="ot">&lt;-</span> price_wide_comb1 <span class="sc">%&gt;%</span> </span>
<span id="cb401-13"><a href="cleaning-code-for-cost-data.html#cb401-13" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, Foodgroup_FNDDS, mixed_dish) <span class="sc">%&gt;%</span> </span>
<span id="cb401-14"><a href="cleaning-code-for-cost-data.html#cb401-14" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb401-15"><a href="cleaning-code-for-cost-data.html#cb401-15" tabindex="-1"></a>    <span class="co"># Consumed</span></span>
<span id="cb401-16"><a href="cleaning-code-for-cost-data.html#cb401-16" tabindex="-1"></a>    <span class="at">price_total_sum_Consumed =</span> <span class="fu">sum</span>(price_total_avg_Consumed),</span>
<span id="cb401-17"><a href="cleaning-code-for-cost-data.html#cb401-17" tabindex="-1"></a>    <span class="at">consumed_total_sum =</span> <span class="fu">sum</span>(consumed_total_avg),</span>
<span id="cb401-18"><a href="cleaning-code-for-cost-data.html#cb401-18" tabindex="-1"></a>    </span>
<span id="cb401-19"><a href="cleaning-code-for-cost-data.html#cb401-19" tabindex="-1"></a>    <span class="at">price_fah_sum_Consumed =</span> <span class="fu">sum</span>(price_fah_avg_Consumed),</span>
<span id="cb401-20"><a href="cleaning-code-for-cost-data.html#cb401-20" tabindex="-1"></a>    <span class="at">consumed_fah_sum =</span> <span class="fu">sum</span>(consumed_fah_avg),</span>
<span id="cb401-21"><a href="cleaning-code-for-cost-data.html#cb401-21" tabindex="-1"></a>    </span>
<span id="cb401-22"><a href="cleaning-code-for-cost-data.html#cb401-22" tabindex="-1"></a>    <span class="at">price_fafh_sum_Consumed =</span> <span class="fu">sum</span>(price_fafh_avg_Consumed),</span>
<span id="cb401-23"><a href="cleaning-code-for-cost-data.html#cb401-23" tabindex="-1"></a>    <span class="at">consumed_fafh_sum =</span> <span class="fu">sum</span>(consumed_fafh_avg),</span>
<span id="cb401-24"><a href="cleaning-code-for-cost-data.html#cb401-24" tabindex="-1"></a>    </span>
<span id="cb401-25"><a href="cleaning-code-for-cost-data.html#cb401-25" tabindex="-1"></a>    <span class="co"># Inedible</span></span>
<span id="cb401-26"><a href="cleaning-code-for-cost-data.html#cb401-26" tabindex="-1"></a>    <span class="at">inedible_total_sum =</span> <span class="fu">sum</span>(inedible_total_avg),</span>
<span id="cb401-27"><a href="cleaning-code-for-cost-data.html#cb401-27" tabindex="-1"></a>    <span class="at">inedible_fah_sum =</span> <span class="fu">sum</span>(inedible_fah_avg),</span>
<span id="cb401-28"><a href="cleaning-code-for-cost-data.html#cb401-28" tabindex="-1"></a>    <span class="at">inedible_fafh_sum =</span> <span class="fu">sum</span>(inedible_fafh_avg),</span>
<span id="cb401-29"><a href="cleaning-code-for-cost-data.html#cb401-29" tabindex="-1"></a>    </span>
<span id="cb401-30"><a href="cleaning-code-for-cost-data.html#cb401-30" tabindex="-1"></a>    <span class="co"># Wasted</span></span>
<span id="cb401-31"><a href="cleaning-code-for-cost-data.html#cb401-31" tabindex="-1"></a>    <span class="at">wasted_total_sum =</span> <span class="fu">sum</span>(wasted_total_avg),</span>
<span id="cb401-32"><a href="cleaning-code-for-cost-data.html#cb401-32" tabindex="-1"></a>    <span class="at">wasted_fah_sum =</span> <span class="fu">sum</span>(wasted_fah_avg),</span>
<span id="cb401-33"><a href="cleaning-code-for-cost-data.html#cb401-33" tabindex="-1"></a>    <span class="at">wasted_fafh_sum =</span> <span class="fu">sum</span>(wasted_fafh_avg))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;, &#39;Foodgroup_FNDDS&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="cleaning-code-for-cost-data.html#cb403-1" tabindex="-1"></a><span class="co"># transform to wide</span></span>
<span id="cb403-2"><a href="cleaning-code-for-cost-data.html#cb403-2" tabindex="-1"></a>price_wide_comb3 <span class="ot">&lt;-</span> price_wide_comb2 <span class="sc">%&gt;%</span> </span>
<span id="cb403-3"><a href="cleaning-code-for-cost-data.html#cb403-3" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> seqn,</span>
<span id="cb403-4"><a href="cleaning-code-for-cost-data.html#cb403-4" tabindex="-1"></a>              <span class="at">names_from =</span> <span class="fu">c</span>(Foodgroup_FNDDS, mixed_dish),</span>
<span id="cb403-5"><a href="cleaning-code-for-cost-data.html#cb403-5" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="sc">-</span><span class="fu">c</span>(seqn, Foodgroup_FNDDS, mixed_dish)) <span class="sc">%&gt;%</span> </span>
<span id="cb403-6"><a href="cleaning-code-for-cost-data.html#cb403-6" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)</span></code></pre></div>
<p>Export dataset to the temporary folder, so it can be used to calculate the impact factors in the next section.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="cleaning-code-for-cost-data.html#cb404-1" tabindex="-1"></a><span class="fu">write_rds</span>(price_wide_comb3, <span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/price_input_dat.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cleaning-code-for-environment-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="calculate-cost-environment-and-social-impact-factors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/05-cleaning-code-cost.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
