<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Cleaning Code for Environment Data | LASTING Four-Pillar Model Methodology</title>
  <meta name="description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Cleaning Code for Environment Data | LASTING Four-Pillar Model Methodology" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Cleaning Code for Environment Data | LASTING Four-Pillar Model Methodology" />
  
  <meta name="twitter:description" content="This is the comprehensive manual that describes all data inputs and methods used for the 4-pillar LASTING model." />
  

<meta name="author" content="Brooke M. Bell" />


<meta name="date" content="2025-04-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cleaning-code-for-health-data.html"/>
<link rel="next" href="cleaning-code-for-cost-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">LASTING Methods Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#github-repository"><i class="fa fa-check"></i>Github Repository</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data-inputs"><i class="fa fa-check"></i>Data Inputs</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code"><i class="fa fa-check"></i>Code</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#model-output"><i class="fa fa-check"></i>Model Output</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html"><i class="fa fa-check"></i><b>1</b> Summary of Data Inputs</a>
<ul>
<li class="chapter" data-level="1.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#diet-inputs"><i class="fa fa-check"></i><b>1.1</b> Diet Inputs</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="summary-of-data-inputs.html"><a href="summary-of-data-inputs.html#counterfactual-intake"><i class="fa fa-check"></i><b>1.1.1</b> Counterfactual Intake</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html"><i class="fa fa-check"></i><b>2</b> Cleaning Code for NHANES Diet Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#processed-and-organ-meat"><i class="fa fa-check"></i><b>2.1</b> Processed and Organ Meat</a></li>
<li class="chapter" data-level="2.2" data-path="cleaning-code-for-nhanes-diet-data.html"><a href="cleaning-code-for-nhanes-diet-data.html#clean-raw-nhanes-data"><i class="fa fa-check"></i><b>2.2</b> Clean Raw NHANES Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html"><i class="fa fa-check"></i><b>3</b> Cleaning Code for Health Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#create-final-data-inputs"><i class="fa fa-check"></i><b>3.1</b> Create Final Data Inputs</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#other-data-inputs"><i class="fa fa-check"></i><b>3.1.1</b> Other Data Inputs</a></li>
<li class="chapter" data-level="3.1.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#health-data-inputs"><i class="fa fa-check"></i><b>3.1.2</b> Health Data Inputs</a></li>
<li class="chapter" data-level="3.1.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#diet-data-inputs"><i class="fa fa-check"></i><b>3.1.3</b> Diet Data Inputs</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#clean-health-datasets"><i class="fa fa-check"></i><b>3.2</b> Clean Health Datasets</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#cancer-incidence-and-2-cvd-mortality"><i class="fa fa-check"></i><b>3.2.1</b> (1) Cancer incidence and (2) CVD mortality</a></li>
<li class="chapter" data-level="3.2.2" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#effect-sizes-for-diet-and-bmi-and-4-diet-and-sbp"><i class="fa fa-check"></i><b>3.2.2</b> (3) Effect sizes for diet and BMI and (4) diet and SBP</a></li>
<li class="chapter" data-level="3.2.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#rrs-for-bmi-and-cancer-and-6-for-bmi-and-cvd"><i class="fa fa-check"></i><b>3.2.3</b> (5) RRs for BMI and cancer and (6) for BMI and CVD</a></li>
<li class="chapter" data-level="3.2.4" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#logrrs-for-diet-and-cancer-and-8-for-diet-and-cvd"><i class="fa fa-check"></i><b>3.2.4</b> (7) LogRRs for diet and cancer and (8) for diet and CVD</a></li>
<li class="chapter" data-level="3.2.5" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#rrs-for-sbp-and-cvd"><i class="fa fa-check"></i><b>3.2.5</b> (9) RRs for SBP and CVD</a></li>
<li class="chapter" data-level="3.2.6" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#current-intake-nhanes-11-tmred-12-counterfactual-and-13-other-health-data"><i class="fa fa-check"></i><b>3.2.6</b> (10) Current intake (NHANES), (11) TMRED, (12) Counterfactual, and (13) Other health data</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="cleaning-code-for-health-data.html"><a href="cleaning-code-for-health-data.html#restructure-data"><i class="fa fa-check"></i><b>3.3</b> Restructure data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning Code for Environment Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#clean-and-restructure-intermediary-datasets"><i class="fa fa-check"></i><b>4.1</b> Clean and Restructure Intermediary Datasets</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#import-and-merge-data-inputs"><i class="fa fa-check"></i><b>4.1.1</b> Import and Merge Data Inputs</a></li>
<li class="chapter" data-level="4.1.2" data-path="cleaning-code-for-environment-data.html"><a href="cleaning-code-for-environment-data.html#calculate-average-environmental-and-social-impact-per-fcid-code"><i class="fa fa-check"></i><b>4.1.2</b> Calculate Average Environmental and Social Impact, Per FCID Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html"><i class="fa fa-check"></i><b>5</b> Cleaning Code for Cost Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#clean-and-restructure-intermediary-datasets-1"><i class="fa fa-check"></i><b>5.1</b> Clean and Restructure Intermediary Datasets</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#import-and-merge-data-inputs-1"><i class="fa fa-check"></i><b>5.1.1</b> Import and Merge Data Inputs</a></li>
<li class="chapter" data-level="5.1.2" data-path="cleaning-code-for-cost-data.html"><a href="cleaning-code-for-cost-data.html#calculate-average-food-cost-per-fndds-food-code"><i class="fa fa-check"></i><b>5.1.2</b> Calculate Average Food Cost, Per FNDDS Food Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html"><i class="fa fa-check"></i><b>6</b> Calculate Cost, Environment, and Social Impact Factors</a>
<ul>
<li class="chapter" data-level="6.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#prepare-data"><i class="fa fa-check"></i><b>6.1</b> Prepare Data</a></li>
<li class="chapter" data-level="6.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors"><i class="fa fa-check"></i><b>6.2</b> Cost Impact Factors</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors-by-food-by-subgroup"><i class="fa fa-check"></i><b>6.2.1</b> Cost Impact Factors, by Food, by Subgroup</a></li>
<li class="chapter" data-level="6.2.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost-impact-factors-per-100-grams-and-per-1-dga-serving"><i class="fa fa-check"></i><b>6.2.2</b> Cost Impact Factors, Per 100 Grams and Per 1 DGA Serving</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmental-social-impact-factors"><i class="fa fa-check"></i><b>6.3</b> Environmental &amp; Social Impact Factors</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmental-social-impact-factors-by-food-by-subgroup"><i class="fa fa-check"></i><b>6.3.1</b> Environmental &amp; Social Impact Factors, by Food, by Subgroup</a></li>
<li class="chapter" data-level="6.3.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmentsocial-impact-factors-per-100-grams-and-per-1-dga-serving"><i class="fa fa-check"></i><b>6.3.2</b> Environment/Social Impact Factors, Per 100 Grams and Per 1 DGA Serving</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#finalize-impact-factors"><i class="fa fa-check"></i><b>6.4</b> Finalize Impact Factors</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#merge-cost-environment-and-social-impact-factors"><i class="fa fa-check"></i><b>6.4.1</b> Merge Cost, Environment, and Social Impact Factors</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#calculate-inedible-and-wasted-proportions"><i class="fa fa-check"></i><b>6.5</b> Calculate Inedible and Wasted Proportions</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#environmentsocial"><i class="fa fa-check"></i><b>6.5.1</b> Environment/Social</a></li>
<li class="chapter" data-level="6.5.2" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#cost"><i class="fa fa-check"></i><b>6.5.2</b> Cost</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="calculate-cost-environment-and-social-impact-factors.html"><a href="calculate-cost-environment-and-social-impact-factors.html#export-data"><i class="fa fa-check"></i><b>6.6</b> Export Data</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">LASTING Four-Pillar Model Methodology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-code-for-environment-data" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Cleaning Code for Environment Data<a href="cleaning-code-for-environment-data.html#cleaning-code-for-environment-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter walks you through all of the R code used to clean the raw <strong>ENVIRONMENT</strong>-related data inputs. The resulting cleaned dataset is then used to calculate the environment impact factors (see <strong>Chapter XXX</strong>).</p>
<div id="clean-and-restructure-intermediary-datasets" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Clean and Restructure Intermediary Datasets<a href="cleaning-code-for-environment-data.html#clean-and-restructure-intermediary-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This script imports all of raw cost-related data inputs, and then cleans and merges them so that the cost impact factors can later be calculated.</p>
<p>Note that you must first open the ‘methods_manual’ R project before running this script or else it will not work.</p>
<p>First, let’s set up our environment.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="cleaning-code-for-environment-data.html#cb70-1" tabindex="-1"></a><span class="co"># check working directory</span></span>
<span id="cb70-2"><a href="cleaning-code-for-environment-data.html#cb70-2" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/Users/bmb73/Library/CloudStorage/Box-Box/lasting_aim_3/model development/methods_manual&quot;</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="cleaning-code-for-environment-data.html#cb72-1" tabindex="-1"></a><span class="co"># SET UP -----</span></span>
<span id="cb72-2"><a href="cleaning-code-for-environment-data.html#cb72-2" tabindex="-1"></a></span>
<span id="cb72-3"><a href="cleaning-code-for-environment-data.html#cb72-3" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb72-4"><a href="cleaning-code-for-environment-data.html#cb72-4" tabindex="-1"></a></span>
<span id="cb72-5"><a href="cleaning-code-for-environment-data.html#cb72-5" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span>
<span id="cb72-6"><a href="cleaning-code-for-environment-data.html#cb72-6" tabindex="-1"></a></span>
<span id="cb72-7"><a href="cleaning-code-for-environment-data.html#cb72-7" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb72-8"><a href="cleaning-code-for-environment-data.html#cb72-8" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb72-9"><a href="cleaning-code-for-environment-data.html#cb72-9" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb72-10"><a href="cleaning-code-for-environment-data.html#cb72-10" tabindex="-1"></a></span>
<span id="cb72-11"><a href="cleaning-code-for-environment-data.html#cb72-11" tabindex="-1"></a>my_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>()</span></code></pre></div>
<div id="import-and-merge-data-inputs" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Import and Merge Data Inputs<a href="cleaning-code-for-environment-data.html#import-and-merge-data-inputs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="nhanes-diet-intake" class="section level4 unnumbered hasAnchor">
<h4>NHANES Diet Intake<a href="cleaning-code-for-environment-data.html#nhanes-diet-intake" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>The following code is the same code used in Section XXX</strong>.</p>
<p>First, read in the NHANES food-level datasets. The data were split into “day 1” and “day 2” earlier, and here we are going to merge them into “both days”. There also are different datasets containing just sugar sweetened beverage (SSB) data, so we have to import those in separately, and then merge with the rest of the day1/day2 diet datasets.</p>
<p>Import all of the “day 1” datasets first.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="cleaning-code-for-environment-data.html#cb73-1" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb73-2"><a href="cleaning-code-for-environment-data.html#cb73-2" tabindex="-1"></a>day1 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day1_clean.rds&quot;</span>)</span>
<span id="cb73-3"><a href="cleaning-code-for-environment-data.html#cb73-3" tabindex="-1"></a></span>
<span id="cb73-4"><a href="cleaning-code-for-environment-data.html#cb73-4" tabindex="-1"></a><span class="co"># only select needed variables</span></span>
<span id="cb73-5"><a href="cleaning-code-for-environment-data.html#cb73-5" tabindex="-1"></a>day1_sub <span class="ot">&lt;-</span> day1 <span class="sc">%&gt;%</span> <span class="fu">select</span>(SEQN, DRDINT, DR1DRSTZ, DR1ILINE, DR1IFDCD, </span>
<span id="cb73-6"><a href="cleaning-code-for-environment-data.html#cb73-6" tabindex="-1"></a>                            DR1IGRMS, DESCRIPTION, foodsource, nhanes_cycle, dayrec, added_sugar) <span class="sc">%&gt;%</span> </span>
<span id="cb73-7"><a href="cleaning-code-for-environment-data.html#cb73-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">seqn =</span> SEQN,</span>
<span id="cb73-8"><a href="cleaning-code-for-environment-data.html#cb73-8" tabindex="-1"></a>         <span class="at">line =</span> DR1ILINE,</span>
<span id="cb73-9"><a href="cleaning-code-for-environment-data.html#cb73-9" tabindex="-1"></a>         <span class="at">foodcode =</span> DR1IFDCD,</span>
<span id="cb73-10"><a href="cleaning-code-for-environment-data.html#cb73-10" tabindex="-1"></a>         <span class="at">grams =</span> DR1IGRMS,</span>
<span id="cb73-11"><a href="cleaning-code-for-environment-data.html#cb73-11" tabindex="-1"></a>         <span class="at">description =</span> DESCRIPTION,</span>
<span id="cb73-12"><a href="cleaning-code-for-environment-data.html#cb73-12" tabindex="-1"></a>         <span class="at">daysintake =</span> DRDINT,</span>
<span id="cb73-13"><a href="cleaning-code-for-environment-data.html#cb73-13" tabindex="-1"></a>         <span class="at">reliable =</span> DR1DRSTZ)</span>
<span id="cb73-14"><a href="cleaning-code-for-environment-data.html#cb73-14" tabindex="-1"></a></span>
<span id="cb73-15"><a href="cleaning-code-for-environment-data.html#cb73-15" tabindex="-1"></a><span class="co"># ssb</span></span>
<span id="cb73-16"><a href="cleaning-code-for-environment-data.html#cb73-16" tabindex="-1"></a>ssb_1 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day1_ssb.rds&quot;</span>)</span>
<span id="cb73-17"><a href="cleaning-code-for-environment-data.html#cb73-17" tabindex="-1"></a></span>
<span id="cb73-18"><a href="cleaning-code-for-environment-data.html#cb73-18" tabindex="-1"></a><span class="co"># merge food and ssb</span></span>
<span id="cb73-19"><a href="cleaning-code-for-environment-data.html#cb73-19" tabindex="-1"></a>day1_sub1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(day1_sub, ssb_1, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seqn&quot;</span> <span class="ot">=</span> <span class="st">&quot;SEQN&quot;</span>,</span>
<span id="cb73-20"><a href="cleaning-code-for-environment-data.html#cb73-20" tabindex="-1"></a>                                               <span class="st">&quot;line&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1ILINE&quot;</span>,</span>
<span id="cb73-21"><a href="cleaning-code-for-environment-data.html#cb73-21" tabindex="-1"></a>                                               <span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1IFDCD&quot;</span>,</span>
<span id="cb73-22"><a href="cleaning-code-for-environment-data.html#cb73-22" tabindex="-1"></a>                                               <span class="st">&quot;description&quot;</span> <span class="ot">=</span> <span class="st">&quot;DESCRIPTION&quot;</span>,</span>
<span id="cb73-23"><a href="cleaning-code-for-environment-data.html#cb73-23" tabindex="-1"></a>                                               <span class="st">&quot;grams&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR1IGRMS&quot;</span>))</span></code></pre></div>
<p>Then import all of “day 2” datasets.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="cleaning-code-for-environment-data.html#cb74-1" tabindex="-1"></a><span class="co"># import</span></span>
<span id="cb74-2"><a href="cleaning-code-for-environment-data.html#cb74-2" tabindex="-1"></a>day2 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day2_clean.rds&quot;</span>)</span>
<span id="cb74-3"><a href="cleaning-code-for-environment-data.html#cb74-3" tabindex="-1"></a></span>
<span id="cb74-4"><a href="cleaning-code-for-environment-data.html#cb74-4" tabindex="-1"></a><span class="co"># only select needed variables</span></span>
<span id="cb74-5"><a href="cleaning-code-for-environment-data.html#cb74-5" tabindex="-1"></a>day2_sub <span class="ot">&lt;-</span> day2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(SEQN, DRDINT, DR2DRSTZ, DR2ILINE, DR2IFDCD, </span>
<span id="cb74-6"><a href="cleaning-code-for-environment-data.html#cb74-6" tabindex="-1"></a>                            DR2IGRMS, DESCRIPTION, foodsource, nhanes_cycle, dayrec, added_sugar) <span class="sc">%&gt;%</span> </span>
<span id="cb74-7"><a href="cleaning-code-for-environment-data.html#cb74-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">seqn =</span> SEQN,</span>
<span id="cb74-8"><a href="cleaning-code-for-environment-data.html#cb74-8" tabindex="-1"></a>         <span class="at">line =</span> DR2ILINE,</span>
<span id="cb74-9"><a href="cleaning-code-for-environment-data.html#cb74-9" tabindex="-1"></a>         <span class="at">foodcode =</span> DR2IFDCD,</span>
<span id="cb74-10"><a href="cleaning-code-for-environment-data.html#cb74-10" tabindex="-1"></a>         <span class="at">grams =</span> DR2IGRMS,</span>
<span id="cb74-11"><a href="cleaning-code-for-environment-data.html#cb74-11" tabindex="-1"></a>         <span class="at">description =</span> DESCRIPTION,</span>
<span id="cb74-12"><a href="cleaning-code-for-environment-data.html#cb74-12" tabindex="-1"></a>         <span class="at">daysintake =</span> DRDINT,</span>
<span id="cb74-13"><a href="cleaning-code-for-environment-data.html#cb74-13" tabindex="-1"></a>         <span class="at">reliable =</span> DR2DRSTZ)</span>
<span id="cb74-14"><a href="cleaning-code-for-environment-data.html#cb74-14" tabindex="-1"></a></span>
<span id="cb74-15"><a href="cleaning-code-for-environment-data.html#cb74-15" tabindex="-1"></a><span class="co"># ssb</span></span>
<span id="cb74-16"><a href="cleaning-code-for-environment-data.html#cb74-16" tabindex="-1"></a>ssb_2 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data_inputs/DIET/dietary_intake/DATA/clean_data/foods_day2_ssb.rds&quot;</span>)</span>
<span id="cb74-17"><a href="cleaning-code-for-environment-data.html#cb74-17" tabindex="-1"></a></span>
<span id="cb74-18"><a href="cleaning-code-for-environment-data.html#cb74-18" tabindex="-1"></a><span class="co"># merge food and ssb</span></span>
<span id="cb74-19"><a href="cleaning-code-for-environment-data.html#cb74-19" tabindex="-1"></a>day2_sub1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(day2_sub, ssb_2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seqn&quot;</span> <span class="ot">=</span> <span class="st">&quot;SEQN&quot;</span>,</span>
<span id="cb74-20"><a href="cleaning-code-for-environment-data.html#cb74-20" tabindex="-1"></a>                                               <span class="st">&quot;line&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2ILINE&quot;</span>,</span>
<span id="cb74-21"><a href="cleaning-code-for-environment-data.html#cb74-21" tabindex="-1"></a>                                               <span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2IFDCD&quot;</span>,</span>
<span id="cb74-22"><a href="cleaning-code-for-environment-data.html#cb74-22" tabindex="-1"></a>                                               <span class="st">&quot;description&quot;</span> <span class="ot">=</span> <span class="st">&quot;DESCRIPTION&quot;</span>,</span>
<span id="cb74-23"><a href="cleaning-code-for-environment-data.html#cb74-23" tabindex="-1"></a>                                               <span class="st">&quot;grams&quot;</span> <span class="ot">=</span> <span class="st">&quot;DR2IGRMS&quot;</span>))</span></code></pre></div>
<p>Then, combine the “day 1” and “day 2” datasets to get a “both_days” dataset.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="cleaning-code-for-environment-data.html#cb75-1" tabindex="-1"></a>both_days <span class="ot">&lt;-</span> <span class="fu">rbind</span>(day1_sub1, day2_sub1) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(seqn, dayrec, line)</span>
<span id="cb75-2"><a href="cleaning-code-for-environment-data.html#cb75-2" tabindex="-1"></a></span>
<span id="cb75-3"><a href="cleaning-code-for-environment-data.html#cb75-3" tabindex="-1"></a><span class="co"># check to make sure the formatting worked</span></span>
<span id="cb75-4"><a href="cleaning-code-for-environment-data.html#cb75-4" tabindex="-1"></a>both_days <span class="sc">%&gt;%</span> <span class="fu">filter</span>(description <span class="sc">==</span> <span class="st">&quot;Meat, NFS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co">#looks good!</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 12
##    seqn daysintake reliable  line foodcode grams description foodsource nhanes_cycle dayrec added_sugar   ssb
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 84032          1        1     9 20000000 11.0  Meat, NFS   Other      2015-2016         1           0     0
## 2 86178          2        1     5 20000000  4.19 Meat, NFS   Other      2015-2016         1           0     0
## 3 86487          2        1    10 20000000 73.3  Meat, NFS   Grocery    2015-2016         1           0     0
## 4 86801          2        1    13 20000000 11.2  Meat, NFS   Other      2015-2016         1           0     0
## 5 87065          2        1     3 20000000 50.2  Meat, NFS   Other      2015-2016         1           0     0
## 6 88767          2        1    12 20000000  7.33 Meat, NFS   Other      2015-2016         1           0     0</code></pre>
<p>Lastly, remove the original diet datasets becuase they are very large and we don’t need them anymore.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="cleaning-code-for-environment-data.html#cb77-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="mapping-from-dietary-factor-to-fndds-food-code" class="section level4 unnumbered hasAnchor">
<h4>Mapping from Dietary Factor to FNDDS Food Code<a href="cleaning-code-for-environment-data.html#mapping-from-dietary-factor-to-fndds-food-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This mapping is needed to handle some data processing in later code chunks.</p>
<p>First, create an empty dataset template that contains all of the foodcodes that exist in the diet dataset (both_days).</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="cleaning-code-for-environment-data.html#cb78-1" tabindex="-1"></a>all_foodcodes <span class="ot">&lt;-</span> both_days <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<p>Then, import the non-grain food mapping (labeled as “map_a”).</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="cleaning-code-for-environment-data.html#cb79-1" tabindex="-1"></a>map_a <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fndds_mapping/DATA/Food_to_FNDDS_mapping_detailed_04-06-25.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 109 Columns: 2
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Foodgroup
## dbl (1): foodcode_prefix
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Then, join the template and the first mapping.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="cleaning-code-for-environment-data.html#cb81-1" tabindex="-1"></a>my_join <span class="ot">&lt;-</span> <span class="fu">full_join</span>(<span class="fu">mutate</span>(all_foodcodes, <span class="at">i=</span><span class="dv">1</span>), </span>
<span id="cb81-2"><a href="cleaning-code-for-environment-data.html#cb81-2" tabindex="-1"></a>                     <span class="fu">mutate</span>(map_a, <span class="at">i=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-3"><a href="cleaning-code-for-environment-data.html#cb81-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>i) <span class="sc">%&gt;%</span> </span>
<span id="cb81-4"><a href="cleaning-code-for-environment-data.html#cb81-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(foodcode, <span class="fu">paste0</span>(<span class="st">&quot;^&quot;</span>, foodcode_prefix))) <span class="sc">%&gt;%</span> </span>
<span id="cb81-5"><a href="cleaning-code-for-environment-data.html#cb81-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>foodcode_prefix)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(i)`</code></pre>
<pre><code>## Warning in full_join(mutate(all_foodcodes, i = 1), mutate(map_a, i = 1)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 1 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<p>Import the grain-only mapping (labeled as “map_b”).</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="cleaning-code-for-environment-data.html#cb84-1" tabindex="-1"></a>map_b <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fndds_mapping/DATA/Food_to_FNDDS_mapping_WHOLE_GRAINS_ONLY_09-05-23.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 1728 Columns: 2
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (1): Foodgroup
## dbl (1): foodcode
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>Merge my_join with the second mapping.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="cleaning-code-for-environment-data.html#cb86-1" tabindex="-1"></a>my_join1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(my_join, map_b) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(foodcode)</span></code></pre></div>
<p>Lastly, merge back with both_days.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="cleaning-code-for-environment-data.html#cb87-1" tabindex="-1"></a>both_days1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days, my_join1, <span class="at">by =</span> <span class="st">&quot;foodcode&quot;</span>)</span></code></pre></div>
<p>Check how many FNDDS codes in the dataset don’t have a mapping to a dietary factor (i.e., food group category)</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="cleaning-code-for-environment-data.html#cb88-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="cleaning-code-for-environment-data.html#cb88-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="cleaning-code-for-environment-data.html#cb88-3" tabindex="-1"></a>  <span class="fu">select</span>(foodcode, description) <span class="sc">%&gt;%</span> </span>
<span id="cb88-4"><a href="cleaning-code-for-environment-data.html#cb88-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb88-5"><a href="cleaning-code-for-environment-data.html#cb88-5" tabindex="-1"></a>  <span class="fu">arrange</span>(foodcode)</span></code></pre></div>
<pre><code>## # A tibble: 0 × 2
## # ℹ 2 variables: foodcode &lt;dbl&gt;, description &lt;chr&gt;</code></pre>
<p>Check SSB by comparing the “ssb” indicator variable and the data when the foodgroup is set to “ssb”.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="cleaning-code-for-environment-data.html#cb90-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description  foodsource nhanes_cycle dayrec added_sugar   ssb Foodgroup
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
## 1 83732          2        1    14 92308000  372  Tea, iced, … Other      2015-2016         2        6.81     1 ssb      
## 2 83736          2        1     2 92410510  326. Soft drink,… Grocery    2015-2016         1        6.97     1 ssb      
## 3 83736          2        1     7 95320200  356. Sports drin… Grocery    2015-2016         1        4.46     1 other    
## 4 83736          2        1     5 95320200  372  Sports drin… Grocery    2015-2016         2        4.65     1 other    
## 5 83736          2        1     7 92410310  248  Soft drink,… Grocery    2015-2016         2        5.88     1 ssb      
## 6 83742          2        1    13 92510960  207. Lemonade, f… Other      2015-2016         1        3.22     1 ssb</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="cleaning-code-for-environment-data.html#cb92-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description  foodsource nhanes_cycle dayrec added_sugar   ssb Foodgroup
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
## 1 83732          2        1    14 92308000  372  Tea, iced, … Other      2015-2016         2        6.81     1 ssb      
## 2 83736          2        1     2 92410510  326. Soft drink,… Grocery    2015-2016         1        6.97     1 ssb      
## 3 83736          2        1     7 92410310  248  Soft drink,… Grocery    2015-2016         2        5.88     1 ssb      
## 4 83742          2        1    13 92510960  207. Lemonade, f… Other      2015-2016         1        3.22     1 ssb      
## 5 83742          2        1     9 92410310  150. Soft drink,… Other      2015-2016         2        3.54     1 ssb      
## 6 83744          2        1     8 92410510  512  Soft drink,… Other      2015-2016         1       11.0      1 ssb</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="cleaning-code-for-environment-data.html#cb94-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># need to change these to ssb</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description  foodsource nhanes_cycle dayrec added_sugar   ssb Foodgroup
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
## 1 83736          2        1     7 95320200  356. Sports drin… Grocery    2015-2016         1        4.46     1 other    
## 2 83736          2        1     5 95320200  372  Sports drin… Grocery    2015-2016         2        4.65     1 other    
## 3 83753          2        1     6 95320200  744  Sports drin… Other      2015-2016         2        9.3      1 other    
## 4 83768          2        1    12 64204010  580. Mango nectar Grocery    2015-2016         1        9.64     1 fruit_ju…
## 5 83780          2        1     9 64205010  116. Peach nectar Grocery    2015-2016         2        2.76     1 fruit_ju…
## 6 83795          2        1    10 95320200  310  Sports drin… Other      2015-2016         2        3.88     1 other</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="cleaning-code-for-environment-data.html#cb96-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># need to change these to other</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description  foodsource nhanes_cycle dayrec added_sugar   ssb Foodgroup
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
## 1 83732          2        1     1 92101000   720 Coffee, bre… Grocery    2015-2016         1           0     0 ssb      
## 2 83732          2        1     7 92410320   600 Soft drink,… Grocery    2015-2016         1           0     0 ssb      
## 3 83732          2        1     1 92101000   255 Coffee, bre… Grocery    2015-2016         2           0     0 ssb      
## 4 83732          2        1    15 92410520   480 Soft drink,… Other      2015-2016         2           0     0 ssb      
## 5 83733          2        1     1 92101000   480 Coffee, bre… Grocery    2015-2016         1           0     0 ssb      
## 6 83733          2        1     1 92101000   450 Coffee, bre… Grocery    2015-2016         2           0     0 ssb</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="cleaning-code-for-environment-data.html#cb98-1" tabindex="-1"></a>both_days1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode  grams description foodsource nhanes_cycle dayrec added_sugar   ssb Foodgroup
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
## 1 83732          2        1     2 91200040   4    Sugar subs… Grocery    2015-2016         1        0        0 added_su…
## 2 83732          2        1     3 12210400   3.92 Coffee cre… Grocery    2015-2016         1        0.07     0 dairy_tot
## 3 83732          2        1     4 94100100 240    Water, bot… Grocery    2015-2016         1        0        0 water    
## 4 83732          2        1     5 51101010  75    Bread, whi… Grocery    2015-2016         1        0.74     0 gr_refin…
## 5 83732          2        1     6 81103080  28.6  Margarine-… Grocery    2015-2016         1        0        0 sat_fat  
## 6 83732          2        1     8 27564060 204    Frankfurte… Grocery    2015-2016         1        1.63     0 pf_redm</code></pre>
<p>We see that, for some of the rows, ssb is labeled incorrectly, so we need to fix it.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="cleaning-code-for-environment-data.html#cb100-1" tabindex="-1"></a>both_days2 <span class="ot">&lt;-</span> both_days1 <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="cleaning-code-for-environment-data.html#cb100-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Foodgroup =</span> <span class="fu">ifelse</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>, <span class="st">&quot;ssb&quot;</span>, Foodgroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb100-3"><a href="cleaning-code-for-environment-data.html#cb100-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Foodgroup =</span> <span class="fu">ifelse</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>, <span class="st">&quot;other&quot;</span>, Foodgroup))</span></code></pre></div>
<p>Check again. Looks good.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="cleaning-code-for-environment-data.html#cb101-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode grams description  foodsource nhanes_cycle dayrec added_sugar   ssb Foodgroup
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
## 1 83732          2        1    14 92308000  372  Tea, iced, … Other      2015-2016         2        6.81     1 ssb      
## 2 83736          2        1     2 92410510  326. Soft drink,… Grocery    2015-2016         1        6.97     1 ssb      
## 3 83736          2        1     7 95320200  356. Sports drin… Grocery    2015-2016         1        4.46     1 ssb      
## 4 83736          2        1     5 95320200  372  Sports drin… Grocery    2015-2016         2        4.65     1 ssb      
## 5 83736          2        1     7 92410310  248  Soft drink,… Grocery    2015-2016         2        5.88     1 ssb      
## 6 83742          2        1    13 92510960  207. Lemonade, f… Other      2015-2016         1        3.22     1 ssb</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="cleaning-code-for-environment-data.html#cb103-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 13
## # ℹ 13 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;,
## #   Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="cleaning-code-for-environment-data.html#cb105-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 13
## # ℹ 13 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;,
## #   Foodgroup &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="cleaning-code-for-environment-data.html#cb107-1" tabindex="-1"></a>both_days2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Foodgroup <span class="sc">!=</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##    seqn daysintake reliable  line foodcode  grams description foodsource nhanes_cycle dayrec added_sugar   ssb Foodgroup
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    
## 1 83732          2        1     1 92101000 720    Coffee, br… Grocery    2015-2016         1        0        0 other    
## 2 83732          2        1     2 91200040   4    Sugar subs… Grocery    2015-2016         1        0        0 added_su…
## 3 83732          2        1     3 12210400   3.92 Coffee cre… Grocery    2015-2016         1        0.07     0 dairy_tot
## 4 83732          2        1     4 94100100 240    Water, bot… Grocery    2015-2016         1        0        0 water    
## 5 83732          2        1     5 51101010  75    Bread, whi… Grocery    2015-2016         1        0.74     0 gr_refin…
## 6 83732          2        1     6 81103080  28.6  Margarine-… Grocery    2015-2016         1        0        0 sat_fat</code></pre>
<p>Rename variable.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="cleaning-code-for-environment-data.html#cb109-1" tabindex="-1"></a>both_days3 <span class="ot">&lt;-</span> both_days2 <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="cleaning-code-for-environment-data.html#cb109-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Foodgroup_FNDDS =</span> Foodgroup)</span></code></pre></div>
<p>Tidy up the global environment and only keep the datasets we currently need.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="cleaning-code-for-environment-data.html#cb110-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days3&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
<p>This dataset containing the FNDDS foodcodes that represent seafood dishes will then be used in the following code chunk.</p>
</div>
<div id="mapping-from-fndds-food-code-to-fcid-code" class="section level4 unnumbered hasAnchor">
<h4>Mapping from FNDDS Food Code to FCID Code<a href="cleaning-code-for-environment-data.html#mapping-from-fndds-food-code-to-fcid-code" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Import the mapping and join with the both_days dataset.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="cleaning-code-for-environment-data.html#cb111-1" tabindex="-1"></a><span class="co"># import </span></span>
<span id="cb111-2"><a href="cleaning-code-for-environment-data.html#cb111-2" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/fndds_to_fcid_mapping/DATA/FCID_0118_LASTING.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 122027 Columns: 12
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): food_desc, fcid_desc, procform_desc, cookstatus_desc, cookmethod_desc
## dbl (7): foodcode, fcidcode, procform, cookstatus, cookmethod, impute, wt
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="cleaning-code-for-environment-data.html#cb113-1" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> map <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode, fcidcode, fcid_desc, wt)</span>
<span id="cb113-2"><a href="cleaning-code-for-environment-data.html#cb113-2" tabindex="-1"></a></span>
<span id="cb113-3"><a href="cleaning-code-for-environment-data.html#cb113-3" tabindex="-1"></a><span class="co"># combine with food data</span></span>
<span id="cb113-4"><a href="cleaning-code-for-environment-data.html#cb113-4" tabindex="-1"></a>both_days4 <span class="ot">&lt;-</span> <span class="fu">full_join</span>(both_days3, map1, <span class="at">by =</span> <span class="st">&quot;foodcode&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in full_join(both_days3, map1, by = &quot;foodcode&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 1 of `x` matches multiple rows in `y`.
## ℹ Row 76852 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="cleaning-code-for-environment-data.html#cb115-1" tabindex="-1"></a><span class="co"># if SEQN (subject ID) is missing, remove from dataset</span></span>
<span id="cb115-2"><a href="cleaning-code-for-environment-data.html#cb115-2" tabindex="-1"></a>both_days5 <span class="ot">&lt;-</span> both_days4 <span class="sc">%&gt;%</span> </span>
<span id="cb115-3"><a href="cleaning-code-for-environment-data.html#cb115-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(seqn))) <span class="sc">%&gt;%</span> </span>
<span id="cb115-4"><a href="cleaning-code-for-environment-data.html#cb115-4" tabindex="-1"></a>  <span class="fu">arrange</span>(seqn, dayrec, line) <span class="sc">%&gt;%</span> </span>
<span id="cb115-5"><a href="cleaning-code-for-environment-data.html#cb115-5" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">c</span>(foodsource, nhanes_cycle, dayrec), <span class="at">.after =</span> <span class="fu">last_col</span>())</span>
<span id="cb115-6"><a href="cleaning-code-for-environment-data.html#cb115-6" tabindex="-1"></a></span>
<span id="cb115-7"><a href="cleaning-code-for-environment-data.html#cb115-7" tabindex="-1"></a><span class="co"># look at ssb</span></span>
<span id="cb115-8"><a href="cleaning-code-for-environment-data.html#cb115-8" tabindex="-1"></a>both_days5 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 16
##    seqn daysintake reliable  line foodcode grams description added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc     wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
## 1 83732          2        1    14 92308000  372  Tea, iced,…        6.81     1 ssb               1.01e8 Beet, su…  2.21 
## 2 83732          2        1    14 92308000  372  Tea, iced,…        6.81     1 ssb               8.60e9 Water, i… 95.0  
## 3 83732          2        1    14 92308000  372  Tea, iced,…        6.81     1 ssb               9.50e9 Tea, dri…  0.266
## 4 83732          2        1    14 92308000  372  Tea, iced,…        6.81     1 ssb               9.50e9 Sugarcan…  2.81 
## 5 83736          2        1     2 92410510  326. Soft drink…        6.97     1 ssb               1.50e9 Corn, fi… 14.2  
## 6 83736          2        1     7 95320200  356. Sports dri…        4.46     1 ssb               9.50e9 Sugarcan…  1.68 
## # ℹ 3 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="cleaning-code-for-environment-data.html#cb117-1" tabindex="-1"></a>both_days5 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(fcid_desc) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## fcid_desc
##                       Almond                 Apple, juice               Apricot, juice                       Banana 
##                           90                         1759                         1767                         1767 
##                Barley, flour                  Beet, sugar                   Blackberry                    Blueberry 
##                           31                         6782                         1759                         1759 
##                  Boysenberry                   Cantaloupe                      Cassava                       Cherry 
##                         1759                           17                          341                            5 
##                Cherry, juice                     Cinnamon        Cocoa bean, chocolate           Cocoa bean, powder 
##                         1759                         1244                            9                           64 
##                Coconut, meat                Coconut, milk                 Coconut, oil              Coffee, instant 
##                           17                            3                         1305                          361 
##         Coffee, roasted bean           Corn, field, flour             Corn, field, oil          Corn, field, starch 
##                          360                           41                           82                          424 
##           Corn, field, syrup             Cranberry, juice                 Grape, juice            Grapefruit, juice 
##                        16067                         1936                         1759                         1760 
##                        Guava                        Lemon                 Lemon, juice                  Lime, juice 
##                           22                           70                         2971                         1759 
##                 Mango, juice                 Maple, sugar                    Milk, fat          Milk, nonfat solids 
##                         1897                           70                          538                          600 
##                  Milk, water      Oat, groats/rolled oats                       Orange                Orange, juice 
##                          538                           18                            5                         2086 
##                Papaya, juice          Passionfruit, juice                        Peach                 Peach, juice 
##                            7                         1760                         1759                           17 
##                  Pear, juice                   Peppermint             Pineapple, juice                Potato, flour 
##                         1777                         1235                         1771                          341 
##             Raspberry, juice                  Rice, flour                      Seaweed                 Sesame, seed 
##                         1759                          341                            5                           81 
##                      Soursop               Soybean, flour                 Soybean, oil            Soybean, soy milk 
##                            2                           61                           59                           19 
##                Spices, other            Strawberry, juice             Sugarcane, sugar                     Tamarind 
##                         1305                         1759                         7089                           16 
##             Tangerine, juice                   Tea, dried                 Tea, instant Water, indirect, all sources 
##                         1759                         2982                          279                         6183 
##                 Wheat, flour 
##                          341</code></pre>
</div>
<div id="food-loss-and-waste-data" class="section level4 unnumbered hasAnchor">
<h4>Food Loss and Waste Data<a href="cleaning-code-for-environment-data.html#food-loss-and-waste-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Import the food loss &amp; waste coefficients and join with the both_days dataset.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="cleaning-code-for-environment-data.html#cb119-1" tabindex="-1"></a><span class="co"># import losswaste data</span></span>
<span id="cb119-2"><a href="cleaning-code-for-environment-data.html#cb119-2" tabindex="-1"></a><span class="co"># losswaste &lt;- read_csv(&quot;data_inputs/OTHER/food_waste/DATA/losswaste.csv&quot;)</span></span>
<span id="cb119-3"><a href="cleaning-code-for-environment-data.html#cb119-3" tabindex="-1"></a></span>
<span id="cb119-4"><a href="cleaning-code-for-environment-data.html#cb119-4" tabindex="-1"></a><span class="co"># import the proxy data for missing loss/waste data</span></span>
<span id="cb119-5"><a href="cleaning-code-for-environment-data.html#cb119-5" tabindex="-1"></a>losswaste_complete <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/food_waste/DATA/missing_data/resolved/Missing waste coefficients (full)_090523.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-6"><a href="cleaning-code-for-environment-data.html#cb119-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(fcid_desc, Foodgroup, Proxy, Notes))</span></code></pre></div>
<pre><code>## Rows: 484 Columns: 8
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (4): fcid_desc, Foodgroup, Proxy, Notes
## dbl (4): fcidcode, waste_coef, ined_coef, retloss_coef
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="cleaning-code-for-environment-data.html#cb121-1" tabindex="-1"></a><span class="co"># merge with bothdays</span></span>
<span id="cb121-2"><a href="cleaning-code-for-environment-data.html#cb121-2" tabindex="-1"></a>both_days6 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days5, losswaste_complete, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span></code></pre></div>
</div>
<div id="mapping-from-fcid-food-code-to-dietary-factor" class="section level4 unnumbered hasAnchor">
<h4>Mapping From FCID Food Code to Dietary Factor<a href="cleaning-code-for-environment-data.html#mapping-from-fcid-food-code-to-dietary-factor" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we import the original mapping.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="cleaning-code-for-environment-data.html#cb122-1" tabindex="-1"></a><span class="co"># import fcid-diet factor mapping</span></span>
<span id="cb122-2"><a href="cleaning-code-for-environment-data.html#cb122-2" tabindex="-1"></a>new_map <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fcid_mapping/DATA/FCID_to_dietaryfactor_mapping_01-09-2024_final.xlsx&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-3"><a href="cleaning-code-for-environment-data.html#cb122-3" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code, Foodgroup) <span class="sc">%&gt;%</span> </span>
<span id="cb122-4"><a href="cleaning-code-for-environment-data.html#cb122-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fcidcode =</span> FCID_Code,</span>
<span id="cb122-5"><a href="cleaning-code-for-environment-data.html#cb122-5" tabindex="-1"></a>         <span class="at">Foodgroup_FCID =</span> Foodgroup)</span>
<span id="cb122-6"><a href="cleaning-code-for-environment-data.html#cb122-6" tabindex="-1"></a></span>
<span id="cb122-7"><a href="cleaning-code-for-environment-data.html#cb122-7" tabindex="-1"></a><span class="co"># merge</span></span>
<span id="cb122-8"><a href="cleaning-code-for-environment-data.html#cb122-8" tabindex="-1"></a>both_days7 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days6, new_map, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span>
<span id="cb122-9"><a href="cleaning-code-for-environment-data.html#cb122-9" tabindex="-1"></a></span>
<span id="cb122-10"><a href="cleaning-code-for-environment-data.html#cb122-10" tabindex="-1"></a><span class="co"># which FNDDS foodcodes have missing FCID food group?</span></span>
<span id="cb122-11"><a href="cleaning-code-for-environment-data.html#cb122-11" tabindex="-1"></a>both_days7 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup_FCID)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar subst…           0     0 added_sugar           NA &lt;NA&gt;         NA
## 2 83732          2        1     7 92410320   600 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 3 83732          2        1     2 91200040     2 Sugar subst…           0     0 added_sugar           NA &lt;NA&gt;         NA
## 4 83732          2        1    15 92410520   480 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 5 83735          1        1     4 92410370   180 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 6 83735          1        1    11 92410370   360 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## # ℹ 7 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="cleaning-code-for-environment-data.html#cb124-1" tabindex="-1"></a>both_days7 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup_FCID)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode, description) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 57 × 2
##    foodcode description                                    
##       &lt;dbl&gt; &lt;chr&gt;                                          
##  1 91200040 Sugar substitute, saccharin, powder            
##  2 92410320 Soft drink, cola, diet                         
##  3 92410520 Soft drink, fruit flavored, diet, caffeine free
##  4 92410370 Soft drink, pepper type, diet                  
##  5 92410350 Soft drink, cola, decaffeinated, diet          
##  6 91201010 Sugar substitute, aspartame, powder            
##  7 91107000 Sugar substitute, sucralose, powder            
##  8 92410210 Carbonated water, unsweetened                  
##  9 93301217 Vodka and water                                
## 10 93301218 Vodka and tonic                                
## # ℹ 47 more rows</code></pre>
<p>But, we can see that there’s some missing so our team went and manually updated the mapping, which is imported in the following code chunk.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="cleaning-code-for-environment-data.html#cb126-1" tabindex="-1"></a><span class="co"># import updated mapping</span></span>
<span id="cb126-2"><a href="cleaning-code-for-environment-data.html#cb126-2" tabindex="-1"></a>fcids_new <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fcid_mapping/DATA/missing_data/resolved/Missing FCIDS_mapped.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb126-3"><a href="cleaning-code-for-environment-data.html#cb126-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>description) <span class="sc">%&gt;%</span> </span>
<span id="cb126-4"><a href="cleaning-code-for-environment-data.html#cb126-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Foodgroup_FCID =</span> Foodgroup)</span></code></pre></div>
<pre><code>## Rows: 55 Columns: 3
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): description, Foodgroup
## dbl (1): foodcode
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="cleaning-code-for-environment-data.html#cb128-1" tabindex="-1"></a><span class="co"># row patch new mapping with both days</span></span>
<span id="cb128-2"><a href="cleaning-code-for-environment-data.html#cb128-2" tabindex="-1"></a>both_days8 <span class="ot">&lt;-</span> <span class="fu">rows_patch</span>(both_days7, fcids_new, <span class="at">unmatched =</span> <span class="st">&quot;ignore&quot;</span>)</span></code></pre></div>
<pre><code>## Matching, by = &quot;foodcode&quot;</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="cleaning-code-for-environment-data.html#cb130-1" tabindex="-1"></a><span class="co"># which ones have missing fcid?</span></span>
<span id="cb130-2"><a href="cleaning-code-for-environment-data.html#cb130-2" tabindex="-1"></a>both_days8 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar subst…           0     0 added_sugar           NA &lt;NA&gt;         NA
## 2 83732          2        1     7 92410320   600 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 3 83732          2        1     2 91200040     2 Sugar subst…           0     0 added_sugar           NA &lt;NA&gt;         NA
## 4 83732          2        1    15 92410520   480 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 5 83735          1        1     4 92410370   180 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 6 83735          1        1    11 92410370   360 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## # ℹ 7 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="cleaning-code-for-environment-data.html#cb132-1" tabindex="-1"></a>both_days8 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(foodcode, description, fcidcode) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   foodcode description                                     fcidcode
##      &lt;dbl&gt; &lt;chr&gt;                                              &lt;dbl&gt;
## 1 91200040 Sugar substitute, saccharin, powder                   NA
## 2 92410320 Soft drink, cola, diet                                NA
## 3 92410520 Soft drink, fruit flavored, diet, caffeine free       NA
## 4 92410370 Soft drink, pepper type, diet                         NA
## 5 92410350 Soft drink, cola, decaffeinated, diet                 NA
## 6 91201010 Sugar substitute, aspartame, powder                   NA</code></pre>
<p>There are now fewer missing coefficients, but still some. In some of these cases, the FNDDS foodcode can represent the FCID code (i.e., single ingredient foods). Below, I manually add these waste coefficents for dasheen and corn.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="cleaning-code-for-environment-data.html#cb134-1" tabindex="-1"></a><span class="co"># dasheen</span></span>
<span id="cb134-2"><a href="cleaning-code-for-environment-data.html#cb134-2" tabindex="-1"></a>dash <span class="ot">&lt;-</span> losswaste_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fcidcode <span class="sc">==</span> <span class="st">&quot;103139000&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-3"><a href="cleaning-code-for-environment-data.html#cb134-3" tabindex="-1"></a>  <span class="co">#change the fcidcode</span></span>
<span id="cb134-4"><a href="cleaning-code-for-environment-data.html#cb134-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodcode =</span> <span class="dv">71962020</span>,</span>
<span id="cb134-5"><a href="cleaning-code-for-environment-data.html#cb134-5" tabindex="-1"></a>         <span class="at">wt =</span> <span class="dv">100</span>)</span>
<span id="cb134-6"><a href="cleaning-code-for-environment-data.html#cb134-6" tabindex="-1"></a></span>
<span id="cb134-7"><a href="cleaning-code-for-environment-data.html#cb134-7" tabindex="-1"></a><span class="co"># corn</span></span>
<span id="cb134-8"><a href="cleaning-code-for-environment-data.html#cb134-8" tabindex="-1"></a>corn <span class="ot">&lt;-</span> losswaste_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fcidcode <span class="sc">==</span> <span class="st">&quot;1500127000&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-9"><a href="cleaning-code-for-environment-data.html#cb134-9" tabindex="-1"></a>  <span class="co">#change the fcidcode</span></span>
<span id="cb134-10"><a href="cleaning-code-for-environment-data.html#cb134-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodcode =</span> <span class="dv">75215990</span>, </span>
<span id="cb134-11"><a href="cleaning-code-for-environment-data.html#cb134-11" tabindex="-1"></a>         <span class="at">wt =</span> <span class="dv">100</span>)</span>
<span id="cb134-12"><a href="cleaning-code-for-environment-data.html#cb134-12" tabindex="-1"></a></span>
<span id="cb134-13"><a href="cleaning-code-for-environment-data.html#cb134-13" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb134-14"><a href="cleaning-code-for-environment-data.html#cb134-14" tabindex="-1"></a>comb <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dash, corn) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>fcidcode)</span>
<span id="cb134-15"><a href="cleaning-code-for-environment-data.html#cb134-15" tabindex="-1"></a></span>
<span id="cb134-16"><a href="cleaning-code-for-environment-data.html#cb134-16" tabindex="-1"></a><span class="co"># row patch with bothdays</span></span>
<span id="cb134-17"><a href="cleaning-code-for-environment-data.html#cb134-17" tabindex="-1"></a>both_days9 <span class="ot">&lt;-</span> <span class="fu">rows_patch</span>(both_days8, comb, <span class="at">by =</span> <span class="st">&quot;foodcode&quot;</span>)</span>
<span id="cb134-18"><a href="cleaning-code-for-environment-data.html#cb134-18" tabindex="-1"></a></span>
<span id="cb134-19"><a href="cleaning-code-for-environment-data.html#cb134-19" tabindex="-1"></a><span class="co"># check missing fcid</span></span>
<span id="cb134-20"><a href="cleaning-code-for-environment-data.html#cb134-20" tabindex="-1"></a>both_days9 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar subst…           0     0 added_sugar           NA &lt;NA&gt;         NA
## 2 83732          2        1     7 92410320   600 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 3 83732          2        1     2 91200040     2 Sugar subst…           0     0 added_sugar           NA &lt;NA&gt;         NA
## 4 83732          2        1    15 92410520   480 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 5 83735          1        1     4 92410370   180 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## 6 83735          1        1    11 92410370   360 Soft drink,…           0     0 other                 NA &lt;NA&gt;         NA
## # ℹ 7 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="cleaning-code-for-environment-data.html#cb136-1" tabindex="-1"></a><span class="co"># check missing waste coef</span></span>
<span id="cb136-2"><a href="cleaning-code-for-environment-data.html#cb136-2" tabindex="-1"></a>both_days9 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(waste_coef)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 20
##    seqn daysintake reliable  line foodcode grams description added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc     wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
## 1 83732          2        1     1 92101000   720 Coffee, br…           0     0 other             9.50e9 Coffee, …   2.19
## 2 83732          2        1     1 92101000   720 Coffee, br…           0     0 other             8.60e9 Water, i… 100   
## 3 83732          2        1     2 91200040     4 Sugar subs…           0     0 added_sugar      NA      &lt;NA&gt;       NA   
## 4 83732          2        1     4 94100100   240 Water, bot…           0     0 water             8.60e9 Water, d… 100   
## 5 83732          2        1     7 92410320   600 Soft drink…           0     0 other            NA      &lt;NA&gt;       NA   
## 6 83732          2        1    11 94100100   240 Water, bot…           0     0 water             8.60e9 Water, d… 100   
## # ℹ 7 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<p>There’s still a few FCID codes that don’t have waste and inedible coefficients, but it’s not very many, so we will leave for now.</p>
<p>Calculate the FCID-level consumed, inedible, and wasted amounts of food.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="cleaning-code-for-environment-data.html#cb138-1" tabindex="-1"></a>both_days10 <span class="ot">&lt;-</span> both_days9 <span class="sc">%&gt;%</span> </span>
<span id="cb138-2"><a href="cleaning-code-for-environment-data.html#cb138-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">consumed_amt_FCID =</span> grams <span class="sc">*</span> (wt <span class="sc">/</span> <span class="dv">100</span>),</span>
<span id="cb138-3"><a href="cleaning-code-for-environment-data.html#cb138-3" tabindex="-1"></a>         <span class="at">inedible_amt_FCID =</span> consumed_amt_FCID <span class="sc">*</span> ined_coef,</span>
<span id="cb138-4"><a href="cleaning-code-for-environment-data.html#cb138-4" tabindex="-1"></a>         <span class="at">wasted_amt_FCID =</span> consumed_amt_FCID <span class="sc">*</span> waste_coef)</span></code></pre></div>
<p>Calculate the FNDDS-level consumed, inedible, and wasted amounts of food. This isn’t needed for the environmental impact factors, but it is needed for the cost impact factors in the next section.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="cleaning-code-for-environment-data.html#cb139-1" tabindex="-1"></a>both_days11 <span class="ot">&lt;-</span></span>
<span id="cb139-2"><a href="cleaning-code-for-environment-data.html#cb139-2" tabindex="-1"></a>  both_days10 <span class="sc">%&gt;%</span> </span>
<span id="cb139-3"><a href="cleaning-code-for-environment-data.html#cb139-3" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, dayrec, line, foodcode) <span class="sc">%&gt;%</span> </span>
<span id="cb139-4"><a href="cleaning-code-for-environment-data.html#cb139-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">consumed_amt_FNDDS =</span> grams,</span>
<span id="cb139-5"><a href="cleaning-code-for-environment-data.html#cb139-5" tabindex="-1"></a>         <span class="at">inedible_amt_FNDDS =</span> <span class="fu">sum</span>(inedible_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb139-6"><a href="cleaning-code-for-environment-data.html#cb139-6" tabindex="-1"></a>         <span class="at">wasted_amt_FNDDS =</span> <span class="fu">sum</span>(wasted_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-7"><a href="cleaning-code-for-environment-data.html#cb139-7" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb139-8"><a href="cleaning-code-for-environment-data.html#cb139-8" tabindex="-1"></a></span>
<span id="cb139-9"><a href="cleaning-code-for-environment-data.html#cb139-9" tabindex="-1"></a><span class="co"># get distinct dataset</span></span>
<span id="cb139-10"><a href="cleaning-code-for-environment-data.html#cb139-10" tabindex="-1"></a>fndds_flw <span class="ot">&lt;-</span> both_days11 <span class="sc">%&gt;%</span> </span>
<span id="cb139-11"><a href="cleaning-code-for-environment-data.html#cb139-11" tabindex="-1"></a>  <span class="fu">select</span>(seqn, dayrec, line, foodcode, description, consumed_amt_FNDDS, </span>
<span id="cb139-12"><a href="cleaning-code-for-environment-data.html#cb139-12" tabindex="-1"></a>         inedible_amt_FNDDS, wasted_amt_FNDDS) <span class="sc">%&gt;%</span> </span>
<span id="cb139-13"><a href="cleaning-code-for-environment-data.html#cb139-13" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb139-14"><a href="cleaning-code-for-environment-data.html#cb139-14" tabindex="-1"></a>  <span class="fu">arrange</span>(seqn, dayrec, line)</span>
<span id="cb139-15"><a href="cleaning-code-for-environment-data.html#cb139-15" tabindex="-1"></a></span>
<span id="cb139-16"><a href="cleaning-code-for-environment-data.html#cb139-16" tabindex="-1"></a><span class="co"># export to use in next section</span></span>
<span id="cb139-17"><a href="cleaning-code-for-environment-data.html#cb139-17" tabindex="-1"></a><span class="fu">saveRDS</span>(fndds_flw, <span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/fndds_flw.rds&quot;</span>)</span></code></pre></div>
<p>Tidy up the global environment.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="cleaning-code-for-environment-data.html#cb140-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days11&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="fcid-level-environmental-impact-factors-datafield" class="section level4 unnumbered hasAnchor">
<h4>FCID-Level Environmental Impact Factors (dataField)<a href="cleaning-code-for-environment-data.html#fcid-level-environmental-impact-factors-datafield" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are two environmental datasets that need to be imported. The first dataset contains greenhouse gas (GHG) and cumulative energy demand (CED) impact factors. The second contains water scarcity (WATER) and bluewater use (BLUEWATER) impact factors.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="cleaning-code-for-environment-data.html#cb141-1" tabindex="-1"></a><span class="co"># import datafield (non-water)</span></span>
<span id="cb141-2"><a href="cleaning-code-for-environment-data.html#cb141-2" tabindex="-1"></a>datafield <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/ENVIRONMENT/ghg_ced_impacts/DATA/dataFIELDv1.0_LASTING_120723.xlsx&quot;</span>,</span>
<span id="cb141-3"><a href="cleaning-code-for-environment-data.html#cb141-3" tabindex="-1"></a>                <span class="at">sheet =</span> <span class="st">&quot;FCID linkages&quot;</span>,</span>
<span id="cb141-4"><a href="cleaning-code-for-environment-data.html#cb141-4" tabindex="-1"></a>                <span class="at">skip =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...11`
## • `` -&gt; `...12`
## • `# of datapoints` -&gt; `# of datapoints...13`
## • `N-average` -&gt; `N-average...14`
## • `Std. Dev` -&gt; `Std. Dev...15`
## • `` -&gt; `...16`
## • `# of datapoints` -&gt; `# of datapoints...17`
## • `N-average` -&gt; `N-average...18`
## • `Std. Dev` -&gt; `Std. Dev...19`
## • `` -&gt; `...20`
## • `` -&gt; `...21`
## • `` -&gt; `...22`
## • `basis` -&gt; `basis...23`
## • `n` -&gt; `n...24`
## • `proxy group mean` -&gt; `proxy group mean...25`
## • `SD (group or indiv food)` -&gt; `SD (group or indiv food)...26`
## • `scaled SD (group SD*food mean/group mean)` -&gt; `scaled SD (group SD*food mean/group mean)...27`
## • `basis` -&gt; `basis...28`
## • `n` -&gt; `n...29`
## • `proxy group mean` -&gt; `proxy group mean...30`
## • `SD (group or indiv food)` -&gt; `SD (group or indiv food)...31`
## • `scaled SD (group SD*food mean/group mean)` -&gt; `scaled SD (group SD*food mean/group mean)...32`</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="cleaning-code-for-environment-data.html#cb143-1" tabindex="-1"></a>datafield_sub <span class="ot">&lt;-</span> datafield <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="cleaning-code-for-environment-data.html#cb143-2" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code, <span class="st">`</span><span class="at">MJ / kg</span><span class="st">`</span>, <span class="st">`</span><span class="at">CO2 eq / kg</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="cleaning-code-for-environment-data.html#cb143-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">GHG_mn =</span> <span class="st">`</span><span class="at">CO2 eq / kg</span><span class="st">`</span>,</span>
<span id="cb143-4"><a href="cleaning-code-for-environment-data.html#cb143-4" tabindex="-1"></a>         <span class="at">CED_mn =</span> <span class="st">`</span><span class="at">MJ / kg</span><span class="st">`</span>,</span>
<span id="cb143-5"><a href="cleaning-code-for-environment-data.html#cb143-5" tabindex="-1"></a>         <span class="at">fcidcode =</span> FCID_Code) <span class="sc">%&gt;%</span> </span>
<span id="cb143-6"><a href="cleaning-code-for-environment-data.html#cb143-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode))</span>
<span id="cb143-7"><a href="cleaning-code-for-environment-data.html#cb143-7" tabindex="-1"></a></span>
<span id="cb143-8"><a href="cleaning-code-for-environment-data.html#cb143-8" tabindex="-1"></a><span class="co"># import datafield (water impacts)</span></span>
<span id="cb143-9"><a href="cleaning-code-for-environment-data.html#cb143-9" tabindex="-1"></a>datafield_water <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/ENVIRONMENT/water_impacts/DATA/dataFIELD_water public v1_LASTING_120723.xlsx&quot;</span>,</span>
<span id="cb143-10"><a href="cleaning-code-for-environment-data.html#cb143-10" tabindex="-1"></a>                             <span class="at">sheet =</span> <span class="st">&quot;FCID Codes&quot;</span>,</span>
<span id="cb143-11"><a href="cleaning-code-for-environment-data.html#cb143-11" tabindex="-1"></a>                             <span class="at">skip =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...10`</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="cleaning-code-for-environment-data.html#cb145-1" tabindex="-1"></a>datafield_water_sub <span class="ot">&lt;-</span> datafield_water <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="cleaning-code-for-environment-data.html#cb145-2" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code, <span class="st">`</span><span class="at">liter eq. / kg</span><span class="st">`</span>, <span class="st">`</span><span class="at">L /kg</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb145-3"><a href="cleaning-code-for-environment-data.html#cb145-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">WATER_mn =</span> <span class="st">`</span><span class="at">liter eq. / kg</span><span class="st">`</span>,</span>
<span id="cb145-4"><a href="cleaning-code-for-environment-data.html#cb145-4" tabindex="-1"></a>         <span class="at">BLUEWATER_mn =</span> <span class="st">`</span><span class="at">L /kg</span><span class="st">`</span>,</span>
<span id="cb145-5"><a href="cleaning-code-for-environment-data.html#cb145-5" tabindex="-1"></a>         <span class="at">fcidcode =</span> FCID_Code) <span class="sc">%&gt;%</span> </span>
<span id="cb145-6"><a href="cleaning-code-for-environment-data.html#cb145-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode))</span>
<span id="cb145-7"><a href="cleaning-code-for-environment-data.html#cb145-7" tabindex="-1"></a></span>
<span id="cb145-8"><a href="cleaning-code-for-environment-data.html#cb145-8" tabindex="-1"></a><span class="co"># merge the two datafield datasets together</span></span>
<span id="cb145-9"><a href="cleaning-code-for-environment-data.html#cb145-9" tabindex="-1"></a>datafield_comb <span class="ot">&lt;-</span> <span class="fu">left_join</span>(datafield_sub, datafield_water_sub, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span>
<span id="cb145-10"><a href="cleaning-code-for-environment-data.html#cb145-10" tabindex="-1"></a></span>
<span id="cb145-11"><a href="cleaning-code-for-environment-data.html#cb145-11" tabindex="-1"></a><span class="co"># now merge with bothdays</span></span>
<span id="cb145-12"><a href="cleaning-code-for-environment-data.html#cb145-12" tabindex="-1"></a>both_days12 <span class="ot">&lt;-</span> both_days11 <span class="sc">%&gt;%</span> </span>
<span id="cb145-13"><a href="cleaning-code-for-environment-data.html#cb145-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode)) <span class="sc">%&gt;%</span> </span>
<span id="cb145-14"><a href="cleaning-code-for-environment-data.html#cb145-14" tabindex="-1"></a>  <span class="fu">left_join</span>(datafield_comb, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span></code></pre></div>
<p>Below, we check the dataset for missing impact factors.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="cleaning-code-for-environment-data.html#cb146-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar subst…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;         NA
## 2 83732          2        1     7 92410320   600 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 3 83732          2        1     2 91200040     2 Sugar subst…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;         NA
## 4 83732          2        1    15 92410520   480 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 5 83735          1        1     4 92410370   180 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 6 83735          1        1    11 92410370   360 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## # ℹ 17 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="cleaning-code-for-environment-data.html#cb148-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn) <span class="sc">&amp;</span> ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 0 × 30
## # ℹ 30 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;, Foodgroup_FNDDS &lt;chr&gt;, fcidcode &lt;chr&gt;, fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;,
## #   foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;,
## #   Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="cleaning-code-for-environment-data.html#cb150-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn) <span class="sc">&amp;</span> Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 0 × 30
## # ℹ 30 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;, Foodgroup_FNDDS &lt;chr&gt;, fcidcode &lt;chr&gt;, fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;,
## #   foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;,
## #   Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="cleaning-code-for-environment-data.html#cb152-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn) <span class="sc">&amp;</span> Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="cleaning-code-for-environment-data.html#cb152-2" tabindex="-1"></a>  <span class="fu">select</span>(description, Foodgroup_FNDDS) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># these are all diet drinks and not ssb</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 2
## # ℹ 2 variables: description &lt;chr&gt;, Foodgroup_FNDDS &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="cleaning-code-for-environment-data.html#cb154-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FNDDS) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## Foodgroup_FNDDS
##     added_sugar        babyfood       dairy_tot fruit_exc_juice     fruit_juice      gr_refined        gr_whole 
##            2125            4322           30348               4             557            4024            1134 
##           other      pf_poultry         pf_redm      pf_seafood          veg_dg         veg_oth         veg_sta 
##            3438             145              27               3               5             102               9 
##           water 
##              41</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="cleaning-code-for-environment-data.html#cb156-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## Foodgroup_FCID
##        babyfood fruit_exc_juice        gr_whole           other      pf_seafood          veg_dg         veg_oth 
##           40550               4               7            5046               3               5              92 
##         veg_sta           water 
##               9             568</code></pre>
<p>Our team manually assigned proxies for some of these FCID codes with missing environmental impact factors.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="cleaning-code-for-environment-data.html#cb158-1" tabindex="-1"></a><span class="co"># import proxies for missing enviro data</span></span>
<span id="cb158-2"><a href="cleaning-code-for-environment-data.html#cb158-2" tabindex="-1"></a>ghg_proxies <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/ENVIRONMENT/ghg_ced_impacts/DATA/missing_data/resolved/Missing environmental impacts_mapped.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 6 Columns: 7
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (4): description, fcid_desc, proxy_desc, proxy_notes
## dbl (3): foodcode, fcidcode, proxy_fcidcode
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="cleaning-code-for-environment-data.html#cb160-1" tabindex="-1"></a>ghg_proxies_sub <span class="ot">&lt;-</span> ghg_proxies <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href="cleaning-code-for-environment-data.html#cb160-2" tabindex="-1"></a>  <span class="fu">select</span>(foodcode, description, proxy_fcidcode, proxy_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb160-3"><a href="cleaning-code-for-environment-data.html#cb160-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fcidcode =</span> proxy_fcidcode,</span>
<span id="cb160-4"><a href="cleaning-code-for-environment-data.html#cb160-4" tabindex="-1"></a>         <span class="at">fcid_desc =</span> proxy_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb160-5"><a href="cleaning-code-for-environment-data.html#cb160-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode))</span>
<span id="cb160-6"><a href="cleaning-code-for-environment-data.html#cb160-6" tabindex="-1"></a></span>
<span id="cb160-7"><a href="cleaning-code-for-environment-data.html#cb160-7" tabindex="-1"></a><span class="co"># update rows with proxies</span></span>
<span id="cb160-8"><a href="cleaning-code-for-environment-data.html#cb160-8" tabindex="-1"></a>both_days13 <span class="ot">&lt;-</span> <span class="fu">rows_update</span>(both_days12, ghg_proxies_sub, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;foodcode&quot;</span>, <span class="st">&quot;description&quot;</span>))</span>
<span id="cb160-9"><a href="cleaning-code-for-environment-data.html#cb160-9" tabindex="-1"></a></span>
<span id="cb160-10"><a href="cleaning-code-for-environment-data.html#cb160-10" tabindex="-1"></a><span class="co"># check corn</span></span>
<span id="cb160-11"><a href="cleaning-code-for-environment-data.html#cb160-11" tabindex="-1"></a>both_days13 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(foodcode <span class="sc">==</span> <span class="dv">75215990</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># good</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 93779          2        1     6 75215990 170   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 2 93806          2        1    12 75215990 108   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 3 93881          2        1     7 75215990 108   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 4 93973          1        1     6 75215990  49.6 Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 5 93985          2        1    10 75215990 170   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 6 94011          2        1    12 75215990  36   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## # ℹ 17 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="cleaning-code-for-environment-data.html#cb162-1" tabindex="-1"></a><span class="co"># fcid should be herb</span></span>
<span id="cb162-2"><a href="cleaning-code-for-environment-data.html#cb162-2" tabindex="-1"></a>both_days13 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(foodcode <span class="sc">==</span> <span class="dv">72133200</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># good!</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 87109          1        1     2 72133200    84 Sweet potat…           0     0 veg_dg          1901184… Herbs, o…  21.3
## 2 87109          1        1     2 72133200    84 Sweet potat…           0     0 veg_dg          1901184… Herbs, o…  30.0
## 3 87109          1        1     2 72133200    84 Sweet potat…           0     0 veg_dg          1901184… Herbs, o…  29.4
## 4 87109          1        1     2 72133200    84 Sweet potat…           0     0 veg_dg          1901184… Herbs, o…  19.2
## 5 87109          1        1     8 72133200    84 Sweet potat…           0     0 veg_dg          1901184… Herbs, o…  21.3
## 6 87109          1        1     8 72133200    84 Sweet potat…           0     0 veg_dg          1901184… Herbs, o…  30.0
## # ℹ 17 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="cleaning-code-for-environment-data.html#cb164-1" tabindex="-1"></a><span class="co"># insert enviro data for fcids that were originally missing</span></span>
<span id="cb164-2"><a href="cleaning-code-for-environment-data.html#cb164-2" tabindex="-1"></a>both_days14 <span class="ot">&lt;-</span> both_days13 <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="cleaning-code-for-environment-data.html#cb164-3" tabindex="-1"></a>  <span class="fu">rows_patch</span>(datafield_comb, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>, <span class="at">unmatched =</span> <span class="st">&quot;ignore&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb164-4"><a href="cleaning-code-for-environment-data.html#cb164-4" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb164-5"><a href="cleaning-code-for-environment-data.html#cb164-5" tabindex="-1"></a></span>
<span id="cb164-6"><a href="cleaning-code-for-environment-data.html#cb164-6" tabindex="-1"></a><span class="co"># check corn</span></span>
<span id="cb164-7"><a href="cleaning-code-for-environment-data.html#cb164-7" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(foodcode <span class="sc">==</span> <span class="dv">75215990</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 93779          2        1     6 75215990 170   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 2 93806          2        1    12 75215990 108   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 3 93881          2        1     7 75215990 108   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 4 93973          1        1     6 75215990  49.6 Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 5 93985          2        1    10 75215990 170   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## 6 94011          2        1    12 75215990  36   Corn, cooke…           0     0 veg_oth         1500127… Corn, sw…   100
## # ℹ 17 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="cleaning-code-for-environment-data.html#cb166-1" tabindex="-1"></a><span class="co"># confirm there are no more missing FCIDs</span></span>
<span id="cb166-2"><a href="cleaning-code-for-environment-data.html#cb166-2" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co"># good</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar subst…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;         NA
## 2 83732          2        1     7 92410320   600 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 3 83732          2        1     2 91200040     2 Sugar subst…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;         NA
## 4 83732          2        1    15 92410520   480 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 5 83735          1        1     4 92410370   180 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 6 83735          1        1    11 92410370   360 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## # ℹ 17 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="cleaning-code-for-environment-data.html#cb168-1" tabindex="-1"></a><span class="co"># confirm there are no more missing GHG</span></span>
<span id="cb168-2"><a href="cleaning-code-for-environment-data.html#cb168-2" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() </span></code></pre></div>
<pre><code>## # A tibble: 6 × 30
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 83732          2        1     2 91200040     4 Sugar subst…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;         NA
## 2 83732          2        1     7 92410320   600 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 3 83732          2        1     2 91200040     2 Sugar subst…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;         NA
## 4 83732          2        1    15 92410520   480 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 5 83735          1        1     4 92410370   180 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## 6 83735          1        1    11 92410370   360 Soft drink,…           0     0 other           &lt;NA&gt;     &lt;NA&gt;         NA
## # ℹ 17 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="cleaning-code-for-environment-data.html#cb170-1" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(description, Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   description                                     Foodgroup_FCID
##   &lt;chr&gt;                                           &lt;chr&gt;         
## 1 Sugar substitute, saccharin, powder             other         
## 2 Soft drink, cola, diet                          other         
## 3 Soft drink, fruit flavored, diet, caffeine free other         
## 4 Soft drink, pepper type, diet                   other         
## 5 Soft drink, cola, decaffeinated, diet           other         
## 6 Milk, human                                     babyfood</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="cleaning-code-for-environment-data.html#cb172-1" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   Foodgroup_FCID
##   &lt;chr&gt;         
## 1 other         
## 2 babyfood      
## 3 water         
## 4 gr_whole      
## 5 pf_seafood</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="cleaning-code-for-environment-data.html#cb174-1" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(WATER_mn)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   Foodgroup_FCID
##   &lt;chr&gt;         
## 1 other         
## 2 babyfood      
## 3 water         
## 4 gr_whole      
## 5 pf_seafood</code></pre>
<p>At this point, most of the missing is for babyfood and other foods, so we will move on.</p>
<p>Tidy up the global environment.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="cleaning-code-for-environment-data.html#cb176-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="fu">c</span>(<span class="st">&quot;both_days14&quot;</span>, <span class="st">&quot;my_date&quot;</span>)))</span></code></pre></div>
</div>
<div id="fcid-level-social-impact-factors-i.e.-forced-labor-risk" class="section level4 unnumbered hasAnchor">
<h4>FCID-Level Social Impact Factors (i.e., Forced Labor Risk)<a href="cleaning-code-for-environment-data.html#fcid-level-social-impact-factors-i.e.-forced-labor-risk" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Import the forced labor (FL) risk scores (excluding seafood for now) and join with both_days.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="cleaning-code-for-environment-data.html#cb177-1" tabindex="-1"></a><span class="co"># import fl scores</span></span>
<span id="cb177-2"><a href="cleaning-code-for-environment-data.html#cb177-2" tabindex="-1"></a>fl <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/SOCIAL/forced_labor/DATA/FL_scores_FCID_062124.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="cleaning-code-for-environment-data.html#cb177-3" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code_chr, Weight_Conversion, FL_Score_Value_grams) <span class="sc">%&gt;%</span> </span>
<span id="cb177-4"><a href="cleaning-code-for-environment-data.html#cb177-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FCID_Code_chr =</span> <span class="fu">as.character</span>(FCID_Code_chr))</span></code></pre></div>
<pre><code>## Rows: 399 Columns: 10
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (3): FCID_Desc, Foodgroup, FL_Score
## dbl (7): FCID_Code, Weight_Conversion, FL_Score_Value, FL_Score_Value_NOFEED, FL_Score_Value_grams, FL_Score_Value_N...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="cleaning-code-for-environment-data.html#cb179-1" tabindex="-1"></a><span class="co"># now merge</span></span>
<span id="cb179-2"><a href="cleaning-code-for-environment-data.html#cb179-2" tabindex="-1"></a>both_days15 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days14, fl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;fcidcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;FCID_Code_chr&quot;</span>))</span>
<span id="cb179-3"><a href="cleaning-code-for-environment-data.html#cb179-3" tabindex="-1"></a></span>
<span id="cb179-4"><a href="cleaning-code-for-environment-data.html#cb179-4" tabindex="-1"></a><span class="co"># any missing fl scores?</span></span>
<span id="cb179-5"><a href="cleaning-code-for-environment-data.html#cb179-5" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co">#fine</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc     wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;
## 1 83732          2        1     1 92101000   720 Coffee, br…           0     0 other           9500115… Coffee, …   2.19
## 2 83732          2        1     1 92101000   720 Coffee, br…           0     0 other           8602000… Water, i… 100   
## 3 83732          2        1     2 91200040     4 Sugar subs…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;       NA   
## 4 83732          2        1     4 94100100   240 Water, bot…           0     0 water           8601200… Water, d… 100   
## 5 83732          2        1     7 92410320   600 Soft drink…           0     0 other           &lt;NA&gt;     &lt;NA&gt;       NA   
## 6 83732          2        1     9 75506010    20 Mustard               0     0 veg_oth         9500390… Vinegar    20   
## # ℹ 19 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="cleaning-code-for-environment-data.html#cb181-1" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="co">#fine</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   Foodgroup_FCID
##   &lt;chr&gt;         
## 1 coffee_tea    
## 2 water         
## 3 other         
## 4 pf_seafood    
## 5 babyfood      
## 6 gr_whole</code></pre>
<p>Now we have to handle the seafood scores. First, look at the rows where either the FNDDS- or FCID-level food group is seafood.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="cleaning-code-for-environment-data.html#cb183-1" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc     wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;
## 1 83733          2        1     4 26107140   226 Catfish, c…        0.43     0 pf_seafood      2301236… Olive, o…  0.163
## 2 83733          2        1     4 26107140   226 Catfish, c…        0.43     0 pf_seafood      2001319… Rapeseed…  0.335
## 3 83733          2        1     4 26107140   226 Catfish, c…        0.43     0 pf_seafood      9500265… Peanut, …  0.109
## 4 83733          2        1     4 26107140   226 Catfish, c…        0.43     0 pf_seafood      2002330… Safflowe…  0.001
## 5 83733          2        1     4 26107140   226 Catfish, c…        0.43     0 pf_seafood      8000158… Fish-fre… 67.4  
## 6 83733          2        1     4 26107140   226 Catfish, c…        0.43     0 pf_seafood      2003128… Cottonse…  0.692
## # ℹ 19 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="cleaning-code-for-environment-data.html#cb185-1" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 83733          2        1     4 26107140  226  Catfish, co…        0.43     0 pf_seafood      8000158… Fish-fre… 67.4 
## 2 83733          2        1     5 26107140  680  Catfish, co…        1.29     0 pf_seafood      8000158… Fish-fre… 67.4 
## 3 83742          2        1    11 58146372  188. Pasta with …        0.19     0 gr_refined      8000161… Fish-she…  7.64
## 4 83742          2        1    11 58146372  188. Pasta with …        0.19     0 gr_refined      8000162… Fish-she… 15.3 
## 5 83755          2        1    10 26109110  153  Cod, cooked…        0        0 pf_seafood      8000160… Fish-sal… 86.2 
## 6 83756          2        1     3 27450060  119  Tuna salad,…        0.44     0 pf_seafood      8000159… Fish-sal… 53.7 
## # ℹ 19 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="cleaning-code-for-environment-data.html#cb187-1" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span> <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 83733          2        1     4 26107140  226  Catfish, co…        0.43     0 pf_seafood      8000158… Fish-fre…  67.4
## 2 83733          2        1     5 26107140  680  Catfish, co…        1.29     0 pf_seafood      8000158… Fish-fre…  67.4
## 3 83755          2        1    10 26109110  153  Cod, cooked…        0        0 pf_seafood      8000160… Fish-sal…  86.2
## 4 83756          2        1     3 27450060  119  Tuna salad,…        0.44     0 pf_seafood      8000159… Fish-sal…  53.7
## 5 83761          2        1     4 27450750  197. Fish and ve…        0        0 pf_seafood      8000160… Fish-sal…  63.4
## 6 83761          2        1    10 27250120  347. Shrimp and …        0        0 pf_seafood      8000161… Fish-she…  34.1
## # ℹ 19 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<p>Split both_days into two distinct datasets so that we can work with them separately: one containing all rows where both the FNDDS- and FCID-level food group is seafood, and the second containing the remaining rows.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="cleaning-code-for-environment-data.html#cb189-1" tabindex="-1"></a>seafood <span class="ot">&lt;-</span> both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span> <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb189-2"><a href="cleaning-code-for-environment-data.html#cb189-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Weight_Conversion, FL_Score_Value_grams))</span>
<span id="cb189-3"><a href="cleaning-code-for-environment-data.html#cb189-3" tabindex="-1"></a></span>
<span id="cb189-4"><a href="cleaning-code-for-environment-data.html#cb189-4" tabindex="-1"></a>no_seafood <span class="ot">&lt;-</span> both_days15 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(Foodgroup_FNDDS <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span> <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>))</span>
<span id="cb189-5"><a href="cleaning-code-for-environment-data.html#cb189-5" tabindex="-1"></a></span>
<span id="cb189-6"><a href="cleaning-code-for-environment-data.html#cb189-6" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb189-7"><a href="cleaning-code-for-environment-data.html#cb189-7" tabindex="-1"></a><span class="fu">nrow</span>(seafood) <span class="sc">+</span> <span class="fu">nrow</span>(no_seafood)</span></code></pre></div>
<pre><code>## [1] 2823994</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="cleaning-code-for-environment-data.html#cb191-1" tabindex="-1"></a><span class="fu">nrow</span>(both_days15)</span></code></pre></div>
<pre><code>## [1] 2823994</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="cleaning-code-for-environment-data.html#cb193-1" tabindex="-1"></a><span class="fu">nrow</span>(seafood) <span class="sc">+</span> <span class="fu">nrow</span>(no_seafood) <span class="sc">==</span> <span class="fu">nrow</span>(both_days15)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Now, import the seafood-specific forced labor scores (“sea_scores”) and join with the seafood diet dataset (“seafood”).</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="cleaning-code-for-environment-data.html#cb195-1" tabindex="-1"></a><span class="co"># import seafood scores</span></span>
<span id="cb195-2"><a href="cleaning-code-for-environment-data.html#cb195-2" tabindex="-1"></a>sea_scores <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data_inputs/SOCIAL/forced_labor/DATA/seafood_FL_scores_FNDDS_062124.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb195-3"><a href="cleaning-code-for-environment-data.html#cb195-3" tabindex="-1"></a>  <span class="fu">select</span>(FNDDS_Code, FL_Score_Value_grams)</span></code></pre></div>
<pre><code>## Rows: 387 Columns: 8
## ── Column specification ────────────────────────────────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): FNDDS_Desc, FL_Score
## dbl (6): FNDDS_Code, FL_Score_Value_chr, FL_Score_Value_NOFEED, FL_Score_Value, FL_Score_Value_grams, FL_Score_Value...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="cleaning-code-for-environment-data.html#cb197-1" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb197-2"><a href="cleaning-code-for-environment-data.html#cb197-2" tabindex="-1"></a>sea_join <span class="ot">&lt;-</span> <span class="fu">left_join</span>(seafood, sea_scores, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;foodcode&quot;</span> <span class="ot">=</span> <span class="st">&quot;FNDDS_Code&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in left_join(seafood, sea_scores, by = c(foodcode = &quot;FNDDS_Code&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 26 of `x` matches multiple rows in `y`.
## ℹ Row 15 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<p>The seafood dish “bouillabaisse” was very complicated to handle, and therefore we had to calculate the FL score for this dish in a separate Excel sheet, which gets read in below.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="cleaning-code-for-environment-data.html#cb199-1" tabindex="-1"></a><span class="co"># missing</span></span>
<span id="cb199-2"><a href="cleaning-code-for-environment-data.html#cb199-2" tabindex="-1"></a>sea_join <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="co"># bouillabaise</span></span></code></pre></div>
<pre><code>## # A tibble: 24 × 31
##     seqn daysintake reliable  line foodcode grams description   added_sugar   ssb Foodgroup_FNDDS fcidcode   fcid_desc  
##    &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;      
##  1 84522          1        1     4 27350110  497. Bouillabaisse           0     0 pf_seafood      8000161000 Fish-shell…
##  2 84522          1        1     4 27350110  497. Bouillabaisse           0     0 pf_seafood      8000160000 Fish-saltw…
##  3 84522          1        1     4 27350110  497. Bouillabaisse           0     0 pf_seafood      8000162000 Fish-shell…
##  4 84522          1        1     4 27350110  497. Bouillabaisse           0     0 pf_seafood      8000157000 Fish-fresh…
##  5 85731          2        1     9 27350110  454  Bouillabaisse           0     0 pf_seafood      8000161000 Fish-shell…
##  6 85731          2        1     9 27350110  454  Bouillabaisse           0     0 pf_seafood      8000160000 Fish-saltw…
##  7 85731          2        1     9 27350110  454  Bouillabaisse           0     0 pf_seafood      8000162000 Fish-shell…
##  8 85731          2        1     9 27350110  454  Bouillabaisse           0     0 pf_seafood      8000157000 Fish-fresh…
##  9 86452          2        1     5 27350110  454  Bouillabaisse           0     0 pf_seafood      8000161000 Fish-shell…
## 10 86452          2        1     5 27350110  454  Bouillabaisse           0     0 pf_seafood      8000160000 Fish-saltw…
## # ℹ 14 more rows
## # ℹ 19 more variables: wt &lt;dbl&gt;, foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="cleaning-code-for-environment-data.html#cb201-1" tabindex="-1"></a><span class="co"># import bouillabaise scores</span></span>
<span id="cb201-2"><a href="cleaning-code-for-environment-data.html#cb201-2" tabindex="-1"></a>bou <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/SOCIAL/forced_labor/DATA/Seafood_mapping_06-04-24.xlsx&quot;</span>,</span>
<span id="cb201-3"><a href="cleaning-code-for-environment-data.html#cb201-3" tabindex="-1"></a>                 <span class="at">sheet =</span> <span class="st">&quot;Bouillabaisse_scores&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb201-4"><a href="cleaning-code-for-environment-data.html#cb201-4" tabindex="-1"></a>  <span class="fu">select</span>(FNDDS_code, FCID_code, FL_Score_FCID) <span class="sc">%&gt;%</span> </span>
<span id="cb201-5"><a href="cleaning-code-for-environment-data.html#cb201-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">foodcode =</span> FNDDS_code,</span>
<span id="cb201-6"><a href="cleaning-code-for-environment-data.html#cb201-6" tabindex="-1"></a>         <span class="at">fcidcode =</span> FCID_code) <span class="sc">%&gt;%</span> </span>
<span id="cb201-7"><a href="cleaning-code-for-environment-data.html#cb201-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FL_Score_Value_bou =</span> FL_Score_FCID <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb201-8"><a href="cleaning-code-for-environment-data.html#cb201-8" tabindex="-1"></a>         <span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode)) <span class="sc">%&gt;%</span> </span>
<span id="cb201-9"><a href="cleaning-code-for-environment-data.html#cb201-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>FL_Score_FCID)</span>
<span id="cb201-10"><a href="cleaning-code-for-environment-data.html#cb201-10" tabindex="-1"></a></span>
<span id="cb201-11"><a href="cleaning-code-for-environment-data.html#cb201-11" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb201-12"><a href="cleaning-code-for-environment-data.html#cb201-12" tabindex="-1"></a>sea_join1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(sea_join, bou)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(foodcode, fcidcode)`</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="cleaning-code-for-environment-data.html#cb203-1" tabindex="-1"></a>sea_join2 <span class="ot">&lt;-</span> sea_join1 <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="cleaning-code-for-environment-data.html#cb203-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FL_Score_Value_grams =</span> <span class="fu">ifelse</span>(foodcode <span class="sc">==</span> <span class="dv">27350110</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_Score_Value_grams), FL_Score_Value_bou, FL_Score_Value_grams),</span>
<span id="cb203-3"><a href="cleaning-code-for-environment-data.html#cb203-3" tabindex="-1"></a>         <span class="co"># set weight conversion to 1 for seafood</span></span>
<span id="cb203-4"><a href="cleaning-code-for-environment-data.html#cb203-4" tabindex="-1"></a>         <span class="at">Weight_Conversion =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb203-5"><a href="cleaning-code-for-environment-data.html#cb203-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>FL_Score_Value_bou)</span>
<span id="cb203-6"><a href="cleaning-code-for-environment-data.html#cb203-6" tabindex="-1"></a></span>
<span id="cb203-7"><a href="cleaning-code-for-environment-data.html#cb203-7" tabindex="-1"></a>sea_join2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="co">#none-woo!</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 32
## # ℹ 32 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;, Foodgroup_FNDDS &lt;chr&gt;, fcidcode &lt;chr&gt;, fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;,
## #   foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;,
## #   Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;</code></pre>
<p>Now re-combine the seafood and non-seafood datasets.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="cleaning-code-for-environment-data.html#cb205-1" tabindex="-1"></a><span class="co"># combine back with no seafood</span></span>
<span id="cb205-2"><a href="cleaning-code-for-environment-data.html#cb205-2" tabindex="-1"></a>both_days12 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(no_seafood, sea_join2) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(seqn, dayrec, line)</span>
<span id="cb205-3"><a href="cleaning-code-for-environment-data.html#cb205-3" tabindex="-1"></a></span>
<span id="cb205-4"><a href="cleaning-code-for-environment-data.html#cb205-4" tabindex="-1"></a><span class="co"># check missing</span></span>
<span id="cb205-5"><a href="cleaning-code-for-environment-data.html#cb205-5" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Weight_Conversion)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="co">#fine</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc     wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;
## 1 83732          2        1     1 92101000   720 Coffee, br…           0     0 other           9500115… Coffee, …   2.19
## 2 83732          2        1     1 92101000   720 Coffee, br…           0     0 other           8602000… Water, i… 100   
## 3 83732          2        1     2 91200040     4 Sugar subs…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;       NA   
## 4 83732          2        1     4 94100100   240 Water, bot…           0     0 water           8601200… Water, d… 100   
## 5 83732          2        1     7 92410320   600 Soft drink…           0     0 other           &lt;NA&gt;     &lt;NA&gt;       NA   
## 6 83732          2        1     9 75506010    20 Mustard               0     0 veg_oth         9500390… Vinegar    20   
## # ℹ 19 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="cleaning-code-for-environment-data.html#cb207-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">head</span>() </span></code></pre></div>
<pre><code>## # A tibble: 6 × 32
##    seqn daysintake reliable  line foodcode grams description added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc     wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;
## 1 83732          2        1     1 92101000   720 Coffee, br…           0     0 other           9500115… Coffee, …   2.19
## 2 83732          2        1     1 92101000   720 Coffee, br…           0     0 other           8602000… Water, i… 100   
## 3 83732          2        1     2 91200040     4 Sugar subs…           0     0 added_sugar     &lt;NA&gt;     &lt;NA&gt;       NA   
## 4 83732          2        1     4 94100100   240 Water, bot…           0     0 water           8601200… Water, d… 100   
## 5 83732          2        1     7 92410320   600 Soft drink…           0     0 other           &lt;NA&gt;     &lt;NA&gt;       NA   
## 6 83732          2        1     9 75506010    20 Mustard               0     0 veg_oth         9500390… Vinegar    20   
## # ℹ 19 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="cleaning-code-for-environment-data.html#cb209-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(fcid_desc) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   fcid_desc                   
##   &lt;chr&gt;                       
## 1 Coffee, roasted bean        
## 2 Water, indirect, all sources
## 3 &lt;NA&gt;                        
## 4 Water, direct, bottled      
## 5 Vinegar                     
## 6 Water, direct, tap</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="cleaning-code-for-environment-data.html#cb211-1" tabindex="-1"></a><span class="co"># missing_fl &lt;- both_days12 %&gt;% filter(is.na(FL_Score_Value_grams)) %&gt;% </span></span>
<span id="cb211-2"><a href="cleaning-code-for-environment-data.html#cb211-2" tabindex="-1"></a><span class="co">#   select(description, Foodgroup_FNDDS, fcid_desc, Foodgroup_FCID) %&gt;% </span></span>
<span id="cb211-3"><a href="cleaning-code-for-environment-data.html#cb211-3" tabindex="-1"></a><span class="co">#   filter(!(Foodgroup_FCID %in% c(&quot;water&quot;, &quot;coffee_tea&quot;, &quot;babyfood&quot;, &quot;other&quot;))) %&gt;% </span></span>
<span id="cb211-4"><a href="cleaning-code-for-environment-data.html#cb211-4" tabindex="-1"></a><span class="co">#   distinct()</span></span>
<span id="cb211-5"><a href="cleaning-code-for-environment-data.html#cb211-5" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb211-6"><a href="cleaning-code-for-environment-data.html#cb211-6" tabindex="-1"></a><span class="co"># # export</span></span>
<span id="cb211-7"><a href="cleaning-code-for-environment-data.html#cb211-7" tabindex="-1"></a><span class="co"># write_csv(missing_fl, paste(&quot;data_inputs/SOCIAL/forced_labor/DATA/missing_data/Missing FL scores_&quot;, my_date, &quot;.csv&quot;, sep=&quot;&quot;))</span></span></code></pre></div>
<p>For the remaining missing FL scores for seafood, we will calculate the median seafood-specific FL score and impute the missing scores.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="cleaning-code-for-environment-data.html#cb212-1" tabindex="-1"></a><span class="co"># create impute median</span></span>
<span id="cb212-2"><a href="cleaning-code-for-environment-data.html#cb212-2" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> </span>
<span id="cb212-3"><a href="cleaning-code-for-environment-data.html#cb212-3" tabindex="-1"></a>  <span class="fu">select</span>(seqn, line, dayrec, fcidcode, Foodgroup_FCID, fcid_desc, FL_Score_Value_grams) <span class="sc">%&gt;%</span> </span>
<span id="cb212-4"><a href="cleaning-code-for-environment-data.html#cb212-4" tabindex="-1"></a>  <span class="fu">filter</span>(Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb212-5"><a href="cleaning-code-for-environment-data.html#cb212-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb212-6"><a href="cleaning-code-for-environment-data.html#cb212-6" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##    seqn  line dayrec fcidcode   Foodgroup_FCID fcid_desc                            FL_Score_Value_grams
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;                                               &lt;dbl&gt;
## 1 83733     4      2 8000158000 pf_seafood     Fish-freshwater finfish, farm raised              0.00131
## 2 83733     5      2 8000158000 pf_seafood     Fish-freshwater finfish, farm raised              0.00131
## 3 83742    11      2 8000161000 pf_seafood     Fish-shellfish, crustacean                       NA      
## 4 83742    11      2 8000162000 pf_seafood     Fish-shellfish, mollusc                          NA      
## 5 83755    10      2 8000160000 pf_seafood     Fish-saltwater finfish, other                     0.00131
## 6 83756     3      2 8000159000 pf_seafood     Fish-saltwater finfish, tuna                      0.00121</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="cleaning-code-for-environment-data.html#cb214-1" tabindex="-1"></a>both_days12 <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="cleaning-code-for-environment-data.html#cb214-2" tabindex="-1"></a>  <span class="fu">select</span>(fcidcode, fcid_desc, Foodgroup_FCID, FL_Score_Value_grams) <span class="sc">%&gt;%</span> </span>
<span id="cb214-3"><a href="cleaning-code-for-environment-data.html#cb214-3" tabindex="-1"></a>  <span class="fu">filter</span>(Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb214-4"><a href="cleaning-code-for-environment-data.html#cb214-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb214-5"><a href="cleaning-code-for-environment-data.html#cb214-5" tabindex="-1"></a>  <span class="fu">arrange</span>(fcidcode) <span class="sc">%&gt;%</span> </span>
<span id="cb214-6"><a href="cleaning-code-for-environment-data.html#cb214-6" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   fcidcode   fcid_desc               Foodgroup_FCID FL_Score_Value_grams
##   &lt;chr&gt;      &lt;chr&gt;                   &lt;chr&gt;                         &lt;dbl&gt;
## 1 8000157000 Fish-freshwater finfish pf_seafood               0.000751  
## 2 8000157000 Fish-freshwater finfish pf_seafood               0.00108   
## 3 8000157000 Fish-freshwater finfish pf_seafood               0.00167   
## 4 8000157000 Fish-freshwater finfish pf_seafood              NA         
## 5 8000157000 Fish-freshwater finfish pf_seafood               0.000578  
## 6 8000157000 Fish-freshwater finfish pf_seafood               0.00000150</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="cleaning-code-for-environment-data.html#cb216-1" tabindex="-1"></a>imputed_fl <span class="ot">&lt;-</span></span>
<span id="cb216-2"><a href="cleaning-code-for-environment-data.html#cb216-2" tabindex="-1"></a>  both_days12 <span class="sc">%&gt;%</span> </span>
<span id="cb216-3"><a href="cleaning-code-for-environment-data.html#cb216-3" tabindex="-1"></a>  <span class="fu">select</span>(seqn, line, dayrec, fcidcode, Foodgroup_FCID, fcid_desc, FL_Score_Value_grams) <span class="sc">%&gt;%</span> </span>
<span id="cb216-4"><a href="cleaning-code-for-environment-data.html#cb216-4" tabindex="-1"></a>  <span class="fu">filter</span>(Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb216-5"><a href="cleaning-code-for-environment-data.html#cb216-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb216-6"><a href="cleaning-code-for-environment-data.html#cb216-6" tabindex="-1"></a>  <span class="fu">group_by</span>(fcidcode, fcid_desc) <span class="sc">%&gt;%</span> </span>
<span id="cb216-7"><a href="cleaning-code-for-environment-data.html#cb216-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">FL_g_group_median =</span> <span class="fu">median</span>(FL_Score_Value_grams, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb216-8"><a href="cleaning-code-for-environment-data.html#cb216-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(fcidcode)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;fcidcode&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="cleaning-code-for-environment-data.html#cb218-1" tabindex="-1"></a><span class="co"># join imputed fl scores with food data</span></span>
<span id="cb218-2"><a href="cleaning-code-for-environment-data.html#cb218-2" tabindex="-1"></a>both_days13 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(both_days12, imputed_fl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;fcidcode&quot;</span>, <span class="st">&quot;fcid_desc&quot;</span>))</span>
<span id="cb218-3"><a href="cleaning-code-for-environment-data.html#cb218-3" tabindex="-1"></a></span>
<span id="cb218-4"><a href="cleaning-code-for-environment-data.html#cb218-4" tabindex="-1"></a><span class="co"># insert food_group median price if missing</span></span>
<span id="cb218-5"><a href="cleaning-code-for-environment-data.html#cb218-5" tabindex="-1"></a>both_days14 <span class="ot">&lt;-</span> both_days13 <span class="sc">%&gt;%</span> </span>
<span id="cb218-6"><a href="cleaning-code-for-environment-data.html#cb218-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FL_Score_Value_grams =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(FL_Score_Value_grams) <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>, FL_g_group_median, FL_Score_Value_grams)) <span class="sc">%&gt;%</span> </span>
<span id="cb218-7"><a href="cleaning-code-for-environment-data.html#cb218-7" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb218-8"><a href="cleaning-code-for-environment-data.html#cb218-8" tabindex="-1"></a></span>
<span id="cb218-9"><a href="cleaning-code-for-environment-data.html#cb218-9" tabindex="-1"></a><span class="co"># check if any missing price per gram (shouldn&#39;t be)</span></span>
<span id="cb218-10"><a href="cleaning-code-for-environment-data.html#cb218-10" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(fcid_desc) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   fcid_desc                   
##   &lt;chr&gt;                       
## 1 Coffee, roasted bean        
## 2 Water, indirect, all sources
## 3 &lt;NA&gt;                        
## 4 Water, direct, bottled      
## 5 Vinegar                     
## 6 Water, direct, tap</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="cleaning-code-for-environment-data.html#cb220-1" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_Score_Value_grams) <span class="sc">&amp;</span> Foodgroup_FCID <span class="sc">==</span> <span class="st">&quot;pf_seafood&quot;</span>) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 33
## # ℹ 33 variables: seqn &lt;dbl&gt;, daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;, line &lt;dbl&gt;, foodcode &lt;dbl&gt;, grams &lt;dbl&gt;,
## #   description &lt;chr&gt;, added_sugar &lt;dbl&gt;, ssb &lt;dbl&gt;, Foodgroup_FNDDS &lt;chr&gt;, fcidcode &lt;chr&gt;, fcid_desc &lt;chr&gt;, wt &lt;dbl&gt;,
## #   foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;, retloss_coef &lt;dbl&gt;,
## #   Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;, FL_g_group_median &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="cleaning-code-for-environment-data.html#cb222-1" tabindex="-1"></a><span class="co"># check cocoa bean</span></span>
<span id="cb222-2"><a href="cleaning-code-for-environment-data.html#cb222-2" tabindex="-1"></a>both_days14 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fcid_desc <span class="sc">==</span> <span class="st">&quot;Cocoa bean, chocolate&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 33
##    seqn daysintake reliable  line foodcode grams description  added_sugar   ssb Foodgroup_FNDDS fcidcode fcid_desc    wt
##   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 83735          1        1     5 91705300     8 Chocolate, …        0.93     0 added_sugar     9500109… Cocoa be… 50   
## 2 83735          1        1     6 91705310    14 Chocolate, …        1.4      0 added_sugar     9500109… Cocoa be… 28.0 
## 3 83737          2        1     4 27146160   244 Chicken wit…        0        0 pf_poultry      9500109… Cocoa be…  1.05
## 4 83739          2        1    14 53210900    42 Cookie, gra…        3.88     0 gr_refined      9500109… Cocoa be…  2.7 
## 5 83745          2        1     9 53206000    90 Cookie, cho…        6.97     0 gr_refined      9500109… Cocoa be… 10.3 
## 6 83755          2        1    11 53520160    36 Doughnut, c…        2.12     0 gr_refined      9500109… Cocoa be…  5.85
## # ℹ 20 more variables: foodsource &lt;chr&gt;, nhanes_cycle &lt;chr&gt;, dayrec &lt;dbl&gt;, waste_coef &lt;dbl&gt;, ined_coef &lt;dbl&gt;,
## #   retloss_coef &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;, consumed_amt_FCID &lt;dbl&gt;, inedible_amt_FCID &lt;dbl&gt;, wasted_amt_FCID &lt;dbl&gt;,
## #   consumed_amt_FNDDS &lt;dbl&gt;, inedible_amt_FNDDS &lt;dbl&gt;, wasted_amt_FNDDS &lt;dbl&gt;, CED_mn &lt;dbl&gt;, GHG_mn &lt;dbl&gt;,
## #   WATER_mn &lt;dbl&gt;, BLUEWATER_mn &lt;dbl&gt;, Weight_Conversion &lt;dbl&gt;, FL_Score_Value_grams &lt;dbl&gt;, FL_g_group_median &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="cleaning-code-for-environment-data.html#cb224-1" tabindex="-1"></a><span class="co"># create new nhanes cycle variable</span></span>
<span id="cb224-2"><a href="cleaning-code-for-environment-data.html#cb224-2" tabindex="-1"></a>both_days15 <span class="ot">&lt;-</span> both_days14 <span class="sc">%&gt;%</span></span>
<span id="cb224-3"><a href="cleaning-code-for-environment-data.html#cb224-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nhanes1516 =</span> <span class="fu">ifelse</span>(nhanes_cycle <span class="sc">==</span> <span class="st">&quot;2015-2016&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code></pre></div>
</div>
</div>
<div id="calculate-average-environmental-and-social-impact-per-fcid-code" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Calculate Average Environmental and Social Impact, Per FCID Code<a href="cleaning-code-for-environment-data.html#calculate-average-environmental-and-social-impact-per-fcid-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, we will calculate (i) the average environmental impacts per 1 gram of each FCID code, and (ii) the average amount of forced labor risk per 1 gram of each FCID code. This process includes aggregating and summarizing the diet dataset.</p>
<p>First, take the original environmental impact factors provided by the dataField datasets, the units of which are per 1 kilograms (1000 grams) and divide by 1000 to get the impacts per 1 gram of food. The forced labor impact factor, on the other hand, just needs to be multiplied by the weight conversion factor.</p>
<p>Then, for all the impact factors, calculate the total amounts of impact for the given amount of consumed food by multiplying the impact factor (per 1 gram of food) by the consumed amount of food (in grams).</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="cleaning-code-for-environment-data.html#cb225-1" tabindex="-1"></a>my_enviro_table <span class="ot">&lt;-</span> </span>
<span id="cb225-2"><a href="cleaning-code-for-environment-data.html#cb225-2" tabindex="-1"></a>  both_days15 <span class="sc">%&gt;%</span> </span>
<span id="cb225-3"><a href="cleaning-code-for-environment-data.html#cb225-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb225-4"><a href="cleaning-code-for-environment-data.html#cb225-4" tabindex="-1"></a>    <span class="at">GHG_impact_per_gram =</span> GHG_mn <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb225-5"><a href="cleaning-code-for-environment-data.html#cb225-5" tabindex="-1"></a>    <span class="at">GHG_impact_per_FCID_Consumed =</span> GHG_impact_per_gram <span class="sc">*</span> consumed_amt_FCID,</span>
<span id="cb225-6"><a href="cleaning-code-for-environment-data.html#cb225-6" tabindex="-1"></a>    </span>
<span id="cb225-7"><a href="cleaning-code-for-environment-data.html#cb225-7" tabindex="-1"></a>    <span class="at">CED_impact_per_gram =</span> CED_mn <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb225-8"><a href="cleaning-code-for-environment-data.html#cb225-8" tabindex="-1"></a>    <span class="at">CED_impact_per_FCID_Consumed =</span> CED_impact_per_gram <span class="sc">*</span> consumed_amt_FCID,</span>
<span id="cb225-9"><a href="cleaning-code-for-environment-data.html#cb225-9" tabindex="-1"></a>    </span>
<span id="cb225-10"><a href="cleaning-code-for-environment-data.html#cb225-10" tabindex="-1"></a>    <span class="at">WATER_impact_per_gram =</span> WATER_mn <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb225-11"><a href="cleaning-code-for-environment-data.html#cb225-11" tabindex="-1"></a>    <span class="at">WATER_impact_per_FCID_Consumed =</span> WATER_impact_per_gram <span class="sc">*</span> consumed_amt_FCID,</span>
<span id="cb225-12"><a href="cleaning-code-for-environment-data.html#cb225-12" tabindex="-1"></a>    </span>
<span id="cb225-13"><a href="cleaning-code-for-environment-data.html#cb225-13" tabindex="-1"></a>    <span class="at">BLUEWATER_impact_per_gram =</span> BLUEWATER_mn <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb225-14"><a href="cleaning-code-for-environment-data.html#cb225-14" tabindex="-1"></a>    <span class="at">BLUEWATER_impact_per_FCID_Consumed =</span> BLUEWATER_impact_per_gram <span class="sc">*</span> consumed_amt_FCID,</span>
<span id="cb225-15"><a href="cleaning-code-for-environment-data.html#cb225-15" tabindex="-1"></a>    </span>
<span id="cb225-16"><a href="cleaning-code-for-environment-data.html#cb225-16" tabindex="-1"></a>    <span class="at">FL_impact_per_gram =</span> FL_Score_Value_grams <span class="sc">*</span> Weight_Conversion,</span>
<span id="cb225-17"><a href="cleaning-code-for-environment-data.html#cb225-17" tabindex="-1"></a>    <span class="at">FL_impact_per_FCID_Consumed =</span> FL_impact_per_gram <span class="sc">*</span> consumed_amt_FCID)</span></code></pre></div>
<p>Check missing.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="cleaning-code-for-environment-data.html#cb226-1" tabindex="-1"></a><span class="co"># what food groups have missing impact factors?</span></span>
<span id="cb226-2"><a href="cleaning-code-for-environment-data.html#cb226-2" tabindex="-1"></a>my_enviro_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_impact_per_gram)) <span class="sc">%&gt;%</span> </span>
<span id="cb226-3"><a href="cleaning-code-for-environment-data.html#cb226-3" tabindex="-1"></a>  <span class="fu">select</span>(fcidcode, fcid_desc, Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   fcidcode   fcid_desc                                    Foodgroup_FCID
##   &lt;chr&gt;      &lt;chr&gt;                                        &lt;chr&gt;         
## 1 &lt;NA&gt;       &lt;NA&gt;                                         other         
## 2 3700222501 Milk, human                                  babyfood      
## 3 &lt;NA&gt;       &lt;NA&gt;                                         water         
## 4 2002365001 Sunflower, oil-babyfood                      babyfood      
## 5 1400114001 Coconut, oil-babyfood                        babyfood      
## 6 3600223001 Milk, nonfat solids-baby food/infant formula babyfood</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="cleaning-code-for-environment-data.html#cb228-1" tabindex="-1"></a><span class="co"># this is fine</span></span>
<span id="cb228-2"><a href="cleaning-code-for-environment-data.html#cb228-2" tabindex="-1"></a></span>
<span id="cb228-3"><a href="cleaning-code-for-environment-data.html#cb228-3" tabindex="-1"></a>my_enviro_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(GHG_impact_per_gram)) <span class="sc">%&gt;%</span> </span>
<span id="cb228-4"><a href="cleaning-code-for-environment-data.html#cb228-4" tabindex="-1"></a>  <span class="fu">select</span>(Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 1
##   Foodgroup_FCID
##   &lt;chr&gt;         
## 1 other         
## 2 babyfood      
## 3 water         
## 4 gr_whole      
## 5 pf_seafood</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="cleaning-code-for-environment-data.html#cb230-1" tabindex="-1"></a>my_enviro_table <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(FL_impact_per_gram)) <span class="sc">%&gt;%</span> </span>
<span id="cb230-2"><a href="cleaning-code-for-environment-data.html#cb230-2" tabindex="-1"></a>  <span class="fu">select</span>(fcidcode, fcid_desc, Foodgroup_FCID) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   fcidcode   fcid_desc                    Foodgroup_FCID
##   &lt;chr&gt;      &lt;chr&gt;                        &lt;chr&gt;         
## 1 9500115000 Coffee, roasted bean         coffee_tea    
## 2 8602000000 Water, indirect, all sources water         
## 3 &lt;NA&gt;       &lt;NA&gt;                         other         
## 4 8601200000 Water, direct, bottled       water         
## 5 9500390000 Vinegar                      other         
## 6 8601100000 Water, direct, tap           water</code></pre>
<p>Then, calculate the total impacts, per day, per person, by adding up the food-level impacts for each person-day combination. Additionally, calculate the consumed, inedible, and wasted amounts of food per day, per person, to be used later in the code.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="cleaning-code-for-environment-data.html#cb232-1" tabindex="-1"></a>enviro_impact <span class="ot">&lt;-</span> my_enviro_table <span class="sc">%&gt;%</span> </span>
<span id="cb232-2"><a href="cleaning-code-for-environment-data.html#cb232-2" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, fcidcode, dayrec) <span class="sc">%&gt;%</span> </span>
<span id="cb232-3"><a href="cleaning-code-for-environment-data.html#cb232-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GHG_per_day_Consumed =</span> <span class="fu">sum</span>(GHG_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb232-4"><a href="cleaning-code-for-environment-data.html#cb232-4" tabindex="-1"></a>            <span class="at">CED_per_day_Consumed =</span> <span class="fu">sum</span>(CED_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb232-5"><a href="cleaning-code-for-environment-data.html#cb232-5" tabindex="-1"></a>            <span class="at">WATER_per_day_Consumed =</span> <span class="fu">sum</span>(WATER_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb232-6"><a href="cleaning-code-for-environment-data.html#cb232-6" tabindex="-1"></a>            <span class="at">BLUEWATER_per_day_Consumed =</span> <span class="fu">sum</span>(BLUEWATER_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb232-7"><a href="cleaning-code-for-environment-data.html#cb232-7" tabindex="-1"></a>            <span class="at">FL_per_day_Consumed =</span> <span class="fu">sum</span>(FL_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb232-8"><a href="cleaning-code-for-environment-data.html#cb232-8" tabindex="-1"></a>            </span>
<span id="cb232-9"><a href="cleaning-code-for-environment-data.html#cb232-9" tabindex="-1"></a>            <span class="at">consumed_per_day =</span> <span class="fu">sum</span>(consumed_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb232-10"><a href="cleaning-code-for-environment-data.html#cb232-10" tabindex="-1"></a>            <span class="at">inedible_per_day =</span> <span class="fu">sum</span>(inedible_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb232-11"><a href="cleaning-code-for-environment-data.html#cb232-11" tabindex="-1"></a>            <span class="at">wasted_per_day =</span> <span class="fu">sum</span>(wasted_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb232-12"><a href="cleaning-code-for-environment-data.html#cb232-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(fcidcode)))  <span class="co"># this is needed bc there are some na fcidcodes</span></span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;, &#39;fcidcode&#39;. You can override using the `.groups` argument.</code></pre>
<p>Now, repeat the same steps above specifically for sugar sweetened beverages (this is done by including the “ssb” variable in the “group_by” statement).</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="cleaning-code-for-environment-data.html#cb234-1" tabindex="-1"></a><span class="co"># now do ssb</span></span>
<span id="cb234-2"><a href="cleaning-code-for-environment-data.html#cb234-2" tabindex="-1"></a>ssb_impact <span class="ot">&lt;-</span> my_enviro_table <span class="sc">%&gt;%</span> </span>
<span id="cb234-3"><a href="cleaning-code-for-environment-data.html#cb234-3" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, fcidcode, dayrec, ssb) <span class="sc">%&gt;%</span> </span>
<span id="cb234-4"><a href="cleaning-code-for-environment-data.html#cb234-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GHG_per_day_Consumed =</span> <span class="fu">sum</span>(GHG_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb234-5"><a href="cleaning-code-for-environment-data.html#cb234-5" tabindex="-1"></a>            <span class="at">CED_per_day_Consumed =</span> <span class="fu">sum</span>(CED_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb234-6"><a href="cleaning-code-for-environment-data.html#cb234-6" tabindex="-1"></a>            <span class="at">WATER_per_day_Consumed =</span> <span class="fu">sum</span>(WATER_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb234-7"><a href="cleaning-code-for-environment-data.html#cb234-7" tabindex="-1"></a>            <span class="at">BLUEWATER_per_day_Consumed =</span> <span class="fu">sum</span>(BLUEWATER_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb234-8"><a href="cleaning-code-for-environment-data.html#cb234-8" tabindex="-1"></a>            <span class="at">FL_per_day_Consumed =</span> <span class="fu">sum</span>(FL_impact_per_FCID_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb234-9"><a href="cleaning-code-for-environment-data.html#cb234-9" tabindex="-1"></a>            </span>
<span id="cb234-10"><a href="cleaning-code-for-environment-data.html#cb234-10" tabindex="-1"></a>            <span class="at">consumed_per_day =</span> <span class="fu">sum</span>(consumed_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb234-11"><a href="cleaning-code-for-environment-data.html#cb234-11" tabindex="-1"></a>            <span class="at">inedible_per_day =</span> <span class="fu">sum</span>(inedible_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb234-12"><a href="cleaning-code-for-environment-data.html#cb234-12" tabindex="-1"></a>            <span class="at">wasted_per_day =</span> <span class="fu">sum</span>(wasted_amt_FCID, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb234-13"><a href="cleaning-code-for-environment-data.html#cb234-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(fcidcode)))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;, &#39;fcidcode&#39;, &#39;dayrec&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="cleaning-code-for-environment-data.html#cb236-1" tabindex="-1"></a><span class="co"># calculate sum of fcid codes for ssb</span></span>
<span id="cb236-2"><a href="cleaning-code-for-environment-data.html#cb236-2" tabindex="-1"></a>ssb_impact <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 12
## # Groups:   seqn, fcidcode, dayrec [6]
##    seqn fcidcode   dayrec   ssb GHG_per_day_Consumed CED_per_day_Consumed WATER_per_day_Consumed BLUEWATER_per_day_Con…¹
##   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;                &lt;dbl&gt;                &lt;dbl&gt;                  &lt;dbl&gt;                   &lt;dbl&gt;
## 1 83732 101052000       2     1              0.00321               0.0375                   3.95                   1.24 
## 2 83732 8602000000      2     1              0                     0                        0                      0    
## 3 83732 9500362000      2     1              0.00731               0.0537                  10.7                    2.40 
## 4 83732 9500372000      2     1              0.00378               0.0529                  11.2                    1.67 
## 5 83736 101052000       1     1              0.00184               0.0215                   2.26                   0.711
## 6 83736 101052000       2     1              0.00192               0.0225                   2.36                   0.742
## # ℹ abbreviated name: ¹​BLUEWATER_per_day_Consumed
## # ℹ 4 more variables: FL_per_day_Consumed &lt;dbl&gt;, consumed_per_day &lt;dbl&gt;, inedible_per_day &lt;dbl&gt;, wasted_per_day &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="cleaning-code-for-environment-data.html#cb238-1" tabindex="-1"></a><span class="co"># calculate summed ssb impact for each seqn and day</span></span>
<span id="cb238-2"><a href="cleaning-code-for-environment-data.html#cb238-2" tabindex="-1"></a>ssb_impact1 <span class="ot">&lt;-</span> ssb_impact <span class="sc">%&gt;%</span> </span>
<span id="cb238-3"><a href="cleaning-code-for-environment-data.html#cb238-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb238-4"><a href="cleaning-code-for-environment-data.html#cb238-4" tabindex="-1"></a>  <span class="fu">filter</span>(ssb <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb238-5"><a href="cleaning-code-for-environment-data.html#cb238-5" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, dayrec) <span class="sc">%&gt;%</span> </span>
<span id="cb238-6"><a href="cleaning-code-for-environment-data.html#cb238-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">GHG_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(GHG_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb238-7"><a href="cleaning-code-for-environment-data.html#cb238-7" tabindex="-1"></a>            <span class="at">CED_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(CED_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb238-8"><a href="cleaning-code-for-environment-data.html#cb238-8" tabindex="-1"></a>            <span class="at">WATER_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(WATER_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb238-9"><a href="cleaning-code-for-environment-data.html#cb238-9" tabindex="-1"></a>            <span class="at">BLUEWATER_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(BLUEWATER_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb238-10"><a href="cleaning-code-for-environment-data.html#cb238-10" tabindex="-1"></a>            <span class="at">FL_per_day_Consumed_ssb =</span> <span class="fu">sum</span>(FL_per_day_Consumed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb238-11"><a href="cleaning-code-for-environment-data.html#cb238-11" tabindex="-1"></a>            </span>
<span id="cb238-12"><a href="cleaning-code-for-environment-data.html#cb238-12" tabindex="-1"></a>            <span class="at">consumed_per_day_ssb =</span> <span class="fu">sum</span>(consumed_per_day, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb238-13"><a href="cleaning-code-for-environment-data.html#cb238-13" tabindex="-1"></a>            <span class="at">inedible_per_day_ssb =</span> <span class="fu">sum</span>(inedible_per_day, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb238-14"><a href="cleaning-code-for-environment-data.html#cb238-14" tabindex="-1"></a>            <span class="at">wasted_per_day_ssb =</span> <span class="fu">sum</span>(wasted_per_day, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="cleaning-code-for-environment-data.html#cb240-1" tabindex="-1"></a><span class="co"># go back to non-ssb</span></span>
<span id="cb240-2"><a href="cleaning-code-for-environment-data.html#cb240-2" tabindex="-1"></a></span>
<span id="cb240-3"><a href="cleaning-code-for-environment-data.html#cb240-3" tabindex="-1"></a><span class="co"># check missing</span></span>
<span id="cb240-4"><a href="cleaning-code-for-environment-data.html#cb240-4" tabindex="-1"></a>enviro_impact <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(consumed_per_day)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Groups:   seqn, fcidcode [0]
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, dayrec &lt;dbl&gt;, GHG_per_day_Consumed &lt;dbl&gt;, CED_per_day_Consumed &lt;dbl&gt;,
## #   WATER_per_day_Consumed &lt;dbl&gt;, BLUEWATER_per_day_Consumed &lt;dbl&gt;, FL_per_day_Consumed &lt;dbl&gt;, consumed_per_day &lt;dbl&gt;,
## #   inedible_per_day &lt;dbl&gt;, wasted_per_day &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="cleaning-code-for-environment-data.html#cb242-1" tabindex="-1"></a>enviro_impact <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fcidcode))</span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Groups:   seqn, fcidcode [0]
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, dayrec &lt;dbl&gt;, GHG_per_day_Consumed &lt;dbl&gt;, CED_per_day_Consumed &lt;dbl&gt;,
## #   WATER_per_day_Consumed &lt;dbl&gt;, BLUEWATER_per_day_Consumed &lt;dbl&gt;, FL_per_day_Consumed &lt;dbl&gt;, consumed_per_day &lt;dbl&gt;,
## #   inedible_per_day &lt;dbl&gt;, wasted_per_day &lt;dbl&gt;</code></pre>
<p>Transform dataset to wide format.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="cleaning-code-for-environment-data.html#cb244-1" tabindex="-1"></a>enviro_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(enviro_impact, </span>
<span id="cb244-2"><a href="cleaning-code-for-environment-data.html#cb244-2" tabindex="-1"></a>                           <span class="at">names_from =</span> dayrec,</span>
<span id="cb244-3"><a href="cleaning-code-for-environment-data.html#cb244-3" tabindex="-1"></a>                           <span class="at">values_from =</span> <span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">&quot;per_day&quot;</span>)))</span></code></pre></div>
<p>Because some participants have 2 days of dietary recall, we need to calculate average impacts for each FCID code, per participant. If a participant only has 1 day of recall, then we use that to represent the average.</p>
<p>To calculate the average, we first need to determine how many days of recall each participant has.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="cleaning-code-for-environment-data.html#cb245-1" tabindex="-1"></a><span class="co"># calculate # days of recall</span></span>
<span id="cb245-2"><a href="cleaning-code-for-environment-data.html#cb245-2" tabindex="-1"></a>both_days15 <span class="sc">%&gt;%</span> <span class="fu">select</span>(reliable) <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## reliable
##       1       4 
## 2799377   25083</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="cleaning-code-for-environment-data.html#cb247-1" tabindex="-1"></a>daysofintake <span class="ot">&lt;-</span> both_days15 <span class="sc">%&gt;%</span> <span class="fu">select</span>(seqn, daysintake, reliable) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb247-2"><a href="cleaning-code-for-environment-data.html#cb247-2" tabindex="-1"></a></span>
<span id="cb247-3"><a href="cleaning-code-for-environment-data.html#cb247-3" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb247-4"><a href="cleaning-code-for-environment-data.html#cb247-4" tabindex="-1"></a>enviro_wide1 <span class="ot">&lt;-</span> enviro_wide <span class="sc">%&gt;%</span> </span>
<span id="cb247-5"><a href="cleaning-code-for-environment-data.html#cb247-5" tabindex="-1"></a>  <span class="fu">left_join</span>(daysofintake, <span class="at">by =</span> <span class="st">&quot;seqn&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in left_join(., daysofintake, by = &quot;seqn&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 33073 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to silence this warning.</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="cleaning-code-for-environment-data.html#cb249-1" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb249-2"><a href="cleaning-code-for-environment-data.html#cb249-2" tabindex="-1"></a>enviro_wide1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(daysintake <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_1)) <span class="co">#good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 20
## # Groups:   seqn, fcidcode [0]
## # ℹ 20 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, GHG_per_day_Consumed_1 &lt;dbl&gt;, GHG_per_day_Consumed_2 &lt;dbl&gt;,
## #   CED_per_day_Consumed_1 &lt;dbl&gt;, CED_per_day_Consumed_2 &lt;dbl&gt;, WATER_per_day_Consumed_1 &lt;dbl&gt;,
## #   WATER_per_day_Consumed_2 &lt;dbl&gt;, BLUEWATER_per_day_Consumed_1 &lt;dbl&gt;, BLUEWATER_per_day_Consumed_2 &lt;dbl&gt;,
## #   FL_per_day_Consumed_1 &lt;dbl&gt;, FL_per_day_Consumed_2 &lt;dbl&gt;, consumed_per_day_1 &lt;dbl&gt;, consumed_per_day_2 &lt;dbl&gt;,
## #   inedible_per_day_1 &lt;dbl&gt;, inedible_per_day_2 &lt;dbl&gt;, wasted_per_day_1 &lt;dbl&gt;, wasted_per_day_2 &lt;dbl&gt;,
## #   daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;</code></pre>
<p>Now, we have to fill in some 0s to properly calculate averages later on.</p>
<p>If a participant has 2 days of intake and their corresponding impact (e.g., GHG) for day 1 or day 2 is missing (NA), then we need to replace those NAs with 0s, because in this case, the data aren’t “missing”, the participant just didn’t consume that food on those day.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="cleaning-code-for-environment-data.html#cb251-1" tabindex="-1"></a>enviro_wide2 <span class="ot">&lt;-</span> enviro_wide1 <span class="sc">%&gt;%</span> </span>
<span id="cb251-2"><a href="cleaning-code-for-environment-data.html#cb251-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="co"># day 2</span></span>
<span id="cb251-3"><a href="cleaning-code-for-environment-data.html#cb251-3" tabindex="-1"></a>    <span class="at">GHG_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(GHG_per_day_Consumed_2), <span class="dv">0</span>, GHG_per_day_Consumed_2),</span>
<span id="cb251-4"><a href="cleaning-code-for-environment-data.html#cb251-4" tabindex="-1"></a>    <span class="at">CED_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(CED_per_day_Consumed_2), <span class="dv">0</span>, CED_per_day_Consumed_2),</span>
<span id="cb251-5"><a href="cleaning-code-for-environment-data.html#cb251-5" tabindex="-1"></a>    <span class="at">WATER_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(WATER_per_day_Consumed_2), <span class="dv">0</span>, WATER_per_day_Consumed_2),</span>
<span id="cb251-6"><a href="cleaning-code-for-environment-data.html#cb251-6" tabindex="-1"></a>    <span class="at">BLUEWATER_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(BLUEWATER_per_day_Consumed_2), <span class="dv">0</span>, BLUEWATER_per_day_Consumed_2),</span>
<span id="cb251-7"><a href="cleaning-code-for-environment-data.html#cb251-7" tabindex="-1"></a>    <span class="at">FL_per_day_Consumed_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_per_day_Consumed_2), <span class="dv">0</span>, FL_per_day_Consumed_2),</span>
<span id="cb251-8"><a href="cleaning-code-for-environment-data.html#cb251-8" tabindex="-1"></a>    </span>
<span id="cb251-9"><a href="cleaning-code-for-environment-data.html#cb251-9" tabindex="-1"></a>    <span class="at">consumed_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_2), <span class="dv">0</span>, consumed_per_day_2),</span>
<span id="cb251-10"><a href="cleaning-code-for-environment-data.html#cb251-10" tabindex="-1"></a>    <span class="at">wasted_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_2), <span class="dv">0</span>, wasted_per_day_2),</span>
<span id="cb251-11"><a href="cleaning-code-for-environment-data.html#cb251-11" tabindex="-1"></a>    <span class="at">inedible_per_day_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_2), <span class="dv">0</span>, inedible_per_day_2),</span>
<span id="cb251-12"><a href="cleaning-code-for-environment-data.html#cb251-12" tabindex="-1"></a>    </span>
<span id="cb251-13"><a href="cleaning-code-for-environment-data.html#cb251-13" tabindex="-1"></a>    <span class="co"># day1</span></span>
<span id="cb251-14"><a href="cleaning-code-for-environment-data.html#cb251-14" tabindex="-1"></a>    <span class="at">GHG_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(GHG_per_day_Consumed_1), <span class="dv">0</span>, GHG_per_day_Consumed_1),</span>
<span id="cb251-15"><a href="cleaning-code-for-environment-data.html#cb251-15" tabindex="-1"></a>    <span class="at">CED_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(CED_per_day_Consumed_1), <span class="dv">0</span>, CED_per_day_Consumed_1),</span>
<span id="cb251-16"><a href="cleaning-code-for-environment-data.html#cb251-16" tabindex="-1"></a>    <span class="at">WATER_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(WATER_per_day_Consumed_1), <span class="dv">0</span>, WATER_per_day_Consumed_1),</span>
<span id="cb251-17"><a href="cleaning-code-for-environment-data.html#cb251-17" tabindex="-1"></a>    <span class="at">BLUEWATER_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(BLUEWATER_per_day_Consumed_1), <span class="dv">0</span>, BLUEWATER_per_day_Consumed_1),</span>
<span id="cb251-18"><a href="cleaning-code-for-environment-data.html#cb251-18" tabindex="-1"></a>    <span class="at">FL_per_day_Consumed_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_per_day_Consumed_1), <span class="dv">0</span>, FL_per_day_Consumed_1),</span>
<span id="cb251-19"><a href="cleaning-code-for-environment-data.html#cb251-19" tabindex="-1"></a>    </span>
<span id="cb251-20"><a href="cleaning-code-for-environment-data.html#cb251-20" tabindex="-1"></a>    <span class="at">consumed_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_1), <span class="dv">0</span>, consumed_per_day_1),</span>
<span id="cb251-21"><a href="cleaning-code-for-environment-data.html#cb251-21" tabindex="-1"></a>    <span class="at">wasted_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_1), <span class="dv">0</span>, wasted_per_day_1),</span>
<span id="cb251-22"><a href="cleaning-code-for-environment-data.html#cb251-22" tabindex="-1"></a>    <span class="at">inedible_per_day_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_1), <span class="dv">0</span>, inedible_per_day_1))</span></code></pre></div>
<p>Calculate the <strong>average</strong> total impacts of consumed food at the FCID code-level for each person. This will give us the data we need to calculate the environmental and forced labor impact factors in the next section.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="cleaning-code-for-environment-data.html#cb252-1" tabindex="-1"></a><span class="co"># summarize DAY1 AND DAY2</span></span>
<span id="cb252-2"><a href="cleaning-code-for-environment-data.html#cb252-2" tabindex="-1"></a>enviro_wide3 <span class="ot">&lt;-</span> enviro_wide2 <span class="sc">%&gt;%</span> </span>
<span id="cb252-3"><a href="cleaning-code-for-environment-data.html#cb252-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-4"><a href="cleaning-code-for-environment-data.html#cb252-4" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb252-5"><a href="cleaning-code-for-environment-data.html#cb252-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ghg_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(GHG_per_day_Consumed_1, GHG_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb252-6"><a href="cleaning-code-for-environment-data.html#cb252-6" tabindex="-1"></a>         <span class="at">ced_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(CED_per_day_Consumed_1, CED_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb252-7"><a href="cleaning-code-for-environment-data.html#cb252-7" tabindex="-1"></a>         <span class="at">water_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(WATER_per_day_Consumed_1, WATER_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb252-8"><a href="cleaning-code-for-environment-data.html#cb252-8" tabindex="-1"></a>         <span class="at">bluewater_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(BLUEWATER_per_day_Consumed_1, BLUEWATER_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb252-9"><a href="cleaning-code-for-environment-data.html#cb252-9" tabindex="-1"></a>         <span class="at">fl_impact_avg_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(FL_per_day_Consumed_1, FL_per_day_Consumed_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb252-10"><a href="cleaning-code-for-environment-data.html#cb252-10" tabindex="-1"></a>         </span>
<span id="cb252-11"><a href="cleaning-code-for-environment-data.html#cb252-11" tabindex="-1"></a>         <span class="at">consumed_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(consumed_per_day_1, consumed_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb252-12"><a href="cleaning-code-for-environment-data.html#cb252-12" tabindex="-1"></a>         <span class="at">inedible_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(inedible_per_day_1, inedible_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb252-13"><a href="cleaning-code-for-environment-data.html#cb252-13" tabindex="-1"></a>         <span class="at">wasted_avg =</span> <span class="fu">mean</span>(<span class="fu">c</span>(wasted_per_day_1, wasted_per_day_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb252-14"><a href="cleaning-code-for-environment-data.html#cb252-14" tabindex="-1"></a>  <span class="fu">select</span>(seqn, fcidcode, <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;ghg_impact_avg_&quot;</span>, <span class="st">&quot;ced_impact_avg_&quot;</span>, <span class="st">&quot;water_impact_avg_&quot;</span>, <span class="st">&quot;bluewater_impact_avg_&quot;</span>, <span class="st">&quot;fl_impact_avg_&quot;</span>)),</span>
<span id="cb252-15"><a href="cleaning-code-for-environment-data.html#cb252-15" tabindex="-1"></a>         consumed_avg, inedible_avg, wasted_avg)</span></code></pre></div>
<p>Import the FCID-to-dietary-factor mapping and join with enviro_wide so that we can later on summarize the impacts at the dietary factor (i.e., food group) level.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="cleaning-code-for-environment-data.html#cb253-1" tabindex="-1"></a><span class="co"># import fcid-diet factor mapping</span></span>
<span id="cb253-2"><a href="cleaning-code-for-environment-data.html#cb253-2" tabindex="-1"></a>new_map <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data_inputs/OTHER/dietfactor_to_fcid_mapping/DATA/FCID_to_dietaryfactor_mapping_01-09-2024_final.xlsx&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb253-3"><a href="cleaning-code-for-environment-data.html#cb253-3" tabindex="-1"></a>  <span class="fu">select</span>(FCID_Code, Foodgroup) <span class="sc">%&gt;%</span> </span>
<span id="cb253-4"><a href="cleaning-code-for-environment-data.html#cb253-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fcidcode =</span> FCID_Code,</span>
<span id="cb253-5"><a href="cleaning-code-for-environment-data.html#cb253-5" tabindex="-1"></a>         <span class="at">Foodgroup_FCID =</span> Foodgroup) <span class="sc">%&gt;%</span> </span>
<span id="cb253-6"><a href="cleaning-code-for-environment-data.html#cb253-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fcidcode =</span> <span class="fu">as.character</span>(fcidcode))</span>
<span id="cb253-7"><a href="cleaning-code-for-environment-data.html#cb253-7" tabindex="-1"></a></span>
<span id="cb253-8"><a href="cleaning-code-for-environment-data.html#cb253-8" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb253-9"><a href="cleaning-code-for-environment-data.html#cb253-9" tabindex="-1"></a>enviro_wide4 <span class="ot">&lt;-</span> enviro_wide3 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(new_map, <span class="at">by =</span> <span class="st">&quot;fcidcode&quot;</span>)</span>
<span id="cb253-10"><a href="cleaning-code-for-environment-data.html#cb253-10" tabindex="-1"></a></span>
<span id="cb253-11"><a href="cleaning-code-for-environment-data.html#cb253-11" tabindex="-1"></a><span class="co"># CHECK NA</span></span>
<span id="cb253-12"><a href="cleaning-code-for-environment-data.html#cb253-12" tabindex="-1"></a>enviro_wide4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(Foodgroup_FCID)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Rowwise: 
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, ghg_impact_avg_Consumed &lt;dbl&gt;, ced_impact_avg_Consumed &lt;dbl&gt;,
## #   water_impact_avg_Consumed &lt;dbl&gt;, bluewater_impact_avg_Consumed &lt;dbl&gt;, fl_impact_avg_Consumed &lt;dbl&gt;,
## #   consumed_avg &lt;dbl&gt;, inedible_avg &lt;dbl&gt;, wasted_avg &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="cleaning-code-for-environment-data.html#cb255-1" tabindex="-1"></a>enviro_wide4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(consumed_avg)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Rowwise: 
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, ghg_impact_avg_Consumed &lt;dbl&gt;, ced_impact_avg_Consumed &lt;dbl&gt;,
## #   water_impact_avg_Consumed &lt;dbl&gt;, bluewater_impact_avg_Consumed &lt;dbl&gt;, fl_impact_avg_Consumed &lt;dbl&gt;,
## #   consumed_avg &lt;dbl&gt;, inedible_avg &lt;dbl&gt;, wasted_avg &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="cleaning-code-for-environment-data.html#cb257-1" tabindex="-1"></a>enviro_wide4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(ghg_impact_avg_Consumed)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Rowwise: 
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, ghg_impact_avg_Consumed &lt;dbl&gt;, ced_impact_avg_Consumed &lt;dbl&gt;,
## #   water_impact_avg_Consumed &lt;dbl&gt;, bluewater_impact_avg_Consumed &lt;dbl&gt;, fl_impact_avg_Consumed &lt;dbl&gt;,
## #   consumed_avg &lt;dbl&gt;, inedible_avg &lt;dbl&gt;, wasted_avg &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="cleaning-code-for-environment-data.html#cb259-1" tabindex="-1"></a>enviro_wide4 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(fl_impact_avg_Consumed)) <span class="co">#none-good</span></span></code></pre></div>
<pre><code>## # A tibble: 0 × 11
## # Rowwise: 
## # ℹ 11 variables: seqn &lt;dbl&gt;, fcidcode &lt;chr&gt;, ghg_impact_avg_Consumed &lt;dbl&gt;, ced_impact_avg_Consumed &lt;dbl&gt;,
## #   water_impact_avg_Consumed &lt;dbl&gt;, bluewater_impact_avg_Consumed &lt;dbl&gt;, fl_impact_avg_Consumed &lt;dbl&gt;,
## #   consumed_avg &lt;dbl&gt;, inedible_avg &lt;dbl&gt;, wasted_avg &lt;dbl&gt;, Foodgroup_FCID &lt;chr&gt;</code></pre>
<p>Now add up the impacts per person, by dietary factor (food group).</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="cleaning-code-for-environment-data.html#cb261-1" tabindex="-1"></a>enviro_wide5 <span class="ot">&lt;-</span> enviro_wide4 <span class="sc">%&gt;%</span> </span>
<span id="cb261-2"><a href="cleaning-code-for-environment-data.html#cb261-2" tabindex="-1"></a>  <span class="fu">group_by</span>(seqn, Foodgroup_FCID) <span class="sc">%&gt;%</span> </span>
<span id="cb261-3"><a href="cleaning-code-for-environment-data.html#cb261-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ghg_impact_sum_Consumed =</span> <span class="fu">sum</span>(ghg_impact_avg_Consumed),</span>
<span id="cb261-4"><a href="cleaning-code-for-environment-data.html#cb261-4" tabindex="-1"></a>            <span class="at">ced_impact_sum_Consumed =</span> <span class="fu">sum</span>(ced_impact_avg_Consumed),</span>
<span id="cb261-5"><a href="cleaning-code-for-environment-data.html#cb261-5" tabindex="-1"></a>            <span class="at">water_impact_sum_Consumed =</span> <span class="fu">sum</span>(water_impact_avg_Consumed),</span>
<span id="cb261-6"><a href="cleaning-code-for-environment-data.html#cb261-6" tabindex="-1"></a>            <span class="at">bluewater_impact_sum_Consumed =</span> <span class="fu">sum</span>(bluewater_impact_avg_Consumed),</span>
<span id="cb261-7"><a href="cleaning-code-for-environment-data.html#cb261-7" tabindex="-1"></a>            <span class="at">fl_impact_sum_Consumed =</span> <span class="fu">sum</span>(fl_impact_avg_Consumed),</span>
<span id="cb261-8"><a href="cleaning-code-for-environment-data.html#cb261-8" tabindex="-1"></a>            </span>
<span id="cb261-9"><a href="cleaning-code-for-environment-data.html#cb261-9" tabindex="-1"></a>            <span class="at">consumed_sum =</span> <span class="fu">sum</span>(consumed_avg),</span>
<span id="cb261-10"><a href="cleaning-code-for-environment-data.html#cb261-10" tabindex="-1"></a>            <span class="at">inedible_sum =</span> <span class="fu">sum</span>(inedible_avg),</span>
<span id="cb261-11"><a href="cleaning-code-for-environment-data.html#cb261-11" tabindex="-1"></a>            <span class="at">wasted_sum =</span> <span class="fu">sum</span>(wasted_avg))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;seqn&#39;. You can override using the `.groups` argument.</code></pre>
<p>Now, repeat the same steps above specifically for sugar sweetened beverages.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="cleaning-code-for-environment-data.html#cb263-1" tabindex="-1"></a><span class="co"># average day 1 and day 2 impacts </span></span>
<span id="cb263-2"><a href="cleaning-code-for-environment-data.html#cb263-2" tabindex="-1"></a>ssb_wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(ssb_impact1, </span>
<span id="cb263-3"><a href="cleaning-code-for-environment-data.html#cb263-3" tabindex="-1"></a>                        <span class="at">id_cols =</span> seqn,</span>
<span id="cb263-4"><a href="cleaning-code-for-environment-data.html#cb263-4" tabindex="-1"></a>                        <span class="at">names_from =</span> dayrec,</span>
<span id="cb263-5"><a href="cleaning-code-for-environment-data.html#cb263-5" tabindex="-1"></a>                        <span class="at">values_from =</span> <span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">&quot;per_day&quot;</span>)))</span>
<span id="cb263-6"><a href="cleaning-code-for-environment-data.html#cb263-6" tabindex="-1"></a></span>
<span id="cb263-7"><a href="cleaning-code-for-environment-data.html#cb263-7" tabindex="-1"></a><span class="co"># join</span></span>
<span id="cb263-8"><a href="cleaning-code-for-environment-data.html#cb263-8" tabindex="-1"></a>ssb_wide1 <span class="ot">&lt;-</span> ssb_wide <span class="sc">%&gt;%</span> </span>
<span id="cb263-9"><a href="cleaning-code-for-environment-data.html#cb263-9" tabindex="-1"></a>  <span class="fu">left_join</span>(daysofintake, <span class="at">by =</span> <span class="st">&quot;seqn&quot;</span>)</span>
<span id="cb263-10"><a href="cleaning-code-for-environment-data.html#cb263-10" tabindex="-1"></a></span>
<span id="cb263-11"><a href="cleaning-code-for-environment-data.html#cb263-11" tabindex="-1"></a><span class="co"># fix 2 participants with duplicated data</span></span>
<span id="cb263-12"><a href="cleaning-code-for-environment-data.html#cb263-12" tabindex="-1"></a>ssb_wide1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(seqn <span class="sc">==</span> <span class="st">&quot;87444&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 19
## # Groups:   seqn [1]
##    seqn GHG_per_day_Consumed_ssb_2 GHG_per_day_Consumed_ssb_1 CED_per_day_Consumed_ssb_2 CED_per_day_Consumed_ssb_1
##   &lt;dbl&gt;                      &lt;dbl&gt;                      &lt;dbl&gt;                      &lt;dbl&gt;                      &lt;dbl&gt;
## 1 87444                         NA                     0.0106                         NA                      0.123
## 2 87444                         NA                     0.0106                         NA                      0.123
## # ℹ 14 more variables: WATER_per_day_Consumed_ssb_2 &lt;dbl&gt;, WATER_per_day_Consumed_ssb_1 &lt;dbl&gt;,
## #   BLUEWATER_per_day_Consumed_ssb_2 &lt;dbl&gt;, BLUEWATER_per_day_Consumed_ssb_1 &lt;dbl&gt;, FL_per_day_Consumed_ssb_2 &lt;dbl&gt;,
## #   FL_per_day_Consumed_ssb_1 &lt;dbl&gt;, consumed_per_day_ssb_2 &lt;dbl&gt;, consumed_per_day_ssb_1 &lt;dbl&gt;,
## #   inedible_per_day_ssb_2 &lt;dbl&gt;, inedible_per_day_ssb_1 &lt;dbl&gt;, wasted_per_day_ssb_2 &lt;dbl&gt;, wasted_per_day_ssb_1 &lt;dbl&gt;,
## #   daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="cleaning-code-for-environment-data.html#cb265-1" tabindex="-1"></a>ssb_wide1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(seqn <span class="sc">==</span> <span class="st">&quot;95147&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 19
## # Groups:   seqn [1]
##    seqn GHG_per_day_Consumed_ssb_2 GHG_per_day_Consumed_ssb_1 CED_per_day_Consumed_ssb_2 CED_per_day_Consumed_ssb_1
##   &lt;dbl&gt;                      &lt;dbl&gt;                      &lt;dbl&gt;                      &lt;dbl&gt;                      &lt;dbl&gt;
## 1 95147                         NA                     0.0340                         NA                      0.393
## 2 95147                         NA                     0.0340                         NA                      0.393
## # ℹ 14 more variables: WATER_per_day_Consumed_ssb_2 &lt;dbl&gt;, WATER_per_day_Consumed_ssb_1 &lt;dbl&gt;,
## #   BLUEWATER_per_day_Consumed_ssb_2 &lt;dbl&gt;, BLUEWATER_per_day_Consumed_ssb_1 &lt;dbl&gt;, FL_per_day_Consumed_ssb_2 &lt;dbl&gt;,
## #   FL_per_day_Consumed_ssb_1 &lt;dbl&gt;, consumed_per_day_ssb_2 &lt;dbl&gt;, consumed_per_day_ssb_1 &lt;dbl&gt;,
## #   inedible_per_day_ssb_2 &lt;dbl&gt;, inedible_per_day_ssb_1 &lt;dbl&gt;, wasted_per_day_ssb_2 &lt;dbl&gt;, wasted_per_day_ssb_1 &lt;dbl&gt;,
## #   daysintake &lt;dbl&gt;, reliable &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="cleaning-code-for-environment-data.html#cb267-1" tabindex="-1"></a>ssb_wide2 <span class="ot">&lt;-</span> </span>
<span id="cb267-2"><a href="cleaning-code-for-environment-data.html#cb267-2" tabindex="-1"></a>  ssb_wide1 <span class="sc">%&gt;%</span> </span>
<span id="cb267-3"><a href="cleaning-code-for-environment-data.html#cb267-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(seqn <span class="sc">==</span> <span class="st">&quot;87444&quot;</span> <span class="sc">&amp;</span> reliable <span class="sc">==</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb267-4"><a href="cleaning-code-for-environment-data.html#cb267-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(seqn <span class="sc">==</span> <span class="st">&quot;95147&quot;</span> <span class="sc">&amp;</span> reliable <span class="sc">==</span> <span class="dv">4</span>))</span>
<span id="cb267-5"><a href="cleaning-code-for-environment-data.html#cb267-5" tabindex="-1"></a></span>
<span id="cb267-6"><a href="cleaning-code-for-environment-data.html#cb267-6" tabindex="-1"></a><span class="co"># add 0s when appropriate</span></span>
<span id="cb267-7"><a href="cleaning-code-for-environment-data.html#cb267-7" tabindex="-1"></a>ssb_wide3 <span class="ot">&lt;-</span> ssb_wide2 <span class="sc">%&gt;%</span> </span>
<span id="cb267-8"><a href="cleaning-code-for-environment-data.html#cb267-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="co"># day 2</span></span>
<span id="cb267-9"><a href="cleaning-code-for-environment-data.html#cb267-9" tabindex="-1"></a>    <span class="at">GHG_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(GHG_per_day_Consumed_ssb_2), <span class="dv">0</span>, GHG_per_day_Consumed_ssb_2),</span>
<span id="cb267-10"><a href="cleaning-code-for-environment-data.html#cb267-10" tabindex="-1"></a>    <span class="at">CED_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(CED_per_day_Consumed_ssb_2), <span class="dv">0</span>, CED_per_day_Consumed_ssb_2),</span>
<span id="cb267-11"><a href="cleaning-code-for-environment-data.html#cb267-11" tabindex="-1"></a>    <span class="at">WATER_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(WATER_per_day_Consumed_ssb_2), <span class="dv">0</span>, WATER_per_day_Consumed_ssb_2),</span>
<span id="cb267-12"><a href="cleaning-code-for-environment-data.html#cb267-12" tabindex="-1"></a>    <span class="at">BLUEWATER_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(BLUEWATER_per_day_Consumed_ssb_2), <span class="dv">0</span>, BLUEWATER_per_day_Consumed_ssb_2),</span>
<span id="cb267-13"><a href="cleaning-code-for-environment-data.html#cb267-13" tabindex="-1"></a>    <span class="at">FL_per_day_Consumed_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_per_day_Consumed_ssb_2), <span class="dv">0</span>, FL_per_day_Consumed_ssb_2),</span>
<span id="cb267-14"><a href="cleaning-code-for-environment-data.html#cb267-14" tabindex="-1"></a>    </span>
<span id="cb267-15"><a href="cleaning-code-for-environment-data.html#cb267-15" tabindex="-1"></a>    <span class="at">consumed_per_day_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_ssb_2), <span class="dv">0</span>, consumed_per_day_ssb_2),</span>
<span id="cb267-16"><a href="cleaning-code-for-environment-data.html#cb267-16" tabindex="-1"></a>    <span class="at">wasted_per_day_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_ssb_2), <span class="dv">0</span>, wasted_per_day_ssb_2),</span>
<span id="cb267-17"><a href="cleaning-code-for-environment-data.html#cb267-17" tabindex="-1"></a>    <span class="at">inedible_per_day_ssb_2 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_ssb_2), <span class="dv">0</span>, inedible_per_day_ssb_2),</span>
<span id="cb267-18"><a href="cleaning-code-for-environment-data.html#cb267-18" tabindex="-1"></a>    </span>
<span id="cb267-19"><a href="cleaning-code-for-environment-data.html#cb267-19" tabindex="-1"></a>    <span class="co"># day1</span></span>
<span id="cb267-20"><a href="cleaning-code-for-environment-data.html#cb267-20" tabindex="-1"></a>    <span class="at">GHG_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(GHG_per_day_Consumed_ssb_1), <span class="dv">0</span>, GHG_per_day_Consumed_ssb_1),</span>
<span id="cb267-21"><a href="cleaning-code-for-environment-data.html#cb267-21" tabindex="-1"></a>    <span class="at">CED_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(CED_per_day_Consumed_ssb_1), <span class="dv">0</span>, CED_per_day_Consumed_ssb_1),</span>
<span id="cb267-22"><a href="cleaning-code-for-environment-data.html#cb267-22" tabindex="-1"></a>    <span class="at">WATER_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(WATER_per_day_Consumed_ssb_1), <span class="dv">0</span>, WATER_per_day_Consumed_ssb_1),</span>
<span id="cb267-23"><a href="cleaning-code-for-environment-data.html#cb267-23" tabindex="-1"></a>    <span class="at">BLUEWATER_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(BLUEWATER_per_day_Consumed_ssb_1), <span class="dv">0</span>, BLUEWATER_per_day_Consumed_ssb_1),</span>
<span id="cb267-24"><a href="cleaning-code-for-environment-data.html#cb267-24" tabindex="-1"></a>    <span class="at">FL_per_day_Consumed_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(FL_per_day_Consumed_ssb_1), <span class="dv">0</span>, FL_per_day_Consumed_ssb_1),</span>
<span id="cb267-25"><a href="cleaning-code-for-environment-data.html#cb267-25" tabindex="-1"></a>    </span>
<span id="cb267-26"><a href="cleaning-code-for-environment-data.html#cb267-26" tabindex="-1"></a>    <span class="at">consumed_per_day_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(consumed_per_day_ssb_1), <span class="dv">0</span>, consumed_per_day_ssb_1),</span>
<span id="cb267-27"><a href="cleaning-code-for-environment-data.html#cb267-27" tabindex="-1"></a>    <span class="at">wasted_per_day_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(wasted_per_day_ssb_1), <span class="dv">0</span>, wasted_per_day_ssb_1),</span>
<span id="cb267-28"><a href="cleaning-code-for-environment-data.html#cb267-28" tabindex="-1"></a>    <span class="at">inedible_per_day_ssb_1 =</span> <span class="fu">ifelse</span>(daysintake <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(inedible_per_day_ssb_1), <span class="dv">0</span>, inedible_per_day_ssb_1))</span>
<span id="cb267-29"><a href="cleaning-code-for-environment-data.html#cb267-29" tabindex="-1"></a></span>
<span id="cb267-30"><a href="cleaning-code-for-environment-data.html#cb267-30" tabindex="-1"></a><span class="co"># summarize DAY1 AND DAY2</span></span>
<span id="cb267-31"><a href="cleaning-code-for-environment-data.html#cb267-31" tabindex="-1"></a>ssb_wide4 <span class="ot">&lt;-</span> ssb_wide3 <span class="sc">%&gt;%</span> </span>
<span id="cb267-32"><a href="cleaning-code-for-environment-data.html#cb267-32" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb267-33"><a href="cleaning-code-for-environment-data.html#cb267-33" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb267-34"><a href="cleaning-code-for-environment-data.html#cb267-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ghg_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(GHG_per_day_Consumed_ssb_1, GHG_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb267-35"><a href="cleaning-code-for-environment-data.html#cb267-35" tabindex="-1"></a>         <span class="at">ced_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(CED_per_day_Consumed_ssb_1, CED_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb267-36"><a href="cleaning-code-for-environment-data.html#cb267-36" tabindex="-1"></a>         <span class="at">water_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(WATER_per_day_Consumed_ssb_1, WATER_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb267-37"><a href="cleaning-code-for-environment-data.html#cb267-37" tabindex="-1"></a>         <span class="at">bluewater_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(BLUEWATER_per_day_Consumed_ssb_1, BLUEWATER_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb267-38"><a href="cleaning-code-for-environment-data.html#cb267-38" tabindex="-1"></a>         <span class="at">fl_impact_sum_Consumed =</span> <span class="fu">mean</span>(<span class="fu">c</span>(FL_per_day_Consumed_ssb_1, FL_per_day_Consumed_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb267-39"><a href="cleaning-code-for-environment-data.html#cb267-39" tabindex="-1"></a>         </span>
<span id="cb267-40"><a href="cleaning-code-for-environment-data.html#cb267-40" tabindex="-1"></a>         <span class="at">consumed_sum =</span> <span class="fu">mean</span>(<span class="fu">c</span>(consumed_per_day_ssb_1, consumed_per_day_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb267-41"><a href="cleaning-code-for-environment-data.html#cb267-41" tabindex="-1"></a>         <span class="at">inedible_sum =</span> <span class="fu">mean</span>(<span class="fu">c</span>(inedible_per_day_ssb_1, inedible_per_day_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb267-42"><a href="cleaning-code-for-environment-data.html#cb267-42" tabindex="-1"></a>         <span class="at">wasted_sum =</span> <span class="fu">mean</span>(<span class="fu">c</span>(wasted_per_day_ssb_1, wasted_per_day_ssb_2), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb267-43"><a href="cleaning-code-for-environment-data.html#cb267-43" tabindex="-1"></a>  <span class="fu">select</span>(seqn, ghg_impact_sum_Consumed, ced_impact_sum_Consumed, water_impact_sum_Consumed, bluewater_impact_sum_Consumed, fl_impact_sum_Consumed,</span>
<span id="cb267-44"><a href="cleaning-code-for-environment-data.html#cb267-44" tabindex="-1"></a>         consumed_sum, inedible_sum, wasted_sum) <span class="sc">%&gt;%</span> </span>
<span id="cb267-45"><a href="cleaning-code-for-environment-data.html#cb267-45" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Foodgroup_FCID =</span> <span class="st">&quot;ssb&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-46"><a href="cleaning-code-for-environment-data.html#cb267-46" tabindex="-1"></a>  <span class="fu">relocate</span>(Foodgroup_FCID, <span class="at">.after =</span> <span class="st">&quot;seqn&quot;</span>)</span></code></pre></div>
<p>Combine the food and SSB datasets together, then transform to wide format.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="cleaning-code-for-environment-data.html#cb268-1" tabindex="-1"></a><span class="co"># rbind with rest of data</span></span>
<span id="cb268-2"><a href="cleaning-code-for-environment-data.html#cb268-2" tabindex="-1"></a>enviro_wide6 <span class="ot">&lt;-</span> </span>
<span id="cb268-3"><a href="cleaning-code-for-environment-data.html#cb268-3" tabindex="-1"></a>  <span class="fu">rbind</span>(enviro_wide5, ssb_wide4) <span class="sc">%&gt;%</span> </span>
<span id="cb268-4"><a href="cleaning-code-for-environment-data.html#cb268-4" tabindex="-1"></a>  <span class="fu">arrange</span>(seqn, Foodgroup_FCID)</span>
<span id="cb268-5"><a href="cleaning-code-for-environment-data.html#cb268-5" tabindex="-1"></a></span>
<span id="cb268-6"><a href="cleaning-code-for-environment-data.html#cb268-6" tabindex="-1"></a><span class="co"># transform to wide</span></span>
<span id="cb268-7"><a href="cleaning-code-for-environment-data.html#cb268-7" tabindex="-1"></a>enviro_wide7 <span class="ot">&lt;-</span> enviro_wide6 <span class="sc">%&gt;%</span> </span>
<span id="cb268-8"><a href="cleaning-code-for-environment-data.html#cb268-8" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> seqn,</span>
<span id="cb268-9"><a href="cleaning-code-for-environment-data.html#cb268-9" tabindex="-1"></a>              <span class="at">names_from =</span> Foodgroup_FCID,</span>
<span id="cb268-10"><a href="cleaning-code-for-environment-data.html#cb268-10" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="sc">!</span><span class="fu">c</span>(seqn, Foodgroup_FCID)) <span class="sc">%&gt;%</span> </span>
<span id="cb268-11"><a href="cleaning-code-for-environment-data.html#cb268-11" tabindex="-1"></a>  <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)</span>
<span id="cb268-12"><a href="cleaning-code-for-environment-data.html#cb268-12" tabindex="-1"></a></span>
<span id="cb268-13"><a href="cleaning-code-for-environment-data.html#cb268-13" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb268-14"><a href="cleaning-code-for-environment-data.html#cb268-14" tabindex="-1"></a>enviro_wide7 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;ssb&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## Adding missing grouping variables: `seqn`</code></pre>
<pre><code>## # A tibble: 6 × 9
## # Groups:   seqn [6]
##    seqn ghg_impact_sum_Consumed_ssb ced_impact_sum_Consumed_ssb water_impact_sum_Consumed_ssb bluewater_impact_sum_Con…¹
##   &lt;dbl&gt;                       &lt;dbl&gt;                       &lt;dbl&gt;                         &lt;dbl&gt;                      &lt;dbl&gt;
## 1 83732                     0.00715                      0.0721                          12.9                       2.66
## 2 83733                     0                            0                                0                         0   
## 3 83734                     0                            0                                0                         0   
## 4 83735                     0                            0                                0                         0   
## 5 83736                     0.0375                       0.417                           19.0                       5.71
## 6 83737                     0                            0                                0                         0   
## # ℹ abbreviated name: ¹​bluewater_impact_sum_Consumed_ssb
## # ℹ 4 more variables: fl_impact_sum_Consumed_ssb &lt;dbl&gt;, consumed_sum_ssb &lt;dbl&gt;, inedible_sum_ssb &lt;dbl&gt;,
## #   wasted_sum_ssb &lt;dbl&gt;</code></pre>
<p>Export datasets to the temporary folder, so they can be used to calculate the impact factors in the next section.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="cleaning-code-for-environment-data.html#cb271-1" tabindex="-1"></a><span class="fu">saveRDS</span>(both_days15, <span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/both_days15_env.rds&quot;</span>)</span>
<span id="cb271-2"><a href="cleaning-code-for-environment-data.html#cb271-2" tabindex="-1"></a><span class="fu">saveRDS</span>(enviro_wide7, <span class="st">&quot;data_inputs/IMPACT_FACTORS/temp_data/enviro_input_dat.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cleaning-code-for-health-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cleaning-code-for-cost-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-cleaning-code-enviro.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
